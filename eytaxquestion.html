<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Blob vs. MongoDB for Tax Questionnaires</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23001E2B'/><path d='M16 4 L18 14 L16 28 L14 14 Z' fill='%2300ED64'/><ellipse cx='16' cy='14' rx='3' ry='5' fill='%2300ED64'/></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F172A; /* bg-slate-900 */
        }
        .card {
            background-color: #1E293B; /* bg-slate-800 */
            border: 1px solid #334155; /* border-slate-700 */
            border-radius: 0.5rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .code-block {
            background-color: #020617; /* bg-slate-950 */
            color: #E2E8F0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            flex-grow: 1;
        }
        .highlight-query {
            background-color: rgba(59, 130, 246, 0.2);
            border-left: 4px solid #3B82F6;
            padding-left: 8px;
            margin-left: -12px;
            transition: all 0.3s ease-in-out;
            border-radius: 4px;
        }
        .highlight-prefill {
            background-color: rgba(16, 185, 129, 0.2);
            border-left: 4px solid #10B981;
            padding-left: 8px;
            margin-left: -12px;
            transition: all 0.3s ease-in-out;
            border-radius: 4px;
        }
        .json-key { color: #93C5FD; }
        .json-string { color: #A5B4FC; }
        .json-number { color: #FBBF24; }
        .json-boolean { color: #F87171; }
        .json-null { color: #9CA3AF; }
        .json-brace { color: #CBD5E1; }
        .btn {
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
            text-align: center;
        }
        .btn-red { background-color: #DC2626; color: white; }
        .btn-red:hover { background-color: #B91C1C; }
        .btn-green { background-color: #16A34A; color: white; }
        .btn-green:hover { background-color: #15803D; }
    </style>
</head>
<body class="text-slate-200">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">From Rigid Blobs to Rich Documents</h1>
            <p class="text-lg text-slate-400 max-w-3xl mx-auto">How MongoDB can transform Tax Questionnare storage and retrieval</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- SQL Blob Approach -->
            <div class="card">
                <div class="flex items-center gap-3 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#F87171" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 8v4l3 3"/></svg>
                    <h2 class="text-2xl font-bold text-white">The Old Way: SQL Blob</h2>
                </div>
                <p class="text-slate-400 mb-4">The entire questionnaire is a single text blob. To find specific data, you must fetch the <strong class="text-red-400">entire blob</strong> and parse it in your application, which is slow and inefficient.</p>
                <div class="code-block" id="sql-blob-container">
                    <span class="text-gray-400">// Table: EmployeeTaxForms</span><br>
                    <span class="text-gray-400">// Column: QuestionnaireData (TEXT/NVARCHAR(MAX))</span><br><br>
                    <div id="sql-blob-content" class="transition-all duration-300"></div>
                </div>
                 <div class="mt-4">
                    <label class="block text-sm font-medium text-slate-300 mb-2">Simulate a Query:</label>
                    <p class="text-xs text-slate-500 mb-2">Notice how the entire blob has to be fetched, regardless of how small your query is.</p>
                    <button id="sql-query-btn" class="btn btn-red w-full"></button>
                </div>
            </div>

            <!-- MongoDB Document Approach -->
            <div class="card">
                 <div class="flex items-center gap-3 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    <h2 class="text-2xl font-bold text-white">The Better Way: MongoDB</h2>
                </div>
                <p class="text-slate-400 mb-4">Each questionnaire is a rich document. The database understands its structure, allowing for <strong class="text-green-400">powerful, efficient queries</strong> and flexible, country-specific schemas.</p>
                
                <div class="mb-4">
                    <label for="country-selector" class="block text-sm font-medium text-slate-300 mb-2">View a tax form from a different country:</label>
                    <select id="country-selector" class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <option value="USA">USA</option>
                        <option value="India">India</option>
                        <option value="UK">UK</option>
                        <option value="Australia">Australia</option>
                    </select>
                </div>

                <div class="code-block mb-4" id="mongodb-doc-container"></div>

                <div class="space-y-4">
                    <div>
                        <label for="mongo-query-selector" class="block text-sm font-medium text-slate-300 mb-2">Run an Efficient Query:</label>
                        <select id="mongo-query-selector" class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 mb-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"></select>
                        <div class="code-block text-sm" id="mongo-query-display">
                            <span class="text-slate-500">Select a query to see the code here...</span>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-slate-300 mb-2">Use Case: Pre-fill Next Year's Form</h3>
                        <p class="text-xs text-slate-500 mb-2">Easily fetch just the repeatable data (like personal info) to pre-populate the form for the user next year, improving user experience.</p>
                         <button id="prefill-btn" class="btn btn-green w-full">
                            Pre-fill 2024 Form
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STORE ---
        // This object simulates your database, holding different document structures for each country.
        const taxData = {
            USA: {
                queries: [
                    {
                        description: "Find users with donations > $1,500",
                        query: { "deductions.donations": { "$gt": 1500 } },
                        highlightSelector: '[data-path="deductions.donations"]'
                    },
                    {
                        description: "Find users with a dependent named 'Jane Doe'",
                        query: { "dependents": { "$elemMatch": { "name": "Jane Doe" } } },
                        highlightSelector: '[data-path^="dependents"]'
                    }
                ],
                prefillFields: ['personalInfo', 'userId', 'country'],
                document: {
                    _id: "ObjectId('67a...')",
                    userId: "emp-us-123",
                    country: "USA",
                    year: 2023,
                    personalInfo: {
                        firstName: "John",
                        lastName: "Doe",
                        ssn: "XXX-XX-XXXX",
                        address: "123 Main St, Anytown"
                    },
                    income: { w2: 85000, investments: 5200 },
                    deductions: { type: "itemized", mortgageInterest: 12000, donations: 1800, stateTaxes: 4500 },
                    dependents: [
                        { name: "Jane Doe", age: 10, relation: "Daughter" }
                    ]
                }
            },
            India: {
                queries: [
                    {
                        description: "Find users claiming 80C deductions",
                        query: { "deductions.80C": { "$exists": true } },
                        highlightSelector: '[data-path="deductions.80C"]'
                    }
                ],
                prefillFields: ['personalInfo', 'userId', 'country'],
                document: {
                    _id: "ObjectId('b3f...')",
                    userId: "emp-in-456",
                    country: "India",
                    year: 2023,
                    personalInfo: { firstName: "Priya", lastName: "Singh", panNumber: "ABCDE1234F", aadhaar: "XXXX-XXXX-1234" },
                    income: { salary: 1200000, otherSources: 50000 },
                    deductions: { "80C": 150000, "80D": 25000, hra: 100000 }
                }
            },
            UK: {
                queries: [
                    {
                        description: "Find users with PAYE income > Â£50,000",
                        query: { "income.paye": { "$gt": 50000 } },
                        highlightSelector: '[data-path="income.paye"]'
                    }
                ],
                prefillFields: ['personalInfo', 'userId', 'country'],
                document: {
                    _id: "ObjectId('c1e...')",
                    userId: "emp-uk-789",
                    country: "UK",
                    year: 2023,
                    personalInfo: { firstName: "David", lastName: "Smith", niNumber: "QQ123456C" },
                    income: { paye: 65000, selfEmployed: 0 },
                    allowances: { personalAllowance: 12570, pensionContributions: 5000 }
                }
            },
            Australia: {
                queries: [
                    {
                        description: "Find users with voluntary super contributions",
                        query: { "superannuation.voluntary": { "$gt": 0 } },
                        highlightSelector: '[data-path="superannuation.voluntary"]'
                    }
                ],
                prefillFields: ['personalInfo', 'userId', 'country'],
                document: {
                    _id: "ObjectId('d9a...')",
                    userId: "emp-au-101",
                    country: "Australia",
                    year: 2023,
                    personalInfo: { firstName: "Emily", lastName: "Jones", tfn: "123-456-789" },
                    income: { grossSalary: 95000 },
                    superannuation: { compulsory: 9975, voluntary: 2000 },
                    levies: { medicare: 1900 }
                }
            }
        };

        // --- DOM ELEMENTS ---
        const countrySelector = document.getElementById('country-selector');
        const mongoQuerySelector = document.getElementById('mongo-query-selector');
        const mongoDocContainer = document.getElementById('mongodb-doc-container');
        const mongoQueryDisplay = document.getElementById('mongo-query-display');
        const prefillBtn = document.getElementById('prefill-btn');
        const sqlBlobContent = document.getElementById('sql-blob-content');
        const sqlQueryBtn = document.getElementById('sql-query-btn');
        const sqlBlobContainer = document.getElementById('sql-blob-container');

        // --- FUNCTIONS ---

        /**
         * Formats and syntax-highlights a JSON object for display.
         * @param {any} data - The data to format.
         * @param {number} indentLevel - The current indentation level.
         * @param {string} path - The current path for data attributes.
         * @returns {string} - The formatted HTML string.
         */
        function formatJson(data, indentLevel = 0, path = '') {
            const indent = '&nbsp;&nbsp;'.repeat(indentLevel);
            if (data === null) return `<span class="json-null">null</span>`;
            if (typeof data !== 'object') {
                if (typeof data === 'string') return `<span class="json-string">"${data}"</span>`;
                if (typeof data === 'number') return `<span class="json-number">${data}</span>`;
                if (typeof data === 'boolean') return `<span class="json-boolean">${data}</span>`;
                return data;
            }

            let html = Array.isArray(data) ? '[<br>' : '{<br>';
            const keys = Object.keys(data);
            keys.forEach((key, index) => {
                const value = data[key];
                const newPath = path ? `${path}.${key}` : key;
                const isLast = index === keys.length - 1;
                const keyDisplay = Array.isArray(data) ? '' : `<span class="json-key">"${key}"</span>: `;
                
                html += `${indent}&nbsp;&nbsp;<span data-path="${newPath}">${keyDisplay}${formatJson(value, indentLevel + 1, newPath)}</span>${isLast ? '' : ','}<br>`;
            });
            html += indent + (Array.isArray(data) ? ']' : '}');
            return html;
        }
        
        /** Clears any existing highlights from the document. */
        function clearHighlights() {
            mongoDocContainer.querySelectorAll('span[data-path]').forEach(el => {
                el.classList.remove('highlight-query', 'highlight-prefill');
            });
            sqlBlobContainer.classList.remove('highlight-query');
        }

        /** Updates the entire view based on the selected country. */
        function updateView() {
            clearHighlights();
            const country = countrySelector.value;
            const data = taxData[country];

            // Update MongoDB document view
            mongoDocContainer.innerHTML = formatJson(data.document);
            
            // Update SQL blob view
            sqlBlobContent.textContent = JSON.stringify(data.document, null, 2);
            sqlQueryBtn.textContent = data.queries[0].description;

            // Update MongoDB query selector
            mongoQuerySelector.innerHTML = `<option value="-1" disabled selected>Select a query to run...</option>`;
            data.queries.forEach((q, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = q.description;
                mongoQuerySelector.appendChild(option);
            });
            mongoQueryDisplay.innerHTML = `<span class="text-slate-500">Select a query to see the code here...</span>`;
        }

        // --- EVENT LISTENERS ---

        countrySelector.addEventListener('change', updateView);

        mongoQuerySelector.addEventListener('change', (e) => {
            clearHighlights();
            const country = countrySelector.value;
            const queryIndex = e.target.value;

            if (queryIndex === "-1") {
                 mongoQueryDisplay.innerHTML = `<span class="text-slate-500">Select a query to see the code here...</span>`;
                return;
            }
            
            const queryData = taxData[country].queries[queryIndex];
            mongoQueryDisplay.innerHTML = `// db.forms.find(<br>${formatJson(queryData.query, 1)}<br>// )`;
            
            const elementToHighlight = mongoDocContainer.querySelector(queryData.highlightSelector);
            if (elementToHighlight) {
                elementToHighlight.classList.add('highlight-query');
                elementToHighlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        prefillBtn.addEventListener('click', () => {
            clearHighlights();
            const country = countrySelector.value;
            const data = taxData[country];
            
            data.prefillFields.forEach(field => {
                const elements = mongoDocContainer.querySelectorAll(`[data-path^="${field}"]`);
                elements.forEach(el => el.classList.add('highlight-prefill'));
            });
            
            const firstHighlight = mongoDocContainer.querySelector('.highlight-prefill');
            if (firstHighlight) {
                firstHighlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        sqlQueryBtn.addEventListener('click', () => {
            clearHighlights();
            sqlBlobContainer.classList.add('highlight-query');
            setTimeout(() => sqlBlobContainer.classList.remove('highlight-query'), 1500);
        });

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', updateView);
    </script>
</body>
</html>
