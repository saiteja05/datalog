<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Strategic Architecture Decision Matrix</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EMongoDB%3C/title%3E%3Cpath fill='%2300ED64' d='M17.193 9.555c-1.264-5.58-4.252-7.414-4.573-8.115-.28-.394-.53-.954-.735-1.44-.036.495-.055.685-.523 1.184-.723.566-4.438 3.682-4.74 10.02-.282 5.912 4.27 9.435 4.888 9.884l.07.05A73.49 73.49 0 0111.91 24h.481c.114-1.032.284-2.056.51-3.07.417-.296.604-.463.85-.693a11.342 11.342 0 003.639-8.464c.01-.814-.103-1.662-.197-2.218zm-5.336 8.195s0-8.291.275-8.29c.213 0 .49 10.695.49 10.695-.381-.045-.765-1.76-.765-2.405z'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    
    <style>
        /* --- CORE STYLES --- */
        :root {
            --bg-primary: #0a1929;
            --bg-secondary: #1a2332;
            --bg-tertiary: #001e2b;
            --bg-surface: rgba(255, 255, 255, 0.95);
            --bg-surface-gradient: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            --bg-header: linear-gradient(135deg, #001E2B 0%, #003547 100%);
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-dark: #001e2b;
            --text-muted: #2c3e50;
            --accent-green: #00ED64;
            --accent-green-dark: #4DB33D;
            --shadow-color: rgba(0,0,0,0.4);
            --shadow-light: rgba(0,0,0,0.2);
            --border-color: rgba(77,179,61,0.2);
            --grid-color: #2a3f54;
            --control-bg: rgba(255, 255, 255, 0.95);
            --control-text: #001e2b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            background-color: #0a1929; /* Immediate dark background */
        }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            transition: background 0.3s ease;
        }

        /* --- HEADER --- */
        header { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 70px; 
            background: linear-gradient(135deg, #001E2B 0%, #003547 100%);
            color: white; 
            display: flex; 
            align-items: center; 
            padding: 0 30px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.4), 0 0 40px rgba(77,179,61,0.1);
            z-index: 100;
            border-bottom: 1px solid rgba(77,179,61,0.2);
        }
        h1 { 
            margin: 0; 
            font-size: 1.5rem; 
            font-weight: 700; 
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { 
            margin-left: 20px; 
            font-size: 0.9rem; 
            color: #00ED64;
            font-weight: 600;
            border-left: 2px solid #00ED64; 
            padding-left: 20px; 
            letter-spacing: 0.5px;
        }

        /* --- DIAGRAM CONTAINER --- */
        #diagram-container { 
            position: relative;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 237, 100, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(77, 179, 61, 0.05) 0%, transparent 50%),
                radial-gradient(#2a3f54 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 30px 30px;
            overflow: hidden; 
            transition: margin-right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .mermaid { 
            width: 100%; 
            height: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            opacity: 0;
            animation: fadeIn 0.6s ease forwards;
        }
        .mermaid svg { 
            height: 100% !important; 
            width: 100% !important; 
            max-width: none !important;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }



        /* --- CONTROLS --- */
        .controls { 
            position: absolute; 
            bottom: 30px; 
            left: 30px; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px; 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            z-index: 90;
        }
        button.ctrl-btn { 
            width: 48px; 
            height: 48px; 
            border: none;
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 1.5rem; 
            color: #001e2b;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        button.ctrl-btn::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #00ED64 0%, #4DB33D 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        button.ctrl-btn:hover::before { opacity: 0.15; }
        button.ctrl-btn:hover { 
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 16px rgba(0,237,100,0.3);
        }
        button.ctrl-btn:active {
            transform: translateY(0) scale(0.98);
        }
        button.ctrl-btn span {
            position: relative;
            z-index: 1;
        }

        /* --- LEGEND --- */
        .legend { 
            position: absolute; 
            top: 90px; 
            left: 30px; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px; 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
            font-size: 0.9rem; 
            z-index: 90;
            min-width: 240px;
        }
        .legend strong {
            display: block;
            font-size: 1rem;
            font-weight: 700;
            color: #001e2b;
            margin-bottom: 16px;
            letter-spacing: -0.3px;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            margin-bottom: 12px; 
            color: #2c3e50;
            font-weight: 500;
            transition: transform 0.2s ease;
        }
        .legend-item:hover {
            transform: translateX(4px);
        }
        .dot { 
            width: 16px; 
            height: 16px; 
            border-radius: 5px; 
            margin-right: 14px;
            transition: transform 0.2s ease;
        }
        .legend-item:hover .dot {
            transform: scale(1.2);
        }
        .l-value { 
            background: linear-gradient(135deg, #00ED64 0%, #4DB33D 100%);
            border: none;
            box-shadow: 0 2px 8px rgba(0,237,100,0.3);
        }
        .l-tech { 
            background: #E3F2FD;
            border: 1px solid #1565C0;
        }
        .l-scale {
            background: #FFF3E0;
            border: 1px solid #EF6C00;
        }
        .l-plat {
            background: #F3E5F5;
            border: 1px solid #7B1FA2;
        }
        .l-deploy {
            background: #E8F5E9;
            border: 1px solid #2E7D32;
        }
        .l-start {
            background: #333;
            border: 1px solid #000;
        }
        .l-exit {
            background: #F5F5F5;
            border: 1px dashed #616161;
        }
        .l-final {
            background: #DEFFF8;
            border: 1px solid #46EDC8;
        }

        /* --- SIDE DRAWER --- */
        #side-drawer {
            position: fixed;
            top: 70px;
            right: -450px;
            width: 420px;
            bottom: 0;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            box-shadow: -8px 0 40px rgba(0,0,0,0.3);
            z-index: 200;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(0,237,100,0.2);
        }

        #side-drawer.open { right: 0; }

        .drawer-header {
            background: linear-gradient(135deg, #001E2B 0%, #003547 100%);
            padding: 28px 32px;
            border-bottom: 1px solid rgba(0,237,100,0.2);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .drawer-header h2 { 
            margin: 0; 
            font-size: 1.4rem; 
            color: #ffffff;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        .close-btn { 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 1.6rem; 
            color: #ffffff;
            cursor: pointer; 
            padding: 0; 
            line-height: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover { 
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        .drawer-body { 
            padding: 32px; 
            overflow-y: auto; 
            flex-grow: 1;
        }

        .drawer-body::-webkit-scrollbar {
            width: 8px;
        }
        .drawer-body::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        .drawer-body::-webkit-scrollbar-thumb {
            background: rgba(0,237,100,0.3);
            border-radius: 4px;
        }
        .drawer-body::-webkit-scrollbar-thumb:hover {
            background: rgba(0,237,100,0.5);
        }

        .value-prop-box {
            background: linear-gradient(135deg, #E8F5E9 0%, #f1f8f4 100%);
            border-left: 4px solid #00ED64;
            padding: 24px;
            margin-bottom: 28px;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 4px 12px rgba(0,237,100,0.1);
        }
        .value-label { 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            color: #2d7a4d;
            font-weight: 800;
            display: block; 
            margin-bottom: 10px; 
            letter-spacing: 1px;
        }
        .value-text { 
            font-size: 1.2rem; 
            color: #001e2b;
            font-weight: 700;
            line-height: 1.5;
        }

        .details-text { 
            color: #34495e;
            line-height: 1.8;
            font-size: 0.95rem; 
            margin-bottom: 32px;
        }

        .doc-link {
            display: block;
            text-align: center;
            background: linear-gradient(135deg, #001E2B 0%, #003547 100%);
            color: white;
            padding: 14px 24px;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,30,43,0.3);
            position: relative;
            overflow: hidden;
        }
        .doc-link::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #00ED64 0%, #4DB33D 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .doc-link:hover::before {
            opacity: 1;
        }
        .doc-link:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,237,100,0.4);
        }
        .doc-link span {
            position: relative;
            z-index: 1;
        }
        .no-link { 
            background: #e0e0e0;
            color: #999; 
            pointer-events: none;
            box-shadow: none;
        }

        /* --- MONGODB LEAF LOGO --- */
        .mongodb-leaf {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 100px;
            height: 100px;
            opacity: 0.2;
            pointer-events: none;
            z-index: 85;
            transition: opacity 0.3s ease;
        }

        /* --- DUAL MODE INTERFACE --- */
        /* Mode Tabs */
        .mode-tabs {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 6px;
            z-index: 95;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .mode-tab {
            padding: 12px 30px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mode-tab:hover {
            color: #fff;
            background: rgba(255,255,255,0.1);
        }
        
        .mode-tab.active {
            background: linear-gradient(135deg, #00ED64 0%, #4DB33D 100%);
            color: #001e2b;
            box-shadow: 0 4px 15px rgba(0,237,100,0.4);
        }

        /* Mode Containers */
        .mode-container {
            position: absolute;
            top: 140px;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }
        
        .mode-container.active {
            opacity: 1;
            visibility: visible;
        }

        /* Guided Mode - Wizard */
        #guided-mode {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 40px;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
        }

        .wizard-progress {
            width: 600px;
            margin-bottom: 40px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ED64 0%, #4DB33D 100%);
            border-radius: 10px;
            transition: width 0.4s ease;
            width: 0%;
        }
        
        .progress-text {
            text-align: center;
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-top: 12px;
            font-weight: 500;
        }

        .wizard-card {
            width: 700px;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            animation: fadeSlideUp 0.5s ease;
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wizard-icon {
            font-size: 3.5rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .wizard-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #001e2b;
            margin-bottom: 12px;
            text-align: center;
        }

        .wizard-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 40px;
            text-align: center;
            line-height: 1.6;
        }

        .wizard-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .wizard-option {
            padding: 20px 25px;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .wizard-option:hover {
            background: #fff;
            border-color: #00ED64;
            box-shadow: 0 4px 20px rgba(0,237,100,0.15);
            transform: translateY(-2px);
        }

        .wizard-option-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #001e2b;
            margin-bottom: 6px;
        }

        .wizard-option-desc {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }

        .wizard-nav {
            display: flex;
            gap: 16px;
            margin-top: 40px;
            justify-content: center;
        }

        .wizard-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wizard-btn.primary {
            background: linear-gradient(135deg, #00ED64 0%, #4DB33D 100%);
            color: #001e2b;
            box-shadow: 0 4px 15px rgba(0,237,100,0.3);
        }

        .wizard-btn.primary:hover {
            box-shadow: 0 6px 20px rgba(0,237,100,0.4);
            transform: translateY(-2px);
        }

        .wizard-btn.secondary {
            background: #f8f9fa;
            color: #001e2b;
        }

        .wizard-btn.secondary:hover {
            background: #e9ecef;
        }

        .wizard-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Recommendation Screen */
        .recommendation-card {
            width: 800px;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 60px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            text-align: center;
            animation: fadeSlideUp 0.5s ease;
        }

        .rec-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .rec-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #001e2b;
            margin-bottom: 16px;
        }

        .rec-subtitle {
            font-size: 1.1rem;
            color: #00ED64;
            font-weight: 600;
            margin-bottom: 30px;
        }

        .rec-details {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: left;
        }

        .rec-section {
            margin-bottom: 20px;
        }

        .rec-section:last-child {
            margin-bottom: 0;
        }

        .rec-section-title {
            font-size: 0.85rem;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .rec-section-value {
            font-size: 1.15rem;
            color: #001e2b;
            font-weight: 600;
        }

        .rec-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Expert View Enhancements */


        .back-to-guided {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            background: rgba(0,237,100,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,237,100,0.3);
            border-radius: 12px;
            color: #00ED64;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 91;
            display: none;
        }

        .back-to-guided.visible {
            display: block;
        }

        .back-to-guided:hover {
            background: rgba(0,237,100,0.25);
            transform: translateX(-3px);
        }

        .path-highlight .node rect,
        .path-highlight .node polygon,
        .path-highlight .node circle {
            stroke-width: 4px !important;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { filter: drop-shadow(0 0 15px currentColor); }
            50% { filter: drop-shadow(0 0 25px currentColor); }
        }

    </style>
</head>
<body>

    <header>
        <h1>MongoDB :  Architecture Decision Matrix</h1>
    </header>

    <!-- Mode Tabs -->
    <div class="mode-tabs">
        <button class="mode-tab active" data-mode="guided">
            <span>üéØ</span>
            <span>Guided Path</span>
        </button>
        <button class="mode-tab" data-mode="expert">
            <span>üó∫Ô∏è</span>
            <span>Expert View</span>
        </button>
    </div>

    <!-- Guided Mode Container -->
    <div id="guided-mode" class="mode-container active">
        <div class="wizard-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">Step <span id="current-step">1</span> of <span id="total-steps">8</span></div>
        </div>
        <div id="wizard-content"></div>
    </div>

    <!-- Expert View Container -->
    <div id="expert-mode" class="mode-container">
        <button class="back-to-guided" id="back-to-guided">‚Üê Back to Guided Mode</button>

    <!-- MongoDB Leaf Logo Watermark -->
    <svg class="mongodb-leaf" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path fill="#00ED64" d="M17.193 9.555c-1.264-5.58-4.252-7.414-4.573-8.115-.28-.394-.53-.954-.735-1.44-.036.495-.055.685-.523 1.184-.723.566-4.438 3.682-4.74 10.02-.282 5.912 4.27 9.435 4.888 9.884l.07.05A73.49 73.49 0 0111.91 24h.481c.114-1.032.284-2.056.51-3.07.417-.296.604-.463.85-.693a11.342 11.342 0 003.639-8.464c.01-.814-.103-1.662-.197-2.218zm-5.336 8.195s0-8.291.275-8.29c.213 0 .49 10.695.49 10.695-.381-.045-.765-1.76-.765-2.405z"/>
    </svg>

    <div class="legend">
        <strong>Node Description</strong><br><br>
        <div class="legend-item"><div class="dot l-value"></div><strong>Value Proposition (Clickable)</strong></div>
        <div class="legend-item"><div class="dot l-tech"></div>Data & Workload</div>
        <div class="legend-item"><div class="dot l-scale"></div>Scalability & Performance</div>
        <div class="legend-item"><div class="dot l-plat"></div>Platform & Integration</div>
        <div class="legend-item"><div class="dot l-deploy"></div>Deployment & Security</div>
        <div class="legend-item"><div class="dot l-exit"></div>Exit / Alternative</div>
        <div class="legend-item"><div class="dot l-final"></div>Final Architecture</div>
    </div>
    <div class="controls">
        <button class="ctrl-btn" onclick="zoomIn()"><span>+</span></button>
        <button class="ctrl-btn" onclick="zoomOut()"><span>‚àí</span></button>
        <button class="ctrl-btn" onclick="resetZoom()"><span>‚Ü∫</span></button>
    </div>

    <div id="side-drawer">
        <div class="drawer-header">
            <h2 id="drawer-title">Node Title</h2>
            <button class="close-btn" onclick="closeDrawer()">√ó</button>
        </div>
        <div class="drawer-body">
            <div class="value-prop-box">
                <span class="value-label">Value Proposition</span>
                <span id="drawer-value" class="value-text">...</span>
            </div>
            <p id="drawer-details" class="details-text">...</p>
            <a id="drawer-link" href="#" target="_blank" class="doc-link"><span>Read Documentation ‚Üí</span></a>
        </div>
    </div>

    <div id="diagram-container" onclick="closeDrawer()">
        <div class="mermaid">
%%{init: {'theme': 'base', 'flowchart': {'curve': 'basis', 'layout': 'dagre', 'nodeSpacing': 180, 'rankSpacing': 200}, 'themeVariables': { 'background': 'transparent', 'mainBkg': 'transparent', 'fontFamily': 'Inter', 'fontSize': '16px', 'lineColor': '#ffffff' }}}%%
flowchart TB
    Start(["Start: Strategic Vision"]) --> WorkloadCheck{"**Workload Nature**<br>Transactional or<br>Analytical?"}
    
    %% Analytical Path
    WorkloadCheck -- Analytical (OLAP) --> AnalyticCheck{"**Analytical Nuance**<br>Massive Joins (10+),<br>Full Table Scans, OR<br>Deep History (&gt;500TB active data set)?"}
    AnalyticCheck -- Yes (Data Warehouse) --> DWH["**Data Warehouse / Lakehouse**<br>Snowflake / Databricks<br>(Cost Efficiency for Cold Data)"]
    AnalyticCheck -- "No (Real-Time Analytics)" --> DevSkill{"**Team Skillset**<br>Code-First (Devs)<br>or SQL-First (DBAs)?"}
    
    %% Transactional Path - Direct to DevSkill
    WorkloadCheck -- Transactional (OLTP) --> DevSkill
    
    %% Developer Skillset Branch
    DevSkill -- "SQL-First" --> AcidCheck{"**ACID Nuance**<br>Multi-table transactions<br>across 10+ tables?"}
    DevSkill -- "Code-First" --> ObjMatch["**Value: Dev Experience**<br>No ORM / Impedance Mismatch"]
    
    %% SQL-First Path
    AcidCheck -- Yes --> NommalizationCheck{"**Rigid Data Model**<br>is data is 3rd or 4th Normal form?"}
    AcidCheck -- No --> VolCheck{"**Volume Nuance**<br>Writes &lt; 1k/sec?"}
    NommalizationCheck -- No --> RigidSQL{"RigidSQL<br> is business logic embedded in sql and plsql?"}
    RigidSQL -- No --> RDBMS["**RDBMS**<br>SQL / Oracle"]
    RigidSQL -- Yes --> Migrator["**Relational Migrator**<br>Schema Transformation"]
    Migrator -- extension --> AMP["**MongoDB AMP**"]
    NommalizationCheck -- Datamodel Optimization --> Migrator
    Migrator --> MongoCore["**MongoDB Core**<br>Flexible Schema"]
    VolCheck -- No --> RDBMS
    VolCheck -- Yes --> MongoCore
    
    %% Code-First Path
    ObjMatch --> DataNature{"**Data Nature**<br>Is the schema volatile<br>or hierarchical?"}
    DataNature -- Yes (JSON) --> GraphCheck{"**Graph Nuance**<br>Unbounded depth<br>(&gt; 5 hops)?"}
    DataNature -- No (Rigid) --> AcidCheck
    GraphCheck -- Yes --> GraphDB["**Neo4j / Neptune**"]
    GraphCheck -- No --> KVCheck{"**Key-Value Nuance**<br>Simple ID Lookup?"}
    KVCheck -- Yes --> Latency{"**Latency Nuance**<br>Need &lt;1ms response<br>&amp; OK with data loss?"}
    Latency -- Yes --> Redis["**Redis / Memcached**"]
    Latency -- No --> MongoCore
    KVCheck -- No (Complex) --> QueryCheck{"**Query Nuance**<br>Need robust filtering,<br>secondary indexes,<br>or aggregations?"}
    QueryCheck -- Yes --> MongoCore
    
    %% MongoDB Core ‚Üí Business Model (Multi-Tenancy Decision)
    MongoCore --> BizModel{"**Business Model**<br>Internal Enterprise App<br>or B2B SaaS?"}
    
    %% B2B SaaS - Multi-Tenancy Branch
    BizModel -- B2B SaaS --> Tenancy{"**Multi-Tenancy Nuance**<br>Isolation Strategy?"}
    Tenancy -- Silo (1 Deployment per Tenant) --> Silo["**Devops Nightmare**<br>Not enforced by MongoDB even for hardware isolation"]
    Tenancy -- Pool (Shared DB) --> Isolation{"**Isolation Check**<br>Need strict data residency<br>per tenant?"}
    Isolation -- Logical Isolation --> Logical["**Logical Sharding**<br>Standard Collections"]
    Isolation -- Physical Isolation --> TenantShard["**Tenant-Aware Sharding**<br>Dedicate Nodes to VIPs"]
    Logical --> Agility{"**Velocity Check**<br>Does schema change<br>frequently?"}
    TenantShard --> Agility
    Silo --> Agility
    
    %% Internal App - Direct to Agility
    BizModel -- Internal App --> Agility
    
    %% Velocity & Scaling
    Agility -- Yes --> AgileVal["**Value: High Agility**<br>Faster Time-to-Market"]
    Agility -- No --> ScaleCheck{"**Scale Check**<br>Data &gt; 2TB OR<br>Writes &gt; 50k/s?"}
    AgileVal --> ScaleCheck
    ScaleCheck -- Yes --> ShardStrat{"**Sharding Strategy**<br>Access Pattern?"}
    ShardStrat -- Distributed Writes --> HashShard["**Hashed Sharding**<br>Uniform Distribution"]
    ShardStrat -- Location Based --> ZoneShard["**Zone Sharding**<br>Data Locality"]
    ShardStrat -- Range Queries --> RangeShard["**Ranged Sharding**<br>Time/Alpha Grouping"]
    ScaleCheck -- No --> Replica["**Replica Set**<br>High Availability"]
    HashShard --> PlatCheck{"**Workload Nuance**<br>Need Search, AI,<br>Streams, or Time Series?"}
    ZoneShard --> PlatCheck
    RangeShard --> PlatCheck
    Replica --> PlatCheck
    
    %% Platform Features
    PlatCheck -- Just CRUD --> Integration{"**Ecosystem Check**<br>Need mature connectors<br>(Kafka/Spark)?"}
    PlatCheck -- "Real-Time Streams" --> StreamCheck{"**Streaming Nuance**<br>Process data in-flight?"}
    StreamCheck -- Yes (Kafka+Flink) --> Flink["**Manage Separate Infra**<br>Complex Glue Code"]
    StreamCheck -- Yes (Unified) --> ASP["**Atlas Stream Processing**<br>Continuous Intelligence"]
    PlatCheck -- Search --> SearchDec{"**ETL Tolerance**<br>Want to manage<br>sync pipelines?"}
    SearchDec -- Yes --> Elastic["**Elasticsearch/SOLR**"]
    SearchDec -- No --> AtlasSearch["**Atlas Search**<br>Lucene on Node"]
    PlatCheck -- AI/Vector --> AIUse{"**AI Pattern**<br>How is Vector used?"}
    AIUse -- Chat History --> AgentMem["**Agent Memory**<br>Long-Term Context"]
    AIUse -- Reduce LLM Cost --> SemCache["**Semantic Cache**<br>Prevent Re-runs"]
    AIUse -- Knowledge Base --> RAG["**Knowledge Graph**<br>RAG + Filters"]
    PlatCheck -- IoT --> TimeSeries["**Time Series**<br>Columnar Store"]
    AtlasSearch --> Consolidation["**Value: Consolidation**<br>Reduced Tech Debt"]
    AgentMem --> Consolidation
    SemCache --> Consolidation
    RAG --> Consolidation
    TimeSeries --> Consolidation
    ASP --> Consolidation
    Consolidation --> Integration
    
    %% Deployment Path
    Integration -- No (Isolated) --> DeployCheck{"**Deployment**<br>Can data touch<br>public cloud?"}
    Integration -- Yes --> Connectors["**Value: Ecosystem**<br>Official Drivers/Connectors"]
    Connectors --> DeployCheck
    DeployCheck -- "No (Air-gapped)" --> SelfMan{"**Self-Managed**<br>Infrastructure?"}
    SelfMan -- Containers --> K8s["**Enterprise Operator**<br>OpenShift/K8s"]
    SelfMan -- VM/Metal --> OpsMan["**Ops Manager**<br>Automation"]
    K8s --> Secure@{ label: "**Trust Level**<br>Need 'Eyes-Off'?" }
    OpsMan --> Secure
    DeployCheck -- Yes (Cloud) --> Portability{"**Lock-In Check**<br>Need Cloud Agnostic<br>or Exit Strategy?"}
    Portability -- No (spefic Native) --> Dynamo["<br>cloud specific databases"]
    Portability -- Yes (Portable) --> NetCheck{"**Network Security**<br>Connection Method?"}
    NetCheck -- AWS/Azure Backbone --> PrivLink["**PrivateLink**<br>One-way Security"]
    NetCheck -- VPC Peering --> Peering["**VPC Peering**<br>Bi-directional"]
    NetCheck -- Public Internet --> IPList["**IP Whitelist**<br>Standard TLS"]
    PrivLink --> RTOCheck{"**DR Strategy**<br>RTO/RPO Requirements?"}
    Peering --> RTOCheck
    IPList --> RTOCheck
    RTOCheck -- "Near-Zero RPO<br>(Multi-Cloud Resilience)" --> MultiCloud["**Multi-Cloud Cluster**<br>AWS+Azure+GCP"]
    RTOCheck -- Minutes (Standard)<br>(Single Region) --> Standard["**Standard Cluster**<br>3-Node Replica"]
    Standard --> Lifecycle{"**Cost Efficiency**<br>Retain history &gt; 90 days?"}
    MultiCloud --> Lifecycle
    Lifecycle -- Yes --> Archive["**Online Archive**<br>Auto-Tiering to S3"]
    Lifecycle -- No --> ObsCheck{"**Ops Nuance**<br>Need Automated<br> Deployment Strategies ?  Performance Tuning?"}
    Archive --> ObsCheck
    ObsCheck -- No (Manual) --> ManualOps["**Manual Tuning**<br>Query Analysis"]
    ObsCheck -- Yes (Intelligent) --> PerfAdv["**MongoDB Atlas Landing Zone and Performance/Query Advisor**<br>*Templatized Deployment Configurations for control and ease of use<br>*Query Performance Visualization<br>*Auto-Index Suggest"]
    PerfAdv --> Secure
    ManualOps --> Secure
    Secure -- Yes (Regulated and High Compliance Requirements) --> CSFLE["Queryable Encryption<br>Client-Side filed encryptions<br>encryption at rest (KMIP)<br>encryption in motion<br><br>Compliance - First Platform<br>"]
    Secure L_Secure_Final_0@-- No --> Final(["**Final DB choice : MongoDB**"])
    CSFLE --> Final
    AMP -.-> Consolidation

    %% --- CLICK BINDINGS ---
    click ObjMatch showInfo
    click AgileVal showInfo
    click Consolidation showInfo
    click Logical showInfo
    click TenantShard showInfo
    click Migrator showInfo
    click MongoCore showInfo
    click HashShard showInfo
    click ZoneShard showInfo
    click RangeShard showInfo
    click Replica showInfo
    click ASP showInfo
    click AtlasSearch showInfo
    click Vector showInfo
    click AgentMem showInfo
    click SemCache showInfo
    click RAG showInfo
    click TimeSeries showInfo
    click Connectors showInfo
    click K8s showInfo
    click OpsMan showInfo
    click PrivLink showInfo
    click Peering showInfo
    click IPList showInfo
    click MultiCloud showInfo
    click Standard showInfo
    click Archive showInfo
    click PerfAdv showInfo
    click CSFLE showInfo
    click AMP showInfo
    click Final "https://cloud.mongodb.com/" "Start with MongoDB Atlas" _blank

    %% --- STYLING ---
    Secure@{ shape: diamond}

     Start:::startNode
     BizModel:::techZone
     WorkloadCheck:::techZone
     Tenancy:::techZone
     Silo:::exitNode
     Isolation:::techZone
     Logical:::valueNode
     TenantShard:::valueNode
     AnalyticCheck:::techZone
     DWH:::exitNode
     DevSkill:::techZone
     AcidCheck:::techZone
     ObjMatch:::valueNode
     DataNature:::techZone
     NommalizationCheck:::techZone
     RigidSQL:::techZone
     RDBMS:::exitNode
     Migrator:::valueNode
     AMP:::valueNode
     MongoCore:::valueNode
     VolCheck:::techZone
     GraphCheck:::techZone
     GraphDB:::exitNode
     KVCheck:::techZone
     Latency:::techZone
     Redis:::exitNode
     QueryCheck:::techZone
     Agility:::techZone
     AgileVal:::valueNode
     ScaleCheck:::scaleZone
     ShardStrat:::scaleZone
     HashShard:::valueNode
     ZoneShard:::valueNode
     RangeShard:::valueNode
     Replica:::valueNode
     PlatCheck:::platZone
     Integration:::platZone
     StreamCheck:::platZone
     Flink:::exitNode
     ASP:::valueNode
     SearchDec:::platZone
     Elastic:::exitNode
     AtlasSearch:::valueNode
     AIUse:::platZone
     AgentMem:::valueNode
     SemCache:::valueNode
     RAG:::valueNode
     TimeSeries:::valueNode
     Consolidation:::valueNode
     DeployCheck:::deployZone
     Connectors:::valueNode
     SelfMan:::deployZone
     K8s:::valueNode
     OpsMan:::valueNode
     Secure:::deployZone
     Portability:::deployZone
     Dynamo:::exitNode
     NetCheck:::deployZone
     PrivLink:::valueNode
     Peering:::valueNode
     IPList:::valueNode
     RTOCheck:::deployZone
     MultiCloud:::valueNode
     Standard:::valueNode
     Lifecycle:::deployZone
     Archive:::valueNode
     ObsCheck:::deployZone
     ManualOps:::exitNode
     PerfAdv:::valueNode
     CSFLE:::valueNode
     Final:::Aqua
    classDef startNode fill:#333,stroke:#333,stroke-width:2px,color:#fff
    classDef techZone fill:#E3F2FD,stroke:#1565C0,stroke-width:2px,color:#000
    classDef scaleZone fill:#FFF3E0,stroke:#EF6C00,stroke-width:2px,color:#000
    classDef platZone fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#000
    classDef deployZone fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#000
    classDef valueNode fill:#00ED64,stroke:#00684A,stroke-width:3px,font-weight:bold,color:#000
    classDef exitNode fill:#F5F5F5,stroke:#616161,stroke-width:1px,stroke-dasharray: 5 5,color:#666
    classDef Sky stroke-width:1px, stroke-dasharray:none, stroke:#374D7C, fill:#E2EBFF, color:#374D7C
    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A
   

    L_Secure_Final_0@{ curve: natural }


        </div>
    </div>

    </div> <!-- /expert-mode -->

    <script>
        // --- DUAL MODE WIZARD ---
        const wizardData = {
            questions: [
                // Use Case Selection
                {
                    id: 0,
                    icon: 'üéØ',
                    title: "What's your primary use case?",
                    subtitle: "Select a scenario or choose 'Custom' for tailored guidance",
                    options: [
                        { value: 'custom', title: 'Custom / Explore Options', desc: 'Tailored guidance for unique needs' },
                        { value: 'saas', title: 'B2B SaaS Application', desc: 'Solution for external customers' },
                        { value: 'logs', title: 'Log Analytics / Observability', desc: 'PB-scale logs, metrics, traces' },
                        { value: 'iot', title: 'IoT / Time-Series', desc: 'Sensor data, metrics over time' },
                        { value: 'cms', title: 'Content Management', desc: 'Articles, media, flexible content' },
                        { value: 'marketplace', title: 'Marketplace', desc: 'Multi-vendor platform, product listings, transactions' },
                        { value: 'ecommerce', title: 'E-Commerce Platform', desc: 'Product catalog, orders, inventory' },
                        { value: 'social', title: 'Social Network', desc: 'User relationships, feeds, graphs' },
                        { value: 'mobile', title: 'Mobile / Edge App', desc: 'Offline-first, local data, sync' }

                    ]
                },
                // Workload Nature
                {
                    id: 1,
                    icon: '‚ö°',
                    title: "Workload nature?",
                    subtitle: "Primary characteristic of your application",
                    options: [
                        { value: 'transactional', title: 'Transactional (OLTP)', desc: 'Frequent reads/writes, user-facing, real-time' },
                        { value: 'analytical', title: 'Analytical (OLAP)', desc: 'Complex queries, reporting, BI, aggregations' }
                    ]
                },
                // Analytical Nuance (only if analytical)
                {
                    id: 2,
                    icon: 'üìä',
                    title: "Analytical characteristics?",
                    subtitle: "How complex are your analytical queries?",
                    condition: {1: 'analytical'},
                    options: [
                        { value: 'warehouse', title: 'Data Warehouse Needs', desc: 'Massive joins (10+), full table scans, >500TB working dataset' },
                        { value: 'realtime', title: 'Real-Time Analytics', desc: 'Lower latency analytics, moderate complexity' }
                    ]
                },
                // Business Model (before MongoDB Core decision)
                {
                    id: 3,
                    icon: 'üè¢',
                    title: "Business model?",
                    subtitle: "How do you serve your users?",
                    condition: {1: 'transactional'},
                    options: [
                        { value: 'internal', title: 'Internal Enterprise App', desc: 'Single organization, internal users' },
                        { value: 'saas', title: 'External Solution/Application', desc: 'Multiple customers (tenants)' }
                    ]
                },
                // Multi-Tenancy Strategy (only if SaaS)
                {
                    id: 4,
                    icon: 'üîê',
                    title: "Multi-tenancy isolation?",
                    subtitle: "How should tenant data be separated?",
                    condition: {3: 'saas'},
                    options: [
                        { value: 'logical', title: 'Logical Isolation', desc: 'Shared collections, tenant_id field' },
                        { value: 'physical', title: 'Physical Isolation', desc: 'Dedicated nodes for VIP tenants' },
                        { value: 'silo', title: 'Silo (Complete Separation)', desc: 'Separate deployment per tenant (not recommended)' },
                        { value: 'na', title: 'Not Applicable', desc: 'Not multi tenant as it is not a SAAS' }
                    ]
                },
                // Team Skillset
                {
                    id: 5,
                    icon: 'üë•',
                    title: "Team skillset?",
                    subtitle: "What are your developers most comfortable with?",
                    options: [
                        { value: 'codefirst', title: 'Code-First Developers', desc: 'JavaScript, Python, Java - prefer APIs' },
                        { value: 'sqlfirst', title: 'SQL-First Engineers', desc: 'DBAs, data engineers - comfortable with SQL' }
                    ]
                },
                // Migration Intent (if SQL-first)
                {
                    id: 6,
                    icon: 'üîÑ',
                    title: "Is this a modernization effort?",
                    subtitle: "Are you migrating from an existing database?",
                    condition: {5: 'sqlfirst'},
                    options: [
                        { value: 'yes', title: 'Yes, Modernizing', desc: 'Migrating from legacy system' },
                        { value: 'no', title: 'No, New Project', desc: 'Greenfield development' }
                    ]
                },
                // Migration Source (if modernizing)
                {
                    id: 7,
                    icon: 'üóÑÔ∏è',
                    title: "What are you migrating from?",
                    subtitle: "Select your current database",
                    condition: {6: 'yes'},
                    options: [
                        { value: 'oracle', title: 'Oracle', desc: 'Oracle Database' },
                        { value: 'sqlserver', title: 'SQL Server', desc: 'Microsoft SQL Server' },
                        { value: 'postgres', title: 'PostgreSQL', desc: 'PostgreSQL' },
                        { value: 'mysql', title: 'MySQL', desc: 'MySQL / MariaDB' },
                        { value: 'db2', title: 'IBM Db2', desc: 'IBM Db2' },
                        { value: 'other', title: 'Other RDBMS', desc: 'Other relational database' }
                    ]
                },
                // ACID Requirements (if SQL-first)
                {
                    id: 8,
                    icon: 'üîí',
                    title: "ACID transaction needs?",
                    subtitle: "Do you need multi-table transactions?",
                    condition: {5: 'sqlfirst'},
                    options: [
                        { value: 'heavy', title: 'Transactions with normalized data model', desc: 'Complex multi-table (10+)  transactions' },
                        { value: 'moderate', title: 'Transactions with denormalized data model', desc: 'multi table transactions with few tables' }
                    ]
                },
                // Normalization Check (if heavy ACID)
                {
                    id: 9,
                    icon: 'üìê',
                    title: "Data model rigidity?",
                    subtitle: "Is your data 3rd or 4th normal form?",
                    condition: {8: 'heavy'},
                    options: [
                        { value: 'rigid', title: 'Highly Normalized', desc: '3NF/4NF, strict relational integrity' },
                        { value: 'optimizable', title: 'Already use Materialized Views for faster reads? i.e Denormalization friendly?', desc: 'Open to data model optimization' }
                    ]
                },
                // SQL Logic Embedded
                {
                    id: 10,
                    icon: 'üíæ',
                    title: "Business logic location?",
                    subtitle: "Where is your business logic?/Where do you want your business logic?",
                    condition: {9: 'rigid'},
                    options: [
                        { value: 'database', title: 'In Database (SQL/PL-SQL)', desc: 'Stored procedures, triggers' },
                        { value: 'application', title: 'In Application Code', desc: 'Logic in app tier' }
                    ]
                },
                // Volume Nuance (if moderate ACID)
                {
                    id: 11,
                    icon: 'üìà',
                    title: "Write volume?",
                    subtitle: "Expected writes per second",
                    condition: {8: 'moderate'},
                    options: [
                        { value: 'low', title: 'Low Scale (<1k writes/sec)', desc: 'low traffic without spikes' },
                        { value: 'high', title: 'Moderate to High Scale', desc: 'Unpredictable traffic with spikes' }
                    ]
                },
                // Traffic Pattern (New Q23)
                {
                    id: 23,
                    icon: 'üìä',
                    title: "Traffic Pattern?",
                    subtitle: "How consistent is your workload?",
                    condition: {1: 'transactional'},
                    options: [
                        { value: 'consistent', title: 'Consistent / Predictable', desc: 'Steady load, predictable peaks' },
                        { value: 'spiky', title: 'Spiky / Unpredictable', desc: 'Bursty traffic, idle periods' }
                    ]
                },
                // Data Nature (if code-first)
                {
                    id: 12,
                    icon: 'üìÇ',
                    title: "Data structure?",
                    subtitle: "How flexible is your schema?",
                    condition: [{5: 'codefirst'}, {5: 'sqlfirst'}, {1: 'analytical'}],
                    options: [
                        { value: 'document', title: 'Flexible & Hierarchical', desc: 'JSON-like, nested, frequent changes' },
                        { value: 'graph', title: 'Highly Connected / Graph', desc: 'Nodes and edges, complex relationships' },
                        { value: 'rigid', title: 'Rigid & Relational', desc: 'Fixed schema, normalized' }
                    ]
                },
                // Graph Depth (if graph)
                {
                    id: 13,
                    icon: 'üï∏Ô∏è',
                    title: "Relationship depth?",
                    subtitle: "How deep are your relationship traversals?",
                    condition: {12: 'graph'},
                    options: [
                        { value: 'deep', title: 'Deep (>5 hops)', desc: 'Friend-of-friend-of-friend, unbounded traversals' },
                        { value: 'shallow', title: 'Shallow (‚â§3-5 hops)', desc: 'Simple relationships' }
                    ]
                },
                // Key-Value Pattern (if shallow graphs OR document)
                {
                    id: 14,
                    icon: 'üîë',
                    title: "Access pattern?",
                    subtitle: "How do you access your data?",
                    condition: [{13: 'shallow'}, {12: 'document'}],
                    options: [
                        { value: 'simple', title: 'Simple ID Lookup', desc: 'Mostly get-by-ID, key-value style' },
                        { value: 'complex', title: 'Complex Queries', desc: 'Filtering, secondary indexes, aggregations' }
                    ]
                },
                // Latency Tolerance (if simple KV)
                {
                    id: 15,
                    icon: '‚ö°',
                    title: "Latency requirements?",
                    subtitle: "How fast do you need responses?",
                    condition: {14: 'simple'},
                    options: [
                        { value: 'submillisecond', title: 'Sub-millisecond (<1ms)', desc: 'Can tolerate some data loss for speed' },
                        { value: 'normal', title: 'Normal (1-10ms)', desc: 'Durability important' }
                    ]
                },
                // Scale Requirements
                {
                    id: 16,
                    icon: 'üìä',
                    title: "Expected scale?",
                    subtitle: "Data volume and write throughput",
                    options: [
                        { value: 'small', title: 'Small (<2TB, <10k writes/sec)', desc: 'Startup or moderate app' },
                        { value: 'large', title: 'Large (>2TB or >50k writes/sec)', desc: 'High-scale production' },
                        { value: 'massive', title: 'Massive (Petabyte-scale)', desc: 'Logs, observability, huge datasets' }
                    ]
                },
                // Sharding Strategy (if large scale)
                {
                    id: 17,
                    icon: 'üóÇÔ∏è',
                    title: "Data distribution pattern?",
                    subtitle: "How should data be sharded?",
                    condition: {16: ['large', 'massive']},
                    options: [
                        { value: 'distributed', title: 'Distributed Writes', desc: 'Uniform distribution across shards' },
                        { value: 'location', title: 'Geo-Partitioned', desc: 'Data locality by region/zone' },
                        { value: 'range', title: 'Range-Based', desc: 'Time-series or alphabetical grouping' },
                        { value: 'skip', title: 'Skip / Not Sure', desc: 'No specific sharding preference yet' }
                    ]
                },
                // Advanced Features
                {
                    id: 18,
                    icon: 'üîç',
                    title: "Need advanced features?",
                    subtitle: "Select any that apply (or skip)",
                    multiselect: true,
                    options: [
                        { value: 'search', title: 'Full-Text Search', desc: 'Search engine capabilities' },
                        { value: 'ai', title: 'AI/Vector Search', desc: 'RAG, embeddings, semantic search' },
                        { value: 'streams', title: 'Real-Time Streams', desc: 'Change data capture, event processing' },
                        { value: 'timeseries', title: 'Time Series / IoT', desc: 'Sensor data, metrics over time' }
                    ],
                    allowSkip: true
                },
                // Search Scale (if search selected)
                {
                    id: 19,
                    icon: 'üîç',
                    title: "Search data scale?",
                    subtitle: "How much data needs to be searchable?",
                    condition: {18: ['search']},
                    options: [
                        { value: 'moderate', title: 'Moderate (< 3TB  size or 500GB active index size)', desc: 'Standard search needs' },
                        { value: 'petabyte', title: 'Petabyte-Scale', desc: 'Log analytics, massive search indices' }
                    ]
                },
                // Deployment Preference
                {
                    id: 20,
                    icon: '‚òÅÔ∏è',
                    title: "Deployment preference?",
                    subtitle: "Where can your data live?",
                    options: [
                        { value: 'cloud', title: 'Public Cloud/Hybrid Cloud', desc: 'AWS, Azure, GCP' },
                        { value: 'onprem', title: 'On-Premise / Air-gapped', desc: 'Private infrastructure' }
                    ]
                },
                // Compliance
                {
                    id: 21,
                    icon: 'üîí',
                    title: "Compliance requirements?",
                    subtitle: "Do you need field-level encryption?",
                    condition: {1: 'transactional'},
                    options: [
                        { value: 'standard', title: 'Standard Security', desc: 'TLS/SSL, At-Rest Encryption' },
                        { value: 'strict', title: 'Strict Compliance', desc: 'HIPAA/PCI, Field-Level Encryption needed' }
                    ]
                },
                // Mobile / Edge (New Q22)
                {
                    id: 22,
                    icon: 'üì±',
                    title: "Offline-First Requirement?",
                    subtitle: "Do devices need to work without internet?",
                    condition: {0: 'mobile'},
                    options: [
                        { value: 'yes', title: 'Yes, Offline Sync', desc: 'Local DB with auto-sync to cloud' },
                        { value: 'no', title: 'No, Always Online', desc: 'Direct API calls to backend' }
                    ]
                }
            ],
            answers: {},
            currentStep: 0
        };

        // Mode switching
        document.querySelectorAll('.mode-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const mode = tab.dataset.mode;
                switchMode(mode);
            });
        });

        function switchMode(mode) {
            // Update tabs
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // Update containers
            document.querySelectorAll('.mode-container').forEach(c => c.classList.remove('active'));
            document.getElementById(`${mode}-mode`).classList.add('active');

            if (mode === 'guided') {
                renderWizardStep();
            } else if (mode === 'expert') {
                // Re-render Mermaid diagram and re-init pan-zoom
                setTimeout(() => {
                    if (window.mermaid) {
                        mermaid.init(undefined, '.mermaid');
                        setupPanZoom(); // Re-attach pan-zoom to new SVG
                    }
                }, 100);
            }
        }

        // ... (renderWizardStep and other wizard functions remain here) ...

        // 3. Pan-Zoom Setup
        function setupPanZoom() {
            // Clear any existing instance
            if (panZoomInstance) {
                panZoomInstance.destroy();
                panZoomInstance = null;
            }

            const interval = setInterval(() => {
                const svg = document.querySelector('.mermaid svg');
                if (svg && svg.getBoundingClientRect().height > 10) {
                    clearInterval(interval);
                    svg.style.height = '100%';
                    svg.style.width = '100%';
                    svg.style.maxWidth = 'none';

                    panZoomInstance = svgPanZoom(svg, {
                        zoomEnabled: true,
                        controlIconsEnabled: false,
                        fit: true,
                        center: true,
                        minZoom: 0.1,
                        maxZoom: 10
                    });
                    panZoomInstance.resize();
                    panZoomInstance.fit();
                    panZoomInstance.center();
                }
            }, 100);
        }

        // Initial setup
        setupPanZoom();

        function zoomIn() { if(panZoomInstance) panZoomInstance.zoomIn(); }
        function zoomOut() { if(panZoomInstance) panZoomInstance.zoomOut(); }
        function resetZoom() { if(panZoomInstance) { panZoomInstance.resetZoom(); panZoomInstance.center(); } }
        
        window.addEventListener('resize', function(){
            if(panZoomInstance) { panZoomInstance.resize(); panZoomInstance.fit(); panZoomInstance.center(); }
        });

        // Validate condition with error handling (CONCERN #4: Error Handling)
        function shouldShowQuestion(question) {
            if (!question.condition) return true;
            
            try {
                const checkCondition = (cond) => {
                    if (!cond || typeof cond !== 'object') return false;
                    
                    for (let [qId, expectedValue] of Object.entries(cond)) {
                        const qIdInt = parseInt(qId);
                        if (isNaN(qIdInt)) {
                            console.warn(`Invalid question ID in condition: ${qId}`);
                            return false;
                        }
                        
                        const answer = wizardData.answers[qIdInt];
                        if (Array.isArray(expectedValue)) {
                            if (!answer || !Array.isArray(answer)) return false;
                            if (!expectedValue.some(val => answer.includes(val))) return false;
                        } else {
                            if (answer !== expectedValue) return false;
                        }
                    }
                    return true;
                };

                if (Array.isArray(question.condition)) {
                    return question.condition.some(cond => checkCondition(cond));
                }
                return checkCondition(question.condition);
            } catch (error) {
                console.error('Error checking condition:', error, 'Question:', question);
                return false;
            }
        }

        // Find next valid question to show
        function findNextQuestion(fromIndex) {
            for (let i = fromIndex; i < wizardData.questions.length; i++) {
                if (shouldShowQuestion(wizardData.questions[i])) {
                    return i;
                }
            }
            return -1; // No more questions
        }

        // Wizard rendering
        function renderWizardStep() {
            const step = wizardData.currentStep;
            const question = wizardData.questions[step];
            const totalSteps = wizardData.questions.length;

            // Update progress
            const progress = ((step + 1) / totalSteps) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('current-step').textContent = step + 1;
            document.getElementById('total-steps').textContent = totalSteps;

            // Render question card
            const wizardContent = document.getElementById('wizard-content');
            const isMultiSelect = question.multiselect || false;
            const selectedValues = wizardData.answers[question.id] || (isMultiSelect ? [] : null);

            wizardContent.innerHTML = `
                <div class="wizard-card">
                    <div class="wizard-icon">${question.icon}</div>
                    <h2 class="wizard-title">${question.title}</h2>
                    <div class="wizard-subtitle">${question.subtitle}</div>
                    <div class="wizard-options">
                        ${question.options.map(opt => {
                            const isSelected = isMultiSelect 
                                ? selectedValues.includes(opt.value)
                                : selectedValues === opt.value;
                            return `
                                <div class="wizard-option ${isSelected ? 'selected' : ''}" 
                                     onclick="selectOption(${question.id}, '${opt.value}', ${isMultiSelect})"
                                     style="${isSelected ? 'border-color: #00ED64; background: #fff;' : ''}">
                                    <div class="wizard-option-title">${isMultiSelect ? (isSelected ? '‚úì ' : '‚òê ') : ''}${opt.title}</div>
                                    <div class="wizard-option-desc">${opt.desc}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="wizard-nav">
                        ${step > 0 ? '<button class="wizard-btn secondary" onclick="prevStep()">‚Üê Back</button>' : ''}
                        ${question.allowSkip ? '<button class="wizard-btn secondary" onclick="skipStep()">Skip</button>' : ''}
                        <button class="wizard-btn primary" onclick="nextStep()" 
                                ${!selectedValues || (isMultiSelect && selectedValues.length === 0) ? 'disabled' : ''}>
                            ${step < totalSteps - 1 ? 'Next ‚Üí' : 'See Recommendation'}
                        </button>
                    </div>
                </div>
            `;
        }

        function selectOption(questionId, value, isMultiSelect) {
            if (isMultiSelect) {
                if (!wizardData.answers[questionId]) {
                    wizardData.answers[questionId] = [];
                }
                const index = wizardData.answers[questionId].indexOf(value);
                if (index > -1) {
                    wizardData.answers[questionId].splice(index, 1);
                } else {
                    wizardData.answers[questionId].push(value);
                }
            } else {
                wizardData.answers[questionId] = value;
            }
            renderWizardStep();
        }

        function nextStep() {
            const nextIndex = findNextQuestion(wizardData.currentStep + 1);
            if (nextIndex >= 0) {
                wizardData.currentStep = nextIndex;
                renderWizardStep();
            } else {
                showRecommendation();
            }
        }

        function prevStep() {
            // Find previous valid question
            for (let i = wizardData.currentStep - 1; i >= 0; i--) {
                if (shouldShowQuestion(wizardData.questions[i])) {
                    wizardData.currentStep = i;
                    renderWizardStep();
                    return;
                }
            }
        }

        function skipStep() {
            const question = wizardData.questions[wizardData.currentStep];
            wizardData.answers[question.id] = [];
            nextStep();
        }

        // CONCERN #5: Refactor helper functions for recommendation logic
        // Determine primary DB choice based on core logic paths
        function determinePrimaryDB(answers) {
            const useCase = answers[0];
            const workload = answers[1];
            const dataStructure = answers[13];
            const graphDepth = answers[14];
            const teamSkill = answers[6];
            const migration = answers[7];
            const migrationSource = answers[8];
            const acidNeeds = answers[9];
            const normalization = answers[10];
            const volumeNuance = answers[12];
            const scale = answers[17];
            const analyticalNuance = answers[3];
            
            // Use case shortcuts
            if (useCase === 'logs') return { db: "Elasticsearch / Solr or MongoDB Atlas Search", reason: "log-analytics" };
            if (useCase === 'iot') return { db: "MongoDB Time Series / InfluxDB", reason: "iot-timeseries" };
            
            // Analytical path
            if (workload === 'analytical') {
                if (dataStructure === 'graph' && graphDepth === 'deep') {
                    return { db: "Neo4j Graph Data Science / TigerGraph", reason: "analytical-deep-graph" };
                } else if (dataStructure === 'graph') {
                    return { db: "MongoDB (Aggregation Pipeline)", reason: "analytical-shallow-graph" };
                } else if (analyticalNuance === 'warehouse' || scale === 'massive') {
                    return { db: "Data Warehouse", reason: "analytical-warehouse" };
                } else {
                    return { db: "MongoDB Atlas (Analytics Nodes) or ClickHouse", reason: "analytical-realtime" };
                }
            }
            
            // Transactional path
            if (useCase === 'mobile' && answers[23] === 'yes') {
                return { db: "MongoDB Atlas + Certified Partner (Ditto / PowerSync / ObjectBox)", reason: "mobile-offline" };
            }
            
            if (dataStructure === 'graph') {
                if (graphDepth === 'deep') {
                    return { db: "MongoDB (Operational) + Neo4j (Graph Database)", reason: "transactional-deep-graph" };
                } else {
                    return { db: "MongoDB", reason: "transactional-shallow-graph" };
                }
            }
            
            // SQL-First team path
            if (teamSkill === 'sqlfirst') {
                if (migration === 'yes' && acidNeeds === 'heavy' && normalization === 'rigid') {
                    const dbMap = { oracle: 'Oracle', sqlserver: 'SQL Server', postgres: 'PostgreSQL', mysql: 'MySQL', db2: 'IBM Db2', other: 'RDBMS' };
                    const source = dbMap[migrationSource] || 'RDBMS';
                    return { db: "MongoDB (with migration support)", reason: "sql-modernization", source: source };
                } else if (acidNeeds === 'heavy' && normalization === 'rigid') {
                    return { db: volumeNuance === 'high' ? "RDBMS" : "RDBMS", reason: "sql-heavy-acid" };
                } else {
                    return { db: "MongoDB (with SQL drivers and Relational Migrator)", reason: "sql-moderate" };
                }
            }
            
            // Code-First team path
            if (dataStructure === 'document') {
                return { db: "MongoDB", reason: "codefirst-document" };
            } else if (dataStructure === 'rigid') {
                return { db: "MongoDB (with Schema Validation)", reason: "codefirst-rigid" };
            }
            
            return { db: "MongoDB", reason: "default" };
        }

        // Recommendation engine (CONCERN #5 & #6: Error handling + Refactored logic)
        function showRecommendation() {
            try {
                const answers = wizardData.answers;
                
                // Default recommendation structure
                let dbChoice = "MongoDB Atlas";
                let architecture = "Replica Set";
                let deployment = "Standard Cloud Cluster";
                let features = [];
                let reasoning = "";
                let useCase = answers[0];
                
                // Get primary DB choice using helper function
                const primaryDB = determinePrimaryDB(answers);
                dbChoice = primaryDB.db;
                const reason = primaryDB.reason;
                
                // Handle special reasons
                if (reason === 'log-analytics') {
                    architecture = "Search / Log Analytics Cluster";
                    reasoning = "For petabyte-scale log analytics, dedicated search engines like Elasticsearch are often preferred, though MongoDB can handle logs with Time Series collections and moderate size log loads (< 3TB size or 500GB active index size).";
                    features.push("Time Series", "Search Indexing");
                } else if (reason === 'iot-timeseries') {
                    architecture = "Time Series Optimized Cluster";
                    reasoning = "IoT workloads require high write throughput and efficient storage of time-stamped data.";
                    features.push("Time Series Collections", "Data Tiering (Hot/Cold)");
                }

            // --- ARCHITECTURE REFINEMENTS ---
            
            // PETABYTE TRANSACTIONAL - Multi-tier Architecture
            if (dbChoice.includes("MongoDB") && answers[1] === 'transactional' && answers[16] === 'massive') {
                if (answers[20] === 'cloud') {
                    dbChoice = "MongoDB (Hot Operational) + Online Archive (Cold) + Data Warehouse (Reporting)";
                    architecture = "Multi-tier: Hot Cluster + Cloud Archive + Analytics Layer";
                    reasoning += " Petabyte-scale transactional workloads require a tiered architecture. MongoDB handles hot operational data (recent transactions), Online Archive stores cold historical data cost-effectively in S3, and a Data Warehouse provides optimized reporting across the full dataset.";
                    features.push("Online Archive", "Atlas Data Federation");
                } else {
                    dbChoice = "MongoDB (Hot Operational) + Object Storage (Cold) + Data Warehouse (Reporting)";
                    architecture = "Multi-tier: Hot Cluster + S3-Compatible Storage + Analytics Layer";
                    reasoning += " Petabyte-scale transactional workloads require a tiered architecture. MongoDB handles hot operational data, S3-compatible object storage holds cold historical data cost-effectively, and a Data Warehouse provides optimized reporting across the full dataset.";
                }
            }
            
            // RDBMS + PETABYTE SCALE - Present Two Options
            if (dbChoice === "RDBMS" && answers[16] === 'massive') {
                if (answers[20] === 'cloud') {
                    dbChoice = "Option 1: RDBMS (Hot) + Data Warehouse (Cold) | Option 2: MongoDB (Hot) + Online Archive (Cold) + Warehouse (Reporting)";
                    architecture = "Multi-tier Architecture with Two Paths";
                    reasoning = "Petabyte-scale relational data requires strategic decision: **Option 1** - Stay in RDBMS ecosystem with tiering (hot operational + cold warehouse). **Option 2** - Modernize to MongoDB (cloud-based) assisted by MongoDB Modernization Programme, leveraging Online Archive for cold data and Warehouse for complex analytics. Consider migration effort, team skills, and licensing costs.";
                    features.push("Relational Migrator (Option 2)", "App Modernization Services (Option 2)", "Online Archive (Option 2)");
                } else {
                    dbChoice = "Option 1: RDBMS (Hot) + Data Warehouse (Cold) | Option 2: MongoDB (Hot) + Object Storage (Cold) + Warehouse (Reporting)";
                    architecture = "Multi-tier Architecture with Two Paths";
                    reasoning = "Petabyte-scale relational data requires strategic decision: **Option 1** - Stay in RDBMS ecosystem with tiering (hot operational + cold warehouse). **Option 2** - Modernize to MongoDB (on-premise) assisted by MongoDB Modernization Programme, with S3-compatible storage for cold data and Warehouse for analytics. Consider migration effort, infrastructure, and team skills.";
                    features.push("Relational Migrator (Option 2)", "App Modernization Services (Option 2)");
                }
            }
            // Regular MongoDB Architecture
            else if (dbChoice.includes("MongoDB")) {
                // Scale
                if (answers[16] === 'massive') {
                    architecture = "Sharded Cluster (Zone Sharding)";
                } else if (answers[16] === 'large') {
                    architecture = "Sharded Cluster";
                    if (answers[17] === 'distributed') architecture += " (Hashed Sharding)";
                    else if (answers[17] === 'location') architecture += " (Zone Sharding)";
                    else if (answers[17] === 'range') architecture += " (Ranged Sharding)";
                } else {
                    architecture = "Replica Set (3-Node)";
                }

                // Multi-Tenancy
                if (answers[3] === 'saas') {
                    let suffix = "";
                    if (dbChoice.includes("Neo4j")) {
                         suffix = " (applied to MongoDB operational layer)";
                         reasoning += " Note: Multi-tenancy isolation strategies (Logical/Physical) are applied to the MongoDB operational layer. Neo4j can be deployed as a shared service or per-tenant instances depending on strictness.";
                    }

                    // WAREHOUSE MULTI-TENANCY
                    if (dbChoice.includes("Data Warehouse")) {
                        if (answers[4] === 'physical') {
                            architecture += " with Dedicated Compute/Accounts (High Cost)";
                            reasoning += " Note: Physical isolation in Data Warehouses typically requires dedicated compute clusters or separate accounts, which significantly increases cost.";
                        } else if (answers[4] === 'logical') {
                            architecture += " with Row-Level Security (RLS)";
                            reasoning += " Note: Logical isolation in Data Warehouses is best achieved using Row-Level Security (RLS) policies.";
                        } else if (answers[4] === 'silo') {
                            architecture += " with Separate Schemas/Databases";
                        }
                    }
                    // STANDARD / MONGODB MULTI-TENANCY
                    else {
                        if (answers[4] === 'physical') {
                            architecture += " with Dedicated Tenant Nodes" + suffix;
                        } else if (answers[4] === 'logical') {
                            architecture += " with Logical Isolation (tenant_id)" + suffix;
                        } else if (answers[4] === 'silo') {
                            architecture += " with Silo Isolation" + suffix;
                        }
                    }
                    // if 'na', do nothing (standard architecture)
                }

                // Latency
                if (answers[15] === 'submillisecond') {
                    features.push("Redis / Cache Layer");
                    reasoning += " For <1ms latency requirements, add a caching layer like Redis.";
                }

                // Traffic Pattern (Spiky)
                if (answers[23] === 'spiky' && dbChoice.includes("MongoDB")) {
                    features.push("Cluster Auto-Scaling");
                    reasoning += " For spiky or unpredictable traffic, enable Cluster Auto-Scaling to handle bursts without over-provisioning (preferred over Serverless for production stability).";
                }
            }

            // --- APP MODERNIZATION VALUE PROPOSITION ---
            if (answers[6] === 'yes' && dbChoice.includes("MongoDB")) {
                const sourceDB = answers[7] || 'legacy system';
                const dbName = sourceDB === 'oracle' ? 'Oracle' :
                              sourceDB === 'sqlserver' ? 'SQL Server' :
                              sourceDB === 'postgres' ? 'PostgreSQL' :
                              sourceDB === 'mysql' ? 'MySQL' :
                              sourceDB === 'db2' ? 'IBM Db2' :
                              'RDBMS';
                
                reasoning += ` Coupled with MongoDB'sApp Modernization Services, Migrating from ${dbName} to MongoDB eliminates ORM complexity, accelerates development with flexible schemas, and reduces licensing costs. MongoDB's Relational Migrator automates schema conversion and data migration.`;
                features.push("Relational Migrator", "App Modernization Services");
            }

            // --- DEPLOYMENT ---
            if (answers[20] === 'onprem') {
                deployment = "Self-Managed / On-Premise";
            } else {
                if (dbChoice.includes("MongoDB")) {
                    deployment = "Fully Managed Cloud (Atlas)";
                } else {
                    deployment = "Fully Managed Cloud (as applicable)";
                }
            }

            // --- ADVANCED FEATURES ---
            const advFeatures = answers[18] || [];
            
            // Search
            if (advFeatures.includes('search')) {
                // ANALYTICAL + SEARCH - Hybrid based on scale
                if (answers[1] === 'analytical') {
                    if (answers[16] === 'massive' || answers[2] === 'warehouse') {
                        // Large/Petabyte scale: Search Engine + Warehouse
                        if (dbChoice.includes("Data Warehouse")) {
                            dbChoice = "Elasticsearch/Solr (Search Engine) + Data Warehouse (Analytics)";
                            architecture = "Hybrid: Search-First + Columnar Analytics";
                            reasoning = "For petabyte-scale analytical search (logs, observability), Elasticsearch/Solr handles search queries while Data Warehouse provides deep analytics on the same dataset via federation or ETL.";
                        }
                    } else {
                        // Small/Medium scale: MongoDB + Search
                        if (dbChoice.includes("MongoDB") || dbChoice.includes("Data Warehouse")) {
                            dbChoice = "MongoDB (Operational Analytics) + Atlas Search";
                            architecture = "Real-Time Analytics with Search";
                            reasoning = "For moderate-scale analytical workloads with search requirements, MongoDB Analytics Nodes combined with Atlas Search provide unified operational analytics and full-text search.";
                            features.push("Atlas Search (Lucene-based)", "Analytics Nodes");
                        }
                    }
                }
                // TRANSACTIONAL + SEARCH
                else if (answers[19] === 'petabyte') {
                    if (dbChoice.includes("MongoDB")) {
                        dbChoice = "MongoDB (Operational) + Elasticsearch/Solr (Search Engine)";
                        reasoning += " For petabyte-scale search workloads, a dedicated search engine alongside MongoDB provides optimal performance.";
                    }
                } else if (dbChoice.includes("MongoDB")) {
                    features.push("Atlas Search (Lucene-based)");
                }
            }

            // AI / Vector
            if (advFeatures.includes('ai')) {
                if (dbChoice.includes("MongoDB")) {
                    features.push("Atlas Vector Search");
                } else {
                    features.push("Pinecone / Weaviate");
                }
            }

            // Streams
            if (advFeatures.includes('streams')) {
                if (dbChoice.includes("MongoDB")) {
                    features.push("Change Streams / Stream Processing");
                } else {
                    features.push("Kafka Flink");
                }
            }

            // Compliance
            if (answers[21] === 'strict') {
                if (dbChoice.includes("MongoDB")) {
                    features.push("Queryable Encryption", "CSFLE", "Storage/Network Encryption");
                } else if (dbChoice.includes("RDBMS") || dbChoice.includes("PostgreSQL") || dbChoice.includes("MySQL")) {
                    features.push("TDE (Transparent Data Encryption)", "Row-Level Security", "pgcrypto / Vault");
                } else if (dbChoice.includes("Neo4j")) {
                    features.push("Enterprise Security", "Role-Based Access Control", "Field-Level Security");
                } else if (dbChoice.includes("Data Warehouse")) {
                    features.push("Platform Encryption", "Dynamic Data Masking", "Governance Catalog");
                } else {
                    features.push("App-Level Field Encryption");
                }
            }

            // Render recommendation
            const wizardContent = document.getElementById('wizard-content');
            wizardContent.innerHTML = `
                <div class="recommendation-card">
                    <div class="rec-icon">‚ú®</div>
                    <h2 class="rec-title">Your Recommended Architecture</h2>
                    <div class="rec-subtitle">${dbChoice}</div>
                    
                    <div class="rec-details">
                        <div class="rec-section">
                            <div class="rec-section-title">Database Platform</div>
                            <div class="rec-section-value">${dbChoice}</div>
                        </div>
                        ${architecture ? `
                        <div class="rec-section">
                            <div class="rec-section-title">Architecture Pattern</div>
                            <div class="rec-section-value">${architecture}</div>
                        </div>
                        ` : ''}
                        <div class="rec-section">
                            <div class="rec-section-title">Deployment Model</div>
                            <div class="rec-section-value">${deployment}</div>
                        </div>
                        ${features.length > 0 ? `
                            <div class="rec-section">
                                <div class="rec-section-title">Recommended Features</div>
                                <div class="rec-section-value">${features.join(', ')}</div>
                            </div>
                        ` : ''}
                        ${reasoning ? `
                            <div class="rec-section">
                                <div class="rec-section-title">Why This Recommendation?</div>
                                <div class="rec-section-value" style="font-size: 1rem; font-weight: 500; line-height: 1.5;">${reasoning}</div>
                            </div>
                        ` : ''}
                    </div>

                    <div class="rec-actions">
                        <button class="wizard-btn secondary" onclick="restartWizard()">Start Over</button>
                        <button class="wizard-btn primary" onclick="viewExpertPath()">See Full Decision Tree ‚Üí</button>
                    </div>
                </div>
            `;
            } catch (error) {
                console.error('Error generating recommendation:', error);
                const wizardContent = document.getElementById('wizard-content');
                wizardContent.innerHTML = `
                    <div class="wizard-card">
                        <div class="wizard-icon">‚ùå</div>
                        <h2 class="wizard-title">Error Generating Recommendation</h2>
                        <div class="wizard-subtitle">Something went wrong. Please try again or refresh the page.</div>
                        <div class="wizard-nav">
                            <button class="wizard-btn secondary" onclick="restartWizard()">Start Over</button>
                        </div>
                    </div>
                `;
            }
        }

        function restartWizard() {
            wizardData.answers = {};
            wizardData.currentStep = 0;
            renderWizardStep();
        }

        function viewExpertPath() {
            switchMode('expert');
            document.getElementById('back-to-guided').classList.add('visible');
        }

        document.getElementById('back-to-guided').addEventListener('click', () => {
            switchMode('guided');
        });

        // Initialize wizard on load
        window.addEventListener('DOMContentLoaded', () => {
            renderWizardStep();
        });

        // --- CONTENT DATABASE ---
        const nodeData = {
            "ObjMatch": {
                title: "Developer Experience",
                value: "Code-Native Data Access",
                detail: "Work with data as natural JSON objects. Eliminates the 'Object-Relational Impedance Mismatch' and removes the need for complex, brittle ORM layers like Hibernate or Prisma.",
                link: "https://www.mongodb.com/docs/drivers/odm/"
            },
            "AgileVal": {
                title: "Business Agility",
                value: "Faster Time-to-Market",
                detail: "Polymorphic schema allows you to launch new features without database downtime or running risky 'ALTER TABLE' migration scripts. The database adapts to your code, not vice versa.",
                link: "https://www.mongodb.com/docs/manual/data-modeling/design-patterns/data-versioning/schema-versioning/"
            },
            "Consolidation": {
                title: "Tech Stack Consolidation",
                value: "Lower TCO & Complexity",
                detail: "By combining Transactional, Search, AI, and Time Series workloads into one API, you remove the cost and maintenance burden of syncing 3-4 separate niche databases.",
                link: "https://www.mongodb.com/products/platform"
            },
            "Logical": {
                title: "Logical Sharding",
                value: "Simple Multi-Tenancy",
                detail: "Isolates tenants using a 'tenant_id' field within standard collections. Ideal for high-volume SaaS where tenants share resources but need logical separation.",
                link: "https://www.mongodb.com/docs/manual/core/moveable-collections/multi-tenant/"
            },
            "TenantShard": {
                title: "Tenant-Aware Sharding",
                value: "Physical Isolation",
                detail: "Pin specific tenants to specific hardware. Allows you to offer 'Premium Tier' performance on dedicated NVMe nodes while keeping 'Free Tier' users on shared hardware‚Äîall in one cluster.",
                link: "https://www.mongodb.com/docs/manual/sharding//"
            },
            "MongoCore": {
                title: "MongoDB Core",
                value: "The Intelligent Document Database",
                detail: "The foundation. Stores data in BSON (Binary JSON), supporting rich indexing, ACID transactions, and aggregations. It scales horizontally by default.",
                link: "https://www.mongodb.com/docs/manual/core/document/"
            },
            "Migrator": {
                title: "Relational Migrator",
                value: "Automated Modernization",
                detail: "Analyzes legacy SQL schemas and automatically generates optimized MongoDB document models and code. De-risks the migration process.",
                link: "https://www.mongodb.com/products/relational-migrator"
            },
            "AMP": {
                title: "MongoDB AMP",
                value: "Application Modernization Platform",
                detail: "An integrated platform extending Relational Migrator to help modernize legacy applications. Includes schema transformation, code migration, and testing capabilities to accelerate the journey from monolithic SQL systems to modern MongoDB architectures.",
                link: "https://www.mongodb.com/resources/basics/application-modernization"
            },
            "HashShard": {
                title: "Hashed Sharding",
                value: "Perfect Write Distribution",
                detail: "Distributes data based on a hash of the shard key. Ensures writes are spread evenly across all nodes, preventing 'hotspots' during massive ingest events.",
                link: "https://www.mongodb.com/docs/manual/core/hashed-sharding/"
            },
            "ZoneShard": {
                title: "Zone Sharding",
                value: "Data Locality / Sovereignty",
                detail: "Allows you to tag shards by geography (e.g., 'EU-West'). Data for German users stays physically on German servers to comply with GDPR, while US data stays in Virginia.",
                link: "https://www.mongodb.com/docs/manual/core/zone-sharding/"
            },
            "RangeShard": {
                title: "Ranged Sharding",
                value: "Optimized Range Queries",
                detail: "Divides data into continuous ranges (e.g., Time or Alphabetical). Ideal for efficient queries that scan a specific window of time or sequence.",
                link: "https://www.mongodb.com/docs/manual/core/ranged-sharding/"
            },
            "Replica": {
                title: "Replica Set",
                value: "High Availability (HA)",
                detail: "A group of at least 3 nodes that maintain the same data set. Provides automatic failover and data redundancy. If the primary crashes, a secondary takes over in seconds.",
                link: "https://www.mongodb.com/docs/manual/replication/"
            },
            "ASP": {
                title: "Atlas Stream Processing",
                value: "Analyze Data In-Flight",
                detail: "Process high-velocity streams (Kafka/EventHub) continuously before storing them. Use standard MongoDB aggregation syntax to build real-time alerts and views.",
                link: "https://www.mongodb.com/products/platform/atlas-stream-processing"
            },
            "AtlasSearch": {
                title: "Atlas Search",
                value: "Lucene-Powered Search",
                detail: "Full-text search integrated into the database. Features fuzzy matching, autocomplete, and highlighting without managing a separate Elasticsearch cluster.",
                link: "https://www.mongodb.com/docs/atlas/atlas-search/"
            },
            "Vector": {
                title: "Vector Search",
                value: "Unified Memory for AI",
                detail: "Store and query vector embeddings alongside operational data. Enables semantic search and RAG workflows without an external vector DB.",
                link: "https://www.mongodb.com/products/platform/atlas-vector-search"
            },
            "AgentMem": {
                title: "Agent Memory",
                value: "Long-Term Context",
                detail: "Use MongoDB to store conversation history and context for AI Agents. Vector search retrieves relevant past interactions to make the AI smarter over time.",
                link: "https://www.mongodb.com/developer/products/atlas/building-generative-ai-applications-vector-search/"
            },
            "SemCache": {
                title: "Semantic Cache",
                value: "Reduce LLM Costs",
                detail: "Cache LLM responses based on semantic similarity. If a user asks a question similar to a previous one, serve the cached answer instantly instead of paying for a new GPU call.",
                link: "https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-overview/"
            },
            "RAG": {
                title: "RAG (Retrieval Augmented Generation)",
                value: "Ground AI in Truth",
                detail: "Retrieve accurate, private enterprise data from MongoDB and feed it to the LLM to prevent hallucinations and provide domain-specific answers.",
                link: "https://www.mongodb.com/docs/atlas/atlas-vector-search/tutorials/local-rag/"
            },
            "TimeSeries": {
                title: "Time Series Collections",
                value: "IoT Efficiency",
                detail: "Columnar storage optimized for time-series data. significantly reduces storage costs and improves query speed for sensor data and metrics.",
                link: "https://www.mongodb.com/docs/manual/core/timeseries-collections/"
            },
            "Connectors": {
                title: "Ecosystem Connectors",
                value: "Enterprise Integration",
                detail: "Official connectors for Kafka, Spark, Flink, and Databricks. Ensures reliable, high-throughput data pipelines without custom glue code.",
                link: "https://www.mongodb.com/products/integrations/connectors"
            },
            "K8s": {
                title: "Enterprise Operator",
                value: "Kubernetes Native",
                detail: "Deploy and manage MongoDB clusters inside your own Kubernetes environment (OpenShift/EKS/AKS). Automates upgrades, scaling, and backups.",
                link: "https://www.mongodb.com/docs/kubernetes/current/"
            },
            "OpsMan": {
                title: "Ops Manager",
                value: "On-Prem Automation",
                detail: "The management plane for self-managed deployments. Provides a GUI for deploying, monitoring, and backing up clusters on VMs or Bare Metal.",
                link: "https://www.mongodb.com/docs/ops-manager/current/"
            },
            "PrivLink": {
                title: "PrivateLink",
                value: "Secure Unidirectional Access",
                detail: "The gold standard for cloud security. Allows your VPC to connect to MongoDB Atlas privately without traversing the public internet or exposing ports.",
                link: "https://www.mongodb.com/docs/atlas/security-private-endpoint/"
            },
            "Peering": {
                title: "VPC Peering",
                value: "Bi-Directional Networking",
                detail: "Connects your VPC network directly to the Atlas VPC network. Useful for legacy setups, though PrivateLink is generally preferred for tighter security.",
                link: "https://www.mongodb.com/docs/atlas/security-vpc-peering/"
            },
            "IPList": {
                title: "IP Access List",
                value: "Basic Firewalling",
                detail: "Allow access only from specific IP addresses or CIDR blocks. Simple to set up for development or smaller deployments.",
                link: "https://www.mongodb.com/docs/atlas/security/ip-access-list/"
            },
            "MultiCloud": {
                title: "Multi-Cloud Cluster",
                value: "Ultimate Resilience",
                detail: "Span your cluster across AWS, Azure, and Google Cloud simultaneously. Protects against entire cloud provider outages.",
                link: "https://www.mongodb.com/docs/atlas/create-database-deployment/#global-clusters"
            },
            "Standard": {
                title: "Standard Cluster",
                value: "Reliable & Cost-Effective",
                detail: "A standard 3-node replica set deployed in a single region. Provides 99.99% uptime and automatic failover for most production workloads.",
                link: "https://www.mongodb.com/pricing"
            },
            "Archive": {
                title: "Online Archive",
                value: "Cost-Efficient History",
                detail: "Automatically moves old data to cheap S3 object storage while keeping it queryable. Reduces the cost of storing petabytes of historical logs.",
                link: "https://www.mongodb.com/docs/atlas/online-archive/overview/"
            },
            "PerfAdv": {
                title: "Performance Advisor",
                value: "24/7 Intelligent Ops",
                detail: "A built-in tool that analyzes your slow queries and automatically suggests indexes to fix them. It acts as an automated DBA.",
                link: "https://www.mongodb.com/docs/atlas/performance-advisor/"
            },
            "CSFLE": {
                title: "Security and Compliance at everylevel",
                value: "Encryption-in-Use",
                detail: "State-of-the-art security, compliance, and encryption, with the ability to query encrypted data.",
                link: "https://trust.mongodb.com/"
            }
        };

        // --- INTERACTIVITY LOGIC ---
        var panZoomInstance;

        // 1. Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, securityLevel: 'loose' });

        // 2. Define the Click Handler
        window.showInfo = function(nodeId) {
            // Prevent event bubbling so clicking a node doesn't immediately close the drawer via body click
            event.stopPropagation();

            const data = nodeData[nodeId];
            if (data) {
                document.getElementById('drawer-title').innerText = data.title;
                document.getElementById('drawer-value').innerText = data.value;
                document.getElementById('drawer-details').innerText = data.detail;
                
                const linkBtn = document.getElementById('drawer-link');
                if (data.link) {
                    linkBtn.href = data.link;
                    linkBtn.classList.remove('no-link');
                    linkBtn.innerHTML = "<span>Read Documentation ‚Üí</span>";
                    linkBtn.style.pointerEvents = "auto";
                } else {
                    linkBtn.classList.add('no-link');
                    linkBtn.innerHTML = "<span>No Link Available</span>";
                    linkBtn.style.pointerEvents = "none";
                }
                
                // Open Drawer
                document.getElementById('side-drawer').classList.add('open');
            }
        };

        window.closeDrawer = function() {
            document.getElementById('side-drawer').classList.remove('open');
        };



    </script>
</body>
</html>