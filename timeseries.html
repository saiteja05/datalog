<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Time Series Collections - Deep Dive</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><path fill='%2300ED64' d='M15.9.2l.9 1.9c.2.4.5.8.8 1.1 2.2 2.1 3.5 4.6 4.1 7.6.3 1.4.3 2.9.2 4.4-.2 2.1-.8 4-1.8 5.8-1.5 2.7-3.6 4.8-6.3 6.3-.3.2-.6.3-1 .5v-1.5c0-.3 0-.5.1-.8.3-1.4.3-2.9 0-4.3-.2-1-.6-1.9-1.2-2.7-.4-.5-.8-1-1.3-1.4-.2-.2-.3-.3-.3-.6 0-2.5.4-4.9 1.4-7.2.7-1.6 1.6-3 2.8-4.3.5-.6 1-1.1 1.5-1.7.3-.4.6-.8.9-1.2.1-.1.1-.2.1-.3l.1-.6z'/><path fill='%23B8C4C2' d='M15.9.2l-.1.6c0 .1 0 .2-.1.3-.3.4-.6.8-.9 1.2-.5.6-1 1.1-1.5 1.7-1.2 1.3-2.1 2.7-2.8 4.3-1 2.3-1.4 4.7-1.4 7.2 0 .3.1.4.3.6.5.4.9.9 1.3 1.4.6.8 1 1.7 1.2 2.7.3 1.4.3 2.9 0 4.3-.1.3-.1.5-.1.8v1.5c-.1 0-.1.1-.2.1-.1-.1-.1-.1-.1-.2v-5.9c0-.2 0-.3-.2-.4-.5-.3-.8-.7-.9-1.3-.1-.5 0-1 .3-1.4.1-.2.1-.3 0-.5-.4-.8-.5-1.6-.4-2.5.1-.7.4-1.3.9-1.8.1-.1.1-.2.1-.4-.2-1.2-.1-2.3.3-3.4.3-.9.8-1.6 1.5-2.2.1-.1.2-.2.2-.4.1-1.5.5-2.9 1.2-4.2.2-.3.3-.6.5-.9 0 0 .1-.1.1-.2l-.1.2z'/></svg>" type="image/svg+xml">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #111821;
            --bg-tertiary: #1a2332;
            --accent-green: #00ed64;
            --accent-green-dim: #00ed6433;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --accent-orange: #f97316;
            --accent-pink: #ec4899;
            --accent-cyan: #22d3ee;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #1e293b;
            --card-bg: linear-gradient(135deg, #111821 0%, #1a2332 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0, 237, 100, 0.15), transparent),
                radial-gradient(ellipse 60% 40% at 80% 80%, rgba(59, 130, 246, 0.1), transparent),
                radial-gradient(ellipse 40% 30% at 10% 60%, rgba(168, 85, 247, 0.08), transparent);
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-image: 
                linear-gradient(rgba(0, 237, 100, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 237, 100, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            padding: 80px 40px 60px;
            text-align: center;
        }

        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: var(--accent-green-dim);
            border: 1px solid var(--accent-green);
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--accent-green);
            margin-bottom: 24px;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 237, 100, 0.2); }
            50% { box-shadow: 0 0 40px rgba(0, 237, 100, 0.4); }
        }

        .header h1 {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-green) 50%, var(--accent-cyan) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -2px;
        }

        .header p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px 80px;
        }

        /* Section Styling */
        .section {
            margin-bottom: 80px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .section-number {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-cyan) 100%);
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--bg-primary);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--accent-green);
            box-shadow: 0 0 40px rgba(0, 237, 100, 0.1);
            transform: translateY(-2px);
        }

        /* Intro Grid */
        .intro-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        .intro-card {
            text-align: center;
            padding: 40px 24px;
        }

        .intro-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            font-size: 2.5rem;
        }

        .intro-card:nth-child(1) .intro-icon {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%);
        }

        .intro-card:nth-child(2) .intro-icon {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%);
        }

        .intro-card:nth-child(3) .intro-icon {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.05) 100%);
        }

        .intro-card h3 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .intro-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Time Series Flow Visualization */
        .flow-container {
            position: relative;
            padding: 60px 40px;
            overflow: hidden;
        }

        .flow-stage {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
            margin-bottom: 60px;
        }

        .flow-stage:last-child {
            margin-bottom: 0;
        }

        .flow-box {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            position: relative;
        }

        .flow-box-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .flow-box-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .flow-box-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--accent-green);
            flex-shrink: 0;
            animation: arrow-pulse 1.5s ease-in-out infinite;
        }

        @keyframes arrow-pulse {
            0%, 100% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(5px); opacity: 0.6; }
        }

        /* Document Visualization */
        .documents-incoming {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .doc-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            animation: doc-flow 2s ease-in-out infinite;
        }

        .doc-item:nth-child(2) { animation-delay: 0.3s; }
        .doc-item:nth-child(3) { animation-delay: 0.6s; }
        .doc-item:nth-child(4) { animation-delay: 0.9s; }
        .doc-item:nth-child(5) { animation-delay: 1.2s; }

        @keyframes doc-flow {
            0%, 100% { transform: translateX(0); opacity: 0.7; }
            50% { transform: translateX(5px); opacity: 1; }
        }

        .doc-time {
            color: var(--accent-cyan);
            font-weight: 500;
        }

        .doc-meta {
            color: var(--accent-purple);
        }

        .doc-value {
            color: var(--accent-green);
        }

        /* Bucket Visualization */
        .bucket-container {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 237, 100, 0.02) 100%);
            border: 2px dashed var(--accent-green);
            border-radius: 16px;
            padding: 20px;
        }

        .bucket-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 237, 100, 0.2);
        }

        .bucket-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-green);
        }

        .bucket-range {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .bucket-docs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .bucket-doc {
            width: 8px;
            height: 24px;
            background: var(--accent-green);
            border-radius: 2px;
            animation: bucket-fill 0.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes bucket-fill {
            to { opacity: 1; }
        }

        /* Compression Visualization */
        .compression-viz {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 24px;
            align-items: center;
        }

        .data-block {
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }

        .data-raw {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(249, 115, 22, 0.05) 100%);
            border: 1px solid var(--accent-orange);
        }

        .data-compressed {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%);
            border: 1px solid var(--accent-green);
        }

        .data-size {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 8px;
        }

        .data-raw .data-size { color: var(--accent-orange); }
        .data-compressed .data-size { color: var(--accent-green); }

        .data-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .compression-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .compression-ratio {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-green);
        }

        /* Internal Architecture */
        .architecture-diagram {
            position: relative;
            padding: 40px;
        }

        .arch-layer {
            display: flex;
            align-items: stretch;
            gap: 24px;
            margin-bottom: 40px;
            position: relative;
        }

        .arch-layer::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, var(--accent-green), transparent);
        }

        .arch-layer:last-child::after {
            display: none;
        }

        .arch-box {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .arch-box:hover {
            border-color: var(--accent-green);
            transform: scale(1.02);
        }

        .arch-box.highlight {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 237, 100, 0.02) 100%);
        }

        .arch-box-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--bg-secondary);
            font-size: 1.5rem;
        }

        .arch-box h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .arch-box p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Bucket Detail Visualization */
        .bucket-detail {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 32px;
        }

        .bucket-structure {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .struct-field {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .struct-field:last-child {
            margin-bottom: 0;
        }

        .field-meta {
            background: rgba(168, 85, 247, 0.1);
            border-left: 3px solid var(--accent-purple);
        }

        .field-time {
            background: rgba(34, 211, 238, 0.1);
            border-left: 3px solid var(--accent-cyan);
        }

        .field-data {
            background: rgba(0, 237, 100, 0.1);
            border-left: 3px solid var(--accent-green);
        }

        .field-control {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--accent-blue);
        }

        .field-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: 4px;
        }

        .field-value {
            color: var(--text-primary);
        }

        /* Column Storage Visualization */
        .column-storage {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .column {
            background: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .column-header {
            padding: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .column:nth-child(1) .column-header { background: rgba(34, 211, 238, 0.2); color: var(--accent-cyan); }
        .column:nth-child(2) .column-header { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        .column:nth-child(3) .column-header { background: rgba(0, 237, 100, 0.2); color: var(--accent-green); }
        .column:nth-child(4) .column-header { background: rgba(249, 115, 22, 0.2); color: var(--accent-orange); }

        .column-values {
            padding: 12px;
        }

        .column-value {
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            text-align: center;
        }

        .column-value:last-child {
            margin-bottom: 0;
        }

        /* Delta Encoding Visualization */
        .delta-viz {
            display: grid;
            grid-template-columns: 1fr 60px 1fr;
            gap: 24px;
            align-items: start;
        }

        .delta-original, .delta-encoded {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .delta-title {
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .delta-original .delta-title { color: var(--accent-orange); }
        .delta-encoded .delta-title { color: var(--accent-green); }

        .delta-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border-radius: 6px;
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .delta-row:last-child {
            margin-bottom: 0;
        }

        .delta-arrow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-green);
            font-size: 1.5rem;
        }

        /* Interactive Bucket Demo */
        .bucket-demo {
            padding: 32px;
        }

        .demo-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
        }

        .demo-btn {
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-btn:hover {
            border-color: var(--accent-green);
            background: var(--accent-green-dim);
        }

        .demo-btn.active {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
        }

        .demo-canvas {
            min-height: 300px;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        /* Animated Data Stream */
        .data-stream {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

        .stream-doc {
            position: absolute;
            left: 0;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            white-space: nowrap;
            animation: stream-flow 4s linear infinite;
        }

        @keyframes stream-flow {
            0% { transform: translateX(-100%); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(calc(100vw + 100%)); opacity: 0; }
        }

        /* Buckets Animation */
        .buckets-display {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .animated-bucket {
            width: 200px;
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.15) 0%, rgba(0, 237, 100, 0.02) 100%);
            border: 2px solid var(--accent-green);
            border-radius: 12px;
            padding: 16px;
            animation: bucket-appear 0.5s ease-out forwards;
        }

        @keyframes bucket-appear {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animated-bucket-header {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--accent-green);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 237, 100, 0.3);
        }

        .bucket-fill-bar {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .bucket-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 40px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--accent-green);
            transform: translateY(-4px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 8px;
        }

        .stat-card:nth-child(1) .stat-value { color: var(--accent-green); }
        .stat-card:nth-child(2) .stat-value { color: var(--accent-cyan); }
        .stat-card:nth-child(3) .stat-value { color: var(--accent-purple); }
        .stat-card:nth-child(4) .stat-value { color: var(--accent-orange); }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Code Block */
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            overflow: hidden;
            margin: 24px 0;
        }

        .code-header {
            background: #161b22;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .code-dot.red { background: #ff5f56; }
        .code-dot.yellow { background: #ffbd2e; }
        .code-dot.green { background: #27c93f; }

        .code-title {
            margin-left: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .code-content {
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            overflow-x: auto;
        }

        .code-content .keyword { color: #ff7b72; }
        .code-content .string { color: #a5d6ff; }
        .code-content .property { color: #79c0ff; }
        .code-content .value { color: #7ee787; }
        .code-content .comment { color: #8b949e; }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--accent-green), var(--accent-cyan), var(--accent-purple));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 32px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            left: -33px;
            top: 4px;
            width: 16px;
            height: 16px;
            background: var(--accent-green);
            border-radius: 50%;
            border: 3px solid var(--bg-primary);
        }

        .timeline-content {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }

        .timeline-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-cyan);
            margin-bottom: 8px;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .timeline-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .intro-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .column-storage {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bucket-detail {
                grid-template-columns: 1fr;
            }
            
            .compression-viz {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .compression-arrow {
                transform: rotate(90deg);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 0 20px 60px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .flow-stage {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .comparison-table th:first-child {
            border-radius: 12px 0 0 0;
        }

        .comparison-table th:last-child {
            border-radius: 0 12px 0 0;
        }

        .comparison-table td {
            background: var(--bg-secondary);
        }

        .comparison-table tr:last-child td:first-child {
            border-radius: 0 0 0 12px;
        }

        .comparison-table tr:last-child td:last-child {
            border-radius: 0 0 12px 0;
        }

        .comparison-table .highlight-cell {
            color: var(--accent-green);
            font-weight: 600;
        }

        .comparison-table .dim-cell {
            color: var(--text-muted);
        }

        /* Process Flow */
        .process-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 40px 20px;
            position: relative;
        }

        .process-flow::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan), var(--accent-purple), var(--accent-orange));
            z-index: 0;
        }

        .process-step {
            position: relative;
            z-index: 1;
            text-align: center;
            width: 120px;
        }

        .process-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            border: 3px solid var(--accent-green);
            border-radius: 50%;
            font-size: 1.5rem;
        }

        .process-step:nth-child(2) .process-icon { border-color: var(--accent-cyan); }
        .process-step:nth-child(3) .process-icon { border-color: var(--accent-purple); }
        .process-step:nth-child(4) .process-icon { border-color: var(--accent-orange); }

        .process-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.02) 100%);
            border: 1px solid var(--accent-blue);
            border-radius: 12px;
            padding: 20px 24px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin: 24px 0;
        }

        .info-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .info-content h4 {
            color: var(--accent-blue);
            margin-bottom: 8px;
        }

        .info-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Enhanced Memory Visualization */
        .memory-viz {
            position: relative;
            padding: 40px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .memory-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
        }

        .memory-block {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .memory-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(90deg, var(--accent-purple) 0%, var(--accent-pink) 100%);
            opacity: 0.2;
        }

        .memory-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--accent-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .memory-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .memory-stat {
            background: rgba(168, 85, 247, 0.1);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .memory-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-purple);
        }

        .memory-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Bucket Catalog Visualization */
        .bucket-catalog {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .catalog-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .catalog-title {
            font-weight: 600;
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .catalog-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .bucket-entry {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bucket-entry:hover {
            transform: translateX(4px);
            border-left-color: var(--accent-green);
        }

        .bucket-entry.open {
            border-left-color: var(--accent-green);
            background: linear-gradient(90deg, rgba(0, 237, 100, 0.1) 0%, var(--bg-secondary) 100%);
        }

        .bucket-entry.closed {
            border-left-color: var(--accent-cyan);
            opacity: 0.7;
        }

        .bucket-entry.archived {
            border-left-color: var(--text-muted);
            opacity: 0.5;
        }

        .bucket-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .bucket-status.open {
            background: var(--accent-green);
            box-shadow: 0 0 10px var(--accent-green);
            animation: status-pulse 2s ease-in-out infinite;
        }

        .bucket-status.closed {
            background: var(--accent-cyan);
        }

        .bucket-status.archived {
            background: var(--text-muted);
        }

        @keyframes status-pulse {
            0%, 100% { box-shadow: 0 0 10px var(--accent-green); }
            50% { box-shadow: 0 0 20px var(--accent-green); }
        }

        .bucket-info {
            flex: 1;
        }

        .bucket-meta-info {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        .bucket-time-range {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .bucket-size {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-orange);
        }

        /* Bucket State Machine */
        .state-machine {
            position: relative;
            padding: 40px 20px;
        }

        .state-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .state-flow::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 80px;
            right: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan), var(--accent-purple), var(--accent-orange));
            transform: translateY(-50%);
            z-index: 0;
        }

        .state-node {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .state-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            border: 4px solid;
            margin: 0 auto 12px;
            transition: all 0.3s ease;
        }

        .state-circle:hover {
            transform: scale(1.1);
        }

        .state-node:nth-child(1) .state-circle { border-color: var(--accent-green); }
        .state-node:nth-child(2) .state-circle { border-color: var(--accent-cyan); }
        .state-node:nth-child(3) .state-circle { border-color: var(--accent-purple); }
        .state-node:nth-child(4) .state-circle { border-color: var(--accent-orange); }

        .state-icon {
            font-size: 2rem;
            margin-bottom: 4px;
        }

        .state-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .state-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            max-width: 120px;
            margin: 0 auto;
        }

        /* Trigger Conditions */
        .trigger-conditions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 40px;
        }

        .trigger-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .trigger-card:hover {
            border-color: var(--accent-orange);
            transform: translateY(-4px);
        }

        .trigger-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(249, 115, 22, 0.1);
            border-radius: 12px;
            font-size: 1.5rem;
        }

        .trigger-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--accent-orange);
        }

        .trigger-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .trigger-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Interactive Memory Demo */
        .memory-demo {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
            border: 1px solid var(--accent-purple);
            border-radius: 16px;
            padding: 32px;
            margin-top: 32px;
        }

        .memory-demo-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .memory-gauge {
            width: 200px;
            height: 20px;
            background: var(--bg-secondary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .memory-gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan), var(--accent-purple));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .memory-gauge-label {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-primary);
        }

        /* Live Bucket Grid */
        .live-bucket-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .live-bucket {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .live-bucket::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-green);
        }

        .live-bucket.open::before {
            background: var(--accent-green);
            animation: bucket-pulse 1s ease-in-out infinite;
        }

        .live-bucket.closing::before {
            background: var(--accent-orange);
        }

        .live-bucket.closed::before {
            background: var(--accent-cyan);
        }

        @keyframes bucket-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-bucket-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .live-bucket-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--accent-green);
        }

        .live-bucket-status {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .live-bucket-status.open {
            background: rgba(0, 237, 100, 0.2);
            color: var(--accent-green);
        }

        .live-bucket-status.closing {
            background: rgba(249, 115, 22, 0.2);
            color: var(--accent-orange);
        }

        .live-bucket-status.closed {
            background: rgba(34, 211, 238, 0.2);
            color: var(--accent-cyan);
        }

        .live-bucket-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .live-bucket-progress {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .live-bucket-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .live-bucket-stats {
            display: flex;
            justify-content: space-between;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Detailed Architecture Diagram */
        .detail-arch {
            position: relative;
        }

        .arch-connection {
            stroke: var(--accent-green);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5, 5;
            animation: dash-flow 1s linear infinite;
        }

        @keyframes dash-flow {
            to { stroke-dashoffset: -10; }
        }

        /* Interactive Tabs */
        .tab-container {
            margin-top: 24px;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            border-color: var(--accent-green);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--bg-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Compression Algorithm Visualization */
        .compression-stages {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .compression-stage {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .compression-stage::after {
            content: 'â†’';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-green);
            font-size: 1.5rem;
        }

        .compression-stage:last-child::after {
            display: none;
        }

        .stage-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 1.5rem;
        }

        .compression-stage:nth-child(1) .stage-icon { background: rgba(249, 115, 22, 0.2); }
        .compression-stage:nth-child(2) .stage-icon { background: rgba(168, 85, 247, 0.2); }
        .compression-stage:nth-child(3) .stage-icon { background: rgba(34, 211, 238, 0.2); }
        .compression-stage:nth-child(4) .stage-icon { background: rgba(0, 237, 100, 0.2); }

        .stage-name {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .stage-size {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .compression-stage:nth-child(1) .stage-size { color: var(--accent-orange); }
        .compression-stage:nth-child(2) .stage-size { color: var(--accent-purple); }
        .compression-stage:nth-child(3) .stage-size { color: var(--accent-cyan); }
        .compression-stage:nth-child(4) .stage-size { color: var(--accent-green); }

        .stage-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* WiredTiger Diagram */
        .wiredtiger-flow {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow-x: auto;
        }

        .wt-component {
            flex-shrink: 0;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            min-width: 140px;
            transition: all 0.3s ease;
        }

        .wt-component:hover {
            border-color: var(--accent-green);
            transform: scale(1.05);
        }

        .wt-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .wt-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .wt-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .wt-arrow {
            font-size: 1.5rem;
            color: var(--accent-cyan);
            flex-shrink: 0;
            animation: arrow-flow 1s ease-in-out infinite;
        }

        @keyframes arrow-flow {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(5px); }
        }

        /* Hover Info Tooltip */
        .tooltip-trigger {
            position: relative;
            cursor: help;
            border-bottom: 1px dashed var(--accent-cyan);
        }

        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            border: 1px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 12px 16px;
            width: 250px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
        }

        .tooltip-trigger:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 10px);
        }

        /* Navigation dots */
        .nav-dots {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot:hover, .nav-dot.active {
            background: var(--accent-green);
            transform: scale(1.3);
        }

        /* Master Index Navigation */
        .master-index {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
        }

        .index-toggle {
            width: 50px;
            height: 50px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            gap: 2px;
        }

        .index-toggle:hover {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .index-toggle:hover span {
            color: var(--bg-primary);
        }

        .index-toggle span:first-child {
            font-size: 1.2rem;
        }

        .index-label {
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .index-content {
            position: absolute;
            left: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            width: 320px;
            max-height: 80vh;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .index-content.show {
            opacity: 1;
            visibility: visible;
        }

        .index-content::-webkit-scrollbar {
            width: 6px;
        }

        .index-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .index-content::-webkit-scrollbar-thumb {
            background: var(--accent-green);
            border-radius: 3px;
        }

        .index-group {
            margin-bottom: 16px;
        }

        .index-group:last-child {
            margin-bottom: 0;
        }

        .index-group-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }

        .index-item {
            display: block;
            padding: 6px 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            margin-bottom: 2px;
        }

        .index-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding-left: 16px;
        }

        .index-item.active {
            background: var(--accent-green-dim);
            color: var(--accent-green);
        }

        /* Master Section Headers */
        .master-section-header {
            padding: 40px 0 20px;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }

        .master-section-header::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100px;
            height: 2px;
        }

        .master-section-header.fundamentals::before { background: var(--accent-green); }
        .master-section-header.core::before { background: var(--accent-cyan); }
        .master-section-header.architecture::before { background: var(--accent-purple); }
        .master-section-header.operations::before { background: var(--accent-orange); }
        .master-section-header.comparisons::before { background: var(--accent-pink); }
        .master-section-header.tools::before { background: var(--accent-blue); }

        .master-section-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .master-section-badge.fundamentals { background: rgba(0, 237, 100, 0.1); color: var(--accent-green); }
        .master-section-badge.core { background: rgba(34, 211, 238, 0.1); color: var(--accent-cyan); }
        .master-section-badge.architecture { background: rgba(168, 85, 247, 0.1); color: var(--accent-purple); }
        .master-section-badge.operations { background: rgba(249, 115, 22, 0.1); color: var(--accent-orange); }
        .master-section-badge.comparisons { background: rgba(236, 72, 153, 0.1); color: var(--accent-pink); }
        .master-section-badge.tools { background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); }

        .master-section-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .master-section-desc {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        @media (max-width: 1200px) {
            .master-index {
                left: 10px;
            }
            
            .index-content {
                width: 280px;
                left: 55px;
            }
        }

        @media (max-width: 768px) {
            .master-index {
                top: auto;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .index-content {
                left: 50%;
                transform: translateX(-50%);
                top: auto;
                bottom: 60px;
                max-height: 60vh;
            }
        }
        
        /* Index Query Visualizer Styles */
        .index-query-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 14px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 110px;
        }
        
        .index-query-btn:hover {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
            transform: translateY(-2px);
        }
        
        .index-query-btn.active {
            border-color: var(--accent-green);
            background: rgba(0, 237, 100, 0.15);
            color: var(--text-primary);
            box-shadow: 0 0 20px rgba(0, 237, 100, 0.2);
        }
        
        .index-exec-step {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.4s ease;
            border-left: 3px solid transparent;
        }
        
        .index-exec-step.active {
            opacity: 1 !important;
            border-left-color: var(--accent-green);
            background: rgba(0, 237, 100, 0.05);
            transform: translateX(4px);
        }
        
        .index-exec-step.completed {
            opacity: 0.7;
            border-left-color: var(--accent-cyan);
        }
        
        .index-step-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .index-step-content {
            flex: 1;
        }
        
        .index-step-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.85rem;
            margin-bottom: 2px;
        }
        
        .index-step-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .index-step-detail {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--accent-cyan);
            margin-top: 6px;
            padding: 6px 10px;
            background: var(--bg-primary);
            border-radius: 6px;
            display: none;
        }
        
        .index-exec-step.active .index-step-detail,
        .index-exec-step.completed .index-step-detail {
            display: block;
        }
        
        .index-step-status {
            font-size: 1rem;
        }
        
        .btree-node {
            transition: all 0.3s ease;
        }
        
        .btree-node.highlight rect {
            stroke: var(--accent-green) !important;
            stroke-width: 3 !important;
            filter: drop-shadow(0 0 8px rgba(0, 237, 100, 0.5));
        }
        
        .btree-node.dimmed {
            opacity: 0.2;
        }
        
        .btree-node.scanning rect {
            animation: scanPulse 0.5s ease infinite;
        }
        
        @keyframes scanPulse {
            0%, 100% { stroke: var(--accent-cyan); }
            50% { stroke: var(--accent-green); filter: drop-shadow(0 0 10px rgba(0, 237, 100, 0.8)); }
        }
        
        #runIndexQuery:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 237, 100, 0.3);
        }
        
        #runIndexQuery:active {
            transform: translateY(0);
        }
        
        #runIndexQuery.running {
            background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-purple) 100%);
            pointer-events: none;
        }
        
        /* Storage Bucket Styles */
        .storage-bucket {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.7rem;
            transition: all 0.4s ease;
        }
        
        .storage-bucket.fetched {
            border-color: var(--accent-green);
            background: rgba(0, 237, 100, 0.1);
            box-shadow: 0 0 15px rgba(0, 237, 100, 0.3);
        }
        
        .storage-bucket.pruned {
            border-color: var(--accent-orange);
            background: rgba(249, 115, 22, 0.1);
            opacity: 0.6;
        }
        
        .storage-bucket.skipped {
            opacity: 0.25;
            filter: grayscale(0.5);
        }
        
        .storage-bucket.decompressing {
            animation: decompress 0.5s ease infinite;
        }
        
        @keyframes decompress {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(0, 237, 100, 0.5); }
        }
        
        .bucket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .bucket-region {
            font-size: 0.6rem;
            padding: 2px 6px;
            background: var(--bg-secondary);
            border-radius: 8px;
            color: var(--text-muted);
        }
        
        .bucket-control {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .ctrl-label {
            color: var(--text-muted);
        }
        
        .bucket-status {
            margin-top: 6px;
            font-size: 0.6rem;
            color: var(--text-muted);
            text-align: center;
            padding: 3px;
            background: var(--bg-secondary);
            border-radius: 4px;
        }
        
        /* New Execution Step Style */
        .index-exec-step-v2 {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
            transition: all 0.4s ease;
            border: 2px solid transparent;
            opacity: 0.5;
        }
        
        .index-exec-step-v2.active {
            opacity: 1;
            border-color: var(--accent-green);
            background: rgba(0, 237, 100, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 237, 100, 0.2);
        }
        
        .index-exec-step-v2.completed {
            opacity: 0.8;
            border-color: var(--accent-cyan);
        }
        
        .index-exec-step-v2 .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            margin: 0 auto 8px;
        }
        
        .index-exec-step-v2 .step-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.8rem;
            margin-bottom: 2px;
        }
        
        .index-exec-step-v2 .step-desc {
            font-size: 0.65rem;
            color: var(--text-muted);
        }
        
        .index-exec-step-v2 .step-detail {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: var(--accent-cyan);
            margin-top: 8px;
            padding: 6px;
            background: var(--bg-primary);
            border-radius: 6px;
            display: none;
            word-break: break-all;
        }
        
        .index-exec-step-v2.active .step-detail,
        .index-exec-step-v2.completed .step-detail {
            display: block;
        }
        
        .index-exec-step-v2 .step-status {
            margin-top: 8px;
            font-size: 1rem;
        }
        
        .btree-node.highlight rect {
            stroke: var(--accent-green) !important;
            stroke-width: 3 !important;
            filter: drop-shadow(0 0 8px rgba(0, 237, 100, 0.6));
        }
        
        .btree-node.scanning rect {
            animation: indexScan 0.3s ease infinite;
        }
        
        @keyframes indexScan {
            0%, 100% { stroke-width: 2; }
            50% { stroke-width: 4; stroke: var(--accent-cyan); }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="grid-overlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-badge">
            <span>ðŸ“Š</span>
            <span>MongoDB 5.0+</span>
        </div>
        <h1>Time Series Collections</h1>
        <p>A deep dive into MongoDB's specialized storage for time-stamped data: bucketing, compression, and internal architecture</p>
    </header>

    <!-- Master Index Navigation -->
    <nav class="master-index" id="masterIndex">
        <div class="index-toggle" onclick="toggleIndex()">
            <span>ðŸ“‘</span>
            <span class="index-label">Index</span>
        </div>
        <div class="index-content" id="indexContent">
            <div style="font-size: 0.9rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--accent-green);">
                ðŸ“Š MongoDB Time Series Collections
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-green);">I. FUNDAMENTALS</div>
                <a href="#fundamentals" class="index-item">â†’ What & Why</a>
                <a href="#use-cases" class="index-item">â†’ Use Cases</a>
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-cyan);">II. CORE CONCEPTS</div>
                <a href="#bucket-structure" class="index-item">â†’ Bucket Structure</a>
                <a href="#granularity" class="index-item">â†’ Granularity â­</a>
                <a href="#data-flow" class="index-item">â†’ Data Flow</a>
                <a href="#compression" class="index-item">â†’ Compression</a>
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-purple);">III. ARCHITECTURE</div>
                <a href="#architecture" class="index-item">â†’ System Architecture</a>
                <a href="#memory" class="index-item">â†’ Memory Management â­</a>
                <a href="#wiredtiger" class="index-item">â†’ WiredTiger</a>
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-orange);">IV. OPERATIONS</div>
                <a href="#creating" class="index-item">â†’ Creating Collections</a>
                <a href="#write-query" class="index-item">â†’ Write & Query Paths</a>
                <a href="#query-pruning" class="index-item">â†’ Query Execution â­</a>
                <a href="#indexes" class="index-item">â†’ Secondary Indexes</a>
                <a href="#aggregations" class="index-item">â†’ Aggregations</a>
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-pink);">V. COMPARISONS</div>
                <a href="#vs-regular" class="index-item">â†’ vs Regular Collections</a>
                <a href="#vs-tsdb" class="index-item">â†’ vs Other TSDB</a>
                <a href="#limitations" class="index-item">â†’ Limitations âš ï¸</a>
            </div>
            <div class="index-group">
                <div class="index-group-title" style="color: var(--accent-blue);">VI. TOOLS</div>
                <a href="#best-practices" class="index-item">â†’ Best Practices</a>
                <a href="#calculator" class="index-item">â†’ Storage Calculator</a>
                <a href="#versions" class="index-item">â†’ Version History</a>
                <a href="#demo" class="index-item">â†’ Live Demo ðŸŽ®</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">

        <!-- ====== PART I: FUNDAMENTALS ====== -->
        <div class="master-section-header fundamentals">
            <div class="master-section-badge fundamentals">Part I</div>
            <h2 class="master-section-title">Fundamentals</h2>
            <p class="master-section-desc">Understanding what Time Series collections are and when to use them</p>
        </div>
        
        <!-- Section 1: Introduction -->
        <section class="section" id="fundamentals">
            <div class="section-header">
                <div class="section-number">01</div>
                <h2 class="section-title">What are Time Series Collections?</h2>
            </div>
            
            <!-- WHY: The Problem -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-green);">
                <h4 style="color: var(--accent-green); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>ðŸŽ¯</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 12px;">
                    <strong>The Problem:</strong> Time series data (IoT sensors, metrics, logs) generates massive volumes - often millions of documents per day. 
                    Regular MongoDB collections store each document separately, leading to:
                </p>
                <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                    <span style="background: rgba(249, 115, 22, 0.15); color: var(--accent-orange); padding: 6px 12px; border-radius: 6px; font-size: 0.8rem;">âŒ 10x more storage than needed</span>
                    <span style="background: rgba(249, 115, 22, 0.15); color: var(--accent-orange); padding: 6px 12px; border-radius: 6px; font-size: 0.8rem;">âŒ Slow range queries</span>
                    <span style="background: rgba(249, 115, 22, 0.15); color: var(--accent-orange); padding: 6px 12px; border-radius: 6px; font-size: 0.8rem;">âŒ Index bloat</span>
                </div>
                <p style="color: var(--text-secondary); margin-top: 12px;">
                    <strong>The Solution:</strong> Time Series collections automatically bucket, compress, and optimize this data - giving you <span style="color: var(--accent-green);">90%+ storage savings</span> and <span style="color: var(--accent-green);">10x faster queries</span> with zero application changes.
                </p>
            </div>
            
            <!-- WHAT: Core Features -->
            <div class="intro-grid">
                <div class="card intro-card">
                    <div class="intro-icon">â±ï¸</div>
                    <h3>Time-Ordered Data</h3>
                    <p>Optimized for data that arrives sequentially over time: IoT sensors, metrics, logs, stock prices, and any timestamped events.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon">ðŸ“¦</div>
                    <h3>Automatic Bucketing</h3>
                    <p>MongoDB groups documents into "buckets" based on time intervals and metadata, dramatically reducing storage overhead.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon">ðŸ—œï¸</div>
                    <h3>Column Compression</h3>
                    <p>Data within buckets is stored in columnar format with delta encoding, achieving up to 90%+ compression ratios.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Real-World Use Cases -->
        <section class="section" id="use-cases">
            <div class="section-header">
                <div class="section-number">02</div>
                <h2 class="section-title">Real-World Use Cases</h2>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
                <div class="card" style="margin: 0;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;">ðŸŒ¡ï¸</div>
                        <div>
                            <h3 style="color: var(--accent-green);">IoT Sensor Data</h3>
                            <p style="font-size: 0.85rem; color: var(--text-secondary);">Temperature, humidity, pressure readings</p>
                        </div>
                    </div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; background: var(--bg-secondary); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">// Document structure</div>
                        <div><span style="color: var(--accent-purple);">timeField:</span> <span style="color: var(--accent-cyan);">"timestamp"</span></div>
                        <div><span style="color: var(--accent-purple);">metaField:</span> <span style="color: var(--accent-cyan);">"device"</span></div>
                        <div><span style="color: var(--accent-purple);">granularity:</span> <span style="color: var(--accent-green);">"seconds"</span></div>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(0,237,100,0.1); color: var(--accent-green); border-radius: 20px;">High Frequency</span>
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(168,85,247,0.1); color: var(--accent-purple); border-radius: 20px;">~95% Compression</span>
                    </div>
                </div>
                
                <div class="card" style="margin: 0;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;">ðŸ“ˆ</div>
                        <div>
                            <h3 style="color: var(--accent-blue);">Financial Market Data</h3>
                            <p style="font-size: 0.85rem; color: var(--text-secondary);">Stock prices, trades, order book</p>
                        </div>
                    </div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; background: var(--bg-secondary); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">// Document structure</div>
                        <div><span style="color: var(--accent-purple);">timeField:</span> <span style="color: var(--accent-cyan);">"tradeTime"</span></div>
                        <div><span style="color: var(--accent-purple);">metaField:</span> <span style="color: var(--accent-cyan);">"symbol"</span></div>
                        <div><span style="color: var(--accent-purple);">granularity:</span> <span style="color: var(--accent-green);">"seconds"</span></div>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(59,130,246,0.1); color: var(--accent-blue); border-radius: 20px;">Ultra High Freq</span>
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(168,85,247,0.1); color: var(--accent-purple); border-radius: 20px;">~80% Compression</span>
                    </div>
                </div>
                
                <div class="card" style="margin: 0;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.05) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;">ðŸ–¥ï¸</div>
                        <div>
                            <h3 style="color: var(--accent-purple);">Application Metrics</h3>
                            <p style="font-size: 0.85rem; color: var(--text-secondary);">CPU, memory, latency metrics</p>
                        </div>
                    </div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; background: var(--bg-secondary); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">// Document structure</div>
                        <div><span style="color: var(--accent-purple);">timeField:</span> <span style="color: var(--accent-cyan);">"collectedAt"</span></div>
                        <div><span style="color: var(--accent-purple);">metaField:</span> <span style="color: var(--accent-cyan);">"host"</span></div>
                        <div><span style="color: var(--accent-purple);">granularity:</span> <span style="color: var(--accent-green);">"minutes"</span></div>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(168,85,247,0.1); color: var(--accent-purple); border-radius: 20px;">Medium Freq</span>
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(0,237,100,0.1); color: var(--accent-green); border-radius: 20px;">~90% Compression</span>
                    </div>
                </div>
                
                <div class="card" style="margin: 0;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(249, 115, 22, 0.05) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;">ðŸ“‹</div>
                        <div>
                            <h3 style="color: var(--accent-orange);">Event Logs</h3>
                            <p style="font-size: 0.85rem; color: var(--text-secondary);">Application logs, audit trails</p>
                        </div>
                    </div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; background: var(--bg-secondary); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">// Document structure</div>
                        <div><span style="color: var(--accent-purple);">timeField:</span> <span style="color: var(--accent-cyan);">"eventTime"</span></div>
                        <div><span style="color: var(--accent-purple);">metaField:</span> <span style="color: var(--accent-cyan);">"service"</span></div>
                        <div><span style="color: var(--accent-purple);">granularity:</span> <span style="color: var(--accent-green);">"hours"</span></div>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(249,115,22,0.1); color: var(--accent-orange); border-radius: 20px;">Variable Freq</span>
                        <span style="font-size: 0.7rem; padding: 4px 10px; background: rgba(168,85,247,0.1); color: var(--accent-purple); border-radius: 20px;">~70% Compression</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ====== PART II: CORE CONCEPTS ====== -->
        <div class="master-section-header core">
            <div class="master-section-badge core">Part II</div>
            <h2 class="master-section-title">Core Concepts</h2>
            <p class="master-section-desc">How buckets, granularity, data flow, and compression work together</p>
        </div>
        
        <!-- Section 3: Bucket Structure -->
        <section class="section" id="bucket-structure">
            <div class="section-header">
                <div class="section-number">03</div>
                <h2 class="section-title">Inside a Bucket Document</h2>
            </div>
            
            <!-- WHY: Understanding Buckets -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-purple);">
                <h4 style="color: var(--accent-purple); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>ðŸŽ¯</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary);">
                    <strong>Buckets are the secret sauce.</strong> Instead of storing 1 million individual documents, MongoDB groups them into ~1,000 buckets. 
                    Each bucket holds documents with the <span style="color: var(--accent-cyan);">same metadata</span> within a <span style="color: var(--accent-cyan);">time window</span>. 
                    This means: fewer documents to scan, better compression, and indexes that are 1000x smaller. Understanding bucket structure helps you choose the right granularity and metadata fields.
                </p>
            </div>
            
            <!-- DEMO: Visual Flow -->
            <div class="card flow-container">
                <div class="flow-stage">
                    <div class="flow-box">
                        <div class="flow-box-header">
                            <div class="flow-box-icon" style="background: rgba(249, 115, 22, 0.2);">ðŸ“¥</div>
                            <span class="flow-box-title">Incoming Documents</span>
                        </div>
                        <div class="documents-incoming">
                            <div class="doc-item">
                                <span class="doc-time">10:00:01</span>
                                <span class="doc-meta">sensor_A</span>
                                <span class="doc-value">23.5Â°C</span>
                            </div>
                            <div class="doc-item">
                                <span class="doc-time">10:00:02</span>
                                <span class="doc-meta">sensor_B</span>
                                <span class="doc-value">45.2Â°C</span>
                            </div>
                            <div class="doc-item">
                                <span class="doc-time">10:00:03</span>
                                <span class="doc-meta">sensor_A</span>
                                <span class="doc-value">23.6Â°C</span>
                            </div>
                            <div class="doc-item">
                                <span class="doc-time">10:00:04</span>
                                <span class="doc-meta">sensor_B</span>
                                <span class="doc-value">45.1Â°C</span>
                            </div>
                            <div class="doc-item">
                                <span class="doc-time">10:00:05</span>
                                <span class="doc-meta">sensor_A</span>
                                <span class="doc-value">23.7Â°C</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-arrow">â†’</div>
                    
                    <div class="flow-box">
                        <div class="flow-box-header">
                            <div class="flow-box-icon" style="background: rgba(168, 85, 247, 0.2);">ðŸ”€</div>
                            <span class="flow-box-title">Grouping by Metadata + Time</span>
                        </div>
                        <div style="display: flex; gap: 16px;">
                            <div style="flex: 1;">
                                <div style="font-size: 0.85rem; color: var(--accent-purple); margin-bottom: 8px;">sensor_A group</div>
                                <div class="doc-item"><span class="doc-time">10:00:01</span> <span class="doc-value">23.5Â°C</span></div>
                                <div class="doc-item"><span class="doc-time">10:00:03</span> <span class="doc-value">23.6Â°C</span></div>
                                <div class="doc-item"><span class="doc-time">10:00:05</span> <span class="doc-value">23.7Â°C</span></div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 0.85rem; color: var(--accent-cyan); margin-bottom: 8px;">sensor_B group</div>
                                <div class="doc-item"><span class="doc-time">10:00:02</span> <span class="doc-value">45.2Â°C</span></div>
                                <div class="doc-item"><span class="doc-time">10:00:04</span> <span class="doc-value">45.1Â°C</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-arrow">â†’</div>
                    
                    <div class="flow-box">
                        <div class="flow-box-header">
                            <div class="flow-box-icon" style="background: rgba(0, 237, 100, 0.2);">ðŸ“¦</div>
                            <span class="flow-box-title">Stored as Buckets</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="bucket-container">
                                <div class="bucket-header">
                                    <span class="bucket-id">Bucket #1 - sensor_A</span>
                                    <span class="bucket-range">10:00 - 10:59</span>
                                </div>
                                <div class="bucket-docs">
                                    <div class="bucket-doc" style="animation-delay: 0.1s;"></div>
                                    <div class="bucket-doc" style="animation-delay: 0.2s;"></div>
                                    <div class="bucket-doc" style="animation-delay: 0.3s;"></div>
                                </div>
                            </div>
                            <div class="bucket-container">
                                <div class="bucket-header">
                                    <span class="bucket-id">Bucket #2 - sensor_B</span>
                                    <span class="bucket-range">10:00 - 10:59</span>
                                </div>
                                <div class="bucket-docs">
                                    <div class="bucket-doc" style="animation-delay: 0.4s;"></div>
                                    <div class="bucket-doc" style="animation-delay: 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <div class="info-icon">ðŸ’¡</div>
                <div class="info-content">
                    <h4>Key Insight: Bucket Granularity</h4>
                    <p>MongoDB automatically determines bucket boundaries based on the <code>granularity</code> setting (seconds, minutes, hours). Documents with the same metadata that arrive within the same time window go into the same bucket.</p>
                </div>
            </div>
        </section>

        <!-- Section 4: Granularity Deep Dive -->
        <section class="section" id="granularity">
            <div class="section-header">
                <div class="section-number">04</div>
                <h2 class="section-title">Granularity Deep Dive</h2>
            </div>
            
            <div class="card">
                <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.02) 100%); border: 2px solid #ef4444; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <span style="font-size: 2rem;">âš ï¸</span>
                        <h3 style="color: #ef4444;">Common Misconception!</h3>
                    </div>
                    <p style="font-size: 1rem; color: var(--text-primary);">
                        <strong>"seconds" granularity does NOT mean buckets close every second!</strong>
                    </p>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px;">
                        Granularity controls the <strong>bucket time span</strong> and <strong>timestamp rounding</strong>, not how often buckets close.
                    </p>
                </div>
                
                <h4 style="color: var(--accent-cyan); margin-bottom: 20px;">ðŸ“ What Granularity Actually Controls</h4>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px;">
                    <div style="background: var(--bg-tertiary); border: 2px solid var(--accent-green); border-radius: 16px; padding: 24px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 8px;">â±ï¸</div>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; color: var(--accent-green); margin-bottom: 4px;">seconds</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--text-primary); margin: 16px 0;">1 HOUR</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Bucket Time Span</div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Best for: &gt;1 doc/sec</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-tertiary); border: 2px solid var(--accent-cyan); border-radius: 16px; padding: 24px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 8px;">â±ï¸</div>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; color: var(--accent-cyan); margin-bottom: 4px;">minutes</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--text-primary); margin: 16px 0;">24 HOURS</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Bucket Time Span</div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Best for: 1 doc/min</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-tertiary); border: 2px solid var(--accent-purple); border-radius: 16px; padding: 24px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 8px;">â±ï¸</div>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; color: var(--accent-purple); margin-bottom: 4px;">hours</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--text-primary); margin: 16px 0;">30 DAYS</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Bucket Time Span</div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Best for: &lt;1 doc/hour</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="color: var(--accent-orange); margin-bottom: 20px;">ðŸ”„ When Do Buckets Actually Close?</h4>
                
                <div style="background: var(--bg-secondary); border-radius: 16px; padding: 24px;">
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">A bucket closes when <strong>ANY</strong> of these conditions is met:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">ðŸ“Š</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-green);">~1000</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Documents reached</div>
                        </div>
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">ðŸ’¾</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-cyan);">~125 KB</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Size limit reached</div>
                        </div>
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">â°</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-purple);">Time Span</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Exceeded (1h/24h/30d)</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, transparent 100%); border-radius: 12px; border: 1px solid var(--accent-green);">
                        <h5 style="color: var(--accent-green); margin-bottom: 12px;">ðŸ“ Example: "seconds" granularity with 10 docs/second</h5>
                        <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
                                <span style="color: var(--text-secondary);">Bucket fills in:</span>
                                <span style="color: var(--accent-cyan);">1000 docs Ã· 10 docs/sec = </span>
                                <span style="color: var(--accent-green); font-weight: 700;">~100 seconds</span>
                            </div>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px;">NOT every second! The bucket stays open until it fills up or hits the 1-hour time boundary.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Bucket Internal Structure -->
        <section class="section" id="data-flow">
            <div class="section-header">
                <div class="section-number">05</div>
                <h2 class="section-title">Inside a Bucket Document</h2>
            </div>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Under the hood, MongoDB stores time series data in a special <code>system.buckets.&lt;collection&gt;</code> collection. Each bucket is a single document with a specific structure:
                </p>
                
                <div class="code-block" style="margin-bottom: 24px;">
                    <div class="code-header">
                        <div class="code-dot red"></div>
                        <div class="code-dot yellow"></div>
                        <div class="code-dot green"></div>
                        <span class="code-title">Actual Bucket Document (system.buckets.sensorData)</span>
                    </div>
                    <pre class="code-content" style="font-size: 0.8rem;">{
  <span class="property">"_id"</span>: <span class="string">ObjectId("...")</span>,           <span class="comment">// Encodes bucket start time</span>
  <span class="property">"control"</span>: {
    <span class="property">"version"</span>: <span class="value">1</span>,                     <span class="comment">// Bucket format version</span>
    <span class="property">"min"</span>: {
      <span class="property">"_id"</span>: <span class="string">ObjectId("...")</span>,        <span class="comment">// Min values for pruning</span>
      <span class="property">"timestamp"</span>: <span class="string">ISODate("2024-01-01T10:00:00Z")</span>,
      <span class="property">"temperature"</span>: <span class="value">22.1</span>
    },
    <span class="property">"max"</span>: {
      <span class="property">"timestamp"</span>: <span class="string">ISODate("2024-01-01T10:59:59Z")</span>,
      <span class="property">"temperature"</span>: <span class="value">28.7</span>
    },
    <span class="property">"closed"</span>: <span class="value">false</span>,               <span class="comment">// Is bucket accepting writes?</span>
    <span class="property">"count"</span>: <span class="value">847</span>                     <span class="comment">// Number of measurements</span>
  },
  <span class="property">"meta"</span>: {                            <span class="comment">// Your metaField value</span>
    <span class="property">"sensorId"</span>: <span class="string">"sensor_001"</span>,
    <span class="property">"location"</span>: <span class="string">"NYC"</span>
  },
  <span class="property">"data"</span>: {                            <span class="comment">// Columnar compressed data</span>
    <span class="property">"timestamp"</span>: { <span class="string">"0"</span>: <span class="string">ISODate(...)</span>, <span class="string">"1"</span>: <span class="string">ISODate(...)</span>, ... },
    <span class="property">"temperature"</span>: { <span class="string">"0"</span>: <span class="value">23.5</span>, <span class="string">"1"</span>: <span class="value">23.6</span>, <span class="string">"2"</span>: <span class="value">23.7</span>, ... },
    <span class="property">"humidity"</span>: { <span class="string">"0"</span>: <span class="value">45</span>, <span class="string">"1"</span>: <span class="value">46</span>, <span class="string">"2"</span>: <span class="value">44</span>, ... }
  }
}</pre>
                </div>
                
                <div class="bucket-detail">
                    <div class="bucket-structure">
                        <h4 style="margin-bottom: 16px; color: var(--accent-green);">Bucket Document Structure</h4>
                        
                        <div class="struct-field field-control">
                            <div class="field-label">BUCKET ID</div>
                            <div class="field-value">_id: ObjectId("...")</div>
                        </div>
                        
                        <div class="struct-field field-time">
                            <div class="field-label">CONTROL - TIME BOUNDS</div>
                            <div class="field-value">control.min.timestamp</div>
                            <div class="field-value">control.max.timestamp</div>
                        </div>
                        
                        <div class="struct-field field-meta">
                            <div class="field-label">METADATA</div>
                            <div class="field-value">meta: { sensorId: "A", location: "NYC" }</div>
                        </div>
                        
                        <div class="struct-field field-data">
                            <div class="field-label">COLUMNAR DATA</div>
                            <div class="field-value">data.timestamp: [t1, t2, t3...]</div>
                            <div class="field-value">data.temperature: [23.5, 23.6, 23.7...]</div>
                            <div class="field-value">data.humidity: [45, 46, 44...]</div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--text-primary);">Columnar Storage Format</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            Instead of storing each measurement as a separate document, values are stored column-by-column, enabling efficient compression:
                        </p>
                        
                        <div class="column-storage">
                            <div class="column">
                                <div class="column-header">timestamp</div>
                                <div class="column-values">
                                    <div class="column-value">10:00:01</div>
                                    <div class="column-value">10:00:02</div>
                                    <div class="column-value">10:00:03</div>
                                    <div class="column-value">10:00:04</div>
                                    <div class="column-value">10:00:05</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="column-header">sensorId</div>
                                <div class="column-values">
                                    <div class="column-value">A</div>
                                    <div class="column-value">A</div>
                                    <div class="column-value">A</div>
                                    <div class="column-value">A</div>
                                    <div class="column-value">A</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="column-header">temperature</div>
                                <div class="column-values">
                                    <div class="column-value">23.5</div>
                                    <div class="column-value">23.6</div>
                                    <div class="column-value">23.7</div>
                                    <div class="column-value">23.8</div>
                                    <div class="column-value">23.9</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="column-header">humidity</div>
                                <div class="column-values">
                                    <div class="column-value">45</div>
                                    <div class="column-value">46</div>
                                    <div class="column-value">44</div>
                                    <div class="column-value">45</div>
                                    <div class="column-value">47</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Compression Deep Dive -->
        <section class="section" id="compression">
            <div class="section-header">
                <div class="section-number">06</div>
                <h2 class="section-title">Compression Magic: Delta Encoding</h2>
            </div>
            
            <!-- WHY: Cost Savings -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-green);">
                <h4 style="color: var(--accent-green); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>ðŸ’°</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary);">
                    <strong>Compression directly impacts your costs.</strong> At scale, storing 1TB of raw sensor data might cost $100/month. 
                    With 90% compression, that drops to $10/month. Time series collections achieve this automatically through delta encoding - 
                    no application changes needed. Understanding how it works helps you design schemas that compress even better.
                </p>
            </div>
            
            <!-- DEMO: Delta Encoding -->
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 32px;">
                    Time series data is highly compressible because consecutive values are often similar. MongoDB uses <strong>delta encoding</strong> to store only the differences between values:
                </p>
                
                <div class="delta-viz">
                    <div class="delta-original">
                        <div class="delta-title">
                            <span>ðŸ“Š</span>
                            <span>Original Timestamps</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">tâ‚</span>
                            <span style="color: var(--accent-cyan);">1702742401000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">tâ‚‚</span>
                            <span style="color: var(--accent-cyan);">1702742402000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">tâ‚ƒ</span>
                            <span style="color: var(--accent-cyan);">1702742403000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">tâ‚„</span>
                            <span style="color: var(--accent-cyan);">1702742404000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">tâ‚…</span>
                            <span style="color: var(--accent-cyan);">1702742405000</span>
                        </div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 0.85rem;">Total: </span>
                            <span style="color: var(--accent-orange); font-family: 'JetBrains Mono', monospace;">65 bytes</span>
                        </div>
                    </div>
                    
                    <div class="delta-arrow-container">
                        <span>â†’</span>
                    </div>
                    
                    <div class="delta-encoded">
                        <div class="delta-title">
                            <span>ðŸ—œï¸</span>
                            <span>Delta Encoded</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">base</span>
                            <span style="color: var(--accent-green);">1702742401000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">Î”â‚</span>
                            <span style="color: var(--accent-green);">+1000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">Î”â‚‚</span>
                            <span style="color: var(--accent-green);">+1000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">Î”â‚ƒ</span>
                            <span style="color: var(--accent-green);">+1000</span>
                        </div>
                        <div class="delta-row">
                            <span style="color: var(--text-secondary);">Î”â‚„</span>
                            <span style="color: var(--accent-green);">+1000</span>
                        </div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 0.85rem;">Total: </span>
                            <span style="color: var(--accent-green); font-family: 'JetBrains Mono', monospace;">21 bytes</span>
                        </div>
                    </div>
                </div>
                
                <div class="compression-viz" style="margin-top: 48px;">
                    <div class="data-block data-raw">
                        <div class="data-size">100 MB</div>
                        <div class="data-label">Regular Collection</div>
                    </div>
                    <div class="compression-arrow">
                        <div style="font-size: 2rem;">â†’</div>
                        <div class="compression-ratio">~90% smaller</div>
                    </div>
                    <div class="data-block data-compressed">
                        <div class="data-size">10 MB</div>
                        <div class="data-label">Time Series Collection</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">10x</div>
                    <div class="stat-label">Storage Reduction</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1000+</div>
                    <div class="stat-label">Docs per Bucket</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">90%</div>
                    <div class="stat-label">Fewer Index Entries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">50%</div>
                    <div class="stat-label">Faster Queries</div>
                </div>
            </div>
        </section>

        <!-- ====== PART III: ARCHITECTURE ====== -->
        <div class="master-section-header architecture">
            <div class="master-section-badge architecture">Part III</div>
            <h2 class="master-section-title">Internal Architecture</h2>
            <p class="master-section-desc">Deep dive into how MongoDB manages buckets, memory, and storage</p>
        </div>
        
        <!-- Section 5: Internal Architecture -->
        <section class="section" id="architecture">
            <div class="section-header">
                <div class="section-number">07</div>
                <h2 class="section-title">Internal Architecture</h2>
            </div>
            
            <div class="card architecture-diagram">
                <div class="arch-layer">
                    <div class="arch-box highlight">
                        <div class="arch-box-icon">ðŸ“</div>
                        <h4>Application Layer</h4>
                        <p>Your app writes documents with timestamp, metadata, and measurements</p>
                    </div>
                </div>
                
                <div class="arch-layer">
                    <div class="arch-box">
                        <div class="arch-box-icon">ðŸ”„</div>
                        <h4>Time Series Engine</h4>
                        <p>Routes documents, manages bucket lifecycle, handles compression</p>
                    </div>
                    <div class="arch-box">
                        <div class="arch-box-icon">ðŸ“Š</div>
                        <h4>Bucket Manager</h4>
                        <p>Creates, closes, and maintains buckets based on time + metadata</p>
                    </div>
                    <div class="arch-box">
                        <div class="arch-box-icon">ðŸ—œï¸</div>
                        <h4>Column Compressor</h4>
                        <p>Applies delta encoding, RLE, and zstd compression</p>
                    </div>
                </div>
                
                <div class="arch-layer">
                    <div class="arch-box">
                        <div class="arch-box-icon">ðŸ“</div>
                        <h4>system.buckets.*</h4>
                        <p>Internal collection storing compressed bucket documents</p>
                    </div>
                    <div class="arch-box">
                        <div class="arch-box-icon">ðŸ”</div>
                        <h4>Clustered Index</h4>
                        <p>Time-based clustering for efficient range queries</p>
                    </div>
                </div>
                
                <div class="arch-layer" style="margin-bottom: 0;">
                    <div class="arch-box highlight">
                        <div class="arch-box-icon">ðŸ’¾</div>
                        <h4>WiredTiger Storage</h4>
                        <p>Block-compressed storage with efficient I/O patterns</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Bucket Lifecycle & Memory Management -->
        <section class="section" id="memory">
            <div class="section-header">
                <div class="section-number">08</div>
                <h2 class="section-title">Bucket Lifecycle & Memory Management</h2>
            </div>
            
            <!-- WHY: Performance Tuning -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-purple);">
                <h4 style="color: var(--accent-purple); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>âš¡</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary);">
                    <strong>Memory management directly affects write performance.</strong> MongoDB keeps "open" buckets in RAM for fast inserts. 
                    If you have too many unique metadata combinations, you'll exhaust the bucket catalog and trigger constant disk I/O. 
                    Understanding the lifecycle helps you design metadata fields that don't explode your memory usage.
                </p>
            </div>
            
            <!-- DEMO: Bucket Catalog -->
            <div class="card">
                <h3 style="margin-bottom: 24px; color: var(--accent-purple);">ðŸ§  The Bucket Catalog</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    MongoDB maintains an in-memory <strong>Bucket Catalog</strong> that tracks all open buckets. This is crucial for high-performance writes - instead of searching disk for the right bucket, MongoDB keeps active buckets readily accessible in RAM.
                </p>
                
                <div class="memory-container">
                    <div class="memory-block">
                        <div class="memory-title">
                            <span>ðŸ’¾</span>
                            <span>Memory Allocation</span>
                        </div>
                        <div class="memory-stats">
                            <div class="memory-stat">
                                <div class="memory-stat-value" id="memUsed">128</div>
                                <div class="memory-stat-label">MB Used</div>
                            </div>
                            <div class="memory-stat">
                                <div class="memory-stat-value">256</div>
                                <div class="memory-stat-label">MB Limit</div>
                            </div>
                        </div>
                        <div class="memory-gauge">
                            <div class="memory-gauge-fill" id="memGauge" style="width: 50%;"></div>
                            <span class="memory-gauge-label">50%</span>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 16px;">
                            When memory pressure increases, older buckets are closed and flushed to disk.
                        </p>
                    </div>
                    
                    <div class="bucket-catalog">
                        <div class="catalog-header">
                            <span class="catalog-title">
                                <span>ðŸ“‹</span>
                                <span>Open Bucket Registry</span>
                            </span>
                            <span class="catalog-count">4 open buckets</span>
                        </div>
                        
                        <div class="bucket-entry open">
                            <div class="bucket-status open"></div>
                            <div class="bucket-info">
                                <div class="bucket-meta-info">sensor_A â†’ Building_NYC</div>
                                <div class="bucket-time-range">10:00:00 - 10:59:59 (current)</div>
                            </div>
                            <div class="bucket-size">847 docs</div>
                        </div>
                        
                        <div class="bucket-entry open">
                            <div class="bucket-status open"></div>
                            <div class="bucket-info">
                                <div class="bucket-meta-info">sensor_B â†’ Building_NYC</div>
                                <div class="bucket-time-range">10:00:00 - 10:59:59 (current)</div>
                            </div>
                            <div class="bucket-size">632 docs</div>
                        </div>
                        
                        <div class="bucket-entry closed">
                            <div class="bucket-status closed"></div>
                            <div class="bucket-info">
                                <div class="bucket-meta-info">sensor_A â†’ Building_SF</div>
                                <div class="bucket-time-range">09:00:00 - 09:59:59</div>
                            </div>
                            <div class="bucket-size">1000 docs</div>
                        </div>
                        
                        <div class="bucket-entry archived">
                            <div class="bucket-status archived"></div>
                            <div class="bucket-info">
                                <div class="bucket-meta-info">sensor_C â†’ Building_LA</div>
                                <div class="bucket-time-range">08:00:00 - 08:59:59</div>
                            </div>
                            <div class="bucket-size">Flushed</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 24px;">
                <h3 style="margin-bottom: 24px; color: var(--accent-orange);">ðŸ”„ Bucket State Machine</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Every bucket transitions through distinct states. Understanding this lifecycle is key to optimizing time series performance.
                </p>
                
                <div class="state-machine">
                    <div class="state-flow">
                        <div class="state-node">
                            <div class="state-circle">
                                <span class="state-icon">âœ¨</span>
                            </div>
                            <div class="state-name">CREATED</div>
                            <div class="state-desc">New bucket allocated in memory</div>
                        </div>
                        
                        <div class="state-node">
                            <div class="state-circle">
                                <span class="state-icon">ðŸ“</span>
                            </div>
                            <div class="state-name">OPEN</div>
                            <div class="state-desc">Actively receiving documents</div>
                        </div>
                        
                        <div class="state-node">
                            <div class="state-circle">
                                <span class="state-icon">ðŸ”’</span>
                            </div>
                            <div class="state-name">CLOSING</div>
                            <div class="state-desc">Preparing for compression</div>
                        </div>
                        
                        <div class="state-node">
                            <div class="state-circle">
                                <span class="state-icon">ðŸ’¾</span>
                            </div>
                            <div class="state-name">CLOSED</div>
                            <div class="state-desc">Compressed & persisted to disk</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin: 32px 0 16px; color: var(--text-primary);">What Triggers Bucket Closure?</h4>
                <div class="trigger-conditions">
                    <div class="trigger-card">
                        <div class="trigger-icon">ðŸ“Š</div>
                        <div class="trigger-title">Document Limit</div>
                        <div class="trigger-value">~1000 docs</div>
                        <div class="trigger-desc">Bucket reaches maximum document count</div>
                    </div>
                    <div class="trigger-card">
                        <div class="trigger-icon">ðŸ’¾</div>
                        <div class="trigger-title">Size Limit</div>
                        <div class="trigger-value">~125 KB</div>
                        <div class="trigger-desc">Uncompressed bucket size exceeds threshold</div>
                    </div>
                    <div class="trigger-card">
                        <div class="trigger-icon">â°</div>
                        <div class="trigger-title">Time Boundary</div>
                        <div class="trigger-value">Granularity</div>
                        <div class="trigger-desc">Timestamp falls outside bucket's time range</div>
                    </div>
                </div>
            </div>
            
            <div class="card memory-demo" style="margin-top: 24px;">
                <div class="memory-demo-header">
                    <h3 style="color: var(--accent-purple);">ðŸŽ® Live Bucket Manager Simulation</h3>
                    <div class="demo-controls" style="margin-bottom: 0;">
                        <button class="demo-btn" onclick="startMemoryDemo()" id="memStartBtn">â–¶ Start</button>
                        <button class="demo-btn" onclick="stopMemoryDemo()" id="memStopBtn">â¹ Stop</button>
                        <button class="demo-btn" onclick="resetMemoryDemo()" id="memResetBtn">ðŸ”„ Reset</button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 250px 1fr; gap: 24px; margin-top: 24px;">
                    <div>
                        <h4 style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px;">Memory Pressure</h4>
                        <div class="memory-gauge" style="height: 30px; width: 100%;">
                            <div class="memory-gauge-fill" id="livememGauge" style="width: 0%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                            <span>0 MB</span>
                            <span id="liveMemValue">0 MB / 256 MB</span>
                            <span>256 MB</span>
                        </div>
                        
                        <div style="margin-top: 24px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">Open Buckets:</span>
                                <span style="font-family: 'JetBrains Mono', monospace; color: var(--accent-green);" id="openBucketCount">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">Closed Buckets:</span>
                                <span style="font-family: 'JetBrains Mono', monospace; color: var(--accent-cyan);" id="closedBucketCount">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">Docs/sec:</span>
                                <span style="font-family: 'JetBrains Mono', monospace; color: var(--accent-orange);" id="docsPerSec">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px;">Active Buckets</h4>
                        <div class="live-bucket-grid" id="liveBucketGrid">
                            <!-- Buckets will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: WiredTiger Integration -->
        <section class="section" id="wiredtiger">
            <div class="section-header">
                <div class="section-number">09</div>
                <h2 class="section-title">WiredTiger Storage Integration</h2>
            </div>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    When a bucket is closed, it flows through MongoDB's WiredTiger storage engine. Here's the complete journey from memory to disk:
                </p>
                
                <div class="wiredtiger-flow">
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ“</div>
                        <div class="wt-name">Bucket (Memory)</div>
                        <div class="wt-desc">Raw columnar data in RAM</div>
                    </div>
                    <div class="wt-arrow">â†’</div>
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ—œï¸</div>
                        <div class="wt-name">Delta Encoder</div>
                        <div class="wt-desc">Compute deltas for timestamps</div>
                    </div>
                    <div class="wt-arrow">â†’</div>
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ“Š</div>
                        <div class="wt-name">RLE Compressor</div>
                        <div class="wt-desc">Run-length encoding</div>
                    </div>
                    <div class="wt-arrow">â†’</div>
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ”§</div>
                        <div class="wt-name">BSON Serializer</div>
                        <div class="wt-desc">Convert to BSON format</div>
                    </div>
                    <div class="wt-arrow">â†’</div>
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ“‹</div>
                        <div class="wt-name">WiredTiger</div>
                        <div class="wt-desc">Block compression (zstd)</div>
                    </div>
                    <div class="wt-arrow">â†’</div>
                    <div class="wt-component">
                        <div class="wt-icon">ðŸ’¾</div>
                        <div class="wt-name">Disk</div>
                        <div class="wt-desc">Persistent storage</div>
                    </div>
                </div>
                
                <h4 style="margin: 32px 0 16px; color: var(--text-primary);">Compression Pipeline Breakdown</h4>
                <div class="compression-stages">
                    <div class="compression-stage">
                        <div class="stage-icon">ðŸ“¦</div>
                        <div class="stage-name">Raw Data</div>
                        <div class="stage-size">1000 KB</div>
                        <div class="stage-desc">Uncompressed columnar arrays</div>
                    </div>
                    <div class="compression-stage">
                        <div class="stage-icon">Î”</div>
                        <div class="stage-name">Delta Encoded</div>
                        <div class="stage-size">350 KB</div>
                        <div class="stage-desc">-65% for sequential data</div>
                    </div>
                    <div class="compression-stage">
                        <div class="stage-icon">ðŸ”</div>
                        <div class="stage-name">RLE Applied</div>
                        <div class="stage-size">180 KB</div>
                        <div class="stage-desc">-50% for repeated values</div>
                    </div>
                    <div class="compression-stage">
                        <div class="stage-icon">âœ“</div>
                        <div class="stage-name">Final (zstd)</div>
                        <div class="stage-size">90 KB</div>
                        <div class="stage-desc">-50% block compression</div>
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 24px;">
                    <div class="info-icon">ðŸŽ¯</div>
                    <div class="info-content">
                        <h4>Total Compression: 91% Reduction</h4>
                        <p>From 1000 KB down to 90 KB. This is why time series collections are so storage-efficient! The combination of columnar storage + delta encoding + RLE + block compression creates massive savings.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ====== PART IV: OPERATIONS ====== -->
        <div class="master-section-header operations">
            <div class="master-section-badge operations">Part IV</div>
            <h2 class="master-section-title">Operations</h2>
            <p class="master-section-desc">Creating collections, querying data, indexes, and aggregations</p>
        </div>
        
        <!-- Section 9: Creating a Time Series Collection -->
        <section class="section" id="creating">
            <div class="section-header">
                <div class="section-number">10</div>
                <h2 class="section-title">Creating a Time Series Collection</h2>
            </div>
            
            <div class="card">
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dot red"></div>
                        <div class="code-dot yellow"></div>
                        <div class="code-dot green"></div>
                        <span class="code-title">MongoDB Shell</span>
                    </div>
                    <pre class="code-content"><span class="comment">// Create a time series collection</span>
<span class="property">db</span>.<span class="keyword">createCollection</span>(<span class="string">"sensorData"</span>, {
    <span class="property">timeseries</span>: {
        <span class="property">timeField</span>: <span class="string">"timestamp"</span>,        <span class="comment">// Required: field containing timestamp</span>
        <span class="property">metaField</span>: <span class="string">"metadata"</span>,        <span class="comment">// Optional: field for grouping</span>
        <span class="property">granularity</span>: <span class="string">"minutes"</span>       <span class="comment">// "seconds" | "minutes" | "hours"</span>
    },
    <span class="property">expireAfterSeconds</span>: <span class="value">86400 * 30</span>   <span class="comment">// Optional: auto-delete after 30 days</span>
});

<span class="comment">// Insert a document</span>
<span class="property">db</span>.<span class="property">sensorData</span>.<span class="keyword">insertOne</span>({
    <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>(),
    <span class="property">metadata</span>: {
        <span class="property">sensorId</span>: <span class="string">"sensor_001"</span>,
        <span class="property">location</span>: <span class="string">"building_A"</span>
    },
    <span class="property">temperature</span>: <span class="value">23.5</span>,
    <span class="property">humidity</span>: <span class="value">45.2</span>,
    <span class="property">pressure</span>: <span class="value">1013.25</span>
});</pre>
                </div>
                
                <h4 style="margin: 32px 0 16px; color: var(--text-primary);">Granularity Options</h4>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Granularity</th>
                            <th>Bucket Time Span</th>
                            <th>Best For</th>
                            <th>Max Docs/Bucket</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="highlight-cell">seconds</td>
                            <td>1 hour</td>
                            <td>High-frequency data (100+ docs/min)</td>
                            <td>~1000</td>
                        </tr>
                        <tr>
                            <td class="highlight-cell">minutes</td>
                            <td>24 hours</td>
                            <td>Medium frequency (1-100 docs/min)</td>
                            <td>~1000</td>
                        </tr>
                        <tr>
                            <td class="highlight-cell">hours</td>
                            <td>30 days</td>
                            <td>Low frequency (&lt;1 doc/min)</td>
                            <td>~1000</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 7: Write & Query Path -->
        <section class="section" id="write-query">
            <div class="section-header">
                <div class="section-number">11</div>
                <h2 class="section-title">Write & Query Paths</h2>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 24px; color: var(--accent-green);">Write Path</h3>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showTab('in-order-tab', this)">In-Order Writes</button>
                        <button class="tab-btn" onclick="showTab('out-order-tab', this)">Out-of-Order Writes</button>
                        <button class="tab-btn" onclick="showTab('bucket-reopen-tab', this)">Bucket Reopening</button>
                    </div>
                    
                    <div class="tab-content active" id="in-order-tab">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">
                            <strong>Optimal case:</strong> Documents arrive in chronological order. MongoDB efficiently appends to the current open bucket.
                        </p>
                        <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">10:00:01</div>
                                <div style="padding: 12px; background: rgba(0,237,100,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_1 â†’ Bucket A</div>
                            </div>
                            <div style="color: var(--accent-green);">â†’</div>
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">10:00:02</div>
                                <div style="padding: 12px; background: rgba(0,237,100,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_2 â†’ Bucket A</div>
                            </div>
                            <div style="color: var(--accent-green);">â†’</div>
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">10:00:03</div>
                                <div style="padding: 12px; background: rgba(0,237,100,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_3 â†’ Bucket A</div>
                            </div>
                        </div>
                        <p style="color: var(--accent-green); font-size: 0.85rem; margin-top: 12px;">âœ“ Fast: Single bucket lookup, append operation</p>
                    </div>
                    
                    <div class="tab-content" id="out-order-tab">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">
                            <strong>Out-of-order writes:</strong> When documents arrive with timestamps outside the current bucket's range, MongoDB must find or create the appropriate bucket.
                        </p>
                        <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">10:00:01</div>
                                <div style="padding: 12px; background: rgba(0,237,100,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_1 â†’ Bucket A</div>
                            </div>
                            <div style="color: var(--accent-green);">â†’</div>
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--accent-orange); margin-bottom: 8px;">09:45:00 âš ï¸</div>
                                <div style="padding: 12px; background: rgba(249,115,22,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_2 â†’ New Bucket!</div>
                            </div>
                            <div style="color: var(--accent-green);">â†’</div>
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">10:00:02</div>
                                <div style="padding: 12px; background: rgba(0,237,100,0.2); border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;">doc_3 â†’ Bucket A</div>
                            </div>
                        </div>
                        <p style="color: var(--accent-orange); font-size: 0.85rem; margin-top: 12px;">âš ï¸ Creates additional buckets, reducing compression efficiency</p>
                    </div>
                    
                    <div class="tab-content" id="bucket-reopen-tab">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">
                            <strong>MongoDB 6.0+:</strong> Closed buckets can be reopened if a new document falls within their time range. This improves handling of late-arriving data.
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="padding: 20px; background: rgba(249,115,22,0.1); border: 1px solid var(--accent-orange); border-radius: 12px;">
                                <h4 style="color: var(--accent-orange); margin-bottom: 12px;">Before 6.0</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Late data â†’ Creates new bucket</p>
                                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">âŒ More buckets, less compression</p>
                            </div>
                            <div style="padding: 20px; background: rgba(0,237,100,0.1); border: 1px solid var(--accent-green); border-radius: 12px;">
                                <h4 style="color: var(--accent-green); margin-bottom: 12px;">MongoDB 6.0+</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Late data â†’ Reopens existing bucket</p>
                                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">âœ“ Better bucket utilization</p>
                            </div>
                        </div>
                        <div class="info-box" style="margin-top: 16px;">
                            <div class="info-icon">ðŸ’¡</div>
                            <div class="info-content">
                                <h4>bucketMaxSpanSeconds & bucketRoundingSeconds</h4>
                                <p>In MongoDB 6.3+, you can fine-tune bucket time spans with <code>bucketMaxSpanSeconds</code> for custom granularity beyond seconds/minutes/hours.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="process-flow">
                    <div class="process-step">
                        <div class="process-icon">ðŸ“¥</div>
                        <div class="process-label">Insert Document</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">ðŸ”</div>
                        <div class="process-label">Find/Create Bucket</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">ðŸ“¦</div>
                        <div class="process-label">Add to Bucket</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">ðŸ’¾</div>
                        <div class="process-label">Compress & Store</div>
                    </div>
                </div>
                
                <div class="timeline" style="margin-top: 32px;">
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-time">Step 1: Document Arrives</div>
                            <div class="timeline-title">Extract timeField and metaField</div>
                            <div class="timeline-desc">MongoDB extracts the timestamp and metadata fields you specified when creating the collection.</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: var(--accent-cyan);"></div>
                        <div class="timeline-content">
                            <div class="timeline-time">Step 2: Bucket Selection</div>
                            <div class="timeline-title">Find matching open bucket</div>
                            <div class="timeline-desc">The engine looks for an open bucket with matching metadata and time range. If none exists, a new bucket is created.</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: var(--accent-purple);"></div>
                        <div class="timeline-content">
                            <div class="timeline-time">Step 3: Bucket Update</div>
                            <div class="timeline-title">Append to columnar arrays</div>
                            <div class="timeline-desc">Each field value is appended to its corresponding column array within the bucket document.</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: var(--accent-orange);"></div>
                        <div class="timeline-content">
                            <div class="timeline-time">Step 4: Bucket Close (When Full)</div>
                            <div class="timeline-title">Apply final compression</div>
                            <div class="timeline-desc">When a bucket reaches its capacity or time limit, it's closed and final compression is applied.</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 24px;">
                <h3 style="margin-bottom: 24px; color: var(--accent-cyan);">Query Path</h3>
                <div class="process-flow">
                    <div class="process-step">
                        <div class="process-icon">ðŸ”Ž</div>
                        <div class="process-label">Parse Query</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">ðŸ“‹</div>
                        <div class="process-label">Bucket Pruning</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">ðŸ“–</div>
                        <div class="process-label">Decompress</div>
                    </div>
                    <div class="process-step">
                        <div class="process-icon">âœ¨</div>
                        <div class="process-label">Reconstruct Docs</div>
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 24px;">
                    <div class="info-icon">âš¡</div>
                    <div class="info-content">
                        <h4>Query Optimization</h4>
                        <p>Time-based queries skip entire buckets using the control.min/max bounds. A query for "last 24 hours" only reads recent buckets, not the entire collection!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 13: Query Execution & Bucket Pruning -->
        <section class="section" id="query-pruning">
            <div class="section-header">
                <div class="section-number">12</div>
                <h2 class="section-title">Query Execution & Bucket Pruning</h2>
            </div>
            
            <!-- WHY: Query Speed -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-green);">
                <h4 style="color: var(--accent-green); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>âš¡</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary);">
                    <strong>Bucket pruning is why time series queries are fast.</strong> When you query "last 24 hours", MongoDB doesn't scan all your data. 
                    Each bucket has <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">control.min</code> and <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">control.max</code> 
                    fields that let MongoDB skip entire buckets that can't possibly contain matching documents. 
                    A year of data might have 8,760 buckets, but a "last hour" query only touches 1-2 buckets.
                </p>
            </div>
            
            <!-- DEMO: Query Flow -->
            <div class="card">
                <h4 style="color: var(--accent-cyan); margin-bottom: 20px;">ðŸ” Step-by-Step: How a Read Query Executes</h4>
                
                <div style="position: relative; padding: 20px 0;">
                    <!-- Query Flow Visualization -->
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        
                        <!-- Step 1: Query arrives -->
                        <div style="display: flex; align-items: flex-start; gap: 20px;">
                            <div style="width: 50px; height: 50px; background: var(--accent-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--bg-primary); flex-shrink: 0;">1</div>
                            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border-left: 4px solid var(--accent-green);">
                                <h5 style="color: var(--accent-green); margin-bottom: 8px;">Query Arrives</h5>
                                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #0d1117; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <span style="color: var(--accent-purple);">db.sensors.find</span>({<br>
                                    &nbsp;&nbsp;<span style="color: var(--accent-cyan);">timestamp</span>: { <span style="color: var(--accent-orange);">$gte</span>: <span style="color: var(--accent-green);">ISODate("2024-01-15T10:00:00Z")</span> },<br>
                                    &nbsp;&nbsp;<span style="color: var(--accent-cyan);">"metadata.sensorId"</span>: <span style="color: var(--accent-green);">"sensor_001"</span><br>
                                    })
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">MongoDB parses the query and identifies filterable fields.</p>
                            </div>
                        </div>
                        
                        <!-- Step 2: Index Lookup -->
                        <div style="display: flex; align-items: flex-start; gap: 20px;">
                            <div style="width: 50px; height: 50px; background: var(--accent-cyan); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--bg-primary); flex-shrink: 0;">2</div>
                            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border-left: 4px solid var(--accent-cyan);">
                                <h5 style="color: var(--accent-cyan); margin-bottom: 8px;">Secondary Index Lookup (on system.buckets.*)</h5>
                                <div style="display: flex; gap: 16px; margin-bottom: 12px;">
                                    <div style="flex: 1; background: var(--bg-secondary); border-radius: 8px; padding: 12px;">
                                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">Index Used</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent-cyan);">{ meta.sensorId: 1, control.min.timestamp: 1 }</div>
                                    </div>
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Index returns <strong>bucket IDs</strong> that MIGHT contain matching documents (based on metadata match).</p>
                            </div>
                        </div>
                        
                        <!-- Step 3: Bucket Pruning -->
                        <div style="display: flex; align-items: flex-start; gap: 20px;">
                            <div style="width: 50px; height: 50px; background: var(--accent-purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--bg-primary); flex-shrink: 0;">3</div>
                            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border-left: 4px solid var(--accent-purple);">
                                <h5 style="color: var(--accent-purple); margin-bottom: 12px;">Bucket Pruning using control.min/max</h5>
                                
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px;">
                                    <!-- Bucket 1 - Pruned -->
                                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; opacity: 0.4; border: 2px dashed var(--text-muted);">
                                        <div style="font-size: 0.7rem; color: var(--text-muted);">Bucket A</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); margin-top: 4px;">
                                            min: Jan 14 08:00<br>
                                            max: Jan 14 09:00
                                        </div>
                                        <div style="font-size: 0.7rem; color: #ef4444; margin-top: 8px;">âŒ PRUNED</div>
                                        <div style="font-size: 0.6rem; color: var(--text-muted);">max &lt; query min</div>
                                    </div>
                                    
                                    <!-- Bucket 2 - Pruned -->
                                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; opacity: 0.4; border: 2px dashed var(--text-muted);">
                                        <div style="font-size: 0.7rem; color: var(--text-muted);">Bucket B</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); margin-top: 4px;">
                                            min: Jan 14 09:00<br>
                                            max: Jan 14 10:00
                                        </div>
                                        <div style="font-size: 0.7rem; color: #ef4444; margin-top: 8px;">âŒ PRUNED</div>
                                        <div style="font-size: 0.6rem; color: var(--text-muted);">max &lt; query min</div>
                                    </div>
                                    
                                    <!-- Bucket 3 - Scanned -->
                                    <div style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%); border-radius: 8px; padding: 12px; border: 2px solid var(--accent-green);">
                                        <div style="font-size: 0.7rem; color: var(--accent-green);">Bucket C</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); margin-top: 4px;">
                                            min: Jan 15 09:30<br>
                                            max: Jan 15 10:30
                                        </div>
                                        <div style="font-size: 0.7rem; color: var(--accent-green); margin-top: 8px;">âœ… SCAN</div>
                                        <div style="font-size: 0.6rem; color: var(--text-muted);">overlaps query</div>
                                    </div>
                                    
                                    <!-- Bucket 4 - Scanned -->
                                    <div style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%); border-radius: 8px; padding: 12px; border: 2px solid var(--accent-green);">
                                        <div style="font-size: 0.7rem; color: var(--accent-green);">Bucket D</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); margin-top: 4px;">
                                            min: Jan 15 10:30<br>
                                            max: Jan 15 11:30
                                        </div>
                                        <div style="font-size: 0.7rem; color: var(--accent-green); margin-top: 8px;">âœ… SCAN</div>
                                        <div style="font-size: 0.6rem; color: var(--text-muted);">after query min</div>
                                    </div>
                                </div>
                                
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                    <strong>Key insight:</strong> MongoDB checks each bucket's <code>control.min.timestamp</code> and <code>control.max.timestamp</code>. 
                                    If the query range doesn't overlap â†’ bucket is skipped entirely!
                                </p>
                            </div>
                        </div>
                        
                        <!-- Step 4: Decompress & Filter -->
                        <div style="display: flex; align-items: flex-start; gap: 20px;">
                            <div style="width: 50px; height: 50px; background: var(--accent-orange); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--bg-primary); flex-shrink: 0;">4</div>
                            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border-left: 4px solid var(--accent-orange);">
                                <h5 style="color: var(--accent-orange); margin-bottom: 8px;">Decompress & Filter Matching Buckets</h5>
                                <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                                    <div style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.75rem; color: var(--text-muted);">Compressed</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; color: var(--accent-cyan);">12 KB</div>
                                    </div>
                                    <div style="color: var(--accent-orange);">â†’</div>
                                    <div style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.75rem; color: var(--text-muted);">Decompressed</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; color: var(--accent-orange);">125 KB</div>
                                    </div>
                                    <div style="color: var(--accent-orange);">â†’</div>
                                    <div style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.75rem; color: var(--text-muted);">Filtered Results</div>
                                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; color: var(--accent-green);">847 docs</div>
                                    </div>
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Only matching buckets are decompressed. Documents are reconstructed from columnar format and filtered.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 24px;">
                <h4 style="color: var(--accent-cyan); margin-bottom: 16px;">ðŸŽ® Interactive Query Analyzer</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Select Query Type:</label>
                        <select id="queryType" onchange="updateQueryDemo()" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
                            <option value="timeRange">Time Range Query (Last 24 hours)</option>
                            <option value="noTimeRange">No Time Filter (Full Scan) âš ï¸</option>
                            <option value="metaOnly">Metadata Only Query</option>
                            <option value="combined">Combined (Time + Metadata) â­</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Query Preview:</label>
                        <div id="queryPreview" style="padding: 12px; background: #0d1117; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent-green); min-height: 44px;">
                            db.sensors.find({ timestamp: { $gte: ISODate("...") } })
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <h5 style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px;">Bucket Scan Visualization (30 buckets over 30 days):</h5>
                    <div id="bucketScanViz" style="display: flex; gap: 4px; flex-wrap: wrap;"></div>
                    <div style="display: flex; gap: 24px; margin-top: 16px; font-size: 0.8rem;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--accent-green); border-radius: 4px;"></div>
                            <span style="color: var(--text-secondary);">Scanned (I/O required)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--text-muted); border-radius: 4px; opacity: 0.3;"></div>
                            <span style="color: var(--text-secondary);">Pruned (Zero I/O!)</span>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 24px;">
                    <div style="padding: 16px; background: var(--bg-tertiary); border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent-green);" id="bucketsScanned">3</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Buckets Scanned</div>
                    </div>
                    <div style="padding: 16px; background: var(--bg-tertiary); border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent-cyan);" id="bucketsPruned">27</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Buckets Pruned</div>
                    </div>
                    <div style="padding: 16px; background: var(--bg-tertiary); border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent-purple);" id="queryEfficiency">90%</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">I/O Saved</div>
                    </div>
                    <div style="padding: 16px; background: var(--bg-tertiary); border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent-orange);" id="dataScanned">3.6 MB</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">vs 36 MB full scan</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 18: Secondary Indexes -->
        <section class="section" id="indexes">
            <div class="section-header">
                <div class="section-number">13</div>
                <h2 class="section-title">Secondary Indexes on Time Series</h2>
            </div>
            
            <!-- WHY: Query Performance -->
            <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-cyan);">
                <h4 style="color: var(--accent-cyan); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <span>ðŸ”</span> Why This Matters
                </h4>
                <p style="color: var(--text-secondary);">
                    <strong>Indexes on time series collections are 1000x smaller</strong> than on regular collections because they index <em>buckets</em>, not individual documents. 
                    A collection with 10 million documents might have only 10,000 buckets - so your index has 10,000 entries instead of 10 million. 
                    But they work differently: indexes are created on the internal <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">system.buckets.*</code> collection, and query planning uses bucket metadata for pruning.
                </p>
            </div>
            
            <!-- DETAILS: How Indexes Work -->
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Time series collections support secondary indexes, but they work differently than regular collections:
                </p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                    <div>
                        <h4 style="color: var(--accent-green); margin-bottom: 16px;">âœ… Automatically Created</h4>
                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px;">
                            <div style="margin-bottom: 16px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 4px;">Clustered Index</div>
                                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--accent-cyan);">{ meta: 1, timestamp: 1 }</div>
                                <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px;">Created automatically on the internal bucket collection</p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--accent-cyan); margin-top: 24px; margin-bottom: 16px;">ðŸ“Œ Common Index Patterns</h4>
                        <div class="code-block" style="margin: 0;">
                            <pre class="code-content" style="font-size: 0.75rem; padding: 16px;"><span class="comment">// Index on metadata subfields</span>
db.sensors.createIndex({ <span class="string">"metadata.region"</span>: <span class="value">1</span> })

<span class="comment">// Compound with time (for range + filter)</span>
db.sensors.createIndex({ 
  <span class="string">"metadata.sensorType"</span>: <span class="value">1</span>,
  <span class="string">"timestamp"</span>: <span class="value">-1</span> 
})

<span class="comment">// Index on measurement fields</span>
db.sensors.createIndex({ <span class="string">"temperature"</span>: <span class="value">1</span> })</pre>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--accent-purple); margin-bottom: 16px;">ðŸ” How Indexes Work Internally</h4>
                        
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 40px; height: 40px; background: rgba(168, 85, 247, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">1</div>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Index on Bucket Documents</div>
                                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Indexes are created on system.buckets.*, not the view</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 40px; height: 40px; background: rgba(168, 85, 247, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">2</div>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">One Entry Per Bucket</div>
                                    <p style="font-size: 0.8rem; color: var(--text-secondary);">~1000x fewer index entries than regular collections</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 40px; height: 40px; background: rgba(168, 85, 247, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">3</div>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Uses control.min/max</div>
                                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Bucket bounds enable efficient range pruning</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Interactive Index Query Visualizer -->
            <div class="card" style="margin-top: 24px;">
                <h4 style="color: var(--accent-green); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.5rem;">ðŸŽ¯</span>
                    Interactive Index Query Visualizer
                </h4>
                
                <!-- Query Builder -->
                <div style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.05) 0%, rgba(6, 182, 212, 0.05) 100%); border: 1px solid rgba(0, 237, 100, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">Select Query Type:</span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;" id="indexQuerySelector">
                        <button class="index-query-btn active" data-query="metadata">
                            <span style="font-size: 1.2rem;">ðŸ·ï¸</span>
                            <span>By Metadata</span>
                            <span style="font-size: 0.7rem; opacity: 0.7;">region: "us-east"</span>
                        </button>
                        <button class="index-query-btn" data-query="timerange">
                            <span style="font-size: 1.2rem;">ðŸ“…</span>
                            <span>Time Range</span>
                            <span style="font-size: 0.7rem; opacity: 0.7;">last 24 hours</span>
                        </button>
                        <button class="index-query-btn" data-query="compound">
                            <span style="font-size: 1.2rem;">ðŸ”—</span>
                            <span>Compound</span>
                            <span style="font-size: 0.7rem; opacity: 0.7;">meta + time</span>
                        </button>
                        <button class="index-query-btn" data-query="measurement">
                            <span style="font-size: 1.2rem;">ðŸ“Š</span>
                            <span>By Value</span>
                            <span style="font-size: 0.7rem; opacity: 0.7;">temp > 30</span>
                        </button>
                    </div>
                    
                    <!-- Generated Query Display -->
                    <div style="margin-top: 20px; background: var(--bg-primary); border-radius: 12px; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">
                        <div style="color: var(--text-muted); font-size: 0.7rem; margin-bottom: 8px;">Generated Query:</div>
                        <div id="indexQueryDisplay" style="color: var(--accent-cyan);"></div>
                    </div>
                    
                    <button id="runIndexQuery" style="margin-top: 16px; background: linear-gradient(135deg, var(--accent-green) 0%, #00c853 100%); color: var(--bg-primary); border: none; padding: 12px 32px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; transition: all 0.3s ease;">
                        <span>â–¶</span> Execute Query
                    </button>
                </div>
                
                <!-- Query Execution Visualization - Properly Separated Concepts -->
                <div style="margin-bottom: 20px;">
                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px dashed var(--accent-purple); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
                            <strong style="color: var(--accent-purple);">âš ï¸ Important Distinction:</strong> 
                            The <strong>B-Tree Index</strong> (indexing structure) and <strong>Buckets</strong> (time series storage) are <em>separate concepts</em>. 
                            The index stores pointers TO bucket documents, not the buckets themselves.
                        </p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- B-Tree Index (Indexing Layer) -->
                    <div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                            <div style="width: 24px; height: 24px; background: var(--accent-purple); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem;">ðŸŒ³</div>
                            <h5 style="color: var(--accent-purple); font-size: 0.85rem; margin: 0;">B-Tree Index</h5>
                            <span style="font-size: 0.65rem; color: var(--text-muted); background: var(--bg-tertiary); padding: 2px 8px; border-radius: 10px;">Indexing Layer</span>
                        </div>
                        <div id="btreeViz" style="background: var(--bg-secondary); border: 2px solid var(--accent-purple); border-radius: 12px; padding: 16px; min-height: 280px; position: relative;">
                            <!-- Index field label -->
                            <div id="indexFieldLabel" style="position: absolute; top: 8px; right: 12px; font-size: 0.65rem; color: var(--accent-purple); font-family: 'JetBrains Mono', monospace; background: var(--bg-tertiary); padding: 3px 8px; border-radius: 6px;">
                                { meta.region: 1 }
                            </div>
                            <svg id="btreeSvg" width="100%" height="250" viewBox="0 0 300 250">
                                <!-- Root Node -->
                                <g id="btreeRoot" class="btree-node" transform="translate(100, 10)">
                                    <rect width="100" height="32" rx="6" fill="var(--bg-tertiary)" stroke="var(--accent-purple)" stroke-width="2"/>
                                    <text x="50" y="14" text-anchor="middle" fill="var(--text-muted)" font-size="7" font-family="JetBrains Mono">INDEX ROOT</text>
                                    <text id="rootLabel" x="50" y="25" text-anchor="middle" fill="var(--text-primary)" font-size="9" font-family="JetBrains Mono">meta.region</text>
                                </g>
                                
                                <!-- Level 1 - Index Entries (Keys) - Dynamic content -->
                                <g id="btreeL1_1" class="btree-node index-entry" transform="translate(15, 70)">
                                    <rect width="75" height="40" rx="5" fill="var(--bg-tertiary)" stroke="var(--border-color)" stroke-width="1.5"/>
                                    <text id="key1" x="37" y="15" text-anchor="middle" fill="var(--accent-green)" font-size="8" font-family="JetBrains Mono">us-east</text>
                                    <text x="37" y="28" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                    <text x="37" y="36" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                </g>
                                <g id="btreeL1_2" class="btree-node index-entry" transform="translate(110, 70)">
                                    <rect width="75" height="40" rx="5" fill="var(--bg-tertiary)" stroke="var(--border-color)" stroke-width="1.5"/>
                                    <text id="key2" x="37" y="15" text-anchor="middle" fill="var(--accent-cyan)" font-size="8" font-family="JetBrains Mono">us-west</text>
                                    <text x="37" y="28" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                    <text x="37" y="36" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                </g>
                                <g id="btreeL1_3" class="btree-node index-entry" transform="translate(205, 70)">
                                    <rect width="75" height="40" rx="5" fill="var(--bg-tertiary)" stroke="var(--border-color)" stroke-width="1.5"/>
                                    <text id="key3" x="37" y="15" text-anchor="middle" fill="var(--accent-orange)" font-size="8" font-family="JetBrains Mono">eu-west</text>
                                    <text x="37" y="28" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                    <text x="37" y="36" text-anchor="middle" fill="var(--text-muted)" font-size="6" font-family="JetBrains Mono">â†’ ObjectId...</text>
                                </g>
                                
                                <!-- Connecting Lines -->
                                <line x1="150" y1="42" x2="52" y2="70" stroke="var(--border-color)" stroke-width="1" opacity="0.5"/>
                                <line x1="150" y1="42" x2="147" y2="70" stroke="var(--border-color)" stroke-width="1" opacity="0.5"/>
                                <line x1="150" y1="42" x2="242" y2="70" stroke="var(--border-color)" stroke-width="1" opacity="0.5"/>
                                
                                <!-- Arrow indicators pointing down to buckets -->
                                <g id="indexPointers" style="opacity: 0;">
                                    <line id="pointer1" x1="52" y1="115" x2="52" y2="140" stroke="var(--accent-green)" stroke-width="2" stroke-dasharray="4,2">
                                        <animate attributeName="stroke-dashoffset" from="20" to="0" dur="0.5s" repeatCount="indefinite"/>
                                    </line>
                                    <polygon id="arrow1" points="52,145 47,138 57,138" fill="var(--accent-green)"/>
                                    
                                    <line id="pointer2" x1="147" y1="115" x2="147" y2="140" stroke="var(--accent-cyan)" stroke-width="2" stroke-dasharray="4,2">
                                        <animate attributeName="stroke-dashoffset" from="20" to="0" dur="0.5s" repeatCount="indefinite"/>
                                    </line>
                                    <polygon id="arrow2" points="147,145 142,138 152,138" fill="var(--accent-cyan)"/>
                                    
                                    <line id="pointer3" x1="242" y1="115" x2="242" y2="140" stroke="var(--accent-orange)" stroke-width="2" stroke-dasharray="4,2">
                                        <animate attributeName="stroke-dashoffset" from="20" to="0" dur="0.5s" repeatCount="indefinite"/>
                                    </line>
                                    <polygon id="arrow3" points="242,145 237,138 247,138" fill="var(--accent-orange)"/>
                                </g>
                                
                                <!-- Label -->
                                <text x="150" y="175" text-anchor="middle" fill="var(--text-muted)" font-size="8" font-family="sans-serif">
                                    Index stores keys + pointers to buckets
                                </text>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Bucket Storage (Time Series Layer) -->
                    <div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                            <div style="width: 24px; height: 24px; background: var(--accent-green); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem;">ðŸ“¦</div>
                            <h5 style="color: var(--accent-green); font-size: 0.85rem; margin: 0;">Bucket Storage</h5>
                            <span style="font-size: 0.65rem; color: var(--text-muted); background: var(--bg-tertiary); padding: 2px 8px; border-radius: 10px;">system.buckets.*</span>
                        </div>
                        <div id="bucketStorage" style="background: var(--bg-secondary); border: 2px solid var(--accent-green); border-radius: 12px; padding: 16px; min-height: 280px;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <!-- Bucket 1 -->
                                <div class="storage-bucket" id="bucket1" data-region="us-east">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-green);">Bucket 1</span>
                                        <span class="bucket-region">us-east</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 00:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">docs:</span> 847</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                                
                                <!-- Bucket 2 -->
                                <div class="storage-bucket" id="bucket2" data-region="us-east">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-green);">Bucket 2</span>
                                        <span class="bucket-region">us-east</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 02:00</div>
                                        <div><span class="ctrl-label">docs:</span> 923</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                                
                                <!-- Bucket 3 -->
                                <div class="storage-bucket" id="bucket3" data-region="us-west">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-cyan);">Bucket 3</span>
                                        <span class="bucket-region">us-west</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 00:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">docs:</span> 756</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                                
                                <!-- Bucket 4 -->
                                <div class="storage-bucket" id="bucket4" data-region="us-west">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-cyan);">Bucket 4</span>
                                        <span class="bucket-region">us-west</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 02:00</div>
                                        <div><span class="ctrl-label">docs:</span> 812</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                                
                                <!-- Bucket 5 -->
                                <div class="storage-bucket" id="bucket5" data-region="eu-west">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-orange);">Bucket 5</span>
                                        <span class="bucket-region">eu-west</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 00:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">docs:</span> 634</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                                
                                <!-- Bucket 6 -->
                                <div class="storage-bucket" id="bucket6" data-region="eu-west">
                                    <div class="bucket-header">
                                        <span style="font-weight: 600; color: var(--accent-orange);">Bucket 6</span>
                                        <span class="bucket-region">eu-west</span>
                                    </div>
                                    <div class="bucket-control">
                                        <div><span class="ctrl-label">min.t:</span> Jan 15 01:00</div>
                                        <div><span class="ctrl-label">max.t:</span> Jan 15 02:00</div>
                                        <div><span class="ctrl-label">docs:</span> 701</div>
                                    </div>
                                    <div class="bucket-status">ðŸ’¤ Compressed</div>
                                </div>
                            </div>
                            
                            <!-- Legend -->
                            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 16px; font-size: 0.7rem; padding-top: 12px; border-top: 1px solid var(--border-color);">
                                <span style="display: flex; align-items: center; gap: 4px;">
                                    <span style="width: 10px; height: 10px; background: var(--accent-green); border-radius: 2px;"></span>
                                    <span style="color: var(--text-muted);">Fetched</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 4px;">
                                    <span style="width: 10px; height: 10px; background: var(--accent-orange); border-radius: 2px;"></span>
                                    <span style="color: var(--text-muted);">Pruned by control.min/max</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 4px;">
                                    <span style="width: 10px; height: 10px; background: var(--text-muted); border-radius: 2px; opacity: 0.3;"></span>
                                    <span style="color: var(--text-muted);">Skipped (wrong meta)</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Execution Flow -->
                <h5 style="color: var(--accent-cyan); margin-bottom: 16px; font-size: 0.85rem;">Query Execution Flow</h5>
                <div id="indexExecutionFlow" style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
                    <!-- Step 1: Parse -->
                    <div class="index-exec-step-v2" id="indexStep1">
                        <div class="step-number" style="background: rgba(168, 85, 247, 0.2); color: var(--accent-purple);">1</div>
                        <div class="step-title">Parse Query</div>
                        <div class="step-desc">Analyze predicates</div>
                        <div class="step-detail" id="indexStepDetail1"></div>
                        <div class="step-status">â³</div>
                    </div>
                    
                    <!-- Step 2: Index Lookup -->
                    <div class="index-exec-step-v2" id="indexStep2">
                        <div class="step-number" style="background: rgba(168, 85, 247, 0.2); color: var(--accent-purple);">2</div>
                        <div class="step-title">Index Lookup</div>
                        <div class="step-desc">B-tree traversal</div>
                        <div class="step-detail" id="indexStepDetail2"></div>
                        <div class="step-status">â³</div>
                    </div>
                    
                    <!-- Step 3: Get Bucket Pointers -->
                    <div class="index-exec-step-v2" id="indexStep3">
                        <div class="step-number" style="background: rgba(6, 182, 212, 0.2); color: var(--accent-cyan);">3</div>
                        <div class="step-title">Get Pointers</div>
                        <div class="step-desc">Bucket ObjectIds</div>
                        <div class="step-detail" id="indexStepDetail3"></div>
                        <div class="step-status">â³</div>
                    </div>
                    
                    <!-- Step 4: Bucket Pruning -->
                    <div class="index-exec-step-v2" id="indexStep4">
                        <div class="step-number" style="background: rgba(0, 237, 100, 0.2); color: var(--accent-green);">4</div>
                        <div class="step-title">Prune Buckets</div>
                        <div class="step-desc">Check min/max</div>
                        <div class="step-detail" id="indexStepDetail4"></div>
                        <div class="step-status">â³</div>
                    </div>
                    
                    <!-- Step 5: Decompress -->
                    <div class="index-exec-step-v2" id="indexStep5">
                        <div class="step-number" style="background: rgba(249, 115, 22, 0.2); color: var(--accent-orange);">5</div>
                        <div class="step-title">Decompress</div>
                        <div class="step-desc">Filter & return</div>
                        <div class="step-detail" id="indexStepDetail5"></div>
                        <div class="step-status">â³</div>
                    </div>
                </div>
                
                <!-- Results Stats -->
                <div id="indexQueryStats" style="display: none; margin-top: 24px; background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%); border-radius: 16px; padding: 24px;">
                    <h5 style="color: var(--accent-green); margin-bottom: 16px;">ðŸ“ˆ Query Statistics</h5>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="text-align: center; background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green);" id="statBucketsScanned">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Buckets Scanned</div>
                        </div>
                        <div style="text-align: center; background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-cyan);" id="statBucketsPruned">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Buckets Pruned</div>
                        </div>
                        <div style="text-align: center; background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-purple);" id="statDocsExamined">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Docs Examined</div>
                        </div>
                        <div style="text-align: center; background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-orange);" id="statDocsReturned">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Docs Returned</div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; display: flex; align-items: center; gap: 12px;">
                        <div style="flex: 1; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                            <div id="efficiencyBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); transition: width 0.5s ease;"></div>
                        </div>
                        <span style="font-size: 0.85rem; color: var(--accent-green); font-weight: 600;" id="efficiencyPercent">0% efficient</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 14: Time Series Aggregations -->
        <section class="section" id="aggregations">
            <div class="section-header">
                <div class="section-number">14</div>
                <h2 class="section-title">Time Series Aggregations</h2>
            </div>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    MongoDB provides powerful aggregation stages designed specifically for time series analysis:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--accent-green)'" onmouseout="this.style.borderColor='var(--border-color)'">
                        <div style="font-size: 2rem; margin-bottom: 12px;">ðŸ“…</div>
                        <h4 style="color: var(--accent-green); margin-bottom: 8px;">$densify</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">Fill gaps in time series data by generating documents for missing time intervals.</p>
                        <div class="code-block" style="margin: 0;">
                            <pre class="code-content" style="font-size: 0.7rem; padding: 12px;">{ $densify: {
  field: "timestamp",
  range: {
    step: 1,
    unit: "hour",
    bounds: "full"
  }
}}</pre>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--accent-cyan)'" onmouseout="this.style.borderColor='var(--border-color)'">
                        <div style="font-size: 2rem; margin-bottom: 12px;">ðŸ”„</div>
                        <h4 style="color: var(--accent-cyan); margin-bottom: 8px;">$fill</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">Fill null values using linear interpolation or last observed value (LOCF).</p>
                        <div class="code-block" style="margin: 0;">
                            <pre class="code-content" style="font-size: 0.7rem; padding: 12px;">{ $fill: {
  sortBy: { timestamp: 1 },
  output: {
    temperature: {
      method: "linear"
    }
  }
}}</pre>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--accent-purple)'" onmouseout="this.style.borderColor='var(--border-color)'">
                        <div style="font-size: 2rem; margin-bottom: 12px;">ðŸ“Š</div>
                        <h4 style="color: var(--accent-purple); margin-bottom: 8px;">$setWindowFields</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">Compute moving averages, running totals, and rankings over time windows.</p>
                        <div class="code-block" style="margin: 0;">
                            <pre class="code-content" style="font-size: 0.7rem; padding: 12px;">{ $setWindowFields: {
  sortBy: { timestamp: 1 },
  output: {
    movingAvg: {
      $avg: "$temp",
      window: { range: [-1, 0], unit: "hour" }
    }
  }
}}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ====== PART V: COMPARISONS ====== -->
        <div class="master-section-header comparisons">
            <div class="master-section-badge comparisons">Part V</div>
            <h2 class="master-section-title">Comparisons & Trade-offs</h2>
            <p class="master-section-desc">Understanding when to use time series collections and their limitations</p>
        </div>
        
        <!-- Section 10: Regular vs Time Series -->
        <section class="section" id="vs-regular">
            <div class="section-header">
                <div class="section-number">15</div>
                <h2 class="section-title">Regular Collection vs Time Series</h2>
            </div>
            
            <div class="card">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Aspect</th>
                            <th>Regular Collection</th>
                            <th>Time Series Collection</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Document Storage</td>
                            <td class="dim-cell">One document = one BSON document</td>
                            <td class="highlight-cell">Many documents = one bucket document</td>
                        </tr>
                        <tr>
                            <td>Field Storage</td>
                            <td class="dim-cell">Row-oriented (all fields together)</td>
                            <td class="highlight-cell">Column-oriented (fields stored separately)</td>
                        </tr>
                        <tr>
                            <td>Compression</td>
                            <td class="dim-cell">Block-level only (WiredTiger)</td>
                            <td class="highlight-cell">Delta + RLE + Block compression</td>
                        </tr>
                        <tr>
                            <td>Index Entries</td>
                            <td class="dim-cell">One per document</td>
                            <td class="highlight-cell">One per bucket (~1000x fewer)</td>
                        </tr>
                        <tr>
                            <td>Time Range Queries</td>
                            <td class="dim-cell">Scans matching documents</td>
                            <td class="highlight-cell">Bucket pruning + clustered access</td>
                        </tr>
                        <tr>
                            <td>Write Pattern</td>
                            <td class="dim-cell">Individual inserts</td>
                            <td class="highlight-cell">Batched into bucket updates</td>
                        </tr>
                        <tr>
                            <td>Storage for 1M docs</td>
                            <td class="dim-cell">~500 MB</td>
                            <td class="highlight-cell">~50 MB (90% savings)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 20: Comparison with Other TSDB -->
        <section class="section" id="vs-tsdb">
            <div class="section-header">
                <div class="section-number">16</div>
                <h2 class="section-title">MongoDB vs Other Time Series Databases</h2>
            </div>
            
            <div class="card">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th style="text-align: center;">
                                <span style="color: var(--accent-green);">MongoDB</span>
                            </th>
                            <th style="text-align: center;">InfluxDB</th>
                            <th style="text-align: center;">TimescaleDB</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Data Model</td>
                            <td class="highlight-cell" style="text-align: center;">Document (BSON)</td>
                            <td style="text-align: center; color: var(--text-secondary);">Line Protocol</td>
                            <td style="text-align: center; color: var(--text-secondary);">Relational (SQL)</td>
                        </tr>
                        <tr>
                            <td>Query Language</td>
                            <td class="highlight-cell" style="text-align: center;">MQL + Aggregation</td>
                            <td style="text-align: center; color: var(--text-secondary);">Flux / InfluxQL</td>
                            <td style="text-align: center; color: var(--text-secondary);">SQL</td>
                        </tr>
                        <tr>
                            <td>Schema Flexibility</td>
                            <td class="highlight-cell" style="text-align: center;">â­â­â­â­â­</td>
                            <td style="text-align: center; color: var(--text-secondary);">â­â­â­</td>
                            <td style="text-align: center; color: var(--text-secondary);">â­â­</td>
                        </tr>
                        <tr>
                            <td>Joins & Relations</td>
                            <td class="highlight-cell" style="text-align: center;">$lookup, embedding</td>
                            <td style="text-align: center; color: var(--text-secondary);">Limited</td>
                            <td style="text-align: center; color: var(--text-secondary);">Full SQL joins</td>
                        </tr>
                        <tr>
                            <td>Ecosystem</td>
                            <td class="highlight-cell" style="text-align: center;">Atlas, Charts, Search</td>
                            <td style="text-align: center; color: var(--text-secondary);">Telegraf, Grafana</td>
                            <td style="text-align: center; color: var(--text-secondary);">PostgreSQL ecosystem</td>
                        </tr>
                        <tr>
                            <td>Best For</td>
                            <td class="highlight-cell" style="text-align: center;">Mixed workloads</td>
                            <td style="text-align: center; color: var(--text-secondary);">Pure metrics</td>
                            <td style="text-align: center; color: var(--text-secondary);">SQL shops</td>
                        </tr>
                        <tr>
                            <td>Compression</td>
                            <td class="highlight-cell" style="text-align: center;">~90%</td>
                            <td style="text-align: center; color: var(--text-secondary);">~95%</td>
                            <td style="text-align: center; color: var(--text-secondary);">~85%</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="info-box" style="margin-top: 24px; border-color: var(--accent-green);">
                    <div class="info-icon">ðŸŽ¯</div>
                    <div class="info-content">
                        <h4 style="color: var(--accent-green);">MongoDB's Unique Advantage</h4>
                        <p>MongoDB lets you store time series data alongside your operational data in one database. No need for a separate TSDB + complex ETL pipelines. Combine sensor readings with device metadata, user profiles, and application state in unified queries.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 17: Limitations & Gotchas -->
        <section class="section" id="limitations">
            <div class="section-header">
                <div class="section-number">17</div>
                <h2 class="section-title">Limitations & Gotchas</h2>
            </div>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Time series collections have some restrictions to be aware of. Understanding these helps you design better schemas:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.02) 100%); border: 1px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">ðŸš«</span>
                            <h4 style="color: #ef4444;">Cannot Modify timeField</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Once inserted, the timestamp field cannot be updated. You must delete and re-insert to change it.</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.02) 100%); border: 1px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">ðŸš«</span>
                            <h4 style="color: #ef4444;">Cannot Modify metaField</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">The metadata field is immutable after insertion. Plan your metadata structure carefully upfront.</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.02) 100%); border: 1px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">ðŸš«</span>
                            <h4 style="color: #ef4444;">No Transactions</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Time series collections don't support multi-document transactions. Use for append-only workloads.</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.02) 100%); border: 1px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">ðŸš«</span>
                            <h4 style="color: #ef4444;">No Change Streams (Pre-6.0)</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Change streams weren't supported until MongoDB 6.0. Now available with some limitations.</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(249, 115, 22, 0.02) 100%); border: 1px solid var(--accent-orange); border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">âš ï¸</span>
                            <h4 style="color: var(--accent-orange);">Deletes are Expensive</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Individual deletes must decompress buckets. Use TTL instead for automatic expiration.</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(249, 115, 22, 0.02) 100%); border: 1px solid var(--accent-orange); border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">âš ï¸</span>
                            <h4 style="color: var(--accent-orange);">Schema Changes Limited</h4>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Can't change granularity or field mappings after creation. Plan schema carefully.</p>
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 24px; border-color: var(--accent-green);">
                    <div class="info-icon">âœ…</div>
                    <div class="info-content">
                        <h4 style="color: var(--accent-green);">Pro Tip: Design for Append-Only</h4>
                        <p>Time series collections work best for append-only, immutable data. If you need frequent updates, consider a regular collection with appropriate indexes.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ====== PART VI: TOOLS & REFERENCE ====== -->
        <div class="master-section-header tools">
            <div class="master-section-badge tools">Part VI</div>
            <h2 class="master-section-title">Tools & Reference</h2>
            <p class="master-section-desc">Best practices, calculators, and interactive demos</p>
        </div>
        
        <!-- Section 11: Best Practices -->
        <section class="section" id="best-practices">
            <div class="section-header">
                <div class="section-number">18</div>
                <h2 class="section-title">Best Practices</h2>
            </div>
            
            <div class="intro-grid">
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.2) 0%, rgba(0, 237, 100, 0.05) 100%);">âœ…</div>
                    <h3>Choose Right Granularity</h3>
                    <p>Match granularity to your data frequency. Higher frequency = finer granularity for optimal bucketing.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%);">âœ…</div>
                    <h3>Use MetaField Wisely</h3>
                    <p>Group related measurements together. High-cardinality metadata creates more buckets = less compression.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.05) 100%);">âœ…</div>
                    <h3>Insert In Order</h3>
                    <p>Insert documents in time order when possible. Out-of-order inserts may create additional buckets.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(249, 115, 22, 0.05) 100%);">âœ…</div>
                    <h3>Add Secondary Indexes</h3>
                    <p>Create indexes on metaField sub-fields if you query by those values frequently.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(236, 72, 153, 0.05) 100%);">âœ…</div>
                    <h3>Use TTL for Cleanup</h3>
                    <p>Set expireAfterSeconds to automatically remove old data and keep storage costs down.</p>
                </div>
                <div class="card intro-card">
                    <div class="intro-icon" style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.2) 0%, rgba(34, 211, 238, 0.05) 100%);">âœ…</div>
                    <h3>Query Time Ranges</h3>
                    <p>Always include time range filters in queries to benefit from bucket pruning optimization.</p>
                </div>
            </div>
        </section>

        <!-- Section 15: Storage Calculator -->
        <section class="section" id="calculator">
            <div class="section-header">
                <div class="section-number">19</div>
                <h2 class="section-title">Storage Savings Calculator</h2>
            </div>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Estimate your storage savings by switching to time series collections:
                </p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                    <div>
                        <h4 style="color: var(--accent-cyan); margin-bottom: 20px;">ðŸ“ Input Your Data Profile</h4>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Documents per day:</label>
                            <input type="number" id="docsPerDay" value="1000000" oninput="calculateStorage()" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Average document size (bytes):</label>
                            <input type="number" id="docSize" value="200" oninput="calculateStorage()" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Retention period (days):</label>
                            <input type="number" id="retention" value="365" oninput="calculateStorage()" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 8px;">Compression ratio (adjust based on data):</label>
                            <input type="range" id="compressionSlider" min="50" max="95" value="85" oninput="calculateStorage()" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted);">
                                <span>50%</span>
                                <span id="compressionValue">85%</span>
                                <span>95%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--accent-green); margin-bottom: 20px;">ðŸ“Š Storage Comparison</h4>
                        
                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 24px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <span style="color: var(--text-secondary);">Regular Collection:</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; color: var(--accent-orange);" id="regularSize">73.0 GB</span>
                            </div>
                            <div style="height: 24px; background: var(--bg-tertiary); border-radius: 6px; overflow: hidden; margin-bottom: 24px;">
                                <div style="height: 100%; background: var(--accent-orange); width: 100%;"></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <span style="color: var(--text-secondary);">Time Series Collection:</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; color: var(--accent-green);" id="tsSize">11.0 GB</span>
                            </div>
                            <div style="height: 24px; background: var(--bg-tertiary); border-radius: 6px; overflow: hidden;">
                                <div id="tsBar" style="height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); width: 15%; transition: width 0.5s ease;"></div>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 237, 100, 0.02) 100%); border: 1px solid var(--accent-green); border-radius: 12px; padding: 24px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--accent-green);" id="storageSavedCalc">62.0 GB</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Storage Saved</div>
                            <div style="font-size: 0.8rem; color: var(--accent-cyan); margin-top: 8px;" id="compressionPercent">85% compression</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 19: Version History -->
        <section class="section" id="versions">
            <div class="section-header">
                <div class="section-number">20</div>
                <h2 class="section-title">Version History & Evolution</h2>
            </div>
            
            <div class="card">
                <div style="position: relative; padding-left: 40px;">
                    <div style="position: absolute; left: 15px; top: 0; bottom: 0; width: 3px; background: linear-gradient(to bottom, var(--accent-green), var(--accent-cyan), var(--accent-purple), var(--accent-orange));"></div>
                    
                    <div style="margin-bottom: 32px; position: relative;">
                        <div style="position: absolute; left: -33px; width: 20px; height: 20px; background: var(--accent-green); border-radius: 50%; border: 4px solid var(--bg-primary);"></div>
                        <div style="background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-green); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-green);">MongoDB 5.0</span>
                                <span style="font-size: 0.75rem; padding: 4px 10px; background: rgba(0,237,100,0.2); color: var(--accent-green); border-radius: 20px;">July 2021</span>
                            </div>
                            <ul style="list-style: none; font-size: 0.85rem; color: var(--text-secondary);">
                                <li style="margin-bottom: 6px;">âœ¨ Time Series collections introduced</li>
                                <li style="margin-bottom: 6px;">âœ¨ Automatic bucketing & compression</li>
                                <li style="margin-bottom: 6px;">âœ¨ TTL support for automatic data expiration</li>
                                <li>âœ¨ Secondary indexes on metadata</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 32px; position: relative;">
                        <div style="position: absolute; left: -33px; width: 20px; height: 20px; background: var(--accent-cyan); border-radius: 50%; border: 4px solid var(--bg-primary);"></div>
                        <div style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-cyan); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-cyan);">MongoDB 6.0</span>
                                <span style="font-size: 0.75rem; padding: 4px 10px; background: rgba(34,211,238,0.2); color: var(--accent-cyan); border-radius: 20px;">July 2022</span>
                            </div>
                            <ul style="list-style: none; font-size: 0.85rem; color: var(--text-secondary);">
                                <li style="margin-bottom: 6px;">ðŸ”„ Bucket reopening for out-of-order data</li>
                                <li style="margin-bottom: 6px;">ðŸ“¡ Change streams support</li>
                                <li style="margin-bottom: 6px;">ðŸ—‘ï¸ Delete operations support</li>
                                <li>ðŸ“Š $densify and $fill aggregation stages</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 32px; position: relative;">
                        <div style="position: absolute; left: -33px; width: 20px; height: 20px; background: var(--accent-purple); border-radius: 50%; border: 4px solid var(--bg-primary);"></div>
                        <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-purple); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-purple);">MongoDB 6.3</span>
                                <span style="font-size: 0.75rem; padding: 4px 10px; background: rgba(168,85,247,0.2); color: var(--accent-purple); border-radius: 20px;">March 2023</span>
                            </div>
                            <ul style="list-style: none; font-size: 0.85rem; color: var(--text-secondary);">
                                <li style="margin-bottom: 6px;">â±ï¸ bucketMaxSpanSeconds for custom granularity</li>
                                <li style="margin-bottom: 6px;">ðŸ”„ bucketRoundingSeconds for alignment</li>
                                <li>ðŸ“ˆ Improved query performance</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="position: relative;">
                        <div style="position: absolute; left: -33px; width: 20px; height: 20px; background: var(--accent-orange); border-radius: 50%; border: 4px solid var(--bg-primary);"></div>
                        <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, transparent 100%); border: 1px solid var(--accent-orange); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-orange);">MongoDB 7.0+</span>
                                <span style="font-size: 0.75rem; padding: 4px 10px; background: rgba(249,115,22,0.2); color: var(--accent-orange); border-radius: 20px;">August 2023</span>
                            </div>
                            <ul style="list-style: none; font-size: 0.85rem; color: var(--text-secondary);">
                                <li style="margin-bottom: 6px;">ðŸ”€ Sharding support for time series</li>
                                <li style="margin-bottom: 6px;">âš¡ Column store indexes (preview)</li>
                                <li style="margin-bottom: 6px;">ðŸ“Š Enhanced aggregation pushdown</li>
                                <li>ðŸš€ Improved compression algorithms</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 21: Interactive Demo -->
        <section class="section" id="demo">
            <div class="section-header">
                <div class="section-number">21</div>
                <h2 class="section-title">Live Visualization</h2>
            </div>
            
            <div class="card bucket-demo">
                <div class="demo-controls">
                    <button class="demo-btn active" onclick="startDemo()" id="startBtn">â–¶ Start Streaming</button>
                    <button class="demo-btn" onclick="stopDemo()" id="stopBtn">â¹ Stop</button>
                    <button class="demo-btn" onclick="resetDemo()" id="resetBtn">ðŸ”„ Reset</button>
                </div>
                
                <div class="demo-canvas">
                    <div style="display: flex; gap: 40px;">
                        <!-- Incoming Stream -->
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 16px; color: var(--accent-cyan);">ðŸ“¥ Incoming Documents</h4>
                            <div id="incomingDocs" style="height: 250px; overflow: hidden; position: relative; background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                                <!-- Documents will appear here -->
                            </div>
                        </div>
                        
                        <!-- Buckets -->
                        <div style="flex: 2;">
                            <h4 style="margin-bottom: 16px; color: var(--accent-green);">ðŸ“¦ Buckets</h4>
                            <div id="bucketsContainer" class="buckets-display">
                                <!-- Buckets will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 24px; margin-top: 32px;">
                        <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green);" id="docsInserted">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Documents Inserted</div>
                        </div>
                        <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-cyan);" id="bucketsCreated">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Buckets</div>
                        </div>
                        <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-purple);" id="compressionRatio">0%</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Compression</div>
                        </div>
                        <div style="flex: 1; background: var(--bg-tertiary); border-radius: 12px; padding: 20px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-orange);" id="storageSaved">0 KB</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Storage Saved</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // ==========================================
        // SECTION 12: LIVE VISUALIZATION DEMO
        // ==========================================
        let demoInterval = null;
        let docsCount = 0;
        const sensors = ['sensor_A', 'sensor_B', 'sensor_C', 'sensor_D'];
        const locations = ['NYC', 'SF', 'LA', 'CHI'];
        const buckets = {};
        const DOCS_PER_BUCKET = 15;
        let totalBucketsCreated = 0;
        
        function startDemo() {
            if (demoInterval) return;
            document.getElementById('startBtn').classList.add('active');
            document.getElementById('stopBtn').classList.remove('active');
            demoInterval = setInterval(() => insertDocument(), 400);
        }
        
        function stopDemo() {
            if (demoInterval) {
                clearInterval(demoInterval);
                demoInterval = null;
            }
            document.getElementById('startBtn').classList.remove('active');
            document.getElementById('stopBtn').classList.add('active');
        }
        
        function resetDemo() {
            stopDemo();
            docsCount = 0;
            totalBucketsCreated = 0;
            Object.keys(buckets).forEach(key => delete buckets[key]);
            document.getElementById('incomingDocs').innerHTML = '';
            document.getElementById('bucketsContainer').innerHTML = '';
            document.getElementById('docsInserted').textContent = '0';
            document.getElementById('bucketsCreated').textContent = '0';
            document.getElementById('compressionRatio').textContent = '0%';
            document.getElementById('storageSaved').textContent = '0 KB';
            document.getElementById('startBtn').classList.remove('active');
        }
        
        function insertDocument() {
            docsCount++;
            const sensor = sensors[Math.floor(Math.random() * sensors.length)];
            const location = locations[Math.floor(Math.random() * locations.length)];
            const temp = (20 + Math.random() * 10).toFixed(1);
            const humidity = (40 + Math.random() * 30).toFixed(0);
            const time = new Date().toLocaleTimeString();
            const bucketKey = `${sensor}_${location}`;
            
            // Show incoming document with more detail
            const docEl = document.createElement('div');
            docEl.style.cssText = `
                padding: 10px 14px;
                background: var(--bg-secondary);
                border-radius: 8px;
                margin-bottom: 8px;
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.75rem;
                animation: slideIn 0.3s ease-out;
                border-left: 3px solid var(--accent-green);
            `;
            docEl.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span style="color: var(--accent-cyan);">${time}</span>
                    <span style="color: var(--accent-purple);">${sensor}</span>
                </div>
                <div style="display: flex; gap: 16px; color: var(--text-secondary);">
                    <span>ðŸ“ ${location}</span>
                    <span style="color: var(--accent-green);">ðŸŒ¡ï¸ ${temp}Â°C</span>
                    <span style="color: var(--accent-blue);">ðŸ’§ ${humidity}%</span>
                </div>
            `;
            
            const incomingContainer = document.getElementById('incomingDocs');
            incomingContainer.insertBefore(docEl, incomingContainer.firstChild);
            while (incomingContainer.children.length > 6) {
                incomingContainer.removeChild(incomingContainer.lastChild);
            }
            
            // Add to bucket
            if (!buckets[bucketKey]) {
                totalBucketsCreated++;
                buckets[bucketKey] = { 
                    count: 0, 
                    id: totalBucketsCreated,
                    sensor: sensor,
                    location: location,
                    startTime: time,
                    status: 'open'
                };
                createBucketElement(bucketKey, buckets[bucketKey]);
            }
            
            buckets[bucketKey].count++;
            updateBucketElement(bucketKey);
            
            // Check if bucket is full
            if (buckets[bucketKey].count >= DOCS_PER_BUCKET) {
                closeBucket(bucketKey);
            }
            
            updateStats();
        }
        
        function createBucketElement(key, data) {
            const container = document.getElementById('bucketsContainer');
            const bucketEl = document.createElement('div');
            bucketEl.className = 'animated-bucket';
            bucketEl.id = `bucket-${key}`;
            bucketEl.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span class="animated-bucket-header" style="margin: 0; padding: 0; border: 0;">Bucket #${data.id}</span>
                    <span style="font-size: 0.65rem; padding: 2px 8px; background: rgba(0,237,100,0.2); color: var(--accent-green); border-radius: 10px;" class="bucket-status-badge">OPEN</span>
                </div>
                <div style="font-size: 0.75rem; color: var(--accent-purple); margin-bottom: 4px;">${data.sensor} â†’ ${data.location}</div>
                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px;">Started: ${data.startTime}</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">
                    <span class="doc-count">0</span>/${DOCS_PER_BUCKET} docs
                </div>
                <div class="bucket-fill-bar">
                    <div class="bucket-fill" style="width: 0%;"></div>
                </div>
            `;
            container.insertBefore(bucketEl, container.firstChild);
        }
        
        function updateBucketElement(key) {
            const bucketEl = document.getElementById(`bucket-${key}`);
            if (!bucketEl || !buckets[key]) return;
            const count = buckets[key].count;
            const pct = (count / DOCS_PER_BUCKET) * 100;
            bucketEl.querySelector('.doc-count').textContent = count;
            bucketEl.querySelector('.bucket-fill').style.width = `${pct}%`;
            
            // Change color as it fills up
            if (pct > 80) {
                bucketEl.style.borderColor = 'var(--accent-orange)';
                bucketEl.querySelector('.bucket-status-badge').textContent = 'CLOSING';
                bucketEl.querySelector('.bucket-status-badge').style.background = 'rgba(249,115,22,0.2)';
                bucketEl.querySelector('.bucket-status-badge').style.color = 'var(--accent-orange)';
            }
        }
        
        function closeBucket(key) {
            const bucketEl = document.getElementById(`bucket-${key}`);
            if (bucketEl) {
                bucketEl.style.borderColor = 'var(--accent-cyan)';
                bucketEl.style.background = 'linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(34, 211, 238, 0.02) 100%)';
                bucketEl.querySelector('.bucket-fill').style.background = 'linear-gradient(90deg, var(--accent-cyan), var(--accent-purple))';
                bucketEl.querySelector('.bucket-status-badge').textContent = 'CLOSED';
                bucketEl.querySelector('.bucket-status-badge').style.background = 'rgba(34,211,238,0.2)';
                bucketEl.querySelector('.bucket-status-badge').style.color = 'var(--accent-cyan)';
            }
            delete buckets[key];
        }
        
        function updateStats() {
            document.getElementById('docsInserted').textContent = docsCount;
            document.getElementById('bucketsCreated').textContent = totalBucketsCreated;
            const compression = Math.min(85 + (docsCount * 0.05), 95);
            document.getElementById('compressionRatio').textContent = `${compression.toFixed(0)}%`;
            const rawSize = docsCount * 0.2;
            const saved = rawSize * (compression/100);
            document.getElementById('storageSaved').textContent = `${saved.toFixed(1)} KB`;
        }
        
        // ==========================================
        // SECTION 6: MEMORY MANAGEMENT DEMO
        // ==========================================
        let memoryDemoInterval = null;
        let memoryUsed = 0;
        const MEMORY_LIMIT = 256;
        let liveBuckets = {};
        let liveBucketIdCounter = 0;
        let liveClosedCount = 0;
        let liveDocsPerSec = 0;
        let liveDocCounter = 0;
        
        const sensorTypes = [
            { id: 'temp_sensor', color: '#00ed64', icon: 'ðŸŒ¡ï¸' },
            { id: 'humidity_sensor', color: '#22d3ee', icon: 'ðŸ’§' },
            { id: 'pressure_sensor', color: '#a855f7', icon: 'ðŸ“Š' },
            { id: 'motion_sensor', color: '#f97316', icon: 'ðŸƒ' },
            { id: 'light_sensor', color: '#ec4899', icon: 'ðŸ’¡' }
        ];
        
        function startMemoryDemo() {
            if (memoryDemoInterval) return;
            document.getElementById('memStartBtn').classList.add('active');
            document.getElementById('memStopBtn').classList.remove('active');
            
            // Doc counter for docs/sec
            let lastDocCount = liveDocCounter;
            setInterval(() => {
                liveDocsPerSec = liveDocCounter - lastDocCount;
                lastDocCount = liveDocCounter;
                document.getElementById('docsPerSec').textContent = liveDocsPerSec * 5;
            }, 200);
            
            memoryDemoInterval = setInterval(() => simulateMemoryOperation(), 200);
        }
        
        function stopMemoryDemo() {
            if (memoryDemoInterval) {
                clearInterval(memoryDemoInterval);
                memoryDemoInterval = null;
            }
            document.getElementById('memStartBtn').classList.remove('active');
            document.getElementById('memStopBtn').classList.add('active');
        }
        
        function resetMemoryDemo() {
            stopMemoryDemo();
            memoryUsed = 0;
            liveBuckets = {};
            liveBucketIdCounter = 0;
            liveClosedCount = 0;
            liveDocCounter = 0;
            document.getElementById('liveBucketGrid').innerHTML = '';
            document.getElementById('livememGauge').style.width = '0%';
            document.getElementById('liveMemValue').textContent = '0 MB / 256 MB';
            document.getElementById('openBucketCount').textContent = '0';
            document.getElementById('closedBucketCount').textContent = '0';
            document.getElementById('docsPerSec').textContent = '0';
            document.getElementById('memStartBtn').classList.remove('active');
        }
        
        function simulateMemoryOperation() {
            liveDocCounter++;
            
            // Random sensor type
            const sensorType = sensorTypes[Math.floor(Math.random() * sensorTypes.length)];
            const bucketKey = `${sensorType.id}_${Math.floor(Math.random() * 3)}`;
            
            // Create new bucket if needed
            if (!liveBuckets[bucketKey]) {
                liveBucketIdCounter++;
                liveBuckets[bucketKey] = {
                    id: liveBucketIdCounter,
                    type: sensorType,
                    docs: 0,
                    maxDocs: 80 + Math.floor(Math.random() * 40),
                    memory: 0,
                    status: 'open',
                    created: new Date().toLocaleTimeString()
                };
                memoryUsed += 5; // Initial bucket overhead
                createLiveBucketElement(bucketKey, liveBuckets[bucketKey]);
            }
            
            // Add doc to bucket
            const bucket = liveBuckets[bucketKey];
            bucket.docs++;
            bucket.memory += 0.1 + Math.random() * 0.1;
            memoryUsed += 0.15;
            
            updateLiveBucketElement(bucketKey);
            
            // Check for bucket closure
            if (bucket.docs >= bucket.maxDocs) {
                closeLiveBucket(bucketKey);
            }
            
            // Memory pressure - close oldest buckets if over limit
            if (memoryUsed > MEMORY_LIMIT * 0.9) {
                const oldestKey = Object.keys(liveBuckets)[0];
                if (oldestKey) {
                    closeLiveBucket(oldestKey);
                }
            }
            
            updateMemoryStats();
        }
        
        function createLiveBucketElement(key, data) {
            const grid = document.getElementById('liveBucketGrid');
            const el = document.createElement('div');
            el.className = 'live-bucket open';
            el.id = `live-bucket-${key}`;
            el.style.setProperty('--bucket-color', data.type.color);
            el.innerHTML = `
                <div class="live-bucket-header">
                    <span class="live-bucket-id">${data.type.icon} #${data.id}</span>
                    <span class="live-bucket-status open">OPEN</span>
                </div>
                <div class="live-bucket-meta">${data.type.id}</div>
                <div class="live-bucket-progress">
                    <div class="live-bucket-progress-fill" style="width: 0%;"></div>
                </div>
                <div class="live-bucket-stats">
                    <span class="lb-docs">${data.docs} docs</span>
                    <span class="lb-mem">${data.memory.toFixed(1)} KB</span>
                </div>
            `;
            el.querySelector('.live-bucket-progress-fill').style.background = data.type.color;
            grid.insertBefore(el, grid.firstChild);
        }
        
        function updateLiveBucketElement(key) {
            const el = document.getElementById(`live-bucket-${key}`);
            const bucket = liveBuckets[key];
            if (!el || !bucket) return;
            
            const pct = (bucket.docs / bucket.maxDocs) * 100;
            el.querySelector('.live-bucket-progress-fill').style.width = `${pct}%`;
            el.querySelector('.lb-docs').textContent = `${bucket.docs} docs`;
            el.querySelector('.lb-mem').textContent = `${bucket.memory.toFixed(1)} KB`;
            
            if (pct > 80 && bucket.status === 'open') {
                bucket.status = 'closing';
                el.className = 'live-bucket closing';
                el.querySelector('.live-bucket-status').className = 'live-bucket-status closing';
                el.querySelector('.live-bucket-status').textContent = 'CLOSING';
            }
        }
        
        function closeLiveBucket(key) {
            const el = document.getElementById(`live-bucket-${key}`);
            const bucket = liveBuckets[key];
            if (!el || !bucket) return;
            
            // Compression simulation - reduce memory
            memoryUsed -= bucket.memory * 0.8;
            liveClosedCount++;
            
            el.className = 'live-bucket closed';
            el.querySelector('.live-bucket-status').className = 'live-bucket-status closed';
            el.querySelector('.live-bucket-status').textContent = 'CLOSED';
            
            // Remove from active buckets
            delete liveBuckets[key];
            
            // Fade out after a moment
            setTimeout(() => {
                el.style.opacity = '0.5';
                el.style.transform = 'scale(0.95)';
            }, 500);
            
            // Remove element after more time
            setTimeout(() => {
                if (el.parentNode) el.parentNode.removeChild(el);
            }, 3000);
        }
        
        function updateMemoryStats() {
            const pct = Math.min((memoryUsed / MEMORY_LIMIT) * 100, 100);
            document.getElementById('livememGauge').style.width = `${pct}%`;
            document.getElementById('liveMemValue').textContent = `${memoryUsed.toFixed(0)} MB / ${MEMORY_LIMIT} MB`;
            document.getElementById('openBucketCount').textContent = Object.keys(liveBuckets).length;
            document.getElementById('closedBucketCount').textContent = liveClosedCount;
            
            // Change gauge color based on pressure
            const gauge = document.getElementById('livememGauge');
            if (pct > 80) {
                gauge.style.background = 'linear-gradient(90deg, var(--accent-orange), var(--accent-pink))';
            } else if (pct > 60) {
                gauge.style.background = 'linear-gradient(90deg, var(--accent-cyan), var(--accent-orange))';
            } else {
                gauge.style.background = 'linear-gradient(90deg, var(--accent-green), var(--accent-cyan))';
            }
        }
        
        // ==========================================
        // ANIMATION KEYFRAMES
        // ==========================================
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(-20px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeInUp {
                from { transform: translateY(10px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        // ==========================================
        // INTERACTIVE BUCKET ENTRIES (Section 6)
        // ==========================================
        document.querySelectorAll('.bucket-entry').forEach(entry => {
            entry.addEventListener('click', function() {
                // Toggle expanded view
                this.classList.toggle('expanded');
                if (this.classList.contains('expanded')) {
                    const details = document.createElement('div');
                    details.className = 'bucket-details';
                    details.style.cssText = `
                        margin-top: 12px;
                        padding-top: 12px;
                        border-top: 1px solid var(--border-color);
                        font-size: 0.75rem;
                        color: var(--text-secondary);
                        animation: fadeInUp 0.3s ease;
                    `;
                    details.innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div>Memory: <span style="color: var(--accent-purple);">2.4 KB</span></div>
                            <div>Compression: <span style="color: var(--accent-green);">Pending</span></div>
                            <div>Fields: <span style="color: var(--accent-cyan);">5</span></div>
                            <div>Write Ops: <span style="color: var(--accent-orange);">847</span></div>
                        </div>
                    `;
                    this.appendChild(details);
                } else {
                    const details = this.querySelector('.bucket-details');
                    if (details) details.remove();
                }
            });
        });
        
        // Animate bucket docs on load
        document.querySelectorAll('.bucket-doc').forEach((doc, i) => {
            doc.style.animationDelay = `${i * 0.1}s`;
        });
        
        // Animate memory usage periodically in the static display
        setInterval(() => {
            const base = 128;
            const variation = Math.sin(Date.now() / 2000) * 20;
            const value = Math.round(base + variation);
            const memUsedEl = document.getElementById('memUsed');
            const memGaugeEl = document.getElementById('memGauge');
            if (memUsedEl) memUsedEl.textContent = value;
            if (memGaugeEl) {
                const pct = (value / 256) * 100;
                memGaugeEl.style.width = `${pct}%`;
            }
        }, 100);
        
        // ==========================================
        // NAVIGATION DOTS
        // ==========================================
        const navDots = document.querySelectorAll('.nav-dot');
        const sections = document.querySelectorAll('.section');
        
        // Click to navigate
        navDots.forEach(dot => {
            dot.addEventListener('click', () => {
                const sectionNum = parseInt(dot.dataset.section);
                const targetSection = sections[sectionNum - 1];
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
        
        // Update active dot on scroll
        const observerOptions = {
            root: null,
            rootMargin: '-30% 0px -70% 0px',
            threshold: 0
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const index = Array.from(sections).indexOf(entry.target);
                    navDots.forEach((dot, i) => {
                        dot.classList.toggle('active', i === index);
                    });
                }
            });
        }, observerOptions);
        
        sections.forEach(section => observer.observe(section));
        
        // ==========================================
        // SMOOTH REVEAL ANIMATIONS
        // ==========================================
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });
        
        document.querySelectorAll('.card, .stat-card, .intro-card').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            revealObserver.observe(el);
        });
        
        // ==========================================
        // STATE MACHINE HOVER EFFECTS
        // ==========================================
        document.querySelectorAll('.state-node').forEach((node, index) => {
            node.addEventListener('mouseenter', () => {
                const descriptions = [
                    'A new bucket is created when a document arrives with new metadata or outside current time range.',
                    'The bucket actively accepts new documents. Multiple buckets can be open simultaneously for different metadata values.',
                    'Triggered when bucket reaches size/doc limits. Prepares data for compression.',
                    'Data is compressed (delta + RLE + zstd) and written to disk. Bucket removed from memory.'
                ];
                
                // Create tooltip if not exists
                let tooltip = node.querySelector('.state-tooltip');
                if (!tooltip) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'state-tooltip';
                    tooltip.style.cssText = `
                        position: absolute;
                        bottom: 100%;
                        left: 50%;
                        transform: translateX(-50%);
                        background: var(--bg-primary);
                        border: 1px solid var(--accent-green);
                        border-radius: 8px;
                        padding: 12px 16px;
                        font-size: 0.8rem;
                        color: var(--text-secondary);
                        width: 200px;
                        text-align: center;
                        z-index: 100;
                        margin-bottom: 10px;
                        opacity: 0;
                        transition: opacity 0.2s ease;
                    `;
                    tooltip.textContent = descriptions[index];
                    node.style.position = 'relative';
                    node.appendChild(tooltip);
                }
                tooltip.style.opacity = '1';
            });
            
            node.addEventListener('mouseleave', () => {
                const tooltip = node.querySelector('.state-tooltip');
                if (tooltip) tooltip.style.opacity = '0';
            });
        });
        
        // ==========================================
        // COMPRESSION STAGE ANIMATION
        // ==========================================
        const compressionStages = document.querySelectorAll('.compression-stage');
        let compressionAnimInterval = null;
        
        const startCompressionAnimation = () => {
            let currentStage = 0;
            compressionAnimInterval = setInterval(() => {
                compressionStages.forEach((stage, i) => {
                    stage.style.transform = i === currentStage ? 'scale(1.05)' : 'scale(1)';
                    stage.style.boxShadow = i === currentStage ? '0 0 30px rgba(0,237,100,0.3)' : 'none';
                });
                currentStage = (currentStage + 1) % compressionStages.length;
            }, 1000);
        };
        
        // Start compression animation when visible
        const compressionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    startCompressionAnimation();
                } else if (compressionAnimInterval) {
                    clearInterval(compressionAnimInterval);
                }
            });
        }, { threshold: 0.3 });
        
        const compressionSection = document.querySelector('.compression-stages');
        if (compressionSection) {
            compressionSection.parentElement && compressionObserver.observe(compressionSection.parentElement);
        }
        
        // ==========================================
        // WIREDTIGER FLOW ANIMATION
        // ==========================================
        const wtComponents = document.querySelectorAll('.wt-component');
        let wtAnimInterval = null;
        
        const startWTAnimation = () => {
            let currentComponent = 0;
            wtAnimInterval = setInterval(() => {
                wtComponents.forEach((comp, i) => {
                    if (i === currentComponent) {
                        comp.style.transform = 'scale(1.1)';
                        comp.style.borderColor = 'var(--accent-green)';
                        comp.style.boxShadow = '0 0 20px rgba(0,237,100,0.3)';
                    } else {
                        comp.style.transform = 'scale(1)';
                        comp.style.borderColor = 'var(--border-color)';
                        comp.style.boxShadow = 'none';
                    }
                });
                currentComponent = (currentComponent + 1) % wtComponents.length;
            }, 800);
        };
        
        const wtObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    startWTAnimation();
                } else if (wtAnimInterval) {
                    clearInterval(wtAnimInterval);
                    wtComponents.forEach(comp => {
                        comp.style.transform = 'scale(1)';
                        comp.style.borderColor = 'var(--border-color)';
                        comp.style.boxShadow = 'none';
                    });
                }
            });
        }, { threshold: 0.3 });
        
        const wtFlow = document.querySelector('.wiredtiger-flow');
        if (wtFlow) wtObserver.observe(wtFlow);
        
        // ==========================================
        // TAB SWITCHING
        // ==========================================
        function showTab(tabId, button) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all buttons
            button.parentElement.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }
        
        // ==========================================
        // QUERY OPTIMIZER DEMO
        // ==========================================
        const queryConfigs = {
            timeRange: {
                query: 'db.sensors.find({ timestamp: { $gte: ISODate("24h ago") } })',
                scanned: 3,
                pruned: 27,
                dataMB: 3.6
            },
            noTimeRange: {
                query: 'db.sensors.find({ temperature: { $gt: 25 } })  // âš ï¸ FULL SCAN!',
                scanned: 30,
                pruned: 0,
                dataMB: 36
            },
            metaOnly: {
                query: 'db.sensors.find({ "metadata.sensorId": "sensor_001" })',
                scanned: 10,
                pruned: 20,
                dataMB: 12
            },
            combined: {
                query: 'db.sensors.find({ timestamp: { $gte: ... }, "metadata.sensorId": "sensor_001" })',
                scanned: 1,
                pruned: 29,
                dataMB: 1.2
            }
        };
        
        function updateQueryDemo() {
            const queryType = document.getElementById('queryType').value;
            const config = queryConfigs[queryType];
            
            document.getElementById('queryPreview').textContent = config.query;
            document.getElementById('bucketsScanned').textContent = config.scanned;
            document.getElementById('bucketsPruned').textContent = config.pruned;
            document.getElementById('queryEfficiency').textContent = Math.round((config.pruned / 30) * 100) + '%';
            document.getElementById('dataScanned').textContent = config.dataMB + ' MB';
            
            // Render bucket visualization
            const viz = document.getElementById('bucketScanViz');
            viz.innerHTML = '';
            
            for (let i = 0; i < 30; i++) {
                const bucket = document.createElement('div');
                const isScanned = i >= (30 - config.scanned);
                bucket.style.cssText = `
                    width: 24px;
                    height: 32px;
                    border-radius: 4px;
                    background: ${isScanned ? 'var(--accent-green)' : 'var(--text-muted)'};
                    opacity: ${isScanned ? '1' : '0.2'};
                    transition: all 0.3s ease;
                    transition-delay: ${i * 20}ms;
                    cursor: pointer;
                    position: relative;
                `;
                if (isScanned) {
                    bucket.style.boxShadow = '0 0 10px rgba(0, 237, 100, 0.5)';
                }
                
                // Add day label
                bucket.title = `Day ${i + 1}${isScanned ? ' - SCANNED' : ' - PRUNED'}`;
                
                viz.appendChild(bucket);
            }
        }
        
        // Initialize query demo
        setTimeout(() => updateQueryDemo(), 500);
        
        // ==========================================
        // STORAGE CALCULATOR
        // ==========================================
        function calculateStorage() {
            const docsPerDay = parseInt(document.getElementById('docsPerDay').value) || 0;
            const docSize = parseInt(document.getElementById('docSize').value) || 0;
            const retention = parseInt(document.getElementById('retention').value) || 0;
            const compression = parseInt(document.getElementById('compressionSlider').value) || 85;
            
            document.getElementById('compressionValue').textContent = compression + '%';
            
            // Calculate storage
            const totalDocs = docsPerDay * retention;
            const regularSizeGB = (totalDocs * docSize) / (1024 * 1024 * 1024);
            const tsSizeGB = regularSizeGB * (1 - compression / 100);
            const savedGB = regularSizeGB - tsSizeGB;
            
            // Update display
            document.getElementById('regularSize').textContent = regularSizeGB.toFixed(1) + ' GB';
            document.getElementById('tsSize').textContent = tsSizeGB.toFixed(1) + ' GB';
            document.getElementById('storageSavedCalc').textContent = savedGB.toFixed(1) + ' GB';
            document.getElementById('compressionPercent').textContent = compression + '% compression';
            
            // Update bar
            const barWidth = Math.max(5, (tsSizeGB / regularSizeGB) * 100);
            document.getElementById('tsBar').style.width = barWidth + '%';
        }
        
        // Initialize calculator
        setTimeout(() => calculateStorage(), 500);
        
        // ==========================================
        // MASTER INDEX TOGGLE
        // ==========================================
        function toggleIndex() {
            const content = document.getElementById('indexContent');
            content.classList.toggle('show');
        }
        
        // Close index when clicking outside
        document.addEventListener('click', (e) => {
            const index = document.getElementById('masterIndex');
            const content = document.getElementById('indexContent');
            if (!index.contains(e.target) && content.classList.contains('show')) {
                content.classList.remove('show');
            }
        });
        
        // Update active index item on scroll
        const indexObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    document.querySelectorAll('.index-item').forEach(item => {
                        item.classList.remove('active');
                        if (item.getAttribute('href') === '#' + id) {
                            item.classList.add('active');
                        }
                    });
                }
            });
        }, { threshold: 0.3 });
        
        // Observe all sections
        document.querySelectorAll('.section[id]').forEach(section => {
            indexObserver.observe(section);
        });
        
        // Smooth scroll for index links
        document.querySelectorAll('.index-item').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const target = document.getElementById(targetId);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    document.getElementById('indexContent').classList.remove('show');
                }
            });
        });
        
        console.log('ðŸš€ MongoDB Time Series Visualization loaded!');
        console.log('ðŸ“Š Features: Live bucket simulation, memory management demo, compression pipeline visualization');
        console.log('ðŸ“‘ 21 sections organized into 6 master categories');
        
        // ========== Index Query Visualizer (Corrected - Separate Concepts) ==========
        const indexQueries = {
            metadata: {
                query: `db.sensors.find({ "metadata.region": "us-east" })`,
                index: `{ "metadata.region": 1 }`,
                // Index entries to highlight (B-tree traversal)
                indexNodes: ['btreeRoot', 'btreeL1_1'],
                dimIndexNodes: ['btreeL1_2', 'btreeL1_3'],
                // Buckets returned by index (matching metadata)
                fetchedBuckets: ['bucket1', 'bucket2'],
                // Buckets skipped (wrong metadata - not in index results)
                skippedBuckets: ['bucket3', 'bucket4', 'bucket5', 'bucket6'],
                // Buckets pruned by time range (control.min/max)
                prunedBuckets: [],
                // Final buckets to decompress
                decompressBuckets: ['bucket1', 'bucket2'],
                stats: { indexEntries: 2, fetched: 2, pruned: 0, skipped: 4, examined: 1770, returned: 1203 }
            },
            timerange: {
                query: `db.sensors.find({
  timestamp: {
    $gte: ISODate("2024-01-15T01:00:00Z"),
    $lt: ISODate("2024-01-15T02:00:00Z")
  }
})`,
                index: `{ meta: 1, control.min.t: 1 } (clustered)`,
                indexNodes: ['btreeRoot', 'btreeL1_1', 'btreeL1_2', 'btreeL1_3'],
                dimIndexNodes: [],
                // All buckets potentially match (no metadata filter)
                fetchedBuckets: ['bucket1', 'bucket2', 'bucket3', 'bucket4', 'bucket5', 'bucket6'],
                skippedBuckets: [],
                // Pruned by time range check (control.min/max)
                prunedBuckets: ['bucket1', 'bucket3', 'bucket5'], // 00:00-01:00 buckets pruned
                decompressBuckets: ['bucket2', 'bucket4', 'bucket6'],
                stats: { indexEntries: 6, fetched: 6, pruned: 3, skipped: 0, examined: 2436, returned: 2436 }
            },
            compound: {
                query: `db.sensors.find({
  "metadata.region": "us-west",
  timestamp: { $gte: ISODate("2024-01-15T01:00") }
})`,
                index: `{ "metadata.region": 1, timestamp: -1 }`,
                indexNodes: ['btreeRoot', 'btreeL1_2'],
                dimIndexNodes: ['btreeL1_1', 'btreeL1_3'],
                // Only us-west buckets from index
                fetchedBuckets: ['bucket3', 'bucket4'],
                skippedBuckets: ['bucket1', 'bucket2', 'bucket5', 'bucket6'],
                // Bucket3 (00:00-01:00) pruned by time
                prunedBuckets: ['bucket3'],
                decompressBuckets: ['bucket4'],
                stats: { indexEntries: 2, fetched: 2, pruned: 1, skipped: 4, examined: 812, returned: 756 }
            },
            measurement: {
                query: `db.sensors.find({ temperature: { $gt: 30 } })`,
                index: `{ temperature: 1 } (sparse)`,
                indexNodes: ['btreeRoot', 'btreeL1_1', 'btreeL1_2', 'btreeL1_3'],
                dimIndexNodes: [],
                // All buckets need checking (measurement in data, not meta)
                fetchedBuckets: ['bucket1', 'bucket2', 'bucket3', 'bucket4', 'bucket5', 'bucket6'],
                skippedBuckets: [],
                // Some buckets have control.max.temp < 30, can be pruned
                prunedBuckets: ['bucket2', 'bucket4', 'bucket6'],
                decompressBuckets: ['bucket1', 'bucket3', 'bucket5'],
                stats: { indexEntries: 6, fetched: 6, pruned: 3, skipped: 0, examined: 2237, returned: 423 }
            }
        };
        
        let currentIndexQuery = 'metadata';
        
        // B-Tree index configurations for different query types
        const btreeConfigs = {
            metadata: {
                indexField: '{ meta.region: 1 }',
                rootLabel: 'meta.region',
                keys: ['us-east', 'us-west', 'eu-west'],
                description: 'Index on metadata field - keys are region values'
            },
            timerange: {
                indexField: '{ control.min.t: 1 }',
                rootLabel: 'timestamp',
                keys: ['Jan 15 00:00', 'Jan 15 01:00', 'Jan 15 02:00'],
                description: 'Clustered index - keys are time boundaries'
            },
            compound: {
                indexField: '{ meta.region: 1, t: -1 }',
                rootLabel: 'region + time',
                keys: ['us-west:00', 'us-west:01', 'us-west:02'],
                description: 'Compound index - composite keys'
            },
            measurement: {
                indexField: '{ control.min.temp: 1 }',
                rootLabel: 'temperature',
                keys: ['15Â°-25Â°', '25Â°-35Â°', '35Â°-45Â°'],
                description: 'Index on measurement - keys are value ranges'
            }
        };
        
        // Update B-Tree visualization based on query type
        function updateBtreeVisualization() {
            const config = btreeConfigs[currentIndexQuery];
            
            // Update index field label
            document.getElementById('indexFieldLabel').textContent = config.indexField;
            
            // Update root node label
            document.getElementById('rootLabel').textContent = config.rootLabel;
            
            // Update key labels
            document.getElementById('key1').textContent = config.keys[0];
            document.getElementById('key2').textContent = config.keys[1];
            document.getElementById('key3').textContent = config.keys[2];
        }
        
        // Update query display
        function updateIndexQueryDisplay() {
            const queryData = indexQueries[currentIndexQuery];
            document.getElementById('indexQueryDisplay').innerHTML = `<pre style="margin: 0; white-space: pre-wrap;">${queryData.query}</pre>`;
        }
        
        // Query button selection
        document.querySelectorAll('.index-query-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.index-query-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentIndexQuery = btn.dataset.query;
                updateIndexQueryDisplay();
                updateBtreeVisualization();
                resetIndexVisualization();
            });
        });
        
        // Reset visualization
        function resetIndexVisualization() {
            // Reset B-tree index nodes
            document.querySelectorAll('.btree-node').forEach(node => {
                node.classList.remove('highlight', 'dimmed', 'scanning');
            });
            // Reset bucket storage
            document.querySelectorAll('.storage-bucket').forEach(bucket => {
                bucket.classList.remove('fetched', 'pruned', 'skipped', 'decompressing');
                bucket.querySelector('.bucket-status').textContent = 'ðŸ’¤ Compressed';
            });
            // Hide index pointers
            const pointers = document.getElementById('indexPointers');
            if (pointers) pointers.style.opacity = '0';
            // Reset execution steps
            document.querySelectorAll('.index-exec-step-v2').forEach(step => {
                step.classList.remove('active', 'completed');
                step.querySelector('.step-status').textContent = 'â³';
                const detail = step.querySelector('.step-detail');
                if (detail) detail.textContent = '';
            });
            document.getElementById('indexQueryStats').style.display = 'none';
        }
        
        // Run query animation
        document.getElementById('runIndexQuery').addEventListener('click', async () => {
            const btn = document.getElementById('runIndexQuery');
            btn.classList.add('running');
            btn.innerHTML = '<span class="loading-spinner"></span> Executing...';
            
            resetIndexVisualization();
            
            const queryData = indexQueries[currentIndexQuery];
            
            // Step 1: Parse Query
            await animateStepV2(1, `Index: ${queryData.index}`, 500);
            
            // Step 2: Index Lookup - animate B-tree traversal
            const step2 = document.getElementById('indexStep2');
            step2.classList.add('active');
            document.getElementById('indexStepDetail2').textContent = 'Scanning B-tree...';
            
            // Animate index node traversal
            for (const nodeId of queryData.indexNodes) {
                const node = document.getElementById(nodeId);
                if (node) {
                    node.classList.add('scanning');
                    await sleep(250);
                    node.classList.remove('scanning');
                    node.classList.add('highlight');
                }
            }
            // Dim non-matching index entries
            queryData.dimIndexNodes.forEach(nodeId => {
                const node = document.getElementById(nodeId);
                if (node) node.classList.add('dimmed');
            });
            
            step2.classList.remove('active');
            step2.classList.add('completed');
            step2.querySelector('.step-status').textContent = 'âœ“';
            document.getElementById('indexStepDetail2').textContent = `Found ${queryData.stats.indexEntries} entries`;
            
            await sleep(300);
            
            // Step 3: Get Bucket Pointers - show arrows
            const step3 = document.getElementById('indexStep3');
            step3.classList.add('active');
            document.getElementById('indexStepDetail3').textContent = 'Following pointers...';
            
            // Show pointer arrows
            const pointers = document.getElementById('indexPointers');
            if (pointers) pointers.style.opacity = '1';
            
            await sleep(400);
            
            // Mark fetched buckets
            queryData.fetchedBuckets.forEach(bucketId => {
                const bucket = document.getElementById(bucketId);
                if (bucket) {
                    bucket.classList.add('fetched');
                    bucket.querySelector('.bucket-status').textContent = 'ðŸ“¥ Fetched';
                }
            });
            // Mark skipped buckets (not in index results)
            queryData.skippedBuckets.forEach(bucketId => {
                const bucket = document.getElementById(bucketId);
                if (bucket) {
                    bucket.classList.add('skipped');
                    bucket.querySelector('.bucket-status').textContent = 'â­ï¸ Skipped';
                }
            });
            
            step3.classList.remove('active');
            step3.classList.add('completed');
            step3.querySelector('.step-status').textContent = 'âœ“';
            document.getElementById('indexStepDetail3').textContent = `${queryData.stats.fetched} buckets`;
            
            await sleep(400);
            
            // Step 4: Bucket Pruning using control.min/max
            const step4 = document.getElementById('indexStep4');
            step4.classList.add('active');
            document.getElementById('indexStepDetail4').textContent = 'Checking control.min/max...';
            
            await sleep(300);
            
            // Mark pruned buckets
            queryData.prunedBuckets.forEach(bucketId => {
                const bucket = document.getElementById(bucketId);
                if (bucket) {
                    bucket.classList.remove('fetched');
                    bucket.classList.add('pruned');
                    bucket.querySelector('.bucket-status').textContent = 'âœ‚ï¸ Pruned (time)';
                }
            });
            
            step4.classList.remove('active');
            step4.classList.add('completed');
            step4.querySelector('.step-status').textContent = 'âœ“';
            document.getElementById('indexStepDetail4').textContent = `Pruned ${queryData.stats.pruned}`;
            
            await sleep(400);
            
            // Step 5: Decompress & Return
            const step5 = document.getElementById('indexStep5');
            step5.classList.add('active');
            document.getElementById('indexStepDetail5').textContent = 'Decompressing...';
            
            // Animate decompression
            for (const bucketId of queryData.decompressBuckets) {
                const bucket = document.getElementById(bucketId);
                if (bucket) {
                    bucket.classList.add('decompressing');
                    await sleep(300);
                    bucket.classList.remove('decompressing');
                    bucket.querySelector('.bucket-status').textContent = 'ðŸ“¤ Returned';
                }
            }
            
            step5.classList.remove('active');
            step5.classList.add('completed');
            step5.querySelector('.step-status').textContent = 'âœ“';
            document.getElementById('indexStepDetail5').textContent = `${queryData.stats.returned} docs`;
            
            // Show stats
            showIndexStats(queryData.stats);
            
            btn.classList.remove('running');
            btn.innerHTML = '<span>â–¶</span> Execute Query';
        });
        
        async function animateStepV2(stepNum, detail, duration) {
            const step = document.getElementById(`indexStep${stepNum}`);
            step.classList.add('active');
            document.getElementById(`indexStepDetail${stepNum}`).textContent = detail;
            
            await sleep(duration);
            
            step.classList.remove('active');
            step.classList.add('completed');
            step.querySelector('.step-status').textContent = 'âœ“';
        }
        
        function showIndexStats(stats) {
            const statsDiv = document.getElementById('indexQueryStats');
            statsDiv.style.display = 'block';
            
            // Animate numbers - updated for new stats
            animateNumber('statBucketsScanned', stats.fetched - stats.pruned, 500);
            animateNumber('statBucketsPruned', stats.pruned + stats.skipped, 500);
            animateNumber('statDocsExamined', stats.examined, 800);
            animateNumber('statDocsReturned', stats.returned, 800);
            
            // Efficiency bar
            const efficiency = Math.round((stats.returned / stats.examined) * 100);
            setTimeout(() => {
                document.getElementById('efficiencyBar').style.width = efficiency + '%';
                document.getElementById('efficiencyPercent').textContent = efficiency + '% efficient';
            }, 300);
        }
        
        function animateNumber(elementId, target, duration) {
            const element = document.getElementById(elementId);
            const start = 0;
            const increment = target / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target.toLocaleString();
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current).toLocaleString();
                }
            }, 16);
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Initialize query display and B-tree visualization
        updateIndexQueryDisplay();
        updateBtreeVisualization();
    </script>
</body>
</html>

