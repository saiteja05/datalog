<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Atlas At Scale: Comprehensive Runbook</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --mongo-green: #00ED64;
            --mongo-dark-blue: #001E2B;
            --mongo-dark-green: #023430;
            --mongo-card: #002B3A;
            --mongo-card-accent: #00374E;
            --mongo-text: #E4E5E5;
            --mongo-text-muted: #a0a4a8;
            --mongo-border: #004F69;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--mongo-dark-blue);
            color: var(--mongo-text);
            line-height: 1.7;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, var(--mongo-dark-green) 0%, #001E2B 100%);
            position: relative;
        }
        
        .card-icon {
            width: 1.75rem;
            height: 1.75rem;
            stroke-width: 1.5;
            color: var(--mongo-green);
            flex-shrink: 0;
            filter: drop-shadow(0 2px 4px rgba(0, 237, 100, 0.3));
        }
        
        /* Enhanced Expandable Box Styles */
        .expandable-box {
            background: linear-gradient(135deg, rgba(0, 55, 78, 0.5) 0%, rgba(0, 43, 58, 0.5) 100%);
            backdrop-filter: blur(8px);
            border-left: 4px solid var(--mongo-green);
            border-radius: 0.75rem;
            margin-top: 1.25rem;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        
        .expandable-box:hover {
            background: linear-gradient(135deg, rgba(0, 55, 78, 0.7) 0%, rgba(0, 43, 58, 0.7) 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 237, 100, 0.2), 0 4px 6px -2px rgba(0, 237, 100, 0.1);
            transform: translateY(-2px);
        }
        
        .expandable-box summary {
            font-weight: 600;
            font-size: 1.05rem;
            color: var(--mongo-green);
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            outline: none;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            transition: background 0.2s ease;
        }
        
        .expandable-box summary:hover {
            background: rgba(0, 237, 100, 0.05);
        }
        
        .expandable-box summary::-webkit-details-marker {
            display: none;
        }
        
        .expandable-box summary::after {
            content: '+';
            font-size: 1.75rem;
            font-weight: 300;
            color: var(--mongo-green);
            transition: transform 0.3s ease;
            line-height: 1;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 237, 100, 0.1);
            border-radius: 50%;
        }
        
        .expandable-box[open] summary::after {
            transform: rotate(45deg);
            background: rgba(0, 237, 100, 0.2);
        }
        
        .expandable-box-content {
            padding: 1.5rem;
            color: var(--mongo-text);
            background: rgba(0, 0, 0, 0.15);
            border-top: 1px solid rgba(0, 237, 100, 0.1);
        }
        
        .expandable-box-content p {
            color: var(--mongo-text);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        
        .expandable-box-content p:last-child {
            margin-bottom: 0;
        }
        
        .expandable-box-content strong {
            color: var(--mongo-green);
            font-weight: 600;
        }
        
        .expandable-box-content ul {
            margin-top: 0.75rem;
            padding-left: 1.5rem;
        }
        
        .expandable-box-content ul li {
            margin-bottom: 0.5rem;
            color: var(--mongo-text-muted);
        }
        
        /* Tab styles */
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
        }
        
        .tab-button.active {
            border-bottom-color: var(--mongo-green);
            color: var(--mongo-green);
            background: rgba(0, 237, 100, 0.05);
        }
        
        .tab-button:hover:not(.active) {
            color: var(--mongo-text);
            border-bottom-color: var(--mongo-border);
            background: rgba(255, 255, 255, 0.03);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Enhanced section headers */
        section h3 {
            font-size: 1.75rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        section h4 {
            font-size: 1.35rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #fff;
            border-bottom: 2px solid rgba(0, 237, 100, 0.2);
            padding-bottom: 0.5rem;
        }
        
        /* Better list styling */
        ul.list-disc {
            padding-left: 1.75rem;
        }
        
        ul.list-disc li {
            margin-bottom: 0.75rem;
            line-height: 1.7;
        }
        
        ul.list-disc li strong {
            color: var(--mongo-green);
            font-weight: 600;
        }
        
        /* Code block improvements */
        .code-block {
            background: linear-gradient(135deg, #0a1520 0%, #000810 100%);
            color: var(--mongo-text);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--mongo-border);
            font-family: 'JetBrains Mono', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            margin-top: 1rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* Reference links */
        .ref-link {
            font-size: 0.7rem;
            color: var(--mongo-green);
            opacity: 0.6;
            margin-left: 0.25rem;
            vertical-align: super;
            text-decoration: none;
            transition: opacity 0.2s ease;
            font-weight: 600;
        }
        
        .ref-link:hover {
            opacity: 1;
            text-decoration: underline;
        }
        
        /* SVG Diagram Styles */
        .svg-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 2rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem;
            margin: 1.5rem 0;
        }
        
        .svg-diagram .node {
            fill: var(--mongo-card-accent);
            stroke: var(--mongo-green);
            stroke-width: 2px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }
        
        .svg-diagram .node-text {
            font-size: 11px;
            fill: var(--mongo-text);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        
        .svg-diagram .label-text {
            font-size: 12px;
            fill: var(--mongo-text-muted);
            font-family: 'Inter', sans-serif;
        }
        
        .svg-diagram .arrow-line {
            stroke: var(--mongo-text-muted);
            stroke-width: 2px;
            marker-end: url(#arrowhead);
        }
        
        .svg-diagram .arrow-text {
            font-size: 11px;
            fill: var(--mongo-green);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        
        .svg-diagram .warn-text {
            font-size: 12px;
            fill: #fbbf24;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        
        /* Improved paragraph spacing */
        p {
            margin-bottom: 1rem;
        }
        
        /* Better visual hierarchy for content sections */
        section {
            margin-bottom: 3rem;
        }
        
        section > div:first-child {
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-[--mongo-dark-blue] text-[--mongo-text]">

    <!-- Header -->
    <header class="hero-gradient text-white shadow-lg">
        <div class="container mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight">MongoDB Atlas At Scale</h1>
            <p class="mt-4 text-xl md:text-2xl text-gray-300">A Comprehensive Runbook (<a href="https://docs.google.com/document/d/1hEjghek2Rxk_Iv912dYIdUvbAitL61bHE7J5vwU52Tc/edit?tab=t.0">Source</a>) </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto max-w-7xl p-4 sm:p-6 lg:px-8 -mt-10">

        <!-- Tab Navigation -->
        <nav class="bg-[--mongo-card] rounded-t-lg shadow-lg border-b border-[--mongo-border] flex flex-wrap justify-center sm:justify-start -mb-px">
            <button class="tab-button active text-sm sm:text-base font-semibold text-[--mongo-text-muted] py-4 px-6" data-tab="growth">
                Growth Strategies
            </button>
            <button class="tab-button text-sm sm:text-base font-semibold text-[--mongo-text-muted] py-4 px-6" data-tab="features">
                Core Features
            </button>
            <button class="tab-button text-sm sm:text-base font-semibold text-[--mongo-text-muted] py-4 px-6" data-tab="advanced">
                Advanced Features
            </button>
            <button class="tab-button text-sm sm:text-base font-semibold text-[--mongo-text-muted] py-4 px-6" data-tab="architecture">
                Architecture & Best Practices
            </button>
            <button class="tab-button text-sm sm:text-base font-semibold text-[--mongo-text-muted] py-4 px-6" data-tab="governance">
                Governance & Operations
            </button>
        </nav>

        <!-- Tab Content Area -->
        <div class="bg-[--mongo-card] rounded-b-lg shadow-lg border-x border-b border-[--mongo-border]">

            <!-- Tab 1: Growth Strategies -->
            <div id="tab-growth" class="tab-content active p-6 md:p-10 space-y-8">
                
                <!-- Section 1: Growth & Capacity Planning -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11l5-5m0 0l5 5m-5-5v12" /></svg>
                        <h3 class="text-2xl font-bold">1. Growth & Capacity Planning</h3>
                    </div>

                    <h4 class="text-xl font-semibold text-white mt-4">Managing 20TB+ Growth</h4>
                    <p class="text-[--mongo-text] mb-4">Avoid performance degradation during massive data loads without live rebalancing.<a href="https://www.tencentcloud.com/techpedia/114181" target="_blank" rel="noopener noreferrer" class="ref-link">[1]</a><a href="http://learnmongodbthehardway.com/schema/sharding/" target="_blank" rel="noopener noreferrer" class="ref-link">[2]</a><a href="https://stackoverflow.com/questions/31751008/is-mongodb-always-write-to-primary-shard-and-then-rebalance" target="_blank" rel="noopener noreferrer" class="ref-link">[3]</a></p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mb-4">
                        <li><strong class="text-[--mongo-text]">Pre-sharding is essential:</strong> Manually split chunks *before* bulk loads.</li>
                        <li>Disable the balancer during initial data load to prevent contention.</li>
                        <li><strong class="text-[--mongo-text]">Capacity Planning (4TB Shard Limit):</strong> A 20TB dataset requires a minimum of 5-6 shards.<a href="https://www.mongodb.com/community/forums/t/limits-on-data-size-2/173571" target="_blank" rel="noopener noreferrer" class="ref-link">[4]</a><a href="https://www.mongodb.com/community/forums/t/mongodb-atlas-storage-pricing-for-chunks-and-shard/309514" target="_blank" rel="noopener noreferrer" class="ref-link">[5]</a></li>
                    </ul>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                            <p>This is a critical risk mitigation and future-proofing strategy. Knowing the 4TB "soft-cap" per shard now prevents you from building an architecture that is guaranteed to fail at 5TB, avoiding a costly, high-risk emergency re-architecture later. </p>                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>This 4TB limit isn't just about disk space; it's about the "working set" (active data + indexes) and the RAM on a single node. A single, massive 10TB shard would have a working set that's impossible to cache, leading to 100% disk-bound operations and a total performance collapse. Spreading the load ensures each shard's working set can be effectively managed by its node's RAM.</p>
                        </div>
                    </details>

                    <h4 class="text-xl font-semibold text-white mt-8">1A. Fast-Growth Quick Start ("Scale Wide, then Tall")</h4>
                    <p class="text-[--mongo-text-muted] mb-4">For applications expecting 10+ TB soon. Start with 4 shards (M30 x 4) and scale the tier vertically (M30 -> M50 -> M60) as data grows. This is a zero-downtime operation. </br> NOTE: Use zone sharding if you think growth is unprecedented within a shard key boundary </p>
                    
                    <!-- SVG Illustration for Fast Growth -->
                    <div class="svg-diagram bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                        <svg width="100%" height="150" viewBox="0 0 400 150">
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="var(--mongo-text-muted)" />
                                </marker>
                            </defs>
                            
                            <!-- Initial State -->
                            <text x="50" y="20" class="label-text" text-anchor="middle">Initial Setup</text>
                            <g>
                                <rect x="10" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="50" y="55" class="node-text" text-anchor="middle">M30 x 4 Shards</text>
                                <text x="50" y="85" class="label-text" text-anchor="middle">(2-4TB)</text>
                            </g>
                            
                            <!-- Arrow 1 -->
                            <line x1="95" y1="50" x2="135" y2="50" class="arrow-line" />
                            <text x="115" y="45" class="arrow-text" text-anchor="middle">At 5TB</text>
                            
                            <!-- State 2 -->
                            <g>
                                <rect x="140" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="180" y="55" class="node-text" text-anchor="middle">M50 x 4 Shards</text>
                                <text x="180" y="85" class="label-text" text-anchor="middle">(5-8TB)</text>
                            </g>
                            
                            <!-- Arrow 2 -->
                            <line x1="225" y1="50" x2="265" y2="50" class="arrow-line" />
                            <text x="245" y="45" class="arrow-text" text-anchor="middle">At 8TB</text>
                            
                            <!-- State 3 -->
                            <g>
                                <rect x="270" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="310" y="55" class="node-text" text-anchor="middle">M60 x 4 Shards</text>
                                <text x="310" y="85" class="label-text" text-anchor="middle">(8-16TB)</text>
                            </g>
                            
                            <!-- Vertical Scaling Label -->
                            <line x1="180" y1="95" x2="180" y2="120" class="arrow-line" />
                            <text x="180" y="135" class="arrow-text" text-anchor="middle">"Scale Tall" (Vertical)</text>
                            <text x="50" y="105" class="label-text" text-anchor="middle">"Scale Wide" (4 Shards)</text>
                        </svg>
                    </div>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                            <p>This architecture provides the optimal balance of cost and scalability. It gives you the scalability of a sharded architecture (even data distribution) with the cost-efficiency and operational simplicity of vertical scaling (just clicking a button in the Atlas UI).</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Starting with 4 shards (scaling "wide") before you have the data solves the data distribution problem from day one. New data is automatically spread evenly, preventing "hotspots." Then, as data volume grows, you simply scale vertically (scaling "tall" from M30 -> M50). This is a zero-downtime, rolling operation in Atlas and is far cheaper and safer than trying to add new shards to a "hot" cluster.</p>
                        </div>
                    </details>

                    <h4 class="text-xl font-semibold text-white mt-8">1B. Start Small and Grow Strategy</h4>
                    <p class="text-[--mongo-text-muted] mb-4">The 4-stage path for slow-growth projects (Single Replica Set -> Sharded Cluster).</p>
                    
                    <!-- SVG Illustration for Slow Growth -->
                    <div class="svg-diagram bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                        <svg width="100%" height="150" viewBox="0 0 400 150">
                            <!-- Stage 1 -->
                            <text x="50" y="20" class="label-text" text-anchor="middle">Stage 1 (0-2TB)</text>
                            <g>
                                <rect x="10" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="50" y="55" class="node-text" text-anchor="middle">Single Replica Set</text>
                            </g>
                            
                            <!-- Arrow 1 -->
                            <line x1="95" y1="50" x2="135" y2="50" class="arrow-line" />
                            <text x="115" y="45" class="arrow-text" text-anchor="middle">At 4TB</text>
                            
                            <!-- Stage 3 -->
                            <text x="180" y="20" class="label-text" text-anchor="middle">Stage 3 (4-10TB)</text>
                            <g>
                                <rect x="140" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="180" y="55" class="node-text" text-anchor="middle">2-3 Shards</text>
                            </g>
                            <text x="180" y="85" class="warn-text" text-anchor="middle">!! Rebalancing Risk !!</text>
                            
                            <!-- Arrow 2 -->
                            <line x1="225" y1="50" x2="265" y2="50" class="arrow-line" />
                            <text x="245" y="45" class="arrow-text" text-anchor="middle">At 10TB+</text>
                            
                            <!-- Stage 4 -->
                            <text x="310" y="20" class="label-text" text-anchor="middle">Stage 4 (10-20TB+)</text>
                            <g>
                                <rect x="270" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="310" y="55" class="node-text" text-anchor="middle">Add Shards (3+)</text>
                            </g>
                        </svg>
                    </div>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                           <p>This strategy is optimized for minimal initial cost and complexity. It's the right choice for new projects, internal tools, or businesses with uncertain or slow-growth projections. It avoids the (slightly) higher cost and configuration overhead of a sharded cluster until it's absolutely necessary.</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>This is the most common growth path, but it comes with a significant trade-off. The "Stage 3" conversion from a single replica set to a sharded cluster is a major operational event. It is not a simple button-click. It requires configuration changes, and more importantly, it kicks off a live, production-impacting rebalancing as the database moves 50% of your data from the first shard to the new one.</p>
                        </div>
                    </details>
                    <p class="text-[--mongo-text-muted] mt-4 font-semibold">Note: this will still need rebalancing on production.</p>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                           <p>This warning highlights the primary business risk of the "Start Small" strategy. That "time-consuming task" (rebalancing) introduces significant performance risk to your live application. It can cause latency spikes, resource contention, and unpredictable behavior for hours or even days while the data is redistributed.</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>The "Fast-Growth" (1A) strategy avoids this specific pain point entirely by starting sharded. This "Start Small" (1B) strategy defers the complexity, but you pay for it later with this high-risk rebalancing event. This is a critical trade-off to discuss with stakeholders: minimal cost now vs. operational risk later.</p>
                        </div>
                    </details>
                </section>
            </div>

            <!-- Tab 2: Core & Advanced Features -->
            <div id="tab-features" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Section 2: Core Features -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                        <h3 class="text-2xl font-bold">2. Core Features: Analysis & Rationale</h3>
                    </div>
                    <div class="space-y-6">
                        
                        <div>
                            <strong class="text-white">Document Model (Schema-less)</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Delivers faster time-to-market. Developers can map application objects directly to the database, eliminating the complex "object-relational mapping" (ORM) tax. This flexibility allows for rapid iteration and shipping new features without complex, high-risk schema migrations.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>Storing related data together in a single document (embedding) makes reads incredibly fast, as all data for a "view" (e.g., a user profile with their last 5 orders) is retrieved in a single operation, reducing database load and application latency.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong class="text-white">Sharding<a href="https://www.percona.com/blog/when-should-i-enable-mongodb-sharding/" target="_blank" rel="noopener noreferrer" class="ref-link">[8]</a><a href="https://www.mongodb.com/docs/manual/core/sharding-choose-a-shard-key/" target="_blank" rel="noopener noreferrer" class="ref-link">[9]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Provides cost-effective horizontal scalability. Instead of buying a single, massive, and expensive "scale-up" server, you can scale out by adding cheaper, commodity hardware. This creates a predictable, linear cost model for growth and ensures high performance as user load increases, preventing crashes.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is the strategy for handling web-scale data and user concurrency. Hashed keys are critical for even distribution to prevent "hot shards" (one server taking all the load), which is the most common failure pattern.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong class="text-white">Replica Sets</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Guarantees high availability (HA) and automated disaster recovery. For any critical application, uptime is paramount. Automatic failover (in seconds) means a single server crash is a non-event for users, protecting cluster health, meeting SLAs, and preserving brand reputation.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>The multi-region 5-node setup is required to reliably elect a new "primary" node if there is a region failure (3 nodes will work for in-region redundancy). This self-healing capability is the foundation of a resilient system and requires no manual intervention.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong class="text-white">ACID Transactions<a href="https://severalnines.com/blog/overview-multi-document-acid-transactions-mongodb-and-how-use-them/" target="_blank" rel="noopener noreferrer" class="ref-link">[10]</a><a href="https://www.mongodb.com/resources/products/capabilities/performance-best-practices-transactions-and-read-write-concerns" target="_blank" rel="noopener noreferrer" class="ref-link">[11]</a></strong>
                             <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables the development of mission-critical, reliable applications (e.g., financial ledgers, booking systems) on MongoDB by ensuring "all-or-nothing" data integrity across multiple documents.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This feature simplifies the tech stack. It eliminates the need for a separate relational database just for transactional workloads, thereby reducing operational complexity and total cost of ownership (TCO). The limits (1,000 docs/60s) encourage a micro-service-friendly design rather than large, monolithic database operations.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong class="text-white">Aggregation Pipeline</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables real-time business intelligence (BI) and analytics directly on live operational data. This avoids the cost and delay of slow, nightly ETL (Extract, Transform, Load) jobs to a separate data warehouse, empowering faster, data-driven decisions.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is a powerful data processing tool inside the database. Pushing a `$match` early is a critical optimization; it filters the data before it enters the complex pipeline stages, dramatically reducing memory and CPU usage.</p></div>
                            </details>
                        </div>

           
                        

                        <div>
                            <strong class="text-white">Data Federation<a href="https://www.mongodb.com/docs/atlas/data-federation/" target="_blank" rel="noopener noreferrer" class="ref-link">[19]</a><a href="https://www.mongodb.com/docs/atlas/data-federation/tutorial/deploy/" target="_blank" rel="noopener noreferrer" class="ref-link">[20]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Delivers massive cost optimization via intelligent data tiering. It allows you to archive "cold" (old, rarely accessed) data to low-cost S3 storage (as Parquet) while still retaining the ability to query it on demand.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This provides a unified query interface across all data tiers (hot Atlas, warm S3). Analysts get a complete view of live and historical data without needing complex data movement, simplifying the BI and analytics landscape.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong class="text-white">Atlas Triggers<a href="https://www.mongodb.com/docs/atlas/atlas-ui/triggers/" target="_blank" rel="noopener noreferrer" class="ref-link">[21]</a><a href="https://www.youtube.com/watch?v=2FoNtDqQODO" target="_blank" rel="noopener noreferrer" class="ref-link">[22]</a><a href="https://www.mongodb.com/resources/products/capabilities/database-triggers" target="_blank" rel="noopener noreferrer" class="ref-link">[23]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables highly responsive, event-driven applications. Instead of a slow batch job (e.g., "check inventory every hour"), a Trigger can instantly react to a change (e.g., inventory < 10) and execute code (like sending an alert or placing a reorder).</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is serverless automation inside the database. It simplifies application architecture by moving business logic out of application servers and into the data layer. This reduces server load and eliminates a common point of failure (the batch job server).</p></div>
                            </details>
                        </div>

                    </div>
                </section>
            </div>

            <!-- Tab 3: Advanced Features -->
            <div id="tab-advanced" class="tab-content p-6 md:p-10 space-y-8">
                
                <!-- Full-Text Search (Atlas Search) -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                        <h3 class="text-2xl font-bold">Full-Text Search (Atlas Search)</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Integrated Enterprise Search.</strong> Atlas Search integrates Apache Lucene directly into MongoDB, eliminating the need for separate search infrastructure while delivering rich, modern search experiences.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ’¡ Key Capabilities</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Autocomplete:</strong> Real-time suggestions as users type</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Fuzzy Matching:</strong> Handles typos and misspellings</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Faceted Search:</strong> Filter by categories, price ranges, etc.</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Highlighting:</strong> Show matched terms in results</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Synonyms:</strong> "laptop" matches "notebook computer"</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">âš¡ Business Impact</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">$</span><span><strong class="text-white">70% Cost Reduction:</strong> vs. managing Elasticsearch cluster</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span><strong class="text-white">3x Faster Development:</strong> No data sync pipelines needed</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ”’</span><span><strong class="text-white">Simplified Security:</strong> Single authentication layer</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ“Š</span><span><strong class="text-white">Real-time Updates:</strong> Data searchable within seconds</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Architecture & Performance</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Index Structure:</strong> Atlas Search creates separate Lucene indexes that are automatically kept in sync with your MongoDB collections. Changes to documents trigger near-instant index updates.</p>
                            <p class="mb-3"><strong>Query Performance:</strong> Search queries run in parallel with database queries. A typical autocomplete query returns in <50ms. Faceted search across millions of documents completes in <200ms.</p>
                            <p><strong>Scaling:</strong> Search indexes scale independently from your database. As your data grows, Atlas automatically provisions additional search nodes to maintain performance.</p>
                        </div>
                    </details>
                </section>

                <!-- Atlas Vector Search -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17.67l-3.75-3.75a.75.75 0 011.06-1.06L9.75 14.84l6.69-6.69a.75.75 0 011.06 1.06l-7.5 7.5a.75.75 0 01-1.06 0z" /></svg>
                        <h3 class="text-2xl font-bold">Atlas Vector Search (AI/RAG)</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">The On-Ramp to AI.</strong> Enables semantic (meaning-based) search, recommendations, and RAG (Retrieval-Augmented Generation) for AI applications that can "reason" over your private data.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ¤– AI Use Cases</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Semantic Search:</strong> "affordable SUVs" finds relevant cars</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Recommendations:</strong> "Find similar products"</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">RAG Chatbots:</strong> Answer questions using your docs</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Image Search:</strong> Find visually similar images</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸŽ¯ Technical Advantages</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">No Separate DB:</strong> Eliminates Pinecone/Milvus</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">No Data Sync:</strong> Vectors stored with documents</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Hybrid Search:</strong> Combine vector + keyword search</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Pre/Post Filtering:</strong> Filter by metadata</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>How It Works</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Step 1 - Generate Embeddings:</strong> Use an embedding model (OpenAI, Cohere, VoyageAI) to convert text/images into high-dimensional vectors (arrays of numbers that represent meaning).</p>
                            <p class="mb-3"><strong>Step 2 - Store in MongoDB:</strong> Store the vector alongside your document data. No separate database needed.</p>
                            <p class="mb-3"><strong>Step 3 - Create Vector Index:</strong> Atlas creates a specialized index (HNSW algorithm) optimized for fast similarity search.</p>
                            <p><strong>Step 4 - Query:</strong> Convert your search query to a vector and find the most similar vectors using cosine similarity or Euclidean distance. Results return in <100ms even across millions of vectors.</p>
                        </div>
                    </details>
                </section>

                <!-- Hybrid Search -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        <h3 class="text-2xl font-bold">Hybrid Search on Atlas</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Best of Both Worlds.</strong> Combine keyword-based search (Atlas Search) with semantic search (Vector Search) in a single query for superior accuracy and relevance.</p>
                    
                    <details class="expandable-box">
                        <summary>Why Hybrid Search?</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Keyword Search Alone:</strong> Misses semantic meaning. Searching "affordable cars" won't find "budget vehicles" or "inexpensive automobiles."</p>
                            <p class="mb-3"><strong>Vector Search Alone:</strong> Can miss exact matches. Searching for "MongoDB Atlas" might return results about "database platforms" but miss documents with the exact term.</p>
                            <p><strong>Hybrid Search:</strong> Combines both approaches. Uses keyword search for precision and vector search for recall, then merges results using Reciprocal Rank Fusion (RRF) for optimal relevance.</p>
                        </div>
                    </details>

                    <details class="expandable-box">
                        <summary>Implementation Example</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Use Case:</strong> E-commerce product search where users type "warm winter jacket" but products are tagged as "insulated coat" or "thermal outerwear."</p>
                            <p class="mb-3"><strong>Keyword Search:</strong> Finds exact matches for "winter jacket"</p>
                            <p class="mb-3"><strong>Vector Search:</strong> Finds semantically similar items ("insulated coat", "thermal parka")</p>
                            <p><strong>Result:</strong> Combined results ranked by relevance score, delivering comprehensive results that satisfy both exact and semantic matches.</p>
                        </div>
                    </details>
                </section>

                <!-- VoyageAI -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" /></svg>
                        <h3 class="text-2xl font-bold">VoyageAI Embeddings</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">State-of-the-Art Embeddings.</strong> VoyageAI provides domain-specific embedding models optimized for different use cases, delivering superior accuracy compared to general-purpose models.</p>
                    
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h5 class="text-[--mongo-green] font-bold mb-3">Available Models (Please check official listing)</h5>
                        <ul class="text-[--mongo-text-muted] text-sm space-y-3">
                            <li><strong class="text-white">voyage-large-2:</strong> Best overall performance. 1024 dimensions. Ideal for general-purpose semantic search and RAG applications.</li>
                            <li><strong class="text-white">voyage-code-2:</strong> Optimized for code search. Understands programming languages, function names, and code semantics.</li>
                            <li><strong class="text-white">voyage-finance-2:</strong> Fine-tuned on financial documents. Excels at understanding financial terminology, reports, and analysis.</li>
                            <li><strong class="text-white">voyage-law-2:</strong> Specialized for legal documents. Trained on case law, contracts, and legal terminology.</li>
                        </ul>
                    </div>

                    <details class="expandable-box">
                        <summary>Why VoyageAI?</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Superior Accuracy:</strong> Domain-specific models outperform OpenAI's general-purpose embeddings by 15-30% on specialized tasks.</p>
                            <p class="mb-3"><strong>Cost-Effective:</strong> Smaller dimension count (1024 vs 1536 for OpenAI) means lower storage costs and faster queries while maintaining superior accuracy.</p>
                            <p><strong>Integration:</strong> Generate embeddings via VoyageAI API, store in MongoDB documents, and query using Atlas Vector Search. The entire pipeline can be automated using Atlas Triggers or App Services.</p>
                        </div>
                    </details>
                </section>

                <!-- Time Series Collections -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 class="text-2xl font-bold">Time Series Collections</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Purpose-Built for IoT & Metrics.</strong> Time series collections provide up to 90% storage savings and 10x query performance for timestamped data compared to standard collections.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ“ˆ Ideal Use Cases</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">IoT Sensor Data:</strong> Temperature, pressure, GPS coordinates</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Application Metrics:</strong> CPU, memory, request latency</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Financial Tick Data:</strong> Stock prices, trades, order books</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">User Activity Logs:</strong> Clickstreams, page views</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸŽ¯ Performance Benefits</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">90% Storage Savings:</strong> Columnar compression for time-series data</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">10x Faster Queries:</strong> Optimized for time-range scans</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Automatic Bucketing:</strong> Groups data by time windows</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">TTL Expiration:</strong> Auto-delete old data</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Configuration & Best Practices</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Key Fields:</strong> Define a `timeField` (timestamp), `metaField` (device ID, sensor ID, stock symbol), and optional `granularity` (seconds, minutes, hours). The metaField acts as a "tag" that groups related measurements.</p>
                            <p class="mb-3"><strong>Bucketing Strategy:</strong> MongoDB automatically groups measurements into buckets based on time and metaField. Each bucket is compressed and stored efficiently. Choose granularity based on your query patterns (e.g., "seconds" for high-frequency IoT, "hours" for daily analytics).</p>
                            <p class="mb-3"><strong>Query Optimization:</strong> Always include the metaField in queries for maximum performance. Time-range queries are extremely fast due to the bucketed structure. Combine with aggregation pipelines for real-time analytics.</p>
                            <p><strong>Cost Savings Example:</strong> A 100GB IoT dataset in a standard collection becomes ~10GB in a time series collection, saving $90/month in storage costs on Atlas while delivering faster queries.</p>
                        </div>
                    </details>
                </section>

            </div>

            <!-- Tab 4: Architecture & Best Practices -->
            <div id="tab-architecture" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Section 4: Multi-Tenancy Models -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0v-2a2 2 0 012-2h5a2 2 0 012 2v2m-6 0v-2a2 2 0 012-2h1a2 2 0 012 2v2" /></svg>
                        <h3 class="text-2xl font-bold">4. Multi-Tenancy Models: The Business of SaaS</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4">This decision framework directly aligns your infrastructure cost and isolation model with your business model. The wrong choice can kill profitability or block enterprise sales.<a href="https://www.mongodb.com/docs/atlas/build-multi-tenant-arch/" target="_blank" rel="noopener noreferrer" class="ref-link">[24]</a><a href="https://www.geeksforgeeks.org/dbms/build-a-multi-tenant-architecture-in-mongodb/" target="_blank" rel="noopener noreferrer" class="ref-link">[25]</a></p>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This decision framework directly aligns your infrastructure cost and isolation model with your business model. The wrong choice can kill profitability or block enterprise sales.</p></div>
                    </details>
                    
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-4">
                        <li><strong class="text-[--mongo-text]">Database per Tenant:</strong> A powerful sales tool for high-value enterprise customers. It provides maximum security, data isolation, and compliance (e.g., for HIPAA/GDPR). This is a premium, high-margin offering. (Great for < 100 tenants).</li>
                        <li><strong class="text-[--mongo-text]">Shared Collection:</strong> The key to profitability at scale for B2C, freemium, or SMB products. It has the lowest cost-per-tenant, allowing you to serve millions of users cost-effectively.</li>
                        <li><strong class="text-[--mongo-text]">Hybrid Model:</strong> The optimal business strategy. It allows you to capture the mass market with a low-cost shared plan while offering a high-margin "Enterprise" plan (with a dedicated database) as an upsell.</li>
                    </ul>
                    
                    <p class="text-[--mongo-text] mt-4 font-semibold">Key Recommendations:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>For shared collections, always use compound indexes with `tenantId` as the first field and shard on `{ tenantId: 1, userId: 1 }` for optimal distribution.<a href="https://www.mongodb.com/community/forums/t/best-shard-key-strategy-for-multi-tenant-e-commerce-platform/289972" target="_blank" rel="noopener noreferrer" class="ref-link">[26]</a></li>
                        <li>For Atlas Vector Search Multi-tenancy, use a single collection with `tenantID` as the index to filter out tenants.<a href="https://www.mongodb.com/community/forums/t/multi-tenancy-and-vector-search/252916" target="_blank" rel="noopener noreferrer" class="ref-link">[27]</a><a href="https://www.mongodb.com/docs/atlas/atlas-vector-search/multi-tenant-architecture/" target="_blank" rel="noopener noreferrer" class="ref-link">[28]</a></li>
                    </ul>

                    <details class="expandable-box">
                        <summary>Analysis (Shared Collection Best Practice)</summary>
                        <div class="expandable-box-content">
                            <p>Sharding on `{ tenantId: 1, ... }` is the most critical performance rule for the shared model. It co-locates all data for one tenant on a single shard. This ensures that a query for `tenantId="A"` is extremely fast (it only hits one server) and prevents a single, high-traffic "noisy neighbor" (`tenantId="B"`) from slowing down all other tenants.</p>
                        </div>
                    </details>
                </section>
                
                <!-- Section 5: Critical Best Practices -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2H1v-2h2v-2h2v2h2v-2h2v-2h2v-2h2v-2H9v-2H7V7H5V5h2V3h2v2h2v2h2v2h2v2h-2v2h-2v2h2v-2h-2v-2h-2v2z" /></svg>
                        <h3 class="text-2xl font-bold">5. Critical Best Practices: Protecting Production</h3>
                    </div>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Shard Key Selection<a href="https://www.geeksforgeeks.org/mongodb/shard-keys-in-mongodb/" target="_blank" rel="noopener noreferrer" class="ref-link">[29]</a><a href="https://www.mongodb.com/docs/manual/core/sharding-choose-a-shard-key/" target="_blank" rel="noopener noreferrer" class="ref-link">[9]</a></h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This decision ensures the long-term health and scalability of your entire application. A good key ensures performance and stability as you grow. A bad key (like a timestamp) guarantees performance bottlenecks, downtime, and an expensive, high-risk re-architecture project.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>A bad key (e.g., `_id` or timestamp) creates a "hot shard" where 100% of new writes go to a single server, completely negating the benefit of sharding. A high-cardinality key (like `userId` or `tenantId`) that appears in most queries spreads the load evenly, which is the entire goal.</p></div>
                    </details>
                    <p class="text-[--mongo-text] mt-4 font-semibold">Avoid common pitfalls:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>Don't use monotonically increasing fields (timestamps, `_id`) alone.</li>
                        <li>Don't create low-cardinality shard keys (status, country).</li>
                        <li>Don't skip pre-splitting for bulk loads.</li>
                        <li>Don't run long transactions (>60 seconds or >1,000 docs).</li>
                    </ul>


                    <h4 class="text-xl font-semibold text-white mt-6">Balancer Management</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is a simple risk mitigation strategy to protect cluster health. The balancer's job (moving data to keep shards even) consumes I/O and network resources.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>By scheduling this background maintenance to run only during low-traffic periods (e.g., 2 AM - 4 AM), you ensure it never impacts application performance during peak business hours. This prevents "random" slowdowns and guarantees a smooth experience for users when they are most active.</p>
                            <p>Connect to the `config` database on your Atlas cluster and run:</p>
                            <div class="code-block">
db.settings.updateOne(
  { _id: "balancer" },
  { $set: { activeWindow: { start: "02:00", stop: "06:00" } } },
  { upsert: true }
)
                            </div>
                        </div>
                    </details>
                </section>

                <!-- Section 6: Zero Downtime -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                        <h3 class="text-2xl font-bold">6. Zero Downtime - Highly Available</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4">The <strong>5+1 Solution</strong>: A 3-region setup (5 electable nodes + 1 read-only) that provides <strong class="text-[--mongo-green]">< 5 second</strong> automatic failover with zero downtime if a primary region fails.</p>
                    <p class="text-[--mongo-text] font-semibold">Zero-downtime techniques include:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>Storage auto-scaling (first increase is in-place)<a href="https://www.mongodb.com/docs/atlas/customize-storage/" target="_blank" rel="noopener noreferrer" class="ref-link">[6]</a></li>
                        <li>Live resharding in MongoDB 5.0+ to change shard keys without downtime<a href="https://www.mongodb.com/resources/products/capabilities/scale-out-without-fear-friction-live-resharding-mongodb" target="_blank" rel="noopener noreferrer" class="ref-link">[7]</a></li>
                        <li>Rolling cluster tier upgrades (brief 2-5 second failover)</li>
                    </ul>
                </section>
            </div>

            <!-- Tab 4: Governance & Operations -->
            <div id="tab-governance" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Section 7: Security & Compliance -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.42-.38-2.75-.99-3.9l.01-.01c-.11.39-.22.78-.33 1.172m-13.256 0c1.32.39 2.71.64 4.15.64 3.314 0 6.3-1.29 8.57-3.417-2.27 2.127-5.256 3.417-8.57 3.417A10.965 10.965 0 013.33 6.643z" /></svg>
                        <h3 class="text-2xl font-bold">7. Security & Compliance Strategy</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Moving from "what" features exist to "how" they must be configured to protect the business. Security is the default, not an option.</p>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Network Security (The "Mote")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is a non-negotiable security control that drastically reduces the attack surface. It ensures that only your trusted application servers can even attempt to connect to the database. This is a foundational requirement for achieving compliance (like SOC2, HIPAA, PCI) and preventing unauthorized access.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Atlas clusters must never be open to the public internet (`0.0.0.0/0`). This is the #1 cause of data breaches. The only acceptable configurations are VPC Peering (for app servers in the same cloud) or Private Link (for multi-cloud or complex corporate networks). This creates a private, isolated network perimeter.</p></div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Authentication & Authorization (The "Guards")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This eliminates the risk of leaked or shared credentials. When an employee leaves, their access is revoked centrally at the IdP, and their database access disappears instantly. This provides a clear, auditable trail of access and is a critical control for internal security.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Passwords (SCRAM) are the bare minimum. For production, passwordless authentication (like AWS IAM or OIDC) or x.509 certificates should be used for all application services. This ties database access to your central Identity Provider (IdP) or cloud-native roles. Furthermore, all access must adhere to the Principle of Least Privilege using custom roles.</p></div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Encryption (The "Safe")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides "zero trust" data protection. It's the ultimate safeguard against a full database breach or a malicious insider. For businesses in healthcare (HIPAA) or finance, this feature is often the key differentiator that makes it possible to use a DBaaS platform while remaining compliant.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Atlas encrypts all data at rest and in transit by default. This is good. However, for highly sensitive data (PII, financial info), this is not enough. You must use Client-Side Field Level Encryption (CSFLE) or Queryable Encryption. This encrypts sensitive fields *before* they are sent from your application server, making them unreadable to MongoDB, Atlas staff, and even your own DBAs.</p></div>
                    </details>
                </section>

                <!-- Section 8: Observability -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.2-5.2" /></svg>
                        <h3 class="text-2xl font-bold">8. Observability & Performance Management</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Defining the "pulse" of the system. Proactive problem detection. Don't wait for customers to complain "the app is slow."</p>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Key Metrics to Monitor (The "Dashboard")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides proactive problem detection. Instead of waiting for a customer to call and say "the app is slow" (reactive), this dashboard alerts you to a degrading query or resource bottleneck (proactive). This minimizes performance-related downtime and improves user satisfaction.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Don't just watch CPU and RAM. The most important Atlas metrics are:</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li><strong>Query Targeting:</strong> The ratio of `docsScanned` to `docsReturned`. A 1:1 ratio is perfect. A 1,000,000:1 ratio means you're missing an index.</li>
                                <li><strong>Connections:</strong> A sudden spike or a gradual climb toward the connection limit signals a connection leak in your application.</li>
                                <li><strong>Replication Lag:</strong> If > 10s, your secondary nodes are falling behind, risking data loss and serving stale reads.</li>
                                <li><strong>Disk Queue Depth & IOPS:</strong> If maxed out, your storage is the bottleneck.</li>
                            </ul>
                        </div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Alerting Strategy (The "Pager")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This ensures the right person is notified of the right problem, immediately. It automates the detection part of your incident response, slashing your Time-to-Resolution (TTR) and protecting cluster health.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Set up Atlas Alerts that integrate directly with your team's tools (PagerDuty, Slack, Datadog). Your most critical alerts should be:</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li>Replication Lag > 10 seconds</li>
                                <li>Query Targeting > 1000:1 (on any primary query)</li>
                                <li>Connections > 80% of limit</li>
                                <li>Cluster failed over (so you can investigate why)</li>
                            </ul>
                        </div>
                    </details>
                </section>

                <!-- Section 9: Cost Management -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 class="text-2xl font-bold">9. Cost Management & TCO Optimization</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Ensuring the platform's cost scales efficiently with the business and prevents "bill shock."</p>

                    <h4 class="text-xl font-semibold text-white mt-4">Cluster Sizing & Scaling Model</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is the #1 strategy for reducing TCO. Indexing is free. Hardware is not. A culture of performance tuning directly translates to lower infrastructure costs, maximizing your profitability.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Don't guess your tier (e.g., M40, M50). Use the Performance Advisor to find and add missing indexes first. A single missing index can make an M40 perform worse than a properly indexed M10. Only scale up (vertical scaling) when your working set (data + indexes) exceeds available RAM. Enable cluster auto-scaling as a safety net, but set a max tier to prevent a bad query from bankrupting you.</p></div>
                    </details>
                <!-- This section was missing from the user's uploaded HTML, so I will leave it out as requested -->
                <!--
                <h4 class="text-xl font-semibold text-white mt-6">Serverless vs. Provisioned Clusters</h4>
...
                -->
                </section> <!-- This closes section 9 -->

                <!-- Section 10: Backup & Disaster Recovery -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 10.5v3.75m7.5-3.75h.008v.008H19.5v-.008Zm0 3.75h.008v.008H19.5v-.008Zm-3.75 0h.008v.008H15.75v-.008Zm0-3.75h.008v.008H15.75v-.008Zm-3.75 0h.008v.008H12v-.008Zm0 3.75h.008v.008H12v-.008Zm-3.75 0h.008v.008H8.25v-.008Zm0-3.75h.008v.008H8.25v-.008ZM3 10.5a8.25 8.25 0 0113.5-6.521 8.25 8.25 0 019.646 6.521M3 10.5v6.225A2.25 2.25 0 005.25 19.5h13.5A2.25 2.25 0 0021 16.725V10.5" /></svg>
                        <h3 class="text-2xl font-bold">10. Backup, Restore, & Disaster Recovery (DR)</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">HA (Replica Sets) is NOT Disaster Recovery. A replica set will not save you if a developer drops a collection.</p>
                     
                    <h4 class="text-xl font-semibold text-white mt-4">Backup vs. Restore Strategy (RPO/RTO)</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>PITR is your "undo button" for catastrophic human error (e.g., a bad script deletes all user data). This capability can save the entire business from an extinction-level event. The cost is negligible compared to the risk of irreversible data loss.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Atlas provides Continuous Cloud Backups (Point-in-Time Restore - PITR). This should always be on for production. This allows you to restore to any specific minute in the last 24-72 hours.</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li><strong>RPO (Recovery Point Objective):</strong> ~1-5 minutes. (How much data can you afford to lose?)</li>
                                <li><strong>RTO (Recovery Time Objective):</strong> ~15-60+ minutes. (How fast do you need to be back online?)</li>
                            </ul>
                        </div>
                    </details>
                     
                    <h4 class="text-xl font-semibold text-white mt-6">Disaster Recovery (DR) Plan</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides regional fault tolerance. For applications with a global user base or an extremely high uptime requirement (e.g., 99.99%), this is the only way to survive a cloud provider's regional outage and continue operating. This is a high-cost, high-value feature for mission-critical systems.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>A regional outage (e.g., us-east-1 goes down) will take your cluster with it. A true DR plan involves a multi-region cluster. This places readable secondary nodes in a different geographic region (e.g., us-west-2). In a total regional failure, Atlas can fail over to the other region.</p></div>
                    </details>
                </section>

                <!-- Section 11: Developer Governance -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
                        <h3 class="text-2xl font-bold">11. Developer Governance & CI/CD</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Ensuring that developer velocity doesn't lead to production chaos.</p>
                     
                    <h4 class="text-xl font-semibold text-white mt-4">Schema Governance</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This prevents data corruption and application-level bugs before they happen. It enforces data quality at the database level, dramatically reducing developer time spent debugging "bad data" and simplifying application logic.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>The "schema-less" flexibility is dangerous at scale. You must use Schema Validation on all critical collections. This enforces that a `userId` is always a string, a `createdAt` field always exists, and `status` is one of ["pending", "active", "archived"].</p></div>
                    </details>
                     
                    <h4 class="text-xl font-semibold text-white mt-6">CI/CD & Index Management</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This de-risks database migrations. It makes schema and index changes a routine, automated, and safe operation instead of a high-stress, "all-hands-on-deck" manual event. This supports a true DevOps culture and increases deployment frequency.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Developers should not be applying indexes manually in the Atlas UI. All index changes must go through a CI/CD pipeline. The pipeline should use a tool or script to perform a rolling index build. This builds the index on each secondary node one by one, then finally on the primary, ensuring zero application downtime.</p></div>
                    </details>
                </section>
            </div>
            
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#00131A] text-[--mongo-text-muted] mt-16">
        <div class="container mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 MongoDB Atlas Runbook. </p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all tabs and content
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    // Activate clicked tab and corresponding content
                    tab.classList.add('active');
                    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                });
            });
        });
    </script>

</body>
</html>

