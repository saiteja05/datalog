<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Enterprise Advanced - Architecture Deep Dive</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23001E2B'/><path d='M16 4 L18 14 L16 28 L14 14 Z' fill='%2300ED64'/><ellipse cx='16' cy='14' rx='3' ry='5' fill='%2300ED64'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-card: #161618;
            --bg-card-hover: #1c1c1f;
            --bg-inset: #0e0e10;
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-accent: rgba(0, 237, 100, 0.2);
            --text-primary: #fafafa;
            --text-secondary: #a1a1a6;
            --text-muted: #6b6b70;
            --accent: #00ed64;
            --accent-dim: #00c853;
            --accent-glow: rgba(0, 237, 100, 0.15);
            --blue: #3b82f6;
            --blue-glow: rgba(59, 130, 246, 0.15);
            --purple: #a855f7;
            --purple-glow: rgba(168, 85, 247, 0.15);
            --orange: #f97316;
            --orange-glow: rgba(249, 115, 22, 0.15);
            --red: #ef4444;
            --red-glow: rgba(239, 68, 68, 0.15);
            --yellow: #eab308;
            --yellow-glow: rgba(234, 179, 8, 0.15);
            --cyan: #06b6d4;
            --cyan-glow: rgba(6, 182, 212, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-secondary);
            min-height: 100vh;
            line-height: 1.7;
            font-size: 1rem;
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        /* Header */
        .page-header {
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 2rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .header-title-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent-glow), transparent);
            border: 1px solid var(--border-accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-logo svg { width: 24px; height: 24px; }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .page-title span {
            background: linear-gradient(135deg, var(--accent), #00c853);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .back-link {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            transition: all 0.2s;
        }

        .back-link:hover {
            color: var(--accent);
            border-color: var(--border-accent);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 0.25rem;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tab-nav::-webkit-scrollbar { display: none; }

        .tab-btn {
            padding: 0.625rem 1.25rem;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-card);
        }

        .tab-btn.active {
            color: var(--accent);
            background: var(--accent-glow);
            border-color: var(--border-accent);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2.5rem 2rem;
        }

        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* Section */
        .section {
            margin-bottom: 3rem;
        }

        .section-heading {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .section-sub {
            color: var(--text-muted);
            font-size: 1.0625rem;
            margin-bottom: 2rem;
            max-width: 800px;
        }

        /* Architecture Diagram Containers */
        .arch-diagram {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 2rem;
            overflow-x: auto;
            margin-bottom: 2rem;
        }

        .arch-diagram-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .arch-diagram-title::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
        }

        /* Architecture Boxes */
        .arch-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: stretch;
            flex-wrap: wrap;
        }

        .arch-box {
            background: var(--bg-inset);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            flex: 1;
            min-width: 200px;
            transition: all 0.3s;
            cursor: default;
        }

        .arch-box:hover {
            border-color: var(--border-accent);
            box-shadow: 0 0 30px -10px var(--accent-glow);
        }

        .arch-box.accent { border-color: var(--border-accent); }
        .arch-box.blue { border-color: rgba(59, 130, 246, 0.3); }
        .arch-box.purple { border-color: rgba(168, 85, 247, 0.3); }
        .arch-box.orange { border-color: rgba(249, 115, 22, 0.3); }
        .arch-box.red { border-color: rgba(239, 68, 68, 0.3); }
        .arch-box.cyan { border-color: rgba(6, 182, 212, 0.3); }
        .arch-box.yellow { border-color: rgba(234, 179, 8, 0.3); }

        .arch-box-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .arch-box-icon {
            font-size: 1.25rem;
        }

        .arch-box-title {
            font-size: 1.0625rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .arch-box-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--accent-glow);
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-left: auto;
        }

        .arch-box-badge.blue { background: var(--blue-glow); color: var(--blue); }
        .arch-box-badge.purple { background: var(--purple-glow); color: var(--purple); }
        .arch-box-badge.orange { background: var(--orange-glow); color: var(--orange); }
        .arch-box-badge.red { background: var(--red-glow); color: var(--red); }
        .arch-box-badge.cyan { background: var(--cyan-glow); color: var(--cyan); }

        .arch-box-desc {
            font-size: 0.9375rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .arch-box-list {
            list-style: none;
            margin-top: 0.75rem;
        }

        .arch-box-list li {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            padding: 0.25rem 0;
            padding-left: 1rem;
            position: relative;
        }

        .arch-box-list li::before {
            content: '‚Ä∫';
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: bold;
        }

        /* Flow Arrows */
        .flow-connector {
            text-align: center;
            padding: 0.75rem 0;
            color: var(--text-muted);
            font-size: 1.25rem;
        }

        .flow-connector.horizontal {
            writing-mode: horizontal-tb;
            padding: 0 0.5rem;
            display: flex;
            align-items: center;
            min-width: auto;
            flex: 0;
        }

        .flow-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            color: var(--text-muted);
            text-align: center;
            padding: 0.25rem 0;
        }

        /* Expandable Panels */
        .expandable {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: all 0.3s;
        }

        .expandable:hover {
            border-color: var(--border-accent);
        }

        .expandable-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            user-select: none;
        }

        .expandable-header:hover {
            background: var(--bg-card-hover);
        }

        .expandable-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .expandable-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .expandable-subtitle {
            font-size: 0.9375rem;
            color: var(--text-muted);
        }

        .expandable-chevron {
            margin-left: auto;
            color: var(--text-muted);
            transition: transform 0.3s;
            font-size: 1.25rem;
        }

        .expandable.open .expandable-chevron {
            transform: rotate(180deg);
        }

        .expandable-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .expandable.open .expandable-body {
            max-height: 5000px;
        }

        .expandable-content {
            padding: 0 1.5rem 1.5rem;
            border-top: 1px solid var(--border-subtle);
            padding-top: 1.5rem;
        }

        /* Info Cards Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-card {
            background: var(--bg-inset);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 1.25rem;
            transition: all 0.2s;
        }

        .info-card:hover {
            border-color: var(--border-accent);
        }

        .info-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-card-text {
            font-size: 0.9375rem;
            color: var(--text-muted);
            line-height: 1.7;
        }

        /* Comparison Table */
        .comp-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-subtle);
            margin-bottom: 1.5rem;
        }

        .comp-table th, .comp-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.9375rem;
        }

        .comp-table th {
            background: var(--bg-card);
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
        }

        .comp-table td {
            background: var(--bg-inset);
            color: var(--text-secondary);
        }

        .comp-table tr:last-child td { border-bottom: none; }

        .comp-table tr:hover td {
            background: var(--bg-card);
        }

        .comp-table .feature-col {
            color: var(--text-primary);
            font-weight: 500;
            min-width: 200px;
        }

        .check { color: var(--accent); }
        .cross { color: var(--red); }
        .partial { color: var(--yellow); }

        /* Code Block */
        .code-block {
            background: #0d0d0f;
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            line-height: 1.8;
            color: var(--text-secondary);
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .code-block .comment { color: #6b6b70; }
        .code-block .keyword { color: var(--accent); }
        .code-block .string { color: var(--orange); }
        .code-block .param { color: var(--blue); }
        .code-block .value { color: var(--purple); }

        /* Visual Flow Diagram */
        .flow-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            margin: 1.5rem 0;
        }

        .flow-step {
            background: var(--bg-inset);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 1rem 1.5rem;
            text-align: center;
            min-width: 250px;
            transition: all 0.2s;
        }

        .flow-step:hover {
            border-color: var(--border-accent);
        }

        .flow-step-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .flow-step-desc {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .flow-arrow {
            color: var(--accent);
            font-size: 1.25rem;
        }

        /* Horizontal flow */
        .flow-horizontal {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .flow-horizontal .flow-step {
            min-width: 160px;
            flex: 1;
            max-width: 220px;
        }

        .flow-horizontal .flow-arrow {
            transform: rotate(-90deg);
        }

        /* Callout */
        .callout {
            border-radius: 10px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .callout.warning {
            background: var(--orange-glow);
            border: 1px solid rgba(249, 115, 22, 0.2);
        }

        .callout.info {
            background: var(--blue-glow);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .callout.success {
            background: var(--accent-glow);
            border: 1px solid var(--border-accent);
        }

        .callout-icon { font-size: 1.25rem; flex-shrink: 0; }

        .callout-text {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .callout-text strong {
            color: var(--text-primary);
        }

        /* Tag */
        .tag {
            display: inline-flex;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0.125rem;
        }

        .tag.green { background: var(--accent-glow); color: var(--accent); }
        .tag.blue { background: var(--blue-glow); color: var(--blue); }
        .tag.purple { background: var(--purple-glow); color: var(--purple); }
        .tag.orange { background: var(--orange-glow); color: var(--orange); }
        .tag.red { background: var(--red-glow); color: var(--red); }
        .tag.cyan { background: var(--cyan-glow); color: var(--cyan); }
        .tag.yellow { background: var(--yellow-glow); color: var(--yellow); }

        /* Interactive Diagram - Ops Manager */
        .ops-diagram {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            gap: 1rem;
            align-items: start;
            margin: 2rem 0;
        }

        .ops-diagram-col {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .ops-diagram-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 3rem;
            color: var(--text-muted);
            font-size: 0.8125rem;
            font-family: 'JetBrains Mono', monospace;
            gap: 0.25rem;
        }

        .ops-diagram-arrow span {
            writing-mode: vertical-lr;
            text-orientation: mixed;
            transform: rotate(180deg);
        }

        /* Mini node */
        .mini-node {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
        }

        .mini-node-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
        }

        .mini-node-dot.primary { background: var(--accent); }
        .mini-node-dot.secondary { background: var(--blue); }
        .mini-node-dot.arbiter { background: var(--yellow); }

        /* Subservice interactive */
        .subservice-map {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .subservice-card {
            background: var(--bg-inset);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subservice-card:hover,
        .subservice-card.selected {
            border-color: var(--border-accent);
            box-shadow: 0 0 30px -10px var(--accent-glow);
        }

        .subservice-card.selected {
            background: var(--bg-card);
        }

        .subservice-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .subservice-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .subservice-card-icon.green { background: var(--accent-glow); }
        .subservice-card-icon.blue { background: var(--blue-glow); }
        .subservice-card-icon.purple { background: var(--purple-glow); }
        .subservice-card-icon.orange { background: var(--orange-glow); }
        .subservice-card-icon.red { background: var(--red-glow); }
        .subservice-card-icon.cyan { background: var(--cyan-glow); }

        .subservice-card-name {
            font-size: 1.0625rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .subservice-card-role {
            font-size: 0.6875rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .subservice-card-desc {
            font-size: 0.9375rem;
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .subservice-detail {
            display: none;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-subtle);
        }

        .subservice-card.selected .subservice-detail {
            display: block;
        }

        .subservice-detail-list {
            list-style: none;
        }

        .subservice-detail-list li {
            font-size: 0.875rem;
            color: var(--text-secondary);
            padding: 0.3rem 0;
            padding-left: 1rem;
            position: relative;
        }

        .subservice-detail-list li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        /* Network diagram */
        .network-layers {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1.5rem 0;
        }

        .network-layer {
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid;
        }

        .network-layer.client { border-color: rgba(59, 130, 246, 0.3); background: rgba(59, 130, 246, 0.03); }
        .network-layer.app { border-color: rgba(0, 237, 100, 0.3); background: rgba(0, 237, 100, 0.03); }
        .network-layer.data { border-color: rgba(168, 85, 247, 0.3); background: rgba(168, 85, 247, 0.03); }
        .network-layer.infra { border-color: rgba(249, 115, 22, 0.3); background: rgba(249, 115, 22, 0.03); }

        .network-layer-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
        }

        .network-layer.client .network-layer-label { color: var(--blue); }
        .network-layer.app .network-layer-label { color: var(--accent); }
        .network-layer.data .network-layer-label { color: var(--purple); }
        .network-layer.infra .network-layer-label { color: var(--orange); }

        .network-layer-content {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Config block */
        .config-block {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .config-block-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .config-block-desc {
            font-size: 0.9375rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        /* Two column layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .two-col { grid-template-columns: 1fr; }
            .ops-diagram { grid-template-columns: 1fr; }
            .ops-diagram-arrow { flex-direction: row; padding-top: 0; }
            .ops-diagram-arrow span { writing-mode: horizontal-tb; transform: none; }
        }

        /* Pulse animation */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .pulse { animation: pulse 2s infinite; }

        /* ===== INTERACTIVE ENHANCEMENTS ===== */

        /* Animated layer connectors */
        .layer-connector {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 28px;
            position: relative;
            overflow: hidden;
        }

        .layer-connector-line {
            width: 2px;
            height: 100%;
            background: linear-gradient(180deg, transparent, var(--accent), transparent);
            position: relative;
        }

        .layer-connector-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 8px var(--accent);
            left: 50%;
            transform: translateX(-50%);
            animation: flowDot 1.5s ease-in-out infinite;
        }

        .layer-connector-dot:nth-child(2) { animation-delay: 0.5s; }
        .layer-connector-dot:nth-child(3) { animation-delay: 1s; }

        @keyframes flowDot {
            0% { top: -6px; opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        .layer-connector-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6875rem;
            color: var(--text-muted);
            position: absolute;
            right: calc(50% + 16px);
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            opacity: 0.7;
        }

        /* Interactive mini-nodes */
        .mini-node {
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mini-node:hover {
            border-color: var(--accent);
            background: rgba(0, 237, 100, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px -4px rgba(0, 237, 100, 0.2);
            z-index: 10;
        }

        .mini-node.highlighted {
            border-color: var(--accent);
            background: var(--accent-glow);
            box-shadow: 0 0 20px -5px var(--accent-glow);
        }

        .mini-node.dimmed {
            opacity: 0.3;
            filter: grayscale(0.5);
        }

        /* Node tooltip */
        .node-tooltip {
            position: fixed;
            z-index: 1000;
            background: var(--bg-card);
            border: 1px solid var(--border-accent);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            max-width: 320px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), 0 0 40px -10px var(--accent-glow);
            pointer-events: none;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.2s, transform 0.2s;
        }

        .node-tooltip.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .node-tooltip-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.375rem;
        }

        .node-tooltip-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .node-tooltip-tags {
            display: flex;
            gap: 0.375rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        /* Flow simulation */
        .flow-container {
            position: relative;
        }

        .flow-play-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            background: var(--accent-glow);
            border: 1px solid var(--border-accent);
            border-radius: 8px;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }

        .flow-play-btn:hover {
            background: rgba(0, 237, 100, 0.25);
            box-shadow: 0 0 20px -5px var(--accent-glow);
        }

        .flow-play-btn.playing {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .flow-step {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .flow-step.active-step {
            border-color: var(--accent) !important;
            background: rgba(0, 237, 100, 0.08);
            box-shadow: 0 0 30px -10px var(--accent-glow);
            transform: scale(1.03);
        }

        .flow-step.completed-step {
            border-color: rgba(0, 237, 100, 0.4);
            background: rgba(0, 237, 100, 0.03);
        }

        .flow-step.completed-step .flow-step-title::after {
            content: ' ‚úì';
            color: var(--accent);
            font-size: 0.875rem;
        }

        .flow-arrow {
            transition: all 0.3s;
        }

        .flow-arrow.active-arrow {
            color: var(--accent);
            transform: scale(1.3);
            text-shadow: 0 0 10px var(--accent);
        }

        /* Network layer interactivity */
        .network-layer {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .network-layer:hover {
            transform: translateX(4px);
        }

        .network-layer.layer-active {
            box-shadow: 0 0 40px -15px currentColor;
            transform: translateX(8px);
        }

        .network-layer.layer-dimmed {
            opacity: 0.3;
            filter: grayscale(0.5);
            transform: scale(0.98);
        }

        /* Animated data particles inside layers */
        .layer-particle-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            border-radius: 12px;
        }

        .layer-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            opacity: 0;
        }

        /* Flow step number badge */
        .flow-step-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.375rem;
            transition: all 0.3s;
        }

        .flow-step.active-step .flow-step-num {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
            box-shadow: 0 0 12px var(--accent-glow);
        }

        .flow-step.completed-step .flow-step-num {
            background: rgba(0, 237, 100, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Interactive diagram - connection lines */
        .conn-line {
            stroke: var(--border-subtle);
            stroke-width: 1.5;
            fill: none;
            transition: all 0.3s;
        }

        .conn-line.active {
            stroke: var(--accent);
            stroke-width: 2;
            filter: drop-shadow(0 0 4px var(--accent));
        }

        /* Animated flowing dashes */
        .conn-line-animated {
            stroke-dasharray: 6 4;
            animation: dashFlow 1s linear infinite;
        }

        @keyframes dashFlow {
            to { stroke-dashoffset: -10; }
        }

        /* Subservice card connection indicator */
        .subservice-card::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .subservice-card {
            position: relative;
            overflow: hidden;
        }

        .subservice-card.selected::before,
        .subservice-card:hover::before {
            opacity: 1;
        }

        /* Data flow indicator on subservice cards */
        .subservice-flow-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .subservice-flow-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 1.5s infinite;
        }

        .subservice-flow-dot.paused {
            animation: none;
            background: var(--text-muted);
        }

        /* Interactive highlight groups */
        [data-group]:hover ~ [data-group] {
            opacity: 0.5;
        }

        /* Status indicator animation */
        @keyframes statusPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 237, 100, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(0, 237, 100, 0); }
        }

        .status-live {
            animation: statusPulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-top { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .tab-nav { gap: 0.125rem; }
            .tab-btn { padding: 0.5rem 0.75rem; font-size: 0.8125rem; }
            .main-content { padding: 1.5rem 1rem; }
            .info-grid { grid-template-columns: 1fr; }
            .subservice-map { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="page-header">
        <div class="header-inner">
            <div class="header-top">
                <div class="header-title-group">
                    <div class="header-logo">
                        <svg viewBox="0 0 32 32" fill="none"><path d="M16 4L18 14L16 28L14 14L16 4Z" fill="#00ED64"/><ellipse cx="16" cy="14" rx="3" ry="5" fill="#00ED64"/></svg>
                    </div>
                    <div>
                        <div class="page-title">MongoDB <span>Enterprise Advanced</span></div>
                        <div style="font-size: 0.9375rem; color: var(--text-muted);">Architecture Deep Dive</div>
                    </div>
                </div>
                <a href="home.html" class="back-link">‚Üê Back to Home</a>
            </div>
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="overview">EA Overview</button>
                <button class="tab-btn" data-tab="opsmanager">Ops Manager Architecture</button>
                <button class="tab-btn" data-tab="backup">Backup & Recovery</button>
                <button class="tab-btn" data-tab="security">Security & Encryption</button>
                <button class="tab-btn" data-tab="monitoring">Monitoring & Logging</button>
                <button class="tab-btn" data-tab="ha">HA Architecture</button>
                <button class="tab-btn" data-tab="deployment">Deployment Models</button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">

        <!-- ==================== TAB 1: EA OVERVIEW ==================== -->
        <div class="tab-panel active" id="tab-overview">
            <div class="section">
                <h2 class="section-heading">MongoDB Enterprise Advanced</h2>
                <p class="section-sub">Enterprise-grade features for security, management, and support. Everything in Community plus advanced capabilities for mission-critical deployments.</p>

                <div class="arch-diagram" id="ea-stack-diagram">
                    <div class="arch-diagram-title">MongoDB EA Component Stack <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">CLICK COMPONENTS FOR DETAILS</span></div>

                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer client" data-layer="app">
                            <div class="network-layer-label">Application Layer</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Application Drivers|Official drivers for Python, Java, Node.js, Go, C#, C++, Ruby, Rust, PHP, Swift. Wire protocol compatible. Connection pooling, retryable writes, automatic encryption.|tags:PyMongo,Motor,Java Sync,Node.js,Go">üñ•Ô∏è Application Drivers (all languages)</div>
                                <div class="mini-node" data-tip="BI Connector|mongosqld translates SQL to MQL via MySQL wire protocol. Supports Tableau, Power BI, Looker, Excel. Schema sampling auto-generates table mappings.|tags:SQL,ODBC,JDBC,Port 3307">üîå BI Connector (SQL ‚Üí MQL translation)</div>
                                <div class="mini-node" data-tip="MongoDB Compass|Official GUI for MongoDB. Visual query builder, schema analysis, aggregation pipeline builder, index management, real-time performance tab.|tags:GUI,Free,Cross-platform">üß≠ Compass GUI</div>
                                <div class="mini-node" data-tip="mongosh|Modern MongoDB shell with syntax highlighting, auto-completion, async/await support, and snippets. Replaces legacy mongo shell.|tags:Shell,JavaScript,REPL">üêö mongosh</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">TLS / HTTPS</div></div>
                        <div class="network-layer app" data-layer="mgmt">
                            <div class="network-layer-label">Management Layer ‚Äî Ops Manager</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Automation|Pull-based convergence engine. Agents poll every 10s for goal state JSON. Handles deployments, rolling upgrades, topology changes, auth bootstrap.|tags:Agent,Goal State,Poll" data-connects="backup,monitoring">‚öôÔ∏è Automation</div>
                                <div class="mini-node" data-tip="Monitoring|Collects 100+ metrics per mongod/mongos: serverStatus, replSetGetStatus, dbStats, host hardware. Pushes compressed payloads every 60s.|tags:Metrics,Push,60s interval" data-connects="alerting">üìä Monitoring</div>
                                <div class="mini-node" data-tip="Backup|Continuous oplog tailing + periodic snapshots. Supports PIT restore to any second. Storage: Blockstore RS, S3, or filesystem.|tags:Oplog,Snapshots,PIT">üíæ Backup</div>
                                <div class="mini-node" data-tip="Alerting|Evaluates threshold, rate, and boolean conditions every 60s. Integrates with PagerDuty, Slack, email, webhooks, SNMP.|tags:PagerDuty,Slack,Webhooks" data-connects="monitoring">üîî Alerting</div>
                                <div class="mini-node" data-tip="REST API v2.0|Full CRUD for organizations, projects, clusters, users, alerts, backup configs. Digest auth or programmatic API keys.|tags:REST,JSON,API Keys">üîß REST API</div>
                                <div class="mini-node" data-tip="Web UI|React-based SPA served by embedded Jetty on port 8443. Dashboards, cluster management, user/project settings, activity feed.|tags:React,Jetty,Port 8443">üñ•Ô∏è Web UI</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Agent Protocol</div></div>
                        <div class="network-layer data" data-layer="db">
                            <div class="network-layer-label">Database Layer ‚Äî MongoDB Enterprise Server</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="WiredTiger Encrypted|Default storage engine with native AES-256 encryption. KMIP, AWS KMS, Azure Key Vault, GCP KMS for master key. Online key rotation.|tags:AES-256,KMIP,Encrypted"><span class="mini-node-dot primary"></span> WiredTiger (Encrypted)</div>
                                <div class="mini-node" data-tip="In-Memory Engine|Enterprise-only engine for ultra-low-latency workloads. Data held entirely in RAM. Durability via replica set secondaries on WiredTiger.|tags:RAM-only,Sub-ms,Enterprise"><span class="mini-node-dot secondary"></span> In-Memory Engine</div>
                                <div class="mini-node" data-tip="Authentication|LDAP: Bind to AD/OpenLDAP for user auth + group‚Üírole mapping. Kerberos: GSSAPI/SPNEGO for SSO. x.509: Mutual TLS client certificate auth.|tags:LDAP,Kerberos,x.509,SSO">üîê LDAP / Kerberos / x.509</div>
                                <div class="mini-node" data-tip="Audit Logging|Enterprise-only configurable audit. Filter by event type (auth, CRUD, DDL, admin). Output to file (JSON/BSON), syslog, or console.|tags:Compliance,JSON,Filters">üìã Auditing</div>
                                <div class="mini-node" data-tip="Client-Side Encryption|CSFLE: Driver encrypts fields before sending to server. Deterministic (equality queries) or Randomized. Queryable Encryption: Query encrypted data server-side.|tags:CSFLE,QE,Driver-side">üîë CSFLE / Queryable Encryption</div>
                                <div class="mini-node" data-tip="Cluster-to-Cluster Sync|mongosync: Continuous bi-directional or uni-directional data sync between clusters. Supports live migrations, DR failover, and active-passive.|tags:mongosync,Migration,DR">üîó Cluster-to-Cluster Sync</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Process Mgmt</div></div>
                        <div class="network-layer infra" data-layer="infra">
                            <div class="network-layer-label">Infrastructure Layer</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Kubernetes Operator|Enterprise Operator manages MongoDB CRDs: MongoDB, MongoDBOpsManager, MongoDBUser, MongoDBMultiCluster. Creates StatefulSets, PVCs, Services.|tags:CRDs,StatefulSet,Helm">‚ò∏Ô∏è Kubernetes Operator</div>
                                <div class="mini-node" data-tip="Container Support|Official enterprise Docker images. Init containers for agent setup, sidecar containers for monitoring. OCI-compliant.|tags:Docker,OCI,Sidecar">üê≥ Container Support</div>
                                <div class="mini-node" data-tip="Bare Metal / VM|Direct RPM/DEB installation. Full hardware control. Ansible/Terraform automation. Recommended for air-gapped and high-performance workloads.|tags:RPM,DEB,Ansible">üñß Bare Metal / VM</div>
                                <div class="mini-node" data-tip="Cloud Infrastructure|Deploy on any cloud: AWS (EC2, EBS, EKS), GCP (GCE, GKE), Azure (VMs, AKS). Multi-cloud supported.|tags:AWS,GCP,Azure,Multi-cloud">‚òÅÔ∏è Any Cloud (AWS, GCP, Azure)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-heading">EA vs Community Comparison</h2>
                <p class="section-sub">Key differentiators that make Enterprise Advanced the choice for production workloads.</p>

                <table class="comp-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Community</th>
                            <th>Enterprise Advanced</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="feature-col">Storage Engine - WiredTiger</td><td class="check">‚úì</td><td class="check">‚úì</td></tr>
                        <tr><td class="feature-col">Encryption at Rest (Native)</td><td class="cross">‚úó</td><td class="check">‚úì KMIP, AWS KMS, Azure Key Vault, GCP KMS</td></tr>
                        <tr><td class="feature-col">In-Memory Storage Engine</td><td class="cross">‚úó</td><td class="check">‚úì</td></tr>
                        <tr><td class="feature-col">LDAP Authentication & Authorization</td><td class="cross">‚úó</td><td class="check">‚úì</td></tr>
                        <tr><td class="feature-col">Kerberos Authentication</td><td class="cross">‚úó</td><td class="check">‚úì</td></tr>
                        <tr><td class="feature-col">Audit Logging</td><td class="cross">‚úó</td><td class="check">‚úì Configurable filters</td></tr>
                        <tr><td class="feature-col">Client-Side Field Level Encryption</td><td class="partial">‚ö† Manual only</td><td class="check">‚úì Automatic + Queryable</td></tr>
                        <tr><td class="feature-col">Ops Manager</td><td class="cross">‚úó</td><td class="check">‚úì Full management platform</td></tr>
                        <tr><td class="feature-col">BI Connector</td><td class="cross">‚úó</td><td class="check">‚úì SQL ‚Üí MQL</td></tr>
                        <tr><td class="feature-col">Kubernetes Operator</td><td class="partial">‚ö† Community Operator</td><td class="check">‚úì Enterprise Operator</td></tr>
                        <tr><td class="feature-col">Enterprise Support</td><td class="cross">‚úó</td><td class="check">‚úì 24/7 SLA-backed</td></tr>
                        <tr><td class="feature-col">Cluster-to-Cluster Sync</td><td class="cross">‚úó</td><td class="check">‚úì mongosync</td></tr>
                        <tr><td class="feature-col">SNMP Monitoring</td><td class="cross">‚úó</td><td class="check">‚úì</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2 class="section-heading">EA Product Components</h2>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-card-title">‚öôÔ∏è Ops Manager</div>
                        <div class="info-card-text">Self-hosted management platform. Deploy, monitor, back up, and scale MongoDB clusters. Includes automation, alerting, and a web UI. The on-premises equivalent of Atlas.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üîê Enterprise Server</div>
                        <div class="info-card-text">Enhanced mongod/mongos with encryption at rest, LDAP, Kerberos, auditing, in-memory engine, SNMP, FIPS 140-2 compliance, and Queryable Encryption.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">‚ò∏Ô∏è Kubernetes Operator</div>
                        <div class="info-card-text">CustomResourceDefinitions for MongoDB, MongoDBOpsManager, MongoDBUser. Manages lifecycle via StatefulSets. Integrates with Ops Manager for automation.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üîå BI Connector</div>
                        <div class="info-card-text">Translates SQL queries to MQL. Enables BI tools (Tableau, Power BI, Looker) to query MongoDB directly via a MySQL-compatible wire protocol.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üîó Cluster-to-Cluster Sync</div>
                        <div class="info-card-text"><code style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent);">mongosync</code> enables continuous data synchronization between clusters. Supports migrations, DR, and active-passive topologies.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üõ°Ô∏è Enterprise Support</div>
                        <div class="info-card-text">24/7 SLA-backed support with &lt;1 hour P1 response time. Access to MongoDB field engineers, proactive health checks, and upgrade advisory.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: OPS MANAGER ARCHITECTURE ==================== -->
        <div class="tab-panel" id="tab-opsmanager">
            <div class="section">
                <h2 class="section-heading">Ops Manager Architecture</h2>
                <p class="section-sub">Ops Manager is a self-hosted management platform. It consists of the Application Server, a backing Application Database, agents deployed on every managed host, and dedicated backup infrastructure.</p>

                <div class="arch-diagram" id="om-topology-diagram">
                    <div class="arch-diagram-title">High-Level Ops Manager Topology <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">CLICK COMPONENTS FOR DETAILS</span></div>
                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer client" data-layer="users">
                            <div class="network-layer-label">Users & Integrations</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Web UI Access|Browser-based SPA. Supports LDAP SSO, SAML, and local auth. Session timeout configurable. Requires HTTPS in production.|tags:Port 8443,HTTPS,React">üë§ Ops Manager Web UI</div>
                                <div class="mini-node" data-tip="REST API v2.0|Programmatic access to all Ops Manager resources. Digest auth or API keys. Supports pagination, field projection, and envelope responses.|tags:Digest Auth,JSON,Programmatic">üîß REST API v2.0</div>
                                <div class="mini-node" data-tip="Terraform Provider|HashiCorp Terraform provider for MongoDB. Manages clusters, users, alerts as infrastructure-as-code. Supports plan/apply lifecycle.|tags:IaC,HCL,GitOps">üîó Terraform Provider</div>
                                <div class="mini-node" data-tip="Alert Integrations|Outbound webhooks for alert notifications. Supports PagerDuty, Slack, OpsGenie, VictorOps, email (SMTP), SNMP traps, and custom webhooks.|tags:PagerDuty,Slack,SMTP,SNMP">üìß Alert Webhooks / Email / PagerDuty / Slack</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">HTTPS :8443</div></div>
                        <div class="network-layer app" data-layer="omapp">
                            <div class="network-layer-label">Ops Manager Application Servers (2+ for HA)</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="HTTP Server (Jetty)|Embedded Jetty serves Web UI and API. Handles TLS termination (or behind LB). Default heap: 4 GB. Configurable thread pool.|tags:Jetty,Port 8443,TLS">üñ•Ô∏è HTTP Server (Jetty)</div>
                                <div class="mini-node" data-tip="Backup Daemon|Coordinates snapshot scheduling, Head DB management, and oplog slice processing. Only ONE active instance across all OM servers (active-passive failover).|tags:Active-Passive,Snapshots,Head DB">üíæ Backup Daemon</div>
                                <div class="mini-node" data-tip="Alert Engine|Evaluates all alert conditions every monitoring cycle. Manages alert state machine: OPEN‚ÜíACKNOWLEDGED‚ÜíCLOSED. Handles notification dispatch.|tags:Thresholds,State Machine,60s">üîî Alert Engine</div>
                                <div class="mini-node" data-tip="Goal State Engine|Generates goal state JSON document from user-configured topology. Served to agents on poll. Handles version sequencing for safe rollouts.|tags:JSON,Versioned,Convergence">‚öôÔ∏è Goal State Engine</div>
                                <div class="mini-node" data-tip="Metric Aggregator|Receives compressed metric payloads from monitoring agents. Stores raw data, computes rollups (1min‚Üí5min‚Üí1hr‚Üídaily). Feeds dashboards and alerting.|tags:Compression,Rollups,Time-series">üìä Metric Aggregator</div>
                                <div class="mini-node" data-tip="Authentication|Multi-provider auth: Local SCRAM, LDAP bind, SAML 2.0 SSO. RBAC with Global Owner, Org Admin, Project Owner, Read Only roles.|tags:LDAP,SAML,SSO,RBAC">üë• Auth (LDAP/SAML/SCRAM)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">MongoDB Wire Protocol</div></div>
                        <div class="network-layer data" data-layer="omdata">
                            <div class="network-layer-label">Ops Manager Backing Databases</div>
                            <div class="network-layer-content">
                                <div class="mini-node status-live" data-tip="Application Database|3-node RS storing all OM metadata: users, orgs, projects, configs, metrics, audit. SSD required. ~2 GB per 100 managed servers. NEVER managed by OM itself.|tags:Critical,3-node RS,SSD,Independent"><span class="mini-node-dot primary"></span> Application DB (3-node RS)</div>
                                <div class="mini-node" data-tip="Blockstore|RS storing compressed, deduplicated snapshot chunks. Size: 2-3x total backup data. Can use multiple blockstores for load distribution. Also supports S3/filesystem.|tags:Snapshots,Dedup,Compressed"><span class="mini-node-dot secondary"></span> Blockstore (snapshot chunks)</div>
                                <div class="mini-node" data-tip="Oplog Store|RS storing oplog slices between snapshots for PIT recovery. Size: ~10-20% of blockstore. Compressed. Garbage-collected after snapshots cover the time range.|tags:Oplog Slices,PIT,Compressed"><span class="mini-node-dot secondary"></span> Oplog Store (oplog slices)</div>
                                <div class="mini-node" data-tip="Head Database|Per-replica-set staging copy. Backup Daemon applies oplog to keep current. Snapshots taken from here. High I/O ‚Äî needs fast SSD. Size = dataset of backed-up RS.|tags:Staging,High I/O,SSD,Temporary"><span class="mini-node-dot arbiter"></span> Head DB (staging)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Agent ‚Üê Poll ‚Üí OM</div></div>
                        <div class="network-layer infra" data-layer="agents">
                            <div class="network-layer-label">Managed MongoDB Hosts (Agents)</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="MongoDB Agent (Unified)|Single binary since OM 4.0. Combines automation, monitoring, and backup modules. Outbound HTTPS only (no inbound ports). Auto-restart via systemd.|tags:Unified,Outbound,systemd">ü§ñ MongoDB Agent (unified)</div>
                                <div class="mini-node" data-tip="Automation Module|Polls goal state every 10s. Compares, converges. Manages mongod/mongos processes, configs, keyfiles, certs. Rolling upgrade orchestration.|tags:Poll 10s,Convergence,Rolling">‚Üí Automation Module</div>
                                <div class="mini-node" data-tip="Monitoring Module|Runs serverStatus, replSetGetStatus, dbStats, top, currentOp every 60s. Collects host CPU/disk/memory/network. Pushes compressed to OM.|tags:60s,Push,Compressed">‚Üí Monitoring Module</div>
                                <div class="mini-node" data-tip="Backup Module|Tails local.oplog.rs continuously. Slices and compresses oplog. Coordinates with Backup Daemon for snapshot timing. Bandwidth-throttled.|tags:Oplog Tail,Continuous,Throttled">‚Üí Backup Module</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-heading">Ops Manager Subservices ‚Äî Deep Dive</h2>
                <p class="section-sub">Click each subservice to expand its technical details, internal workings, and interaction patterns.</p>

                <div class="subservice-map" id="subservice-map">
                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon green">‚öôÔ∏è</div>
                            <div>
                                <div class="subservice-card-name">Automation Agent</div>
                                <div class="subservice-card-role">Runs on every managed host</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Manages the entire lifecycle of MongoDB processes ‚Äî provisioning, configuration, upgrades, and topology changes.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Pull-based model:</strong> Agent polls Ops Manager every 10s (configurable) for the "goal state" ‚Äî a JSON document describing desired topology</li>
                                <li><strong>Convergence engine:</strong> Compares current state to goal state and takes actions: start/stop mongod, modify configs, initiate replica set reconfig, add shards</li>
                                <li><strong>Upgrade orchestration:</strong> Rolling upgrades one member at a time. Steps down primary last. Waits for secondaries to catch up before proceeding</li>
                                <li><strong>Process management:</strong> Starts mongod/mongos with correct flags. Monitors process health. Restarts on crash with backoff</li>
                                <li><strong>Configuration:</strong> Generates mongod.conf from goal state. Handles TLS certs, keyfiles, LDAP config, audit config</li>
                                <li><strong>Auth bootstrap:</strong> Creates first admin user, configures keyfile auth, enables auth on replica set</li>
                                <li><strong>Port:</strong> Outbound HTTPS to Ops Manager (port 8443). No inbound ports required</li>
                                <li><strong>Log:</strong> <code>/var/log/mongodb-mms-automation/automation-agent.log</code></li>
                                <li><strong>Failure mode:</strong> If agent is down, existing MongoDB processes keep running. No new changes applied until agent reconnects</li>
                            </ul>
                        </div>
                    </div>

                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon blue">üìä</div>
                            <div>
                                <div class="subservice-card-name">Monitoring Agent</div>
                                <div class="subservice-card-role">Runs on every managed host</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Collects granular performance metrics from every MongoDB process and pushes them to Ops Manager for visualization and alerting.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Data collection methods:</strong> Runs <code>serverStatus</code>, <code>replSetGetStatus</code>, <code>dbStats</code>, <code>collStats</code>, <code>top</code>, <code>currentOp</code>, <code>connPoolStats</code></li>
                                <li><strong>Collection interval:</strong> Default every 60 seconds. Configurable down to 10 seconds</li>
                                <li><strong>Hardware metrics:</strong> CPU usage, disk IOPS, disk utilization, memory (RSS, mapped, virtual), network I/O ‚Äî collected via host agent</li>
                                <li><strong>Replication lag:</strong> Measures optime difference between primary and each secondary. Alerts on configurable thresholds</li>
                                <li><strong>Push model:</strong> Batches metrics and sends compressed payload to Ops Manager HTTP endpoint</li>
                                <li><strong>Metric retention:</strong> 1-minute granularity for 48 hours ‚Üí 5-min for 7 days ‚Üí 1-hour for 90 days ‚Üí daily for 2 years</li>
                                <li><strong>Custom metrics:</strong> Can define custom serverStatus-based metrics for dashboards</li>
                                <li><strong>Profiler integration:</strong> Can collect slow query logs (from profiler level 1/2) and display in Ops Manager</li>
                                <li><strong>Data sent:</strong> ~2-5 KB per mongod per collection interval (compressed)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon purple">üíæ</div>
                            <div>
                                <div class="subservice-card-name">Backup Agent</div>
                                <div class="subservice-card-role">Runs on every managed host</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Handles oplog tailing for continuous backup and coordinates with the Backup Daemon for snapshot creation.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Oplog tailing:</strong> Connects to each replica set member and tails the local.oplog.rs collection continuously</li>
                                <li><strong>Initial sync:</strong> On first backup, performs a full data copy. Uses mongodump internally or filesystem snapshots</li>
                                <li><strong>Oplog slicing:</strong> Divides oplog into time-based slices and sends compressed slices to the Oplog Store</li>
                                <li><strong>Coordination:</strong> Reports status to Backup Daemon on Ops Manager. Daemon orchestrates when to take snapshots</li>
                                <li><strong>Sharded cluster backup:</strong> Coordinates across all shard agents to create a consistent checkpoint using balancer pause + config server oplog position</li>
                                <li><strong>Compression:</strong> Oplog and snapshot data compressed with zstd before transmission and storage</li>
                                <li><strong>Bandwidth control:</strong> Configurable max oplog transfer rate per agent to avoid saturating network</li>
                                <li><strong>Encryption:</strong> Data encrypted in transit (TLS). Optional encryption at rest in blockstore/oplog store</li>
                            </ul>
                        </div>
                    </div>

                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon orange">üèóÔ∏è</div>
                            <div>
                                <div class="subservice-card-name">Backup Daemon</div>
                                <div class="subservice-card-role">Runs on Ops Manager App Server</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Central coordinator for all backup operations. Manages snapshot scheduling, retention policies, and restore orchestration.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Snapshot scheduling:</strong> Creates snapshots at configurable intervals (default: every 6 hours). Base + incremental approach</li>
                                <li><strong>Head Database:</strong> Maintains a staging copy of each backed-up replica set. Applies oplog slices to keep it current. Used as the base for snapshots</li>
                                <li><strong>Snapshot creation:</strong> Takes a point-in-time copy of the Head DB. Chunks the data and stores in the Blockstore</li>
                                <li><strong>Incremental snapshots:</strong> After initial full snapshot, subsequent snapshots only store changed blocks (deduplication)</li>
                                <li><strong>Retention policy:</strong> Configurable per-project. Example: 24 hourly, 7 daily, 4 weekly, 12 monthly snapshots</li>
                                <li><strong>Restore types:</strong> Download snapshot (.tar.gz), Restore to another cluster (automated), Point-in-time restore (to any second), Queryable backup (mount as read-only)</li>
                                <li><strong>HA:</strong> Only ONE active backup daemon per deployment. If the active Ops Manager node fails, another takes over automatically</li>
                                <li><strong>Storage backends:</strong> Blockstore (MongoDB RS), S3-compatible (AWS S3, MinIO, etc.), Filesystem store (NFS/SAN)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon red">üîî</div>
                            <div>
                                <div class="subservice-card-name">Alert Engine</div>
                                <div class="subservice-card-role">Runs on Ops Manager App Server</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Evaluates alert conditions against collected metrics and triggers notifications via multiple integration channels.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Alert conditions:</strong> Threshold-based (e.g., connections > 500), rate-based (e.g., page faults/sec), boolean (e.g., primary step-down)</li>
                                <li><strong>Built-in alerts:</strong> Host down, replication lag, disk usage, oplog window, election events, backup delay, agent disconnect</li>
                                <li><strong>Custom alerts:</strong> Create on any collected metric with AND/OR conditions</li>
                                <li><strong>Integrations:</strong> Email, PagerDuty, Slack, OpsGenie, VictorOps, Webhook (custom), SNMP traps, HipChat</li>
                                <li><strong>Evaluation cycle:</strong> Checks conditions every monitoring interval (default 60s)</li>
                                <li><strong>Alert states:</strong> OPEN ‚Üí ACKNOWLEDGED ‚Üí CLOSED. Configurable auto-resolution</li>
                                <li><strong>Maintenance windows:</strong> Suppress alerts during planned downtime</li>
                            </ul>
                        </div>
                    </div>

                    <div class="subservice-card" onclick="toggleSubservice(this)">
                        <div class="subservice-card-header">
                            <div class="subservice-card-icon cyan">üñ•Ô∏è</div>
                            <div>
                                <div class="subservice-card-name">HTTP Server & API</div>
                                <div class="subservice-card-role">Runs on Ops Manager App Server</div>
                            </div>
                        </div>
                        <div class="subservice-card-desc">Jetty-based HTTP server serving the Web UI and REST API. Handles authentication, authorization, and session management.</div>
                        <div class="subservice-detail">
                            <ul class="subservice-detail-list">
                                <li><strong>Web UI:</strong> React-based SPA served by embedded Jetty. Provides dashboards, cluster management, user management, project settings</li>
                                <li><strong>REST API v2.0:</strong> Full CRUD for all resources ‚Äî organizations, projects, clusters, users, alerts, backup configs. Digest or API key auth</li>
                                <li><strong>Default port:</strong> 8080 (HTTP) / 8443 (HTTPS). TLS strongly recommended for production</li>
                                <li><strong>Authentication:</strong> Local accounts (SCRAM), LDAP bind, SAML 2.0 (SSO with Okta, ADFS, etc.), x.509 client certs</li>
                                <li><strong>Authorization:</strong> RBAC with roles: Global Owner, Org Admin, Project Owner, Project Read Only, etc.</li>
                                <li><strong>Session:</strong> HTTP sessions stored in Application Database. Configurable timeout (default 12 hours)</li>
                                <li><strong>Rate limiting:</strong> Configurable per-user and per-API-key rate limits to protect against abuse</li>
                                <li><strong>Load balancer:</strong> For HA, place 2+ Ops Manager app servers behind an L7 LB with sticky sessions</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-heading">Agent ‚Üî Ops Manager Interaction Flow</h2>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Automation Agent Convergence Loop</div>
                    <button class="flow-play-btn" onclick="playFlow(this)">‚ñ∂ Simulate Flow</button>
                    <div class="flow-horizontal" data-flow-sim>
                        <div class="flow-step">
                            <div class="flow-step-num">1</div>
                            <div class="flow-step-title">Agent Polls</div>
                            <div class="flow-step-desc">GET /api/agent/v1/goalState<br>Every 10s via HTTPS</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">2</div>
                            <div class="flow-step-title">Goal State Received</div>
                            <div class="flow-step-desc">JSON describing desired<br>topology & config</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">3</div>
                            <div class="flow-step-title">Compare</div>
                            <div class="flow-step-desc">Diff current state vs<br>goal state</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">4</div>
                            <div class="flow-step-title">Converge</div>
                            <div class="flow-step-desc">Apply changes: start/stop<br>processes, reconfig RS</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">5</div>
                            <div class="flow-step-title">Report</div>
                            <div class="flow-step-desc">POST status back to<br>Ops Manager</div>
                        </div>
                    </div>
                </div>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Monitoring Data Flow</div>
                    <button class="flow-play-btn" onclick="playFlow(this)">‚ñ∂ Simulate Flow</button>
                    <div class="flow-horizontal" data-flow-sim>
                        <div class="flow-step">
                            <div class="flow-step-num">1</div>
                            <div class="flow-step-title">mongod / mongos</div>
                            <div class="flow-step-desc">serverStatus, replSetGetStatus<br>dbStats, currentOp</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">2</div>
                            <div class="flow-step-title">Monitoring Module</div>
                            <div class="flow-step-desc">Collects every 60s<br>+ host hardware stats</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">3</div>
                            <div class="flow-step-title">Compressed Push</div>
                            <div class="flow-step-desc">HTTPS POST to<br>Ops Manager</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">4</div>
                            <div class="flow-step-title">Metric Aggregator</div>
                            <div class="flow-step-desc">Stores in App DB<br>with time-based rollup</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-step">
                            <div class="flow-step-num">5</div>
                            <div class="flow-step-title">UI / Alerts</div>
                            <div class="flow-step-desc">Dashboards, charts<br>Alert evaluation</div>
                        </div>
                    </div>
                </div>

                <div class="callout info">
                    <div class="callout-icon">üí°</div>
                    <div class="callout-text"><strong>Unified Agent (4.0+):</strong> Since Ops Manager 4.0, all three functions (Automation, Monitoring, Backup) are bundled into a single <code>mongodb-agent</code> binary. The agent runs as a single process and enables/disables modules based on Ops Manager configuration. This simplifies deployment from 3 agents to 1 per host.</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-heading">Ops Manager Backing Databases</h2>
                <p class="section-sub">Ops Manager relies on several dedicated MongoDB instances for its own operation. These are critical infrastructure.</p>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-card-title"><span class="mini-node-dot primary" style="display:inline-block;width:8px;height:8px;margin-right:6px"></span> Application Database</div>
                        <div class="info-card-text">
                            <strong>Purpose:</strong> Stores all Ops Manager metadata ‚Äî users, organizations, projects, cluster configs, alert definitions, metric data, automation goal states, audit logs.<br><br>
                            <strong>Sizing:</strong> Requires 3+ node replica set. SSD recommended. Size depends on # of managed hosts: ~2 GB per 100 servers.<br><br>
                            <strong>Requirements:</strong> Must use WiredTiger. Must have oplog sized for at least 24 hours. Dedicated hardware recommended (not co-located with managed clusters).
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title"><span class="mini-node-dot secondary" style="display:inline-block;width:8px;height:8px;margin-right:6px"></span> Blockstore</div>
                        <div class="info-card-text">
                            <strong>Purpose:</strong> Stores snapshot data as compressed, deduplicated chunks. Each snapshot is a series of blocks referencing a base snapshot plus deltas.<br><br>
                            <strong>Sizing:</strong> Depends on total data being backed up. Rule of thumb: 2-3x the total dataset size (for retention + overhead).<br><br>
                            <strong>Options:</strong> MongoDB replica set (default), S3-compatible (AWS S3, GCS, MinIO), filesystem (NFS/SAN). Can have multiple blockstores for distribution.
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title"><span class="mini-node-dot secondary" style="display:inline-block;width:8px;height:8px;margin-right:6px"></span> Oplog Store</div>
                        <div class="info-card-text">
                            <strong>Purpose:</strong> Stores oplog slices between snapshots. These slices enable point-in-time restore to any second between two snapshots.<br><br>
                            <strong>Sizing:</strong> Grows based on write volume. Typically 10-20% of blockstore size. Oplog slices are compressed.<br><br>
                            <strong>Retention:</strong> Slices are garbage-collected after the next snapshot covers that time range plus the retention window.
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title"><span class="mini-node-dot arbiter" style="display:inline-block;width:8px;height:8px;margin-right:6px"></span> Head Database</div>
                        <div class="info-card-text">
                            <strong>Purpose:</strong> Temporary staging database per backed-up replica set. The Backup Daemon applies oplog slices to keep it up-to-date, then takes periodic snapshots from it.<br><br>
                            <strong>Lifecycle:</strong> Created automatically. One per backed-up replica set. Stored on Backup Daemon host or dedicated storage.<br><br>
                            <strong>Note:</strong> High I/O component. Place on fast SSD. Size equals the dataset of the replica set being backed up.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 3: BACKUP & RECOVERY ==================== -->
        <div class="tab-panel" id="tab-backup">
            <div class="section">
                <h2 class="section-heading">Backup & Recovery Architecture</h2>
                <p class="section-sub">Ops Manager provides enterprise-grade backup with continuous point-in-time recovery, automated scheduling, and multiple restore options.</p>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Backup Data Flow <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">HOVER LAYERS TO FOCUS</span></div>
                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer client">
                            <div class="network-layer-label">Source: Managed MongoDB Clusters</div>
                            <div class="network-layer-content">
                                <div class="mini-node"><span class="mini-node-dot primary"></span> Primary (initial sync source)</div>
                                <div class="mini-node"><span class="mini-node-dot secondary"></span> Secondary (oplog tailing)</div>
                                <div class="mini-node">üìã local.oplog.rs (capped collection)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Oplog Tail</div></div>
                        <div class="network-layer app">
                            <div class="network-layer-label">Processing: Backup Agent + Daemon</div>
                            <div class="network-layer-content">
                                <div class="mini-node">ü§ñ Backup Agent tails oplog continuously</div>
                                <div class="mini-node">üì¶ Slices oplog into time-based chunks</div>
                                <div class="mini-node">üèóÔ∏è Backup Daemon applies slices to Head DB</div>
                                <div class="mini-node">üì∏ Takes periodic snapshots from Head DB</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Compressed Write</div></div>
                        <div class="network-layer data">
                            <div class="network-layer-label">Storage: Blockstore + Oplog Store</div>
                            <div class="network-layer-content">
                                <div class="mini-node">üíæ Blockstore: Compressed snapshot chunks</div>
                                <div class="mini-node">üìã Oplog Store: Oplog slices (PIT restore)</div>
                                <div class="mini-node">‚òÅÔ∏è Optional: S3-compatible backend</div>
                                <div class="mini-node">üìÅ Optional: Filesystem (NFS/SAN)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Snapshot Backup -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üì∏</div>
                    <div>
                        <div class="expandable-title">Snapshot Backup</div>
                        <div class="expandable-subtitle">Periodic full + incremental snapshots with configurable retention</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">How Snapshots Work</h4>
                        <button class="flow-play-btn" onclick="playFlowVertical(this)">‚ñ∂ Simulate Snapshot Process</button>
                        <div class="flow-diagram" data-flow-sim-v>
                            <div class="flow-step" style="border-color: var(--border-accent);">
                                <div class="flow-step-num">1</div>
                                <div class="flow-step-title">Initial Sync</div>
                                <div class="flow-step-desc">Full copy of dataset from primary to Head Database. Uses mongodump or filesystem snapshot.</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">2</div>
                                <div class="flow-step-title">Continuous Oplog Tailing</div>
                                <div class="flow-step-desc">Backup Agent tails oplog from a secondary. Sends compressed slices to Oplog Store every few seconds.</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">3</div>
                                <div class="flow-step-title">Head DB Catch-up</div>
                                <div class="flow-step-desc">Backup Daemon applies oplog slices to Head DB, keeping it within seconds of the live cluster.</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">4</div>
                                <div class="flow-step-title">Snapshot Creation</div>
                                <div class="flow-step-desc">At scheduled intervals, Daemon snapshots the Head DB. First snapshot is full; subsequent ones are incremental (block-level dedup).</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">5</div>
                                <div class="flow-step-title">Storage in Blockstore</div>
                                <div class="flow-step-desc">Snapshot chunks compressed with zstd and stored in Blockstore. Deduplication across snapshots saves 60-80% space.</div>
                            </div>
                        </div>

                        <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Default Retention Policy</h4>
                        <table class="comp-table">
                            <thead><tr><th>Frequency</th><th>Retention</th><th>Example</th></tr></thead>
                            <tbody>
                                <tr><td class="feature-col">Every 6 hours</td><td>24 snapshots</td><td>6 days of 6-hourly snapshots</td></tr>
                                <tr><td class="feature-col">Daily</td><td>7 snapshots</td><td>One week of daily snapshots</td></tr>
                                <tr><td class="feature-col">Weekly</td><td>4 snapshots</td><td>One month of weekly snapshots</td></tr>
                                <tr><td class="feature-col">Monthly</td><td>12 snapshots</td><td>One year of monthly snapshots</td></tr>
                            </tbody>
                        </table>

                        <div class="callout info">
                            <div class="callout-icon">üí°</div>
                            <div class="callout-text"><strong>Sharded Cluster Snapshots:</strong> The Backup Daemon pauses the balancer, records the config server oplog position, and coordinates all shard agents to capture a <strong>consistent cluster-wide checkpoint</strong>. This ensures cross-shard consistency without stopping writes.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuous Backup -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üîÑ</div>
                    <div>
                        <div class="expandable-title">Continuous Backup (Point-in-Time Recovery)</div>
                        <div class="expandable-subtitle">Restore to any second within the oplog window</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">How Point-in-Time Recovery Works</h4>
                        <button class="flow-play-btn" onclick="playFlowVertical(this)">‚ñ∂ Simulate PIT Restore</button>
                        <div class="flow-diagram" data-flow-sim-v>
                            <div class="flow-step" style="border-color: rgba(59, 130, 246, 0.3);">
                                <div class="flow-step-num">1</div>
                                <div class="flow-step-title">Closest Prior Snapshot</div>
                                <div class="flow-step-desc">System identifies the most recent snapshot before the target timestamp</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">2</div>
                                <div class="flow-step-title">Restore Snapshot Base</div>
                                <div class="flow-step-desc">Reconstructs dataset from Blockstore chunks</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">3</div>
                                <div class="flow-step-title">Replay Oplog Slices</div>
                                <div class="flow-step-desc">Applies stored oplog slices from Oplog Store up to the exact target timestamp</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">4</div>
                                <div class="flow-step-title">Deliver Restore</div>
                                <div class="flow-step-desc">Download as archive or automated restore to a cluster</div>
                            </div>
                        </div>

                        <div class="two-col">
                            <div class="config-block">
                                <div class="config-block-title">RPO (Recovery Point Objective)</div>
                                <div class="config-block-desc">Depends on oplog tailing lag. Typically &lt;5 seconds under normal load. Worst case bounded by oplog window size.</div>
                                <div class="code-block">
                                    <span class="comment"># Oplog window requirements</span><br>
                                    <span class="keyword">Minimum recommended:</span> <span class="value">24 hours</span><br>
                                    <span class="keyword">Ideal for backup:</span> <span class="value">48+ hours</span><br>
                                    <span class="keyword">Check with:</span> <span class="string">rs.printReplicationInfo()</span><br>
                                </div>
                            </div>
                            <div class="config-block">
                                <div class="config-block-title">RTO (Recovery Time Objective)</div>
                                <div class="config-block-desc">Depends on dataset size and oplog volume. Automated restore provisions new cluster and streams data.</div>
                                <div class="code-block">
                                    <span class="comment"># Approximate restore times</span><br>
                                    <span class="keyword">10 GB dataset:</span> <span class="value">~5-10 minutes</span><br>
                                    <span class="keyword">100 GB dataset:</span> <span class="value">~30-60 minutes</span><br>
                                    <span class="keyword">1 TB dataset:</span> <span class="value">~2-6 hours</span><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Restore Options -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üîß</div>
                    <div>
                        <div class="expandable-title">Restore Options</div>
                        <div class="expandable-subtitle">Four distinct methods for different recovery scenarios</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <div class="info-card-title">üì• Download Snapshot</div>
                                <div class="info-card-text">Download a compressed .tar.gz archive of a snapshot. Manually restore using <code>mongorestore</code>. Best for: dev/test environments, selective data recovery.</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">üîÑ Automated Restore</div>
                                <div class="info-card-text">Ops Manager provisions target cluster and streams snapshot data. Fully automated. Handles replica set initialization and shard configuration. Best for: DR, cluster rebuild.</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">‚è±Ô∏è Point-in-Time Restore</div>
                                <div class="info-card-text">Restore to any specific second within the PIT window. Combines closest snapshot + oplog replay. Best for: accidental data deletion, corruption recovery.</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">üîç Queryable Backup</div>
                                <div class="info-card-text">Mount any snapshot as a read-only MongoDB instance. Query it like a regular database without full restore. Best for: auditing, data verification, selective retrieval.</div>
                            </div>
                        </div>

                        <div class="callout warning">
                            <div class="callout-icon">‚ö†Ô∏è</div>
                            <div class="callout-text"><strong>Queryable Backup:</strong> Exposes a temporary read-only mongod on a configured port. TLS and auth are required for production use. Snapshot is mounted read-only ‚Äî no writes possible. Automatically dismounts after configurable timeout.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Storage Backends -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üóÑÔ∏è</div>
                    <div>
                        <div class="expandable-title">Storage Backend Options</div>
                        <div class="expandable-subtitle">MongoDB RS, S3-compatible, or filesystem stores</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <table class="comp-table">
                            <thead><tr><th>Backend</th><th>Best For</th><th>Pros</th><th>Cons</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td class="feature-col">MongoDB Replica Set</td>
                                    <td>Default, most features</td>
                                    <td>Deduplication, queryable backup, fast restore</td>
                                    <td>Requires dedicated MongoDB infrastructure</td>
                                </tr>
                                <tr>
                                    <td class="feature-col">S3-Compatible</td>
                                    <td>Cloud, cost optimization</td>
                                    <td>Cheap storage, AWS S3 / GCS / MinIO, scalable</td>
                                    <td>No queryable backup, slower restore</td>
                                </tr>
                                <tr>
                                    <td class="feature-col">Filesystem (NFS/SAN)</td>
                                    <td>Air-gapped, on-prem</td>
                                    <td>Works with existing storage infra, no extra MongoDB needed</td>
                                    <td>No queryable backup, no dedup, manual capacity management</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 4: SECURITY & ENCRYPTION ==================== -->
        <div class="tab-panel" id="tab-security">
            <div class="section">
                <h2 class="section-heading">Security & Encryption</h2>
                <p class="section-sub">MongoDB Enterprise Advanced provides defense-in-depth security across authentication, authorization, encryption, and auditing.</p>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Security Layers <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">HOVER LAYERS TO FOCUS</span></div>
                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.03);">
                            <div class="network-layer-label" style="color: var(--red);">Network Security</div>
                            <div class="network-layer-content">
                                <div class="mini-node">üîí TLS/SSL (all connections)</div>
                                <div class="mini-node">üåê VPC / VPN / Private Link</div>
                                <div class="mini-node">üõ°Ô∏è IP Allowlists</div>
                                <div class="mini-node">üîó x.509 mutual TLS</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div></div>
                        <div class="network-layer" style="border-color: rgba(249, 115, 22, 0.3); background: rgba(249, 115, 22, 0.03);">
                            <div class="network-layer-label" style="color: var(--orange);">Authentication</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="SCRAM-SHA-256|Default auth mechanism. Salted Challenge Response. Supports SHA-1 (legacy) and SHA-256. Password stored as salted hash.|tags:Default,Password,Salted">üîê SCRAM-SHA-256</div>
                                <div class="mini-node" data-tip="LDAP Authentication|Bind against Active Directory or OpenLDAP. Supports simple bind and SASL. Can map LDAP groups to MongoDB roles for authorization.|tags:Active Directory,OpenLDAP,Bind">üìÇ LDAP (Active Directory)</div>
                                <div class="mini-node" data-tip="Kerberos|GSSAPI/SPNEGO authentication. Single sign-on with existing Kerberos infrastructure. Requires keytab file on mongod host.|tags:GSSAPI,SSO,Keytab">üé´ Kerberos (GSSAPI)</div>
                                <div class="mini-node" data-tip="x.509 Certificates|Client certificate authentication via mutual TLS. Certificate subject used as username. Also used for intra-cluster member auth.|tags:Mutual TLS,Certs,PKI">üìú x.509 Certificates</div>
                                <div class="mini-node" data-tip="AWS IAM|Atlas-only: Authenticate using AWS IAM roles. No password management. Supports EC2 instance roles and ECS task roles.|tags:Atlas,IAM Roles,Passwordless">üîë AWS IAM (Atlas)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div></div>
                        <div class="network-layer" style="border-color: rgba(234, 179, 8, 0.3); background: rgba(234, 179, 8, 0.03);">
                            <div class="network-layer-label" style="color: var(--yellow);">Authorization</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="RBAC|100+ built-in roles across read, readWrite, dbAdmin, userAdmin, clusterAdmin, backup, restore. Database-level and collection-level granularity.|tags:100+ Roles,Granular,Built-in">üë§ RBAC (100+ built-in roles)</div>
                                <div class="mini-node" data-tip="LDAP Group Mapping|Map LDAP/AD groups directly to MongoDB roles. Users inherit roles from their group membership. Centralized authorization management.|tags:AD Groups,Centralized,Auto">üìÇ LDAP Group ‚Üí Role Mapping</div>
                                <div class="mini-node" data-tip="Custom Roles|Define roles with specific privilege actions on specific resources (database.collection). Combine multiple privileges. Inherit from other roles.|tags:Custom,Collection-level,Inherit">üîß Custom Roles (collection-level)</div>
                                <div class="mini-node" data-tip="Privilege Actions|180+ granular actions: find, insert, update, remove, createCollection, createIndex, viewRole, killCursors, inprog, and more.|tags:180+ Actions,Fine-grained">üîç Privilege Actions (180+)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div></div>
                        <div class="network-layer" style="border-color: rgba(0, 237, 100, 0.3); background: rgba(0, 237, 100, 0.03);">
                            <div class="network-layer-label" style="color: var(--accent);">Encryption</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Encryption at Rest|WiredTiger native AES-256 encryption. All data files, indexes, journal, oplog encrypted. Master key from KMIP/KMS. Online key rotation.|tags:AES-256,WiredTiger,Online Rotation">üíΩ Encryption at Rest (WiredTiger)</div>
                                <div class="mini-node" data-tip="Key Management|External KMS integration: KMIP (Thales, Gemalto, HashiCorp Vault), AWS KMS, Azure Key Vault, GCP KMS. Master key never on disk.|tags:KMIP,AWS KMS,Azure,GCP">üîë KMIP / AWS KMS / Azure / GCP</div>
                                <div class="mini-node" data-tip="Client-Side FLE|Driver-side encryption before data reaches server. Deterministic (equality queries) or Randomized (no queries). Key vault collection stores DEKs.|tags:Driver-side,Deterministic,DEKs">üîê Client-Side FLE (CSFLE)</div>
                                <div class="mini-node" data-tip="Queryable Encryption|Query encrypted data without server decryption. Equality queries GA, range queries preview. Structured encryption with contention factor.|tags:Encrypted Queries,Equality,Range">üîç Queryable Encryption</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div></div>
                        <div class="network-layer" style="border-color: rgba(168, 85, 247, 0.3); background: rgba(168, 85, 247, 0.03);">
                            <div class="network-layer-label" style="color: var(--purple);">Auditing & Compliance</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Database Audit Log|Enterprise-only. Logs auth, CRUD, DDL, admin events. JSON or BSON format. File, syslog, or console destination.|tags:JSON,BSON,Enterprise">üìã Database Audit Log</div>
                                <div class="mini-node" data-tip="Audit Filters|Match expressions to select which events to audit. Filter by action type, database, collection, user. Reduces log volume.|tags:Selective,Performance">üîç Configurable Audit Filters</div>
                                <div class="mini-node" data-tip="FIPS 140-2|Federal Information Processing Standard. FIPS-validated OpenSSL module. Required for US government and regulated industries.|tags:Government,OpenSSL,Validated">üìú FIPS 140-2</div>
                                <div class="mini-node" data-tip="Compliance|MongoDB Atlas and EA certified for SOC2 Type II, HIPAA, PCI-DSS Level 1, ISO 27001, GDPR, FedRAMP, CSA STAR.|tags:SOC2,HIPAA,PCI,GDPR">üèõÔ∏è SOC2, HIPAA, PCI-DSS, GDPR</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Encryption at Rest -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üíΩ</div>
                    <div>
                        <div class="expandable-title">Encryption at Rest</div>
                        <div class="expandable-subtitle">WiredTiger native encryption with external key management</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Key Hierarchy</h4>
                        <button class="flow-play-btn" onclick="playFlowVertical(this)">‚ñ∂ Simulate Key Wrapping</button>
                        <div class="flow-diagram" data-flow-sim-v>
                            <div class="flow-step" style="border-color: rgba(239, 68, 68, 0.3);">
                                <div class="flow-step-num">1</div>
                                <div class="flow-step-title">Master Key</div>
                                <div class="flow-step-desc">Stored externally in KMIP server, AWS KMS, Azure Key Vault, or GCP KMS. Never stored on disk.</div>
                            </div>
                            <div class="flow-arrow">‚Üì wraps</div>
                            <div class="flow-step" style="border-color: rgba(249, 115, 22, 0.3);">
                                <div class="flow-step-num">2</div>
                                <div class="flow-step-title">Database Key</div>
                                <div class="flow-step-desc">Per-database encryption key. Encrypted (wrapped) by the Master Key. Stored on disk alongside data.</div>
                            </div>
                            <div class="flow-arrow">‚Üì encrypts</div>
                            <div class="flow-step" style="border-color: var(--border-accent);">
                                <div class="flow-step-num">3</div>
                                <div class="flow-step-title">Data Files</div>
                                <div class="flow-step-desc">WiredTiger data files, indexes, journal, oplog ‚Äî all encrypted with AES-256-CBC or AES-256-GCM.</div>
                            </div>
                        </div>

                        <div class="code-block">
                            <span class="comment"># mongod.conf ‚Äî Encryption at Rest with KMIP</span><br>
                            <span class="keyword">security:</span><br>
                            &nbsp;&nbsp;<span class="keyword">enableEncryption:</span> <span class="value">true</span><br>
                            &nbsp;&nbsp;<span class="keyword">kmip:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">serverName:</span> <span class="string">"kmip.example.com"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">port:</span> <span class="value">5696</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">clientCertificateFile:</span> <span class="string">"/etc/ssl/kmip-client.pem"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">serverCAFile:</span> <span class="string">"/etc/ssl/kmip-ca.pem"</span><br>
                            <br>
                            <span class="comment"># Alternative: AWS KMS</span><br>
                            <span class="keyword">security:</span><br>
                            &nbsp;&nbsp;<span class="keyword">enableEncryption:</span> <span class="value">true</span><br>
                            &nbsp;&nbsp;<span class="keyword">encryptionKeyFile:</span> <span class="string">""</span><br>
                            &nbsp;&nbsp;<span class="keyword">kmip:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">serverName:</span> <span class="string">"kms.us-east-1.amazonaws.com"</span><br>
                        </div>

                        <div class="callout success">
                            <div class="callout-icon">üîÑ</div>
                            <div class="callout-text"><strong>Key Rotation:</strong> Master key rotation is online (no downtime). Use <code>db.adminCommand({rotateMasterKey: 1})</code>. The old master key decrypts database keys, which are then re-encrypted with the new master key. Data files are NOT re-encrypted (only the wrapping changes).</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Encryption in Transit -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üîí</div>
                    <div>
                        <div class="expandable-title">Encryption in Transit (TLS/SSL)</div>
                        <div class="expandable-subtitle">All connections encrypted with TLS 1.2+</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <div class="info-card-title">Client ‚Üí mongod/mongos</div>
                                <div class="info-card-text">Application drivers connect over TLS. Certificate validation, hostname verification, and optional client cert auth (x.509 mutual TLS).</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">Member ‚Üí Member (Intra-cluster)</div>
                                <div class="info-card-text">Replica set members and shards communicate over TLS with internal auth using keyFile or x.509 member certificates.</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">Agent ‚Üí Ops Manager</div>
                                <div class="info-card-text">All agent communication to Ops Manager over HTTPS (port 8443). Agent validates Ops Manager's TLS certificate.</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">mongod ‚Üí KMIP Server</div>
                                <div class="info-card-text">Key management traffic encrypted with mutual TLS. Client certificate authenticates the mongod to the KMIP server.</div>
                            </div>
                        </div>

                        <div class="code-block">
                            <span class="comment"># mongod.conf ‚Äî TLS Configuration</span><br>
                            <span class="keyword">net:</span><br>
                            &nbsp;&nbsp;<span class="keyword">tls:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">mode:</span> <span class="value">requireTLS</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">certificateKeyFile:</span> <span class="string">"/etc/ssl/mongod.pem"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">CAFile:</span> <span class="string">"/etc/ssl/ca.pem"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">clusterFile:</span> <span class="string">"/etc/ssl/mongod-internal.pem"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">disabledProtocols:</span> <span class="value">TLS1_0,TLS1_1</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">allowConnectionsWithoutCertificates:</span> <span class="value">false</span><br>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CSFLE & Queryable Encryption -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üîê</div>
                    <div>
                        <div class="expandable-title">Client-Side Field Level Encryption (CSFLE) & Queryable Encryption</div>
                        <div class="expandable-subtitle">Encrypt sensitive fields before they leave the application</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <div class="two-col">
                            <div class="config-block">
                                <div class="config-block-title">CSFLE (Client-Side Field Level Encryption)</div>
                                <div class="config-block-desc">Fields encrypted/decrypted by the driver. Server never sees plaintext.</div>
                                <ul class="arch-box-list">
                                    <li><strong>Deterministic:</strong> Same input ‚Üí same ciphertext. Supports equality queries</li>
                                    <li><strong>Randomized:</strong> Same input ‚Üí different ciphertext each time. No query support but stronger security</li>
                                    <li><strong>Key vault:</strong> Collection storing Data Encryption Keys (DEKs), wrapped by a Customer Master Key (CMK)</li>
                                    <li><strong>CMK providers:</strong> AWS KMS, Azure Key Vault, GCP KMS, KMIP, Local (dev only)</li>
                                    <li><strong>Automatic mode:</strong> Schema map in driver config defines which fields to encrypt. Driver handles transparently</li>
                                    <li><strong>mongocryptd:</strong> Enterprise-only helper process for automatic encryption schema validation</li>
                                </ul>
                            </div>
                            <div class="config-block">
                                <div class="config-block-title">Queryable Encryption</div>
                                <div class="config-block-desc">Query encrypted data without the server ever decrypting it. Uses structured encryption.</div>
                                <ul class="arch-box-list">
                                    <li><strong>Equality queries:</strong> Find documents where encrypted field equals a value</li>
                                    <li><strong>Range queries:</strong> (Preview) Query encrypted numeric/date fields with $gt, $lt</li>
                                    <li><strong>Server-side:</strong> MongoDB stores encrypted index metadata. Queries evaluated on encrypted tokens</li>
                                    <li><strong>Contention factor:</strong> Configurable trade-off between query performance and information leakage</li>
                                    <li><strong>Compaction:</strong> Periodic metadata cleanup to reduce index overhead</li>
                                    <li><strong>Use cases:</strong> PII, SSN, medical records, financial data ‚Äî regulatory compliance</li>
                                </ul>
                            </div>
                        </div>

                        <button class="flow-play-btn" onclick="playFlow(this)">‚ñ∂ Simulate CSFLE Flow</button>
                        <div class="flow-horizontal" data-flow-sim>
                            <div class="flow-step">
                                <div class="flow-step-num">1</div>
                                <div class="flow-step-title">Application</div>
                                <div class="flow-step-desc">{ ssn: "123-45-6789" }</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-step" style="border-color: rgba(249, 115, 22, 0.3);">
                                <div class="flow-step-num">2</div>
                                <div class="flow-step-title">Driver + CMK</div>
                                <div class="flow-step-desc">Encrypts ssn field</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-step" style="border-color: rgba(168, 85, 247, 0.3);">
                                <div class="flow-step-num">3</div>
                                <div class="flow-step-title">MongoDB Server</div>
                                <div class="flow-step-desc">{ ssn: Binary("encrypted...") }</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-step" style="border-color: var(--border-accent);">
                                <div class="flow-step-num">4</div>
                                <div class="flow-step-title">On Disk</div>
                                <div class="flow-step-desc">Encrypted at field level<br>+ encrypted at rest</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Auditing -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üìã</div>
                    <div>
                        <div class="expandable-title">Audit Logging</div>
                        <div class="expandable-subtitle">Granular audit trail for compliance and forensics</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <div class="code-block">
                            <span class="comment"># mongod.conf ‚Äî Audit Configuration</span><br>
                            <span class="keyword">auditLog:</span><br>
                            &nbsp;&nbsp;<span class="param">destination:</span> <span class="value">file</span> <span class="comment"># file | syslog | console</span><br>
                            &nbsp;&nbsp;<span class="param">format:</span> <span class="value">JSON</span> <span class="comment"># JSON | BSON</span><br>
                            &nbsp;&nbsp;<span class="param">path:</span> <span class="string">"/var/log/mongodb/audit.json"</span><br>
                            &nbsp;&nbsp;<span class="param">filter:</span> <span class="string">'{ atype: { $in: ["authenticate", "createCollection", "dropCollection", "createUser", "dropUser", "insert", "update", "delete"] } }'</span><br>
                        </div>

                        <h4 style="color: var(--text-primary); margin: 1rem 0;">Auditable Events</h4>
                        <div class="info-grid">
                            <div class="info-card">
                                <div class="info-card-title">Auth Events</div>
                                <div class="info-card-text"><code>authenticate</code>, <code>authCheck</code>, <code>createUser</code>, <code>dropUser</code>, <code>grantRolesToUser</code>, <code>revokeRolesFromUser</code>, <code>updateUser</code></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">CRUD Events</div>
                                <div class="info-card-text"><code>insert</code>, <code>update</code>, <code>delete</code>, <code>find</code> ‚Äî with audit filter to select specific databases/collections</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">DDL Events</div>
                                <div class="info-card-text"><code>createCollection</code>, <code>dropCollection</code>, <code>createIndex</code>, <code>dropIndex</code>, <code>createDatabase</code>, <code>dropDatabase</code></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">Admin Events</div>
                                <div class="info-card-text"><code>replSetReconfig</code>, <code>enableSharding</code>, <code>addShard</code>, <code>shutdown</code>, <code>applicationMessage</code></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 5: MONITORING & LOGGING ==================== -->
        <div class="tab-panel" id="tab-monitoring">
            <div class="section">
                <h2 class="section-heading">Monitoring & Logging</h2>
                <p class="section-sub">Ops Manager provides deep monitoring of every MongoDB process with real-time dashboards, alerting, and log management.</p>
            </div>

            <div class="section">
                <h2 class="section-heading" style="font-size: 1.25rem;">Metrics Collected</h2>

                <div class="expandable open" onclick="toggleExpandable(this)">
                    <div class="expandable-header">
                        <div class="expandable-icon">üìä</div>
                        <div>
                            <div class="expandable-title">Server Metrics (from serverStatus)</div>
                            <div class="expandable-subtitle">100+ metrics collected per mongod/mongos process</div>
                        </div>
                        <div class="expandable-chevron">‚ñæ</div>
                    </div>
                    <div class="expandable-body">
                        <div class="expandable-content">
                            <div class="info-grid">
                                <div class="info-card">
                                    <div class="info-card-title">üîó Connections</div>
                                    <div class="info-card-text"><code>connections.current</code>, <code>connections.available</code>, <code>connections.totalCreated</code> ‚Äî Track connection pool usage, detect connection leaks or exhaustion.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üìù Operations</div>
                                    <div class="info-card-text"><code>opcounters.insert/query/update/delete/getmore/command</code> ‚Äî Per-second operation rates. Baseline for capacity planning.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üß† Memory</div>
                                    <div class="info-card-text"><code>mem.resident</code>, <code>mem.virtual</code>, <code>mem.mapped</code>, WiredTiger cache: <code>bytesCurrentlyInCache</code>, <code>bytesReadIntoCache</code>, <code>bytesWrittenFromCache</code>, cache eviction rates.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üîí Locks</div>
                                    <div class="info-card-text"><code>globalLock.activeClients.readers/writers</code>, <code>locks.Global/Database/Collection</code> ‚Äî Identify lock contention and concurrency bottlenecks.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üíæ WiredTiger</div>
                                    <div class="info-card-text">Checkpoint duration, cache utilization %, eviction rates, bytes written to journal, log sync latency, concurrent transactions (read/write tickets).</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üåê Network</div>
                                    <div class="info-card-text"><code>network.bytesIn/bytesOut</code>, <code>network.numRequests</code>, <code>network.compression.*.compressor</code> ‚Äî Network throughput and compression efficiency.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="expandable" onclick="toggleExpandable(this)">
                    <div class="expandable-header">
                        <div class="expandable-icon">üîÑ</div>
                        <div>
                            <div class="expandable-title">Replication Metrics</div>
                            <div class="expandable-subtitle">Lag, oplog window, member state tracking</div>
                        </div>
                        <div class="expandable-chevron">‚ñæ</div>
                    </div>
                    <div class="expandable-body">
                        <div class="expandable-content">
                            <div class="info-grid">
                                <div class="info-card">
                                    <div class="info-card-title">‚è±Ô∏è Replication Lag</div>
                                    <div class="info-card-text">Time difference between primary optime and each secondary's optime. Measured in seconds. Alert threshold: typically 10-60 seconds.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üìã Oplog Window</div>
                                    <div class="info-card-text">Time span of operations in the oplog. If a secondary falls behind more than this, it needs a full resync. Alert if &lt; 24 hours.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üîÄ Member State</div>
                                    <div class="info-card-text">PRIMARY, SECONDARY, ARBITER, RECOVERING, STARTUP2, DOWN, ROLLBACK. Track state transitions and election events.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üìä Replication Throughput</div>
                                    <div class="info-card-text">Oplog entries applied per second on secondaries. <code>replSetGetStatus.optimes</code>. Tracks how fast secondaries are catching up.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="expandable" onclick="toggleExpandable(this)">
                    <div class="expandable-header">
                        <div class="expandable-icon">üñ•Ô∏è</div>
                        <div>
                            <div class="expandable-title">Host Hardware Metrics</div>
                            <div class="expandable-subtitle">System-level metrics from the agent host</div>
                        </div>
                        <div class="expandable-chevron">‚ñæ</div>
                    </div>
                    <div class="expandable-body">
                        <div class="expandable-content">
                            <div class="info-grid">
                                <div class="info-card">
                                    <div class="info-card-title">‚ö° CPU</div>
                                    <div class="info-card-text">User %, system %, iowait %, idle %. Per-core breakdown. Normalized to mongod process CPU usage.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üíæ Disk</div>
                                    <div class="info-card-text">IOPS (read/write), throughput (MB/s), latency (ms/op), queue depth, disk utilization %, free space.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üß† System Memory</div>
                                    <div class="info-card-text">Total, free, cached, buffers, swap usage. Compare with WiredTiger cache to detect memory pressure.</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-title">üåê Network</div>
                                    <div class="info-card-text">Bytes in/out per interface, packet errors, dropped packets. Critical for replica set and sharded cluster health.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-heading" style="font-size: 1.25rem;">Metric Retention & Granularity</h2>
                <table class="comp-table">
                    <thead><tr><th>Time Range</th><th>Granularity</th><th>Retention</th></tr></thead>
                    <tbody>
                        <tr><td class="feature-col">Last 48 hours</td><td>1 minute</td><td>2 days</td></tr>
                        <tr><td class="feature-col">Last 7 days</td><td>5 minutes</td><td>7 days</td></tr>
                        <tr><td class="feature-col">Last 90 days</td><td>1 hour</td><td>90 days</td></tr>
                        <tr><td class="feature-col">Last 2 years</td><td>1 day</td><td>730 days</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2 class="section-heading" style="font-size: 1.25rem;">Logging Architecture</h2>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-card-title">üìÑ MongoDB Server Logs</div>
                        <div class="info-card-text">
                            Structured JSON logs (since 4.4). Components: ACCESS, COMMAND, CONTROL, ELECTION, GEO, INDEX, NETWORK, QUERY, REPL, SHARDING, STORAGE, WRITE.<br><br>
                            Configurable verbosity per component (0-5). Slow query logging via profiler or <code>slowOpThresholdMs</code> (default 100ms).
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">ü§ñ Agent Logs</div>
                        <div class="info-card-text">
                            <code>/var/log/mongodb-mms-automation/</code><br><br>
                            <strong>automation-agent.log</strong> ‚Äî Goal state changes, process starts/stops, config changes.<br>
                            <strong>monitoring-agent.log</strong> ‚Äî Metric collection events, connection issues.<br>
                            <strong>backup-agent.log</strong> ‚Äî Oplog tailing status, sync progress.
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üñ•Ô∏è Ops Manager Logs</div>
                        <div class="info-card-text">
                            <code>/opt/mongodb/mms/logs/</code><br><br>
                            <strong>mms0.log</strong> ‚Äî Application server logs (HTTP requests, API calls).<br>
                            <strong>daemon.log</strong> ‚Äî Backup daemon operations.<br>
                            <strong>mms0-audit.log</strong> ‚Äî Ops Manager user actions audit.
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üîó External Integration</div>
                        <div class="info-card-text">
                            Forward logs to external systems via:<br><br>
                            <strong>Syslog:</strong> <code>systemLog.destination: syslog</code><br>
                            <strong>File ‚Üí Fluentd/Logstash:</strong> Ship JSON logs to ELK/Splunk<br>
                            <strong>SNMP:</strong> Enterprise SNMP traps for integration with Nagios, Zabbix
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 6: HA ARCHITECTURE ==================== -->
        <div class="tab-panel" id="tab-ha">

            <!-- Unified HA Introduction -->
            <div class="section">
                <h2 class="section-heading">High Availability ‚Äî From Nodes to Datacenters</h2>
                <p class="section-sub">MongoDB EA HA isn't a single feature ‚Äî it's a layered defense. Each level protects against a broader class of failure, and they all build on the same replica set foundation. A production deployment should address <strong>every</strong> level.</p>

                <div class="info-grid" style="grid-template-columns: repeat(4, 1fr); margin-top: 1.5rem;">
                    <div class="info-card" style="border-left: 3px solid var(--accent);">
                        <div class="info-card-title">Level 1 ‚Äî Process</div>
                        <div class="info-card-text">A single <code>mongod</code> crashes, runs OOM, or is killed. Replica set auto-elects a new primary in ~5-10s. Zero data loss with journaling.</div>
                    </div>
                    <div class="info-card" style="border-left: 3px solid var(--blue);">
                        <div class="info-card-title">Level 2 ‚Äî Host / Rack</div>
                        <div class="info-card-text">A physical server dies or a rack loses power. Members in other racks/AZs elect a new primary. Spread members across failure domains within a DC.</div>
                    </div>
                    <div class="info-card" style="border-left: 3px solid var(--purple);">
                        <div class="info-card-title">Level 3 ‚Äî Datacenter</div>
                        <div class="info-card-text">An entire DC goes offline ‚Äî network, power, or disaster. Replica set members in surviving DCs elect a new primary. Requires members distributed across DCs.</div>
                    </div>
                    <div class="info-card" style="border-left: 3px solid var(--orange);">
                        <div class="info-card-title">Level 4 ‚Äî Region / Global</div>
                        <div class="info-card-text">A region-wide outage or you need zero write-latency in each region. Zone sharding pins data locally; mongosync enables standby clusters for manual failover.</div>
                    </div>
                </div>

                <div class="callout info" style="margin-top: 1.5rem;">
                    <div class="callout-icon">üí°</div>
                    <div class="callout-text">The same <code>rs.initiate()</code> and <code>w: "majority"</code> mechanics work identically whether members are on the same rack or spread across continents. MongoDB does not distinguish between "local HA" and "geo HA" ‚Äî it's all replica set replication. The only things that change are <strong>network latency</strong>, <strong>member placement</strong>, and <strong>election configuration</strong>.</div>
                </div>
            </div>

            <!-- Component HA Matrix -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Component HA Matrix</h2>
                <p class="section-sub">Every component in the EA stack must be resilient. Here's the HA strategy for each, applicable whether running in a single DC or across multiple.</p>

                <table class="comp-table">
                    <thead><tr><th>Component</th><th>HA Strategy</th><th>Min Nodes</th><th>Failover</th></tr></thead>
                    <tbody>
                        <tr>
                            <td class="feature-col">Managed MongoDB RS</td>
                            <td>3+ member replica set. Spread across AZs (single DC) or DCs (multi-DC).</td>
                            <td>3 (5 for multi-DC)</td>
                            <td>Automatic election, ~5-10s within DC, ~10-30s cross-DC.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">Ops Manager App Server</td>
                            <td>2+ instances behind L7 load balancer (sticky sessions). Can span DCs.</td>
                            <td>2</td>
                            <td>LB routes to healthy instance. 0 downtime.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">Application Database</td>
                            <td>Standard MongoDB RS. Should span DCs in multi-DC deployments.</td>
                            <td>3</td>
                            <td>Automatic election. ~5-10s single DC, ~10-30s cross-DC.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">Backup Daemon</td>
                            <td>Active-passive across Ops Manager instances.</td>
                            <td>2 (OM servers)</td>
                            <td>Auto failover to another OM instance. 1-2 min.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">Blockstore / Oplog Store</td>
                            <td>MongoDB RS(s). Multiple stores for load. Should span DCs for DR.</td>
                            <td>3 per RS</td>
                            <td>RS automatic election. Multiple stores for distribution.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">MongoDB Agent</td>
                            <td>Systemd auto-restart. Ops Manager alerts on disconnect.</td>
                            <td>1 per host</td>
                            <td>Agent down = no new automation. Running processes unaffected.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">mongos (Sharded)</td>
                            <td>Stateless. Multiple instances behind app-level LB.</td>
                            <td>2+</td>
                            <td>Driver reconnects to available mongos. No state to lose.</td>
                        </tr>
                        <tr>
                            <td class="feature-col">Config Servers</td>
                            <td>3-member RS (CSRS). Spread across DCs for sharded multi-DC.</td>
                            <td>3</td>
                            <td>Automatic election. Cluster read-only if primary lost during metadata ops.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Production Deployment Topology -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Production Deployment Topology</h2>
                <p class="section-sub">Whether running in one datacenter or three, the stack is the same ‚Äî only the member placement changes.</p>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Single-DC Production Topology <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">HOVER LAYERS TO FOCUS</span></div>

                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer client">
                            <div class="network-layer-label">Load Balancer (L7, sticky sessions)</div>
                            <div class="network-layer-content">
                                <div class="mini-node">üåê HAProxy / Nginx / AWS ALB / F5</div>
                                <div class="mini-node">üîí TLS termination or passthrough</div>
                                <div class="mini-node">‚ù§Ô∏è Health check: GET /user/login (HTTP 200)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Round Robin</div></div>
                        <div class="network-layer app">
                            <div class="network-layer-label">Ops Manager Application Servers (2+)</div>
                            <div class="network-layer-content">
                                <div class="mini-node">üñ•Ô∏è OM Server 1 (HTTP + Backup Daemon ACTIVE)</div>
                                <div class="mini-node">üñ•Ô∏è OM Server 2 (HTTP + Backup Daemon STANDBY)</div>
                                <div class="mini-node">üñ•Ô∏è OM Server 3 (HTTP + Backup Daemon STANDBY)</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Wire Protocol</div></div>
                        <div class="network-layer data">
                            <div class="network-layer-label">Backing Databases (All Replica Sets ‚Äî spread across AZs/racks)</div>
                            <div class="network-layer-content">
                                <div class="mini-node"><span class="mini-node-dot primary"></span> App DB: P + S + S (3 nodes)</div>
                                <div class="mini-node"><span class="mini-node-dot secondary"></span> Blockstore 1: P + S + S</div>
                                <div class="mini-node"><span class="mini-node-dot secondary"></span> Blockstore 2: P + S + S (optional)</div>
                                <div class="mini-node"><span class="mini-node-dot secondary"></span> Oplog Store: P + S + S</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">HTTPS Outbound</div></div>
                        <div class="network-layer infra">
                            <div class="network-layer-label">Managed MongoDB Infrastructure</div>
                            <div class="network-layer-content">
                                <div class="mini-node">ü§ñ Agent on every host (auto-restart via systemd)</div>
                                <div class="mini-node">üì¶ MongoDB RS / Sharded ‚Äî members across AZs or racks</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="callout warning">
                    <div class="callout-icon">‚ö†Ô∏è</div>
                    <div class="callout-text"><strong>Critical:</strong> The Ops Manager Application Database should <strong>never</strong> be managed by Ops Manager itself. Deploy it independently on separate hardware with its own backup strategy (e.g., filesystem snapshots or mongodump cron).</div>
                </div>

                <div class="callout info">
                    <div class="callout-icon">üí°</div>
                    <div class="callout-text"><strong>Backup Daemon HA:</strong> Only one Backup Daemon is active at any time. If the active OM node goes down, another instance automatically takes over within 1-2 minutes. Head DB files must be on shared storage (NFS/SAN) or the new daemon rebuilds from the blockstore.</div>
                </div>

                <p class="section-sub" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-subtle); font-weight: 500; color: var(--text-primary);">The topology above protects against <strong>node and rack failures</strong> within a single DC. But what happens if the entire datacenter goes down? The same replica set just needs its members placed across DCs.</p>
            </div>

            <!-- Scaling to Multi-DC -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Extending to Multi-DC: Same Replica Set, Wider Placement</h2>
                <p class="section-sub">There is no separate "multi-DC mode." You take the same replica set and distribute members across datacenters. Elections, replication, and write concerns all work identically ‚Äî the only difference is network latency between members.</p>

                <div class="arch-diagram">
                    <div class="arch-diagram-title">Multi-DC Replica Set ‚Äî 5 Members Across 3 Datacenters <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">CLICK NODES FOR DETAILS</span></div>
                    <div class="network-layers" data-interactive-layers>
                        <div class="network-layer" style="border-color: rgba(59, 130, 246, 0.3); background: rgba(59, 130, 246, 0.03);">
                            <div class="network-layer-label" style="color: var(--blue);">Datacenter A ‚Äî Primary Region (e.g., us-east-1)</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Primary Node|Handles all writes. Located in the primary DC for lowest write latency. Priority set highest to prefer this DC for elections.|tags:Writes,Priority:10,Low Latency"><span class="mini-node-dot primary"></span> P (Primary) ‚Äî Priority: 10</div>
                                <div class="mini-node" data-tip="Secondary (local)|Provides local read capacity and election vote in the primary DC. Same-DC replication (~1ms lag).|tags:Reads,Vote,~1ms lag"><span class="mini-node-dot secondary"></span> S1 (Secondary) ‚Äî Priority: 8</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Oplog Replication (~5-50ms cross-DC)</div></div>
                        <div class="network-layer" style="border-color: rgba(0, 237, 100, 0.3); background: rgba(0, 237, 100, 0.03);">
                            <div class="network-layer-label" style="color: var(--accent);">Datacenter B ‚Äî Secondary Region (e.g., us-west-2)</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Secondary (remote DC)|Provides DR capability and local reads in DC-B. Replication lag = network latency + apply time (typically 5-50ms).|tags:DR,Local Reads,5-50ms lag"><span class="mini-node-dot secondary"></span> S2 (Secondary) ‚Äî Priority: 6</div>
                                <div class="mini-node" data-tip="Secondary (remote DC)|Second member in DC-B for local read scaling and additional vote. Ensures DC-B can participate in majority even if one member is down.|tags:Read Scale,Vote,Redundancy"><span class="mini-node-dot secondary"></span> S3 (Secondary) ‚Äî Priority: 6</div>
                            </div>
                        </div>
                        <div class="layer-connector"><div class="layer-connector-line"><div class="layer-connector-dot"></div><div class="layer-connector-dot"></div></div><div class="layer-connector-label">Heartbeat / Vote (~10-100ms)</div></div>
                        <div class="network-layer" style="border-color: rgba(234, 179, 8, 0.3); background: rgba(234, 179, 8, 0.03);">
                            <div class="network-layer-label" style="color: var(--yellow);">Datacenter C ‚Äî Tiebreaker (e.g., eu-west-1)</div>
                            <div class="network-layer-content">
                                <div class="mini-node" data-tip="Tiebreaker Node|Critical for avoiding split-brain during DC failure. Can be data-bearing (preferred) or arbiter. Ensures odd number of votes across 3 fault domains.|tags:Vote,Anti-split-brain,3rd Fault Domain"><span class="mini-node-dot arbiter"></span> S4 or Arbiter ‚Äî Priority: 0 (never primary)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="callout info">
                    <div class="callout-icon">üí°</div>
                    <div class="callout-text"><strong>Why 3 fault domains?</strong> With only 2 DCs and a 2+3 member split, losing the 3-member DC means the remaining 2 members cannot form a majority (2 of 5). The cluster becomes read-only. A 3rd DC tiebreaker ensures any single DC failure always leaves a majority ‚Äî enabling automatic failover with zero data loss.</div>
                </div>

                <div class="info-grid" style="margin-top: 1.5rem;">
                    <div class="info-card">
                        <div class="info-card-title">‚è±Ô∏è Election Timing</div>
                        <div class="info-card-text">Default <code>electionTimeoutMillis: 10000</code> (10s). In cross-DC setups, increase to 15-30s to avoid spurious elections from transient network blips between DCs.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üè∑Ô∏è Priority-Based DC Preference</div>
                        <div class="info-card-text">Set higher priority for members in the preferred primary DC (<code>priority: 10</code>). Lower priority for remote DCs (<code>priority: 6</code>). Highest priority + most current oplog wins elections.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üîÄ Network Partition Handling</div>
                        <div class="info-card-text">If DC-A partitions from DC-B+C: the 3-member side forms a majority and elects a new primary. DC-A members step down (no majority). On heal, they rejoin and rollback any uncommitted <code>w:1</code> writes.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üìä Rollback Protection</div>
                        <div class="info-card-text"><code>w: "majority"</code> ensures writes replicate across DCs before ack. These survive any single DC failure with zero rollback. Only <code>w:1</code> writes that haven't replicated will be rolled back.</div>
                    </div>
                </div>
            </div>

            <!-- What Happens When a DC Fails -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">What Happens When a Datacenter Fails</h2>
                <p class="section-sub">The election process is the same whether one node crashes or an entire DC goes dark. The only difference is how many members are lost at once.</p>

                <div class="flow-diagram" data-flow-sim-v>
                    <button class="flow-play-btn" onclick="playFlowVertical(this)">‚ñ∂ Simulate DC-A Failure</button>

                    <div class="flow-step">
                        <div class="flow-step-num">1</div>
                        <div class="flow-step-title">DC-A Goes Offline</div>
                        <div class="flow-step-desc">DC-A loses connectivity ‚Äî Primary (P) and Secondary (S1) become unreachable simultaneously. In-flight writes to the primary are interrupted.</div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="flow-step-num">2</div>
                        <div class="flow-step-title">Heartbeat Timeout (10s)</div>
                        <div class="flow-step-desc">S2, S3 (DC-B) and S4 (DC-C) stop receiving heartbeats from P and S1. After <code>electionTimeoutMillis</code> (10s default), secondaries detect the primary is unreachable ‚Äî same mechanism as a single node failure.</div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="flow-step-num">3</div>
                        <div class="flow-step-title">Majority Check: 3 of 5 Alive</div>
                        <div class="flow-step-desc">Surviving members: S2 + S3 + S4 = 3 of 5 votes. This is a majority. S2 (highest priority among survivors, most current oplog) calls an election.</div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="flow-step-num">4</div>
                        <div class="flow-step-title">S2 Elected Primary in DC-B (~10-15s total)</div>
                        <div class="flow-step-desc">S3 and S4 vote for S2. Election completes. S2 is the new primary, now accepting writes in DC-B. S3 continues as secondary. S4 remains tiebreaker.</div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="flow-step-num">5</div>
                        <div class="flow-step-title">Drivers Reconnect Automatically</div>
                        <div class="flow-step-desc">MongoDB drivers detect the topology change via SDAM (Server Discovery & Monitoring). Writes redirect to S2. Reads with <code>nearest</code> preference already target the local DC. Applications resume within ~1-3s after election.</div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="flow-step-num">6</div>
                        <div class="flow-step-title">DC-A Recovers & Rejoins</div>
                        <div class="flow-step-desc">When DC-A comes back, P and S1 contact S2 (new primary). P steps down to secondary. Any <code>w:1</code> writes not replicated before the failure are rolled back to a file. All <code>w:majority</code> writes are intact ‚Äî they were acknowledged across DCs before the failure.</div>
                    </div>
                </div>
            </div>

            <!-- Write Concern & Read Preference ‚Äî The Knobs That Matter -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Write Concern & Read Preference ‚Äî The Knobs That Control Durability vs Latency</h2>
                <p class="section-sub">These settings work the same in single-DC and multi-DC. The difference is that in multi-DC, <code>w: "majority"</code> must wait for cross-DC replication ‚Äî adding network latency to every acknowledged write.</p>

                <table class="comp-table">
                    <thead><tr><th>Write Concern</th><th>Single-DC Latency</th><th>Multi-DC Latency</th><th>Durability on DC Failure</th></tr></thead>
                    <tbody>
                        <tr>
                            <td class="feature-col"><code>w: 1</code></td>
                            <td>~1ms (local ack)</td>
                            <td>~1ms (local ack)</td>
                            <td class="partial">‚ö† May lose writes if primary DC fails before replication</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>w: "majority"</code></td>
                            <td>~2-5ms (local RS)</td>
                            <td>~50-100ms (cross-DC round-trip)</td>
                            <td class="check">‚úì Zero data loss ‚Äî survives any single DC failure</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>w: "majority", j: true</code></td>
                            <td>~5-10ms</td>
                            <td>~50-150ms</td>
                            <td class="check">‚úì Maximum ‚Äî survives simultaneous power loss at any DC</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>w: 3</code> (numeric)</td>
                            <td>~2-5ms</td>
                            <td>Variable</td>
                            <td class="check">‚úì 3 copies, but may not guarantee cross-DC spread</td>
                        </tr>
                    </tbody>
                </table>

                <table class="comp-table" style="margin-top: 1.5rem;">
                    <thead><tr><th>Read Preference</th><th>Behavior</th><th>Best For</th></tr></thead>
                    <tbody>
                        <tr>
                            <td class="feature-col"><code>primary</code></td>
                            <td>Always reads from primary. Cross-DC latency if app is in a different DC.</td>
                            <td>Strong consistency required</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>primaryPreferred</code></td>
                            <td>Primary if available; secondary during failover.</td>
                            <td>Prefer consistency, tolerate stale during failover</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>nearest</code></td>
                            <td>Lowest-latency member. Always reads from local DC if a member exists there.</td>
                            <td class="check">‚úì Recommended for multi-DC ‚Äî local reads everywhere</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>nearest</code> + <code>tag_sets</code></td>
                            <td>Nearest member matching tags (e.g., <code>dc: "us-west"</code>).</td>
                            <td>Explicit DC-aware routing, data locality</td>
                        </tr>
                        <tr>
                            <td class="feature-col"><code>secondary</code></td>
                            <td>Only secondaries. Can target local DC secondary for analytics.</td>
                            <td>Offload reads from primary for reporting</td>
                        </tr>
                    </tbody>
                </table>

                <div class="callout warning" style="margin-top: 1.5rem;">
                    <div class="callout-icon">‚ö†Ô∏è</div>
                    <div class="callout-text"><strong>The latency trade-off:</strong> In a multi-DC RS with 50ms cross-DC latency, <code>w: "majority"</code> adds ~50-100ms to every write. For latency-sensitive workloads, you have three options: (1) Accept <code>w:1</code> with some RPO risk, (2) Use an Active-Standby pattern with mongosync, or (3) Use Zone Sharding to keep writes local.</div>
                </div>
            </div>

            <!-- Topology Patterns ‚Äî When 3 DCs Aren't Available -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Alternative Multi-DC Patterns</h2>
                <p class="section-sub">A 3-DC replica set is ideal but not always possible. Here are the alternatives and their trade-offs.</p>

                <div class="expandable" onclick="toggleExpandable(this)">
                    <div class="expandable-header">
                        <div class="expandable-icon">üîó</div>
                        <div>
                            <div class="expandable-title">Active-Standby with mongosync (Cluster-to-Cluster Sync)</div>
                            <div class="expandable-subtitle">Two independent clusters, one active, one standby. Works with only 2 DCs. Manual failover.</div>
                        </div>
                        <div class="expandable-chevron">‚ñæ</div>
                    </div>
                    <div class="expandable-body">
                        <div class="expandable-content">
                            <div class="two-col">
                                <div class="config-block">
                                    <div class="config-block-title">Architecture</div>
                                    <ul class="arch-box-list">
                                        <li><strong>Cluster A (Active):</strong> Full 3-node RS in DC-A. All reads & writes</li>
                                        <li><strong>Cluster B (Standby):</strong> Independent 3-node RS in DC-B. Receives changes via <code>mongosync</code></li>
                                        <li><strong>mongosync:</strong> Continuous replication via change streams. Handles initial sync + tailing</li>
                                        <li><strong>Failover:</strong> Manual ‚Äî reverse mongosync direction or promote Cluster B</li>
                                    </ul>
                                </div>
                                <div class="config-block">
                                    <div class="config-block-title">Trade-offs</div>
                                    <ul class="arch-box-list">
                                        <li><strong>RPO:</strong> Seconds to minutes (async)</li>
                                        <li><strong>RTO:</strong> Minutes (manual failover + DNS switch)</li>
                                        <li><strong>Pro:</strong> Zero cross-DC latency on writes. Full local performance</li>
                                        <li><strong>Pro:</strong> Works with only 2 DCs</li>
                                        <li><strong>Con:</strong> Not automatic. Potential data loss</li>
                                        <li><strong>Use case:</strong> On-prem with 2 DCs, or cross-DC latency too high for <code>w:majority</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="expandable" onclick="toggleExpandable(this)">
                    <div class="expandable-header">
                        <div class="expandable-icon">üì¶</div>
                        <div>
                            <div class="expandable-title">Zone Sharding ‚Äî Data Locality Across Regions</div>
                            <div class="expandable-subtitle">Pin data to specific DCs for sovereignty and local writes while maintaining global distribution.</div>
                        </div>
                        <div class="expandable-chevron">‚ñæ</div>
                    </div>
                    <div class="expandable-body">
                        <div class="expandable-content">
                            <div class="config-block">
                                <div class="config-block-title">How It Works</div>
                                <ul class="arch-box-list">
                                    <li><strong>Zones:</strong> Tag shards with zone names ("US", "EU", "APAC"). Each zone maps to a DC/region</li>
                                    <li><strong>Zone ranges:</strong> Map shard key ranges to zones. Data for US users stays on US shards</li>
                                    <li><strong>Balancer:</strong> Automatically migrates chunks to the correct zone. Sovereignty enforced at DB level</li>
                                    <li><strong>Local reads:</strong> App connects to local mongos ‚Üí reads from local shard (sub-ms)</li>
                                    <li><strong>Global queries:</strong> Scatter-gather if query doesn't include the shard key/zone field</li>
                                </ul>
                            </div>
                            <div class="code-block">
                                <span class="comment"># Tag shards to zones</span><br>
                                <span class="keyword">sh.addShardTag</span>(<span class="string">"shard-us-1"</span>, <span class="string">"US"</span>)<br>
                                <span class="keyword">sh.addShardTag</span>(<span class="string">"shard-eu-1"</span>, <span class="string">"EU"</span>)<br>
                                <span class="keyword">sh.addShardTag</span>(<span class="string">"shard-ap-1"</span>, <span class="string">"APAC"</span>)<br><br>
                                <span class="comment"># Pin data ranges to zones</span><br>
                                <span class="keyword">sh.addTagRange</span>(<span class="string">"mydb.users"</span>,<br>
                                &nbsp;&nbsp;{ <span class="param">region</span>: <span class="string">"US"</span> },<br>
                                &nbsp;&nbsp;{ <span class="param">region</span>: <span class="string">"US\uffff"</span> },<br>
                                &nbsp;&nbsp;<span class="string">"US"</span>)<br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Making Everything Multi-DC -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.375rem;">Making the Entire Stack Multi-DC</h2>
                <p class="section-sub">It's not just the data clusters ‚Äî every supporting component should also span DCs for true datacenter-level resilience.</p>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-card-title">üñ•Ô∏è Ops Manager App Servers</div>
                        <div class="info-card-text">Deploy 2+ OM instances across DCs behind a global load balancer (AWS Global Accelerator, Cloudflare, F5 GTM). If the primary DC's OM fails, the LB routes agents and users to the surviving DC's OM.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üóÑÔ∏è Ops Manager App DB</div>
                        <div class="info-card-text">The Application Database RS should span DCs ‚Äî same as managed clusters. Use <code>w: "majority"</code> so OM metadata survives a DC failure.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">üíæ Backup Stores</div>
                        <div class="info-card-text">Blockstore and Oplog Store RS should span DCs too. Or use S3/GCS with cross-region replication. Backup data must survive a DC failure independently.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">ü§ñ Agent Connectivity</div>
                        <div class="info-card-text">Agents connect to OM via HTTPS. Configure <code>mmsBaseUrl</code> to a global LB endpoint so agents automatically reach whichever OM instance is healthy, regardless of which DC it's in.</div>
                    </div>
                </div>
            </div>

        </div>

        <!-- ==================== TAB 7: DEPLOYMENT MODELS ==================== -->
        <div class="tab-panel" id="tab-deployment">
            <div class="section">
                <h2 class="section-heading">Deployment Models</h2>
                <p class="section-sub">MongoDB Enterprise Advanced supports both traditional bare metal/VM deployments and modern Kubernetes-native deployments via the Enterprise Operator.</p>
            </div>

            <div class="section">
                <h2 class="section-heading" style="font-size: 1.25rem;">Comparison: Kubernetes vs Bare Metal / VM</h2>

                <table class="comp-table">
                    <thead><tr><th>Aspect</th><th>Bare Metal / VM</th><th>Kubernetes</th></tr></thead>
                    <tbody>
                        <tr><td class="feature-col">Deployment</td><td>RPM/DEB packages, manual or Ansible/Terraform</td><td>Enterprise Operator + CRDs (kubectl apply)</td></tr>
                        <tr><td class="feature-col">Process Lifecycle</td><td>Automation Agent manages mongod processes</td><td>Operator manages StatefulSets ‚Üí Pods ‚Üí mongod</td></tr>
                        <tr><td class="feature-col">Storage</td><td>Local SSD, SAN, NAS ‚Äî full control</td><td>PersistentVolumeClaims (PVC) ‚Äî StorageClass dependent</td></tr>
                        <tr><td class="feature-col">Networking</td><td>Static IPs, DNS, direct port access</td><td>Kubernetes Services, Headless Services, optional Ingress/LoadBalancer</td></tr>
                        <tr><td class="feature-col">Scaling</td><td>Provision new VMs, install agent, add to topology</td><td><code>kubectl patch</code> to change replica count. Operator handles the rest</td></tr>
                        <tr><td class="feature-col">Upgrades</td><td>Ops Manager rolling upgrade via Automation Agent</td><td>Operator performs rolling update of StatefulSet pods</td></tr>
                        <tr><td class="feature-col">HA / Anti-affinity</td><td>Manual rack/AZ placement</td><td>Pod anti-affinity rules, topology spread constraints</td></tr>
                        <tr><td class="feature-col">Resource Isolation</td><td>Dedicated hardware, cgroups</td><td>Resource limits/requests, QoS classes, node selectors</td></tr>
                        <tr><td class="feature-col">TLS/Cert Management</td><td>Manual cert deployment or Vault integration</td><td>cert-manager integration, automatic rotation</td></tr>
                        <tr><td class="feature-col">Monitoring</td><td>Ops Manager Agent (native)</td><td>Ops Manager Agent in sidecar + Prometheus endpoints</td></tr>
                        <tr><td class="feature-col">Backup</td><td>Ops Manager Backup Agent (native)</td><td>Ops Manager Backup Agent in sidecar</td></tr>
                        <tr><td class="feature-col">Ops Manager itself</td><td>Installed on dedicated VMs</td><td>Can run in K8s via MongoDBOpsManager CRD</td></tr>
                        <tr><td class="feature-col">Best For</td><td>Max control, air-gapped, regulatory, legacy infra</td><td>Cloud-native, GitOps, auto-scaling, dev/staging</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Bare Metal -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">üñß</div>
                    <div>
                        <div class="expandable-title">Bare Metal / VM Deployment</div>
                        <div class="expandable-subtitle">Traditional deployment with full infrastructure control</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Deployment Steps</h4>
                        <button class="flow-play-btn" onclick="playFlowVertical(this)">‚ñ∂ Simulate Deployment</button>
                        <div class="flow-diagram" data-flow-sim-v>
                            <div class="flow-step" style="border-color: rgba(59, 130, 246, 0.3);">
                                <div class="flow-step-num">1</div>
                                <div class="flow-step-title">Provision Infrastructure</div>
                                <div class="flow-step-desc">Allocate VMs/bare metal for: Ops Manager (2+), App DB (3), Blockstore (3), Oplog Store (3), Managed hosts (N)</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">2</div>
                                <div class="flow-step-title">Install Ops Manager</div>
                                <div class="flow-step-desc">RPM/DEB package. Configure gen.key, mms.conf. Point to Application DB connection string</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">3</div>
                                <div class="flow-step-title">Configure Backup Stores</div>
                                <div class="flow-step-desc">Via Ops Manager UI: add Blockstore RS, Oplog Store RS, or S3 backend. Set retention policies</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">4</div>
                                <div class="flow-step-title">Install Agents on Managed Hosts</div>
                                <div class="flow-step-desc">Download agent from Ops Manager. Install via RPM/DEB. Agent auto-registers with Ops Manager</div>
                            </div>
                            <div class="flow-arrow">‚Üì</div>
                            <div class="flow-step">
                                <div class="flow-step-num">5</div>
                                <div class="flow-step-title">Deploy MongoDB Clusters</div>
                                <div class="flow-step-desc">Via Ops Manager UI or API: define topology, agents converge to deploy RS/sharded clusters</div>
                            </div>
                        </div>

                        <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Hardware Recommendations</h4>
                        <table class="comp-table">
                            <thead><tr><th>Component</th><th>CPU</th><th>RAM</th><th>Storage</th><th>Network</th></tr></thead>
                            <tbody>
                                <tr><td class="feature-col">Ops Manager Server</td><td>8+ cores</td><td>16+ GB</td><td>100 GB SSD</td><td>1 Gbps+</td></tr>
                                <tr><td class="feature-col">Application DB node</td><td>4+ cores</td><td>16+ GB</td><td>SSD, sized by metadata</td><td>1 Gbps+</td></tr>
                                <tr><td class="feature-col">Blockstore node</td><td>4+ cores</td><td>16+ GB</td><td>SSD, 2-3x total backup data</td><td>10 Gbps</td></tr>
                                <tr><td class="feature-col">Oplog Store node</td><td>4+ cores</td><td>8+ GB</td><td>SSD, ~10-20% of blockstore</td><td>1 Gbps+</td></tr>
                                <tr><td class="feature-col">Managed mongod host</td><td>Per workload</td><td>Per workload</td><td>SSD/NVMe recommended</td><td>10 Gbps</td></tr>
                            </tbody>
                        </table>

                        <div class="code-block">
                            <span class="comment"># /opt/mongodb/mms/conf/conf-mms.properties (key settings)</span><br>
                            <span class="param">mongo.mongoUri</span>=<span class="string">mongodb://appdb1:27017,appdb2:27017,appdb3:27017/?replicaSet=appdbRS</span><br>
                            <span class="param">mms.centralUrl</span>=<span class="string">https://opsmanager.example.com:8443</span><br>
                            <span class="param">mms.fromEmailAddr</span>=<span class="string">ops-manager@example.com</span><br>
                            <span class="param">mms.adminEmailAddr</span>=<span class="string">admin@example.com</span><br>
                            <span class="param">mms.mail.transport</span>=<span class="string">smtp</span><br>
                            <span class="param">mms.mail.hostname</span>=<span class="string">smtp.example.com</span><br>
                            <span class="param">mms.mail.port</span>=<span class="value">587</span><br>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kubernetes -->
            <div class="expandable" onclick="toggleExpandable(this)">
                <div class="expandable-header">
                    <div class="expandable-icon">‚ò∏Ô∏è</div>
                    <div>
                        <div class="expandable-title">Kubernetes Deployment</div>
                        <div class="expandable-subtitle">Cloud-native deployment with MongoDB Enterprise Kubernetes Operator</div>
                    </div>
                    <div class="expandable-chevron">‚ñæ</div>
                </div>
                <div class="expandable-body">
                    <div class="expandable-content">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Operator Architecture</h4>

                        <div class="arch-diagram" style="margin-bottom: 1.5rem;">
                            <div class="arch-diagram-title">Kubernetes Operator Components <span style="margin-left: auto; font-size: 0.6875rem; opacity: 0.5;">HOVER LAYERS TO FOCUS</span></div>
                            <div class="network-layers" data-interactive-layers>
                                <div class="network-layer" style="border-color: rgba(6, 182, 212, 0.3); background: rgba(6, 182, 212, 0.03);">
                                    <div class="network-layer-label" style="color: var(--cyan);">Custom Resource Definitions (CRDs)</div>
                                    <div class="network-layer-content">
                                        <div class="mini-node">üì¶ MongoDB ‚Äî Replica sets and sharded clusters</div>
                                        <div class="mini-node">‚öôÔ∏è MongoDBOpsManager ‚Äî Ops Manager itself in K8s</div>
                                        <div class="mini-node">üë§ MongoDBUser ‚Äî Database user management</div>
                                        <div class="mini-node">üîó MongoDBMultiCluster ‚Äî Multi-K8s clusters</div>
                                    </div>
                                </div>
                                <div class="network-layer app">
                                    <div class="network-layer-label">Operator Controller (Deployment)</div>
                                    <div class="network-layer-content">
                                        <div class="mini-node">üéØ Watches CRDs for changes</div>
                                        <div class="mini-node">üîÑ Reconciliation loop</div>
                                        <div class="mini-node">üìã Creates/updates StatefulSets, Services, ConfigMaps, Secrets</div>
                                        <div class="mini-node">üîó Communicates with Ops Manager API</div>
                                    </div>
                                </div>
                                <div class="network-layer data">
                                    <div class="network-layer-label">Kubernetes Resources Created</div>
                                    <div class="network-layer-content">
                                        <div class="mini-node">üì¶ StatefulSet (one per RS / shard)</div>
                                        <div class="mini-node">üíæ PersistentVolumeClaim per pod</div>
                                        <div class="mini-node">üåê Headless Service (member discovery)</div>
                                        <div class="mini-node">üîê Secrets (certs, keyfiles, credentials)</div>
                                        <div class="mini-node">ü§ñ Init containers (agent setup)</div>
                                        <div class="mini-node">üìä Sidecar containers (agent process)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Example: Deploy a 3-Node Replica Set</h4>
                        <div class="code-block">
                            <span class="comment"># mongodb-rs.yaml</span><br>
                            <span class="keyword">apiVersion:</span> <span class="string">mongodb.com/v1</span><br>
                            <span class="keyword">kind:</span> <span class="string">MongoDB</span><br>
                            <span class="keyword">metadata:</span><br>
                            &nbsp;&nbsp;<span class="param">name:</span> <span class="string">my-replica-set</span><br>
                            &nbsp;&nbsp;<span class="param">namespace:</span> <span class="string">mongodb</span><br>
                            <span class="keyword">spec:</span><br>
                            &nbsp;&nbsp;<span class="param">members:</span> <span class="value">3</span><br>
                            &nbsp;&nbsp;<span class="param">version:</span> <span class="string">"7.0.12-ent"</span><br>
                            &nbsp;&nbsp;<span class="param">type:</span> <span class="string">ReplicaSet</span><br>
                            &nbsp;&nbsp;<span class="keyword">opsManager:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">configMapRef:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">name:</span> <span class="string">ops-manager-connection</span><br>
                            &nbsp;&nbsp;<span class="keyword">credentials:</span> <span class="string">ops-manager-org-credentials</span><br>
                            &nbsp;&nbsp;<span class="keyword">persistent:</span> <span class="value">true</span><br>
                            &nbsp;&nbsp;<span class="keyword">podSpec:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">podTemplate:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">spec:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">affinity:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">podAntiAffinity:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">requiredDuringSchedulingIgnoredDuringExecution:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="keyword">labelSelector:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">matchExpressions:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="param">key:</span> <span class="string">app</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">operator:</span> <span class="string">In</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">values:</span> [<span class="string">"my-replica-set"</span>]<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">topologyKey:</span> <span class="string">"topology.kubernetes.io/zone"</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">persistence:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">single:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">storage:</span> <span class="value">50Gi</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">storageClass:</span> <span class="string">gp3-encrypted</span><br>
                            &nbsp;&nbsp;<span class="keyword">security:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">tls:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">enabled:</span> <span class="value">true</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">authentication:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">modes:</span> [<span class="string">"SCRAM"</span>]<br>
                        </div>

                        <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Ops Manager in Kubernetes</h4>
                        <div class="code-block">
                            <span class="comment"># ops-manager.yaml ‚Äî Deploy Ops Manager itself in K8s</span><br>
                            <span class="keyword">apiVersion:</span> <span class="string">mongodb.com/v1</span><br>
                            <span class="keyword">kind:</span> <span class="string">MongoDBOpsManager</span><br>
                            <span class="keyword">metadata:</span><br>
                            &nbsp;&nbsp;<span class="param">name:</span> <span class="string">ops-manager</span><br>
                            <span class="keyword">spec:</span><br>
                            &nbsp;&nbsp;<span class="param">replicas:</span> <span class="value">2</span> <span class="comment"># HA: 2 Ops Manager instances</span><br>
                            &nbsp;&nbsp;<span class="param">version:</span> <span class="string">"7.0.4"</span><br>
                            &nbsp;&nbsp;<span class="keyword">adminCredentials:</span> <span class="string">ops-manager-admin</span><br>
                            &nbsp;&nbsp;<span class="keyword">applicationDatabase:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">members:</span> <span class="value">3</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">podSpec:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">persistence:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">single:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">storage:</span> <span class="value">20Gi</span><br>
                            &nbsp;&nbsp;<span class="keyword">backup:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="param">enabled:</span> <span class="value">true</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">s3Stores:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;- <span class="param">name:</span> <span class="string">s3-backup</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">s3BucketEndpoint:</span> <span class="string">s3.amazonaws.com</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">s3BucketName:</span> <span class="string">mongodb-backups</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">s3SecretRef:</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="param">name:</span> <span class="string">s3-credentials</span><br>
                        </div>

                        <div class="callout info">
                            <div class="callout-icon">‚ò∏Ô∏è</div>
                            <div class="callout-text"><strong>Multi-Kubernetes Cluster:</strong> The Enterprise Operator supports deploying a single MongoDB replica set across multiple Kubernetes clusters (e.g., one member per AZ/region). Uses <code>MongoDBMultiCluster</code> CRD. Requires network connectivity between clusters (e.g., VPC peering, service mesh).</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decision Framework -->
            <div class="section">
                <h2 class="section-heading" style="font-size: 1.25rem;">When to Use Which?</h2>

                <div class="two-col">
                    <div class="config-block">
                        <div class="config-block-title">Choose Bare Metal / VM when...</div>
                        <ul class="arch-box-list">
                            <li>Air-gapped / disconnected environments</li>
                            <li>Strict regulatory requirements (gov, financial)</li>
                            <li>Maximum control over hardware and networking</li>
                            <li>Existing VM infrastructure (VMware, OpenStack)</li>
                            <li>Very high-performance workloads needing NVMe/local SSD</li>
                            <li>Team has limited Kubernetes expertise</li>
                        </ul>
                    </div>
                    <div class="config-block">
                        <div class="config-block-title">Choose Kubernetes when...</div>
                        <ul class="arch-box-list">
                            <li>Cloud-native infrastructure strategy</li>
                            <li>GitOps / Infrastructure-as-Code workflows</li>
                            <li>Rapid provisioning of dev/staging/test clusters</li>
                            <li>Auto-healing and self-service for developers</li>
                            <li>Multi-cloud or hybrid deployments</li>
                            <li>Integration with service mesh (Istio, Linkerd)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- /main-content -->

    <!-- Tooltip Element -->
    <div class="node-tooltip" id="node-tooltip">
        <div class="node-tooltip-title" id="tooltip-title"></div>
        <div class="node-tooltip-text" id="tooltip-text"></div>
        <div class="node-tooltip-tags" id="tooltip-tags"></div>
    </div>

    <script>
        // ===== Tab Navigation =====
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // ===== Expandable Panels =====
        function toggleExpandable(el) {
            el.classList.toggle('open');
        }

        // ===== Subservice Cards =====
        function toggleSubservice(el) {
            if (el.classList.contains('selected')) {
                el.classList.remove('selected');
            } else {
                el.classList.add('selected');
            }
        }

        // ===== Interactive Tooltips on Mini-Nodes =====
        const tooltip = document.getElementById('node-tooltip');
        const tooltipTitle = document.getElementById('tooltip-title');
        const tooltipText = document.getElementById('tooltip-text');
        const tooltipTags = document.getElementById('tooltip-tags');
        let tooltipTimeout;
        let activeNode = null;

        document.querySelectorAll('.mini-node[data-tip]').forEach(node => {
            node.addEventListener('click', (e) => {
                e.stopPropagation();
                const tipData = node.getAttribute('data-tip');
                const parts = tipData.split('|');
                const title = parts[0] || '';
                const text = parts[1] || '';
                const tags = parts[2] ? parts[2].replace('tags:', '').split(',') : [];

                // Toggle same node
                if (activeNode === node) {
                    hideTooltip();
                    return;
                }

                // Clear previous
                if (activeNode) activeNode.classList.remove('highlighted');

                activeNode = node;
                node.classList.add('highlighted');

                tooltipTitle.textContent = title;
                tooltipText.textContent = text;
                tooltipTags.innerHTML = tags.map(t =>
                    `<span class="tag green">${t.trim()}</span>`
                ).join('');

                // Position tooltip
                const rect = node.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                let top = rect.bottom + 8;
                let left = rect.left;

                // Keep within viewport
                if (top + 200 > window.innerHeight) {
                    top = rect.top - 8 - 200;
                }
                if (left + 320 > window.innerWidth) {
                    left = window.innerWidth - 330;
                }

                tooltip.style.top = top + 'px';
                tooltip.style.left = Math.max(10, left) + 'px';
                tooltip.classList.add('visible');

                // Dim other nodes in same layer
                const layer = node.closest('.network-layer');
                if (layer) {
                    layer.querySelectorAll('.mini-node').forEach(n => {
                        if (n !== node && !n.classList.contains('highlighted')) {
                            n.classList.add('dimmed');
                        }
                    });
                }
            });
        });

        function hideTooltip() {
            tooltip.classList.remove('visible');
            if (activeNode) {
                activeNode.classList.remove('highlighted');
                activeNode = null;
            }
            document.querySelectorAll('.mini-node.dimmed').forEach(n => n.classList.remove('dimmed'));
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.mini-node') && !e.target.closest('.node-tooltip')) {
                hideTooltip();
            }
        });

        // ===== Network Layer Interactivity =====
        document.querySelectorAll('[data-interactive-layers] .network-layer').forEach(layer => {
            layer.addEventListener('mouseenter', () => {
                const parent = layer.closest('[data-interactive-layers]');
                parent.querySelectorAll('.network-layer').forEach(l => {
                    if (l !== layer) l.classList.add('layer-dimmed');
                });
                layer.classList.add('layer-active');
            });

            layer.addEventListener('mouseleave', () => {
                const parent = layer.closest('[data-interactive-layers]');
                parent.querySelectorAll('.network-layer').forEach(l => {
                    l.classList.remove('layer-dimmed');
                    l.classList.remove('layer-active');
                });
            });
        });

        // ===== Flow Simulation (Horizontal) =====
        function playFlow(btn) {
            if (btn.classList.contains('playing')) return;

            const container = btn.nextElementSibling;
            const steps = container.querySelectorAll('.flow-step');
            const arrows = container.querySelectorAll('.flow-arrow');

            btn.classList.add('playing');
            btn.textContent = '‚èµ Running...';

            // Reset
            steps.forEach(s => { s.classList.remove('active-step', 'completed-step'); });
            arrows.forEach(a => a.classList.remove('active-arrow'));

            let i = 0;
            const interval = setInterval(() => {
                // Deactivate previous step
                if (i > 0) {
                    steps[i - 1].classList.remove('active-step');
                    steps[i - 1].classList.add('completed-step');
                }

                // Activate arrow before this step
                if (i > 0 && arrows[i - 1]) {
                    arrows[i - 1].classList.remove('active-arrow');
                }

                if (i >= steps.length) {
                    clearInterval(interval);
                    btn.classList.remove('playing');
                    btn.textContent = '‚ñ∂ Simulate Flow';

                    // Reset after delay
                    setTimeout(() => {
                        steps.forEach(s => s.classList.remove('active-step', 'completed-step'));
                    }, 2000);
                    return;
                }

                // Activate current arrow
                if (i > 0 && arrows[i - 1]) {
                    arrows[i - 1].classList.add('active-arrow');
                }

                steps[i].classList.add('active-step');
                i++;
            }, 800);
        }

        // ===== Flow Simulation (Vertical) =====
        function playFlowVertical(btn) {
            if (btn.classList.contains('playing')) return;

            const container = btn.nextElementSibling;
            const steps = container.querySelectorAll('.flow-step');
            const arrows = container.querySelectorAll('.flow-arrow');

            btn.classList.add('playing');
            const origText = btn.textContent;
            btn.textContent = '‚èµ Running...';

            // Reset
            steps.forEach(s => { s.classList.remove('active-step', 'completed-step'); });
            arrows.forEach(a => a.classList.remove('active-arrow'));

            let i = 0;
            const interval = setInterval(() => {
                if (i > 0) {
                    steps[i - 1].classList.remove('active-step');
                    steps[i - 1].classList.add('completed-step');
                }

                if (i > 0 && arrows[i - 1]) {
                    arrows[i - 1].classList.remove('active-arrow');
                }

                if (i >= steps.length) {
                    clearInterval(interval);
                    btn.classList.remove('playing');
                    btn.textContent = origText;

                    setTimeout(() => {
                        steps.forEach(s => s.classList.remove('active-step', 'completed-step'));
                    }, 2000);
                    return;
                }

                if (i > 0 && arrows[i - 1]) {
                    arrows[i - 1].classList.add('active-arrow');
                }

                steps[i].classList.add('active-step');
                // Scroll step into view
                steps[i].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                i++;
            }, 1000);
        }

        // ===== Auto-animate first visible flow on tab switch =====
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Reset all flow states on tab switch
                document.querySelectorAll('.flow-step').forEach(s => {
                    s.classList.remove('active-step', 'completed-step');
                });
                document.querySelectorAll('.flow-arrow').forEach(a => {
                    a.classList.remove('active-arrow');
                });
                hideTooltip();
            });
        });

        // ===== Subservice card flow indicators =====
        document.querySelectorAll('.subservice-card').forEach(card => {
            const desc = card.querySelector('.subservice-card-desc');
            if (desc) {
                const indicator = document.createElement('div');
                indicator.className = 'subservice-flow-indicator';
                indicator.innerHTML = '<div class="subservice-flow-dot"></div><span>Active component</span>';
                desc.after(indicator);
            }
        });

        // ===== Keyboard navigation =====
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideTooltip();
            }
        });

        // ===== Mini-node hover glow effect =====
        document.querySelectorAll('.mini-node').forEach(node => {
            node.addEventListener('mouseenter', () => {
                if (!node.classList.contains('dimmed')) {
                    node.style.boxShadow = '0 4px 16px -4px rgba(0, 237, 100, 0.25)';
                }
            });
            node.addEventListener('mouseleave', () => {
                if (!node.classList.contains('highlighted')) {
                    node.style.boxShadow = '';
                }
            });
        });
    </script>
</body>
</html>
