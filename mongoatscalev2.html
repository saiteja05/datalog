<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Atlas At Scale - Command Center V2</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23001E2B'/><path d='M16 4 L18 14 L16 28 L14 14 Z' fill='%2300ED64'/><ellipse cx='16' cy='14' rx='3' ry='5' fill='%2300ED64'/></svg>">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Premium Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap">
    <style>
        :root {
            /* Enhanced Color System */
            --mongo-green: #00ED64;
            --mongo-dark-blue: #001218;
            --mongo-dark-green: #023430;
            --mongo-card: #00202E;
            --mongo-card-accent: #002B3A;
            --mongo-text: #F0F0F0;
            --mongo-text-muted: #B0B4B8;
            --mongo-border: #004F69;
            
            /* Sidebar */
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #001218 0%, #001E2B 50%, #001218 100%);
            background-attachment: fixed;
            color: var(--mongo-text);
            line-height: 1.7;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 237, 100, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 237, 100, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        
        code, pre, .code-block {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Sticky Header */
        .premium-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: rgba(0, 18, 24, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 237, 100, 0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .header-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--mongo-green);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        
        .header-logo svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 8px rgba(0, 237, 100, 0.4));
        }
        
        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            width: 400px;
            max-width: 50vw;
        }
        
        .search-input {
            width: 100%;
            padding: 0.65rem 1rem 0.65rem 2.75rem;
            background: rgba(0, 43, 58, 0.6);
            border: 1px solid rgba(0, 237, 100, 0.2);
            border-radius: 12px;
            color: var(--mongo-text);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--mongo-green);
            background: rgba(0, 43, 58, 0.9);
            box-shadow: 0 0 0 3px rgba(0, 237, 100, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--mongo-text-muted);
        }
        
        .search-kbd {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 237, 100, 0.1);
            border: 1px solid rgba(0, 237, 100, 0.2);
            border-radius: 4px;
            padding: 0.2rem 0.5rem;
            font-size: 0.75rem;
            color: var(--mongo-text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: var(--header-height);
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: rgba(0, 32, 46, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 237, 100, 0.1);
            overflow-y: auto;
            z-index: 900;
            padding: 1.5rem 0;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(0, 237, 100, 0.3);
            border-radius: 3px;
        }
        
        .sidebar-nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.85rem 1.5rem;
            color: var(--mongo-text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            position: relative;
        }
        
        .sidebar-nav-item:hover {
            color: var(--mongo-text);
            background: rgba(0, 237, 100, 0.05);
            border-left-color: var(--mongo-green);
        }
        
        .sidebar-nav-item.active {
            color: var(--mongo-green);
            background: rgba(0, 237, 100, 0.1);
            border-left-color: var(--mongo-green);
            font-weight: 600;
        }
        
        .sidebar-nav-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .sidebar-nav-item.emergency {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.15) 0%, transparent 100%);
            border-left-color: #FF6B6B;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .sidebar-nav-item.emergency:hover,
        .sidebar-nav-item.emergency.active {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.25) 0%, transparent 100%);
            color: #FF6B6B;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 3rem;
            min-height: calc(100vh - var(--header-height));
            position: relative;
            z-index: 1;
        }
        
        /* Code Blocks with Copy Button */
        .code-container {
            position: relative;
            margin: 1.5rem 0;
        }
        
        .code-block {
            background: linear-gradient(135deg, #0a1520 0%, #000810 100%);
            border: 1px solid rgba(0, 237, 100, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            color: #E0E0E0;
            font-size: 0.9rem;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        .copy-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 237, 100, 0.1);
            border: 1px solid rgba(0, 237, 100, 0.3);
            border-radius: 8px;
            color: var(--mongo-green);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .copy-button:hover {
            background: rgba(0, 237, 100, 0.2);
            transform: translateY(-2px);
        }
        
        .copy-button.copied {
            background: rgba(0, 237, 100, 0.3);
        }
        
        /* Scroll Progress */
        .scroll-progress {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: 0%;
            height: 3px;
            background: var(--mongo-green);
            z-index: 1001;
            box-shadow: 0 0 10px var(--mongo-green);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Card Icon */
        .card-icon {
            width: 1.75rem;
            height: 1.75rem;
            stroke-width: 1.5;
            color: var(--mongo-green);
            flex-shrink: 0;
            filter: drop-shadow(0 2px 4px rgba(0, 237, 100, 0.3));
        }
        
        /* Quick Links */
        .quick-links {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--mongo-border);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 2.5rem;
        }
        
        .quick-links h4 {
            color: var(--mongo-green);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 1rem 0;
        }
        
        .quick-links ul {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            padding: 0;
            margin: 0;
            list-style: none;
        }
        
        .quick-links a {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            border-radius: 0.5rem;
            color: var(--mongo-text);
            font-size: 0.85rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .quick-links a:hover {
            background: rgba(0, 237, 100, 0.1);
            border-color: var(--mongo-green);
            color: white;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .search-container {
                width: 200px;
            }
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: rgba(0, 237, 100, 0.1);
            border: 1px solid rgba(0, 237, 100, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            color: var(--mongo-green);
            cursor: pointer;
        }
        
        @media (max-width: 1024px) {
            .mobile-menu-toggle {
                display: block;
            }
        }
        
        /* Enhanced Expandable Box Styles */
        .expandable-box {
            background: linear-gradient(135deg, rgba(0, 55, 78, 0.5) 0%, rgba(0, 43, 58, 0.5) 100%);
            backdrop-filter: blur(8px);
            border-left: 4px solid var(--mongo-green);
            border-radius: 0.75rem;
            margin-top: 1.25rem;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        
        .expandable-box:hover {
            background: linear-gradient(135deg, rgba(0, 55, 78, 0.7) 0%, rgba(0, 43, 58, 0.7) 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 237, 100, 0.2), 0 4px 6px -2px rgba(0, 237, 100, 0.1);
            transform: translateY(-2px);
        }
        
        .expandable-box summary {
            font-weight: 600;
            font-size: 1.05rem;
            color: var(--mongo-green);
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            outline: none;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            transition: background 0.2s ease;
        }
        
        .expandable-box summary:hover {
            background: rgba(0, 237, 100, 0.05);
        }
        
        .expandable-box summary::-webkit-details-marker {
            display: none;
        }
        
        .expandable-box summary::after {
            content: '+';
            font-size: 1.75rem;
            font-weight: 300;
            color: var(--mongo-green);
            transition: transform 0.3s ease;
            line-height: 1;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 237, 100, 0.1);
            border-radius: 50%;
        }
        
        .expandable-box[open] summary::after {
            transform: rotate(45deg);
            background: rgba(0, 237, 100, 0.2);
        }
        
        .expandable-box-content {
            padding: 1.5rem;
            color: var(--mongo-text);
            background: rgba(0, 0, 0, 0.15);
            border-top: 1px solid rgba(0, 237, 100, 0.1);
        }
        
        .expandable-box-content p {
            color: var(--mongo-text);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        
        .expandable-box-content p:last-child {
            margin-bottom: 0;
        }
        
        .expandable-box-content strong {
            color: var(--mongo-green);
            font-weight: 600;
        }
        
        .expandable-box-content ul {
            margin-top: 0.75rem;
            padding-left: 1.5rem;
        }
        
        .expandable-box-content ul li {
            margin-bottom: 0.5rem;
            color: var(--mongo-text-muted);
        }
        
        /* Enhanced section headers */
        section h3 {
            font-size: 1.75rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        section h4 {
            font-size: 1.35rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #fff;
            border-bottom: 2px solid rgba(0, 237, 100, 0.2);
            padding-bottom: 0.5rem;
        }
        
        /* Better list styling */
        ul.list-disc {
            padding-left: 1.75rem;
        }
        
        ul.list-disc li {
            margin-bottom: 0.75rem;
            line-height: 1.7;
        }
        
        ul.list-disc li strong {
            color: var(--mongo-green);
            font-weight: 600;
        }
        
        /* Reference links */
        .ref-link {
            font-size: 0.7rem;
            color: var(--mongo-green);
            opacity: 0.6;
            margin-left: 0.25rem;
            vertical-align: super;
            text-decoration: none;
            transition: opacity 0.2s ease;
            font-weight: 600;
        }
        
        .ref-link:hover {
            opacity: 1;
            text-decoration: underline;
        }
        
        /* SVG Diagram Styles */
        .svg-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 2rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem;
            margin: 1.5rem 0;
        }
        
        .svg-diagram .node {
            fill: var(--mongo-card-accent);
            stroke: var(--mongo-green);
            stroke-width: 2px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }
        
        .svg-diagram .node-text {
            font-size: 11px;
            fill: var(--mongo-text);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        
        .svg-diagram .label-text {
            font-size: 12px;
            fill: var(--mongo-text-muted);
            font-family: 'Inter', sans-serif;
        }
        
        .svg-diagram .arrow-line {
            stroke: var(--mongo-text-muted);
            stroke-width: 2px;
            marker-end: url(#arrowhead);
        }
        
        .svg-diagram .arrow-text {
            font-size: 11px;
            fill: var(--mongo-green);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        
        .svg-diagram .warn-text {
            font-size: 12px;
            fill: #fbbf24;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        
        /* Improved paragraph spacing */
        p {
            margin-bottom: 1rem;
        }
        
        /* Better visual hierarchy for content sections */
        section {
            margin-bottom: 3rem;
        }
        
        section > div:first-child {
            margin-bottom: 2rem;
        }
        
        /* Hero gradient for potential header use */
        .hero-gradient {
            background: linear-gradient(135deg, var(--mongo-dark-green) 0%, #001E2B 100%);
            position: relative;
        }
        
        /* Search Highlight */
        .search-highlight, mark.search-highlight {
            background-color: rgba(0, 237, 100, 0.3);
            color: var(--mongo-text);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Scroll Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>
    
    <!-- Premium Header -->
    <header class="premium-header">
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
        
        <a href="#" class="header-logo">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M13.74 4.23c-.84-1-1.57-2-1.71-2.22H12c-.14.21-.87 1.22-1.71 2.22-7.2 9.19 1.14 15.39 1.14 15.39l.07.05c.06.95.22 2.33.22 2.33h.62s.15-1.37.21-2.33l.07-.06s8.32-6.19 1.12-15.38zM12 19.48a3.48 3.48 0 01-.48-.48L12 9l.45 10a3.57 3.57 0 01-.45.48z"/>
            </svg>
            MongoDB Command Center
        </a>
        
        <div class="header-actions">
            <div class="search-container">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" class="search-input" placeholder="Search documentation..." id="searchInput">
                <kbd class="search-kbd">âŒ˜K</kbd>
            </div>
        </div>
    </header>
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <a href="#" class="sidebar-nav-item emergency active" data-tab="faq">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            Emergency FAQs
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="growth">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
            </svg>
            Capacity Planning
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="performance">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Performance Troubleshooting
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="enterprise">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
            Enterprise Advanced
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="architecture">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            Architecture & Best Practices
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="features">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
            </svg>
            Core Features
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="advanced">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
            </svg>
            Advanced Features
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="governance">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            Governance & Operations
        </a>
        
        <a href="#" class="sidebar-nav-item" data-tab="api">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
            </svg>
            API Examples
        </a>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
            <div id="tab-faq" class="tab-content active p-6 md:p-10 space-y-8">
                
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Emergency Categories</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#faq-emergency" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">ðŸš¨ System Down / Emergency</a>
                        <a href="#faq-sharding" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Scalability & Sharding</a>
                        <a href="#faq-backup" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Backup & DR</a>
                        <a href="#faq-security" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Security & Access</a>
                        <a href="#faq-advanced" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Advanced Features</a>
                        <a href="#faq-general" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">General / How-To</a>
                    </div>
                </div>

                <!-- Section 1: Emergency Performance -->
                <section id="faq-emergency">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                        <h3 class="text-2xl font-bold">ðŸš¨ Emergency Response (CPU, Memory, Latency)</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: The Primary node is at 100% CPU. How do I failover safely?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> Your primary is pegged at 100% CPU. Queries are timing out. Restarting the node could cause data loss if writes are in-flight.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Immediate Action:</strong> Force a controlled election to step down the primary. This triggers a graceful failover to a healthy secondary without data loss.</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Connect to the PRIMARY node via mongosh\nrs.stepDown(60)  // Steps down for 60 seconds, allowing election</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Why this works:</strong> The primary closes all client connections cleanly, flushes writes to disk, and a secondary with the most recent oplog becomes the new primary (typically in 5-10 seconds).</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Root Cause Investigation:</strong> After failover, check the old primary's slow query log. Common causes: missing indexes, poorly written aggregations, or a "hot" shard key causing uneven load distribution.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#core-replica" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Replica Sets Deep Dive â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/reference/method/rs.stepDown/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— rs.stepDown() Docs â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/tutorial/troubleshoot-replica-sets/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Troubleshooting Replica Sets â†’</a>
                            </div>
                        </div>
                        
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: I see "Connection Refused" or connection spikes. Is this a DDoS?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> Your app suddenly can't connect. Atlas shows "Current Connections" spiking from 200 to 10,000+. Users are seeing 503 errors.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Diagnosis:</strong> This is almost always a <strong>connection storm</strong>, not a DDoS. It happens when your app servers retry failed connections in a tight loop, creating exponential growth.</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Check current connections in Atlas RTPP or via mongosh:\ndb.serverStatus().connections
// Look for: current >> available (e.g., 15000 current vs 500 available)</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Immediate Fix:</strong> Restart your application servers (not the database). This breaks the retry loop. Ensure your connection pool has:</p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><code>maxPoolSize</code> = 100 (not 1000+)</li>
                                <li><code>minPoolSize</code> = 10</li>
                                <li>Exponential backoff on retries (not immediate retry)</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Prevention:</strong> Use a connection pooler like <strong>ProxySQL</strong> or ensure your driver's connection pool is properly configured. For serverless apps (AWS Lambda), use <strong>MongoDB connection pooling with context reuse</strong> - store the connection in the Lambda handler's global scope to reuse across invocations, reducing connection overhead.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-connections" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Connection Storms Fix â†’</a>
                                <a href="https://www.mongodb.com/docs/drivers/node/current/fundamentals/connection/connection-options/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Connection Pool Settings â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/manage-connections-aws-lambda/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Lambda Connection Best Practices â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I kill a long-running query that is blocking everything?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> A developer ran an unindexed query on a 500GB collection. It's been running for 20 minutes, consuming all available CPU, and blocking other queries.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Step 1: Identify the operation</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Find operations running longer than 3 seconds:\ndb.currentOp({\"secs_running\": {$gt: 3}, \"op\": {$in: [\"query\", \"getmore\"]}})

// Look for the \"opid\" field in the output</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Step 2: Kill it</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">db.killOp(12345)  // Replace 12345 with the actual opid</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Important:</strong> Killing an operation is <strong>safe</strong> for reads. For writes, it may leave the operation partially complete (e.g., 50% of documents updated). Always check the operation type before killing.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Prevention:</strong> Set <code>maxTimeMS</code> on all queries to auto-kill after a timeout (e.g., 30 seconds for API queries). In Atlas, enable <strong>Query Targeting</strong> alerts to catch collection scans before they cause issues.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-latency" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Latency Diagnosis Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/reference/method/db.killOp/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— db.killOp() Reference â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.maxTimeMS/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— maxTimeMS Documentation â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: Memory is at 95%. Will the node crash?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Short Answer:</strong> Probably not. This is <strong>usually normal</strong> for MongoDB.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Why:</strong> MongoDB's WiredTiger storage engine uses all available RAM as a cache. It's designed to use ~50% of system RAM for the WiredTiger cache, plus additional RAM for OS file system cache. Seeing 90-95% memory usage is expected and optimal.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>When to Panic:</strong> Only if you see these in the logs:</p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><code>OOM Killer</code> messages (Linux kernel killed mongod)</li>
                                <li><code>WiredTiger cache eviction</code> warnings (cache thrashing)</li>
                                <li>Swap usage > 0 (indicates RAM exhaustion)</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Action:</strong> Check the <strong>WiredTiger Cache "Dirty" %</strong> metric in Atlas. If it's consistently > 20%, your working set exceeds RAM. Scale up to a larger instance or add shards to distribute the load.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-monitoring" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Monitoring Metrics Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/wiredtiger/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— WiredTiger Internals â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/faq/diagnostics/#memory-diagnostics" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Memory Diagnostics FAQ â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I find the exact query slowing down the DB right now?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> Your app is slow. Users are complaining. You need to find the culprit query in the next 60 seconds.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Method 1: Atlas Real-Time Performance Panel (RTPP)</strong> [Fastest]</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. Go to Atlas â†’ Performance â†’ Real-Time<br>2. Sort by "Duration" or "Examined Docs"<br>3. Click the slow query â†’ See full query shape, execution stats, and suggested indexes</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Method 2: mongosh (if RTPP is unavailable)</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Show all operations running > 3 seconds:\ndb.currentOp({\"secs_running\": {$gt: 3}})

// For more detail, enable profiling (Level 1 = slow queries only):\ndb.setProfilingLevel(1, {slowms: 100})  // Log queries > 100ms
db.system.profile.find().sort({ts: -1}).limit(10).pretty()</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Key Metrics to Check:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><strong>docsExamined vs docsReturned:</strong> If docsExamined >> docsReturned (e.g., 1M examined, 10 returned), you're missing an index.</li>
                                <li><strong>COLLSCAN:</strong> Indicates a full collection scan (very bad for large collections).</li>
                                <li><strong>Query Shape Hash:</strong> Use this to group similar queries and find the Query Shape Hash in the Performance Advisor.</li>
                            </ul>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-workflow" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Performance Tuning Workflow â†’</a>
                                <a href="#perf-query" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Query Optimization Deep Dive â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/tutorial/manage-the-database-profiler/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Database Profiler Guide â†’</a>
                            </div>
                        </div>
                    </div>
                </section>


                <!-- Section 2: Sharding -->
                <section id="faq-sharding">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0v-2a2 2 0 012-2h5a2 2 0 012 2v2m-6 0v-2a2 2 0 012-2h1a2 2 0 012 2v2" /></svg>
                        <h3 class="text-2xl font-bold">Scalability & Sharding</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: I have a "Jumbo Chunk" error. How do I fix it?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> You're trying to enable sharding or the balancer is stuck. Atlas shows: <code>ChunkTooBig: chunk size is 70MB, but max is 64MB</code>.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Root Cause:</strong> A single chunk grew beyond 64MB (the migration limit) because all documents in that chunk range have the same shard key value. The balancer cannot split it further.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution 1: Refine Shard Key (MongoDB 4.4+)</strong> [Recommended]</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Add a suffix field to increase cardinality\ndb.adminCommand({\n  refineCollectionShardKey: "mydb.mycollection",\n  key: { existingKey: 1, _id: 1 }  // Adds _id to shard key\n})</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution 2: Live Resharding (MongoDB 5.0+, Atlas M30+)</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">Use Atlas UI: Data Explorer â†’ Collection â†’ Reshard Collection. Choose a new shard key with high cardinality (e.g., hashed _id).</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Prevention:</strong> Always choose a shard key with high cardinality (many unique values). Avoid low-cardinality keys like <code>country</code> or <code>status</code>.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#core-sharding" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Sharding Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/sharding-refine-a-shard-key/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Refine Shard Key Docs â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/sharding-reshard-a-collection/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Resharding Guide â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: One shard is full, others are empty. Why isn't the balancer working?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> You have 3 shards. Shard0 has 2TB of data, Shard1 and Shard2 have 50GB each. The balancer is enabled but nothing is moving.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Diagnosis: Check your shard key pattern</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Connect to mongos and check chunk distribution:\nsh.status()
// Look for: "chunks" count per shard. If one shard has 95% of chunks, your shard key is bad.</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Common Causes:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><strong>Monotonically increasing key</strong> (e.g., <code>_id</code>, <code>timestamp</code>): All new writes go to the "max" chunk on one shard.</li>
                                <li><strong>Low cardinality key</strong> (e.g., <code>country</code>): If 90% of users are from "US", 90% of data goes to one shard.</li>
                                <li><strong>Balancer disabled</strong>: Check <code>sh.getBalancerState()</code>. If false, enable with <code>sh.startBalancer()</code>.</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Fix:</strong> Use a <strong>hashed shard key</strong> (e.g., <code>{_id: "hashed"}</code>) for even distribution, or a compound key that combines high cardinality with query patterns (e.g., <code>{userId: 1, timestamp: 1}</code>).</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-sharding" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Hot Shards Troubleshooting â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/sharding-choose-a-shard-key/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Choosing a Shard Key â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: Can I change my Shard Key? It's causing hotspots.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Yes!</strong> MongoDB 5.0+ supports <strong>Live Resharding</strong> (zero downtime). MongoDB 4.4+ supports <strong>Refining</strong> the shard key (adding fields).</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Option 1: Refine Shard Key</strong> (Add fields to existing key)</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">Use case: Your current key is <code>{userId: 1}</code> but you want <code>{userId: 1, timestamp: 1}</code>. This is fast (no data movement).</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Option 2: Live Resharding</strong> (Completely new key)</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">Use case: Your current key is <code>{country: 1}</code> but you want <code>{_id: "hashed"}</code>. This rewrites all data (can take hours for TB+ collections). Available in Atlas M30+ or self-managed MongoDB 5.0+.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Important:</strong> Resharding locks the collection briefly at the start and end. Plan for a maintenance window for large collections (>1TB).</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#arch-best-practices" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Shard Key Best Practices â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/sharding-reshard-a-collection/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Resharding Documentation â†’</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Backup & DR -->
                <section id="faq-backup">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.42-.38-2.75-.99-3.9l.01-.01c-.11.39-.22.78-.33 1.172m-13.256 0c1.32.39 2.71.64 4.15.64 3.314 0 6.3-1.29 8.57-3.417-2.27 2.127-5.256 3.417-8.57 3.417A10.965 10.965 0 013.33 6.643z" /></svg>
                        <h3 class="text-2xl font-bold">Backup & Disaster Recovery</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: I accidentally dropped a collection. How do I restore JUST that collection?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> A developer ran <code>db.users.drop()</code> in production. You need to restore the <code>users</code> collection without affecting other collections.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution: Point-in-Time Restore (PITR) to a separate cluster</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. In Atlas: Backup â†’ Restore Snapshot â†’ Choose timestamp before the drop<br>2. Restore to a NEW cluster (not production)<br>3. Use <code>mongodump</code> to export just the <code>users</code> collection from the restored cluster<br>4. Use <code>mongorestore</code> to import it back to production</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Export from restored cluster:\nmongodump --uri="mongodb+srv://restored-cluster..." --db=mydb --collection=users --out=/backup

// Import to production:\nmongorestore --uri="mongodb+srv://prod-cluster..." --db=mydb --collection=users /backup/mydb/users.bson</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Alternative (Faster):</strong> Use <strong>Atlas Data Federation</strong> to query the snapshot directly and copy data via aggregation <code>$merge</code> or <code>$out</code>.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#arch-backups" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Backup Strategy Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/backup/cloud-backup/restore/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Atlas Restore Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/database-tools/mongodump/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— mongodump Reference â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: An entire AWS region is down. What do I do?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Short Answer:</strong> If you have a multi-region replica set (e.g., 3 regions with 5 nodes), <strong>do nothing</strong>. Failover is automatic.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>How it works:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li>MongoDB uses a <strong>majority election</strong>. If Region A goes down but Regions B and C are healthy, the remaining nodes (3 out of 5) elect a new primary.</li>
                                <li>Failover typically completes in <strong>5-15 seconds</strong>.</li>
                                <li>Your application will see a brief connection error, then reconnect to the new primary automatically (if using the correct connection string with <code>retryWrites=true</code>).</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Requirements for automatic failover:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li>At least <strong>3 regions</strong> (to maintain majority after 1 region fails)</li>
                                <li><strong>5 nodes minimum</strong> (e.g., 2-2-1 distribution across 3 regions)</li>
                                <li>Application uses <strong>MongoDB driver 4.0+</strong> with retry logic enabled</li>
                            </ul>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#arch-zero-downtime" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Zero Downtime Architecture â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/replica-set-elections/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Replica Set Elections â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I query my backups without restoring them?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Use Case:</strong> You need to verify data from 3 months ago for an audit, but don't want to spin up a full cluster restore.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution: Atlas Data Federation (Federated Queries)</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. In Atlas: Data Federation â†’ Create Federated Database<br>2. Add your snapshot as a data source<br>3. Query it directly using standard MongoDB queries (read-only)</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Connect to your federated database:\nmongosh "mongodb://federated-instance..."

// Query the snapshot:\nuse mydb\ndb.users.find({email: "audit@example.com"})</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Benefits:</strong> No cluster spin-up cost, no data movement, instant access. Perfect for compliance audits, data recovery verification, or historical analysis.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#arch-online-archive" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Online Archive & Federation â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/data-federation/query/query-with-sql/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Data Federation Guide â†’</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Security -->
                <section id="faq-security">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                        <h3 class="text-2xl font-bold">Security & Access</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: I'm locked out! "Authentication Failed".</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> Your app suddenly can't connect. Error: <code>MongoServerError: Authentication failed</code> or <code>connection refused</code>.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Checklist (in order):</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><strong>1. IP Whitelist:</strong> In Atlas â†’ Network Access, check if your app server's IP is whitelisted. For dynamic IPs (e.g., AWS Lambda), use <code>0.0.0.0/0</code> (not recommended for prod) or VPC Peering.</li>
                                <li><strong>2. Database User:</strong> In Atlas â†’ Database Access, verify the username/password. Check that the user has the correct role (e.g., <code>readWrite</code> on your database).</li>
                                <li><strong>3. Connection String:</strong> Ensure you're using the correct format: <code>mongodb+srv://</code> for Atlas (not <code>mongodb://</code>).</li>
                                <li><strong>4. Password Special Characters:</strong> If your password contains <code>@</code>, <code>#</code>, or <code>%</code>, URL-encode it (e.g., <code>@</code> becomes <code>%40</code>).</li>
                            </ul>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#gov-security" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Security Strategy â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/security/ip-access-list/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— IP Whitelist Guide â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I rotate database passwords without downtime?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Zero-Downtime Password Rotation (4-step process):</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-2">1. <strong>Create a new user</strong> with a new password (e.g., <code>appuser_v2</code>)</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-2">2. <strong>Update 50% of app servers</strong> to use the new credentials (rolling deployment)</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-2">3. <strong>Verify</strong> the new user works (check logs, monitor connections)</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">4. <strong>Update remaining 50%</strong> of app servers, then delete the old user</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Alternative (Simpler):</strong> Use <strong>AWS Secrets Manager</strong> or <strong>HashiCorp Vault</strong> to auto-rotate credentials. MongoDB Atlas supports native integration with both.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="https://www.mongodb.com/docs/atlas/security-aws-secret-manager/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— AWS Secrets Manager Integration â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I see who deleted a document? (Auditing)</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> A critical document was deleted. You need to know who did it and when for compliance/forensics.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution: Enable Atlas Auditing</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. In Atlas â†’ Project Settings â†’ Advanced â†’ Enable Auditing<br>2. Configure audit filters (e.g., log all <code>delete</code> operations)<br>3. Logs are sent to Atlas UI or forwarded to S3/Datadog/Splunk</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>What gets logged:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li>User who performed the action (database username)</li>
                                <li>Timestamp (UTC)</li>
                                <li>Operation type (insert, update, delete, drop)</li>
                                <li>Query filter (e.g., <code>{_id: "12345"}</code>)</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Important:</strong> Auditing has a <strong>5-10% performance overhead</strong>. Only enable for production clusters where compliance is required (SOC 2, HIPAA, PCI-DSS).</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#gov-security" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Compliance & Governance â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/database-auditing/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Atlas Auditing Guide â†’</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 5: Advanced Features -->
                <section id="faq-advanced">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        <h3 class="text-2xl font-bold">Advanced Features</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: Why is my Atlas Search query returning empty results?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Scenario:</strong> You created an Atlas Search index, but queries return 0 results even though the data exists.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Common Causes:</strong></p>
                            <ul class="text-[--mongo-text-muted] text-xs ml-4 mb-3 list-disc">
                                <li><strong>Index not built yet:</strong> Check Atlas â†’ Search â†’ Index Status. Initial indexing can take 5-30 minutes for large collections.</li>
                                <li><strong>Field mapping mismatch:</strong> Your query searches <code>description</code> but your index only maps <code>title</code>. Use dynamic mapping or explicitly map all fields.</li>
                                <li><strong>Analyzer mismatch:</strong> You're searching for "cafÃ©" but the index uses <code>lucene.standard</code> analyzer which strips accents. Use <code>lucene.keyword</code> for exact matches.</li>
                            </ul>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Debugging:</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Test with a simple wildcard query:\ndb.collection.aggregate([\n  {\n    $search: {\n      index: "default",\n      text: { query: "*", path: { wildcard: "*" } }\n    }\n  }\n])</div>
        </div>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#advanced-search" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Atlas Search Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/atlas/atlas-search/tutorial/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Atlas Search Tutorial â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: Why is my Regex query so slow?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Short Answer:</strong> Regex queries (especially with leading wildcards like <code>/.*value/</code>) cannot use indexes and scan every document. This is an <strong>anti-pattern</strong> for large collections.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Example of a slow query:</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// BAD: Scans entire collection\ndb.products.find({ name: /.*laptop.*/i })  // Case-insensitive search</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution: Use Atlas Search (Lucene-based)</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// GOOD: Uses full-text index\ndb.products.aggregate([\n  {\n    $search: {\n      index: "products_search",\n      text: { query: "laptop", path: "name" }\n    }\n  }\n])</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Performance:</strong> Atlas Search can handle millions of documents with <10ms latency. Regex on the same dataset would take 10+ seconds.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#perf-tips" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Query Anti-Patterns â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/reference/operator/query/regex/#index-use" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Regex Performance Docs â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I expire old data automatically?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Use Case:</strong> You have logs, sessions, or events that should be deleted after 30 days to save storage costs.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution 1: TTL Index (Time-To-Live)</strong> [Simplest]</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Create a TTL index on a date field:\ndb.sessions.createIndex(\n  { "createdAt": 1 },\n  { expireAfterSeconds: 2592000 }  // 30 days in seconds\n)

// MongoDB automatically deletes documents where createdAt + 30 days < now</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Solution 2: Atlas Online Archive</strong> [Cost-Optimized]</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">Move old data to S3 (as Parquet) for 90% cost savings. Data is still queryable via Data Federation but stored in cheap cold storage.</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Comparison:</strong> TTL = data is deleted forever. Online Archive = data is moved to S3 but still accessible.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="#arch-online-archive" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ“– Online Archive Guide â†’</a>
                                <a href="https://www.mongodb.com/docs/manual/core/index-ttl/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— TTL Index Documentation â†’</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 6: General -->
                <section id="faq-general">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                        <h3 class="text-2xl font-bold">General / How-To</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I upgrade the cluster version?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>In Atlas:</strong> Upgrades are <strong>zero-downtime rolling upgrades</strong>. Atlas upgrades secondaries first, then fails over to a new primary.</p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. Atlas â†’ Cluster â†’ Configuration â†’ MongoDB Version â†’ Select new version<br>2. Click "Upgrade" â†’ Atlas handles the rest automatically<br>3. Expect 1-2 brief connection errors during primary failover (5-10 seconds)</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>Important:</strong> Test upgrades in a staging environment first. Major version upgrades (e.g., 5.0 â†’ 6.0) may have breaking changes in query behavior or deprecated features.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="https://www.mongodb.com/docs/atlas/cluster-config/modify-cluster/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— Atlas Cluster Modification â†’</a>
                            </div>
                        </div>

                        <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                            <p class="text-white font-semibold mb-3">Q: How do I export data to CSV/JSON?</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Method 1: mongoexport (CLI)</strong></p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">// Export to JSON:\nmongoexport --uri="mongodb+srv://..." --collection=users --out=users.json

// Export to CSV:\nmongoexport --uri="mongodb+srv://..." --collection=users --type=csv --fields=name,email,createdAt --out=users.csv</div>
        </div>
                            <p class="text-[--mongo-text-muted] text-sm mb-2"><strong>Method 2: MongoDB Compass (GUI)</strong></p>
                            <p class="text-[--mongo-text-muted] text-xs mb-3">1. Open Compass â†’ Connect to cluster<br>2. Navigate to collection â†’ Documents tab<br>3. Click "Export" â†’ Choose JSON or CSV</p>
                            <p class="text-[--mongo-text-muted] text-sm mb-3"><strong>For large exports (>1GB):</strong> Use <code>mongodump</code> (BSON format) for full fidelity, then convert to JSON if needed.</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <a href="https://www.mongodb.com/docs/database-tools/mongoexport/" target="_blank" rel="noopener noreferrer" class="text-[--mongo-green] text-xs hover:underline border border-[--mongo-green] px-2 py-1 rounded">ðŸ”— mongoexport Documentation â†’</a>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab 9: API Examples -->
            <div id="tab-growth" class="tab-content p-6 md:p-10 space-y-8">
                
                <!-- Quick Links Index -->
                <div class="quick-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#growth-planning">Capacity Planning</a></li>
                        <li><a href="#growth-fast">Fast-Growth Strategy</a></li>
                        <li><a href="#growth-slow">Start Small Strategy</a></li>
                    </ul>
                </div>

                <!-- Section 1: Growth & Capacity Planning -->
                <section id="growth-planning">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11l5-5m0 0l5 5m-5-5v12" /></svg>
                        <h3 class="text-2xl font-bold">Growth & Capacity Planning</h3>
                    </div>

                    <h4 class="text-xl font-semibold text-white mt-4">Managing 20TB+ Growth</h4>
                    <p class="text-[--mongo-text] mb-4">Avoid performance degradation during massive data loads without live rebalancing.<a href="https://www.tencentcloud.com/techpedia/114181" target="_blank" rel="noopener noreferrer" class="ref-link">[1]</a><a href="http://learnmongodbthehardway.com/schema/sharding/" target="_blank" rel="noopener noreferrer" class="ref-link">[2]</a><a href="https://stackoverflow.com/questions/31751008/is-mongodb-always-write-to-primary-shard-and-then-rebalance" target="_blank" rel="noopener noreferrer" class="ref-link">[3]</a></p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mb-4">
                        <li><strong class="text-[--mongo-text]">Pre-sharding is essential:</strong> Manually split chunks *before* bulk loads.</li>
                        <li>Disable the balancer during initial data load to prevent contention.</li>
                        <li><strong class="text-[--mongo-text]">Capacity Planning (4TB Shard Limit):</strong> A 20TB dataset requires a minimum of 5-6 shards.<a href="https://www.mongodb.com/community/forums/t/limits-on-data-size-2/173571" target="_blank" rel="noopener noreferrer" class="ref-link">[4]</a><a href="https://www.mongodb.com/community/forums/t/mongodb-atlas-storage-pricing-for-chunks-and-shard/309514" target="_blank" rel="noopener noreferrer" class="ref-link">[5]</a></li>
                    </ul>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                            <p>This is a critical risk mitigation and future-proofing strategy. Knowing the 4TB "soft-cap" per shard now prevents you from building an architecture that is guaranteed to fail at 5TB, avoiding a costly, high-risk emergency re-architecture later. </p>                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>This 4TB limit isn't just about disk space; it's about the "working set" (active data + indexes) and the RAM on a single node. A single, massive 10TB shard would have a working set that's impossible to cache, leading to 100% disk-bound operations and a total performance collapse. Spreading the load ensures each shard's working set can be effectively managed by its node's RAM.</p>
                        </div>
                    </details>

                    <h4 id="growth-fast" class="text-xl font-semibold text-white mt-8">Fast-Growth Quick Start ("Scale Wide, then Tall")</h4>
                    <p class="text-[--mongo-text-muted] mb-4">For applications expecting 10+ TB soon. Start with 4 shards (M30 x 4) and scale the tier vertically (M30 -> M50 -> M60) as data grows. This is a zero-downtime operation. </br> NOTE: Use zone sharding if you think growth is unprecedented within a shard key boundary </p>
                    
                    <!-- SVG Illustration for Fast Growth -->
                    <div class="svg-diagram bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                        <svg width="100%" height="150" viewBox="0 0 400 150">
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="var(--mongo-text-muted)" />
                                </marker>
                            </defs>
                            
                            <!-- Initial State -->
                            <text x="50" y="20" class="label-text" text-anchor="middle">Initial Setup</text>
                            <g>
                                <rect x="10" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="50" y="55" class="node-text" text-anchor="middle">M30 x 4 Shards</text>
                                <text x="50" y="85" class="label-text" text-anchor="middle">(2-4TB)</text>
                            </g>
                            
                            <!-- Arrow 1 -->
                            <line x1="95" y1="50" x2="135" y2="50" class="arrow-line" />
                            <text x="115" y="45" class="arrow-text" text-anchor="middle">At 5TB</text>
                            
                            <!-- State 2 -->
                            <g>
                                <rect x="140" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="180" y="55" class="node-text" text-anchor="middle">M50 x 4 Shards</text>
                                <text x="180" y="85" class="label-text" text-anchor="middle">(5-8TB)</text>
                            </g>
                            
                            <!-- Arrow 2 -->
                            <line x1="225" y1="50" x2="265" y2="50" class="arrow-line" />
                            <text x="245" y="45" class="arrow-text" text-anchor="middle">At 8TB</text>
                            
                            <!-- State 3 -->
                            <g>
                                <rect x="270" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="310" y="55" class="node-text" text-anchor="middle">M60 x 4 Shards</text>
                                <text x="310" y="85" class="label-text" text-anchor="middle">(8-16TB)</text>
                            </g>
                            
                            <!-- Vertical Scaling Label -->
                            <line x1="180" y1="95" x2="180" y2="120" class="arrow-line" />
                            <text x="180" y="135" class="arrow-text" text-anchor="middle">"Scale Tall" (Vertical)</text>
                            <text x="50" y="105" class="label-text" text-anchor="middle">"Scale Wide" (4 Shards)</text>
                        </svg>
                    </div>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                            <p>This architecture provides the optimal balance of cost and scalability. It gives you the scalability of a sharded architecture (even data distribution) with the cost-efficiency and operational simplicity of vertical scaling (just clicking a button in the Atlas UI).</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Starting with 4 shards (scaling "wide") before you have the data solves the data distribution problem from day one. New data is automatically spread evenly, preventing "hotspots." Then, as data volume grows, you simply scale vertically (scaling "tall" from M30 -> M50). This is a zero-downtime, rolling operation in Atlas and is far cheaper and safer than trying to add new shards to a "hot" cluster.</p>
                        </div>
                    </details>

                    <h4 id="growth-slow" class="text-xl font-semibold text-white mt-8">Start Small and Grow Strategy</h4>
                    <p class="text-[--mongo-text-muted] mb-4">The 4-stage path for slow-growth projects (Single Replica Set -> Sharded Cluster).</p>
                    
                    <!-- SVG Illustration for Slow Growth -->
                    <div class="svg-diagram bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                        <svg width="100%" height="150" viewBox="0 0 400 150">
                            <!-- Stage 1 -->
                            <text x="50" y="20" class="label-text" text-anchor="middle">Stage 1 (0-2TB)</text>
                            <g>
                                <rect x="10" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="50" y="55" class="node-text" text-anchor="middle">Single Replica Set</text>
                            </g>
                            
                            <!-- Arrow 1 -->
                            <line x1="95" y1="50" x2="135" y2="50" class="arrow-line" />
                            <text x="115" y="45" class="arrow-text" text-anchor="middle">At 4TB</text>
                            
                            <!-- Stage 3 -->
                            <text x="180" y="20" class="label-text" text-anchor="middle">Stage 3 (4-10TB)</text>
                            <g>
                                <rect x="140" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="180" y="55" class="node-text" text-anchor="middle">2-3 Shards</text>
                            </g>
                            <text x="180" y="85" class="warn-text" text-anchor="middle">!! Rebalancing Risk !!</text>
                            
                            <!-- Arrow 2 -->
                            <line x1="225" y1="50" x2="265" y2="50" class="arrow-line" />
                            <text x="245" y="45" class="arrow-text" text-anchor="middle">At 10TB+</text>
                            
                            <!-- Stage 4 -->
                            <text x="310" y="20" class="label-text" text-anchor="middle">Stage 4 (10-20TB+)</text>
                            <g>
                                <rect x="270" y="30" width="80" height="40" rx="5" class="node" />
                                <text x="310" y="55" class="node-text" text-anchor="middle">Add Shards (3+)</text>
                            </g>
                        </svg>
                    </div>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                           <p>This strategy is optimized for minimal initial cost and complexity. It's the right choice for new projects, internal tools, or businesses with uncertain or slow-growth projections. It avoids the (slightly) higher cost and configuration overhead of a sharded cluster until it's absolutely necessary.</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>This is the most common growth path, but it comes with a significant trade-off. The "Stage 3" conversion from a single replica set to a sharded cluster is a major operational event. It is not a simple button-click. It requires configuration changes, and more importantly, it kicks off a live, production-impacting rebalancing as the database moves 50% of your data from the first shard to the new one.</p>
                        </div>
                    </details>
                    <p class="text-[--mongo-text-muted] mt-4 font-semibold">Note: this will still need rebalancing on production.</p>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content">
                           <p>This warning highlights the primary business risk of the "Start Small" strategy. That "time-consuming task" (rebalancing) introduces significant performance risk to your live application. It can cause latency spikes, resource contention, and unpredictable behavior for hours or even days while the data is redistributed.</p>
                        </div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>The "Fast-Growth" (1A) strategy avoids this specific pain point entirely by starting sharded. This "Start Small" (1B) strategy defers the complexity, but you pay for it later with this high-risk rebalancing event. This is a critical trade-off to discuss with stakeholders: minimal cost now vs. operational risk later.</p>
                        </div>
                    </details>
                </section>
            </div>

            <!-- Tab 2: Core & Advanced Features -->
            <div id="tab-performance" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Quick Links</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#perf-workflow" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Tuning Workflow</a>
                        <a href="#perf-latency" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Latency Spikes</a>
                        <a href="#perf-query" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Query Optimization</a>
                        <a href="#perf-sharding" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Sharding</a>
                        <a href="#perf-monitoring" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Monitoring</a>
                        <a href="#perf-connections" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Connections</a>
                        <a href="#perf-tips" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Query Tips</a>
                    </div>
                </div>
                
                <!-- Introduction -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>
                        <h3 id="perf-overview" class="text-2xl font-bold">Performance Troubleshooting & Optimization</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-6">A systematic approach to diagnosing and resolving performance bottlenecks in MongoDB Atlas. Follow the <strong>Detect â†’ Diagnose â†’ Resolve</strong> workflow to maintain peak performance.</p>

                    <!-- 1. The Performance Tuning Workflow -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-8">
                        <h4 id="perf-workflow" class="text-xl font-semibold text-white mb-4">The Performance Tuning Workflow</h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ” Detect</h5>
                                <p class="text-[--mongo-text-muted] text-sm">Identify issues before users do.</p>
                                <ul class="text-[--mongo-text-muted] text-sm mt-2 space-y-1">
                                    <li>â€¢ <strong>Real-Time Performance Panel:</strong> Spot CPU/Disk spikes.</li>
                                    <li>â€¢ <strong>Alerts:</strong> Receive notifications for high latency.</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ©º Diagnose</h5>
                                <p class="text-[--mongo-text-muted] text-sm">Find the root cause.</p>
                                <ul class="text-[--mongo-text-muted] text-sm mt-2 space-y-1">
                                    <li>â€¢ <strong>Query Profiler:</strong> Find slow operations (>100ms).</li>
                                    <li>â€¢ <strong>Performance Advisor:</strong> Get index recommendations.</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">âœ… Resolve</h5>
                                <p class="text-[--mongo-text-muted] text-sm">Fix and verify.</p>
                                <ul class="text-[--mongo-text-muted] text-sm mt-2 space-y-1">
                                    <li>â€¢ <strong>Add Indexes:</strong> Follow ESR rule.</li>
                                    <li>â€¢ <strong>Scale Up:</strong> Increase instance size if needed.</li>
                                    <li>â€¢ <strong>Optimize Code:</strong> Fix inefficient queries.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Diagnosing Latency Spikes -->
                    <div class="mb-8">
                        <h4 id="perf-latency" class="text-xl font-semibold text-white mb-4">Diagnosing Latency Spikes</h4>
                        <div class="bg-[#001E2B] p-6 rounded-lg border border-[--mongo-border]">
                            <p class="text-[--mongo-text-muted] mb-4">When your application feels slow, use the Real-Time Performance Panel (RTPP) to check cluster health.</p>
                            
                            <!-- How to Identify -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Identify the Source</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>CPU Usage > 80%:</strong> The DB is struggling. Likely missing indexes or unoptimized queries.</li>
                                    <li><strong>Disk IOPS Hitting Limits:</strong> Check "Disk IOPS" chart. If flatlined at max, you need more IOPS or better indexes.</li>
                                    <li><strong>Ticket Queues:</strong> Check "Read/Write Tickets". If available tickets drop to 0, the DB is overwhelmed.</li>
                                    <li><strong>App Logs:</strong> Look for `MongoTimeoutError` or long GC pauses correlating with DB spikes.</li>
                                </ul>
                            </div>

                            <!-- How to Fix -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Fix It</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Immediate Relief:</strong> Kill long-running operations using `db.killOp(<opid>)` (find opid in `db.currentOp()`).</li>
                                    <li><strong>Scale Up:</strong> Temporarily increase instance size (e.g., M30 -> M40) to handle load while debugging.</li>
                                    <li><strong>Add Indexes:</strong> Use the Performance Advisor to find and create missing indexes.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Query Optimization -->
                    <div class="mb-8">
                        <h4 id="perf-query" class="text-xl font-semibold text-white mb-4">Query Optimization (The #1 Fix)</h4>
                        <div class="bg-[#001E2B] p-6 rounded-lg border border-[--mongo-border]">
                            <p class="text-[--mongo-text-muted] mb-4">90% of performance issues are due to unindexed or poorly indexed queries.</p>

                            <!-- How to Identify -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Identify Slow Queries</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Query Profiler:</strong> Look for operations taking <strong>>100ms</strong>. Sort by "Count" to find frequent offenders.</li>
                                    <li><strong>Explain Plan (COLLSCAN):</strong> Indicates a full collection scan (Bad).</li>
                                    <li><strong>Explain Plan (SORT_KEY_GENERATOR):</strong> Indicates an expensive in-memory sort.</li>
                                </ul>
                            </div>

                            <!-- How to Fix -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Fix: Indexing Strategies</h5>
                                <p class="text-sm text-[--mongo-text-muted] mb-2"><strong>The ESR Rule (Equality, Sort, Range):</strong> Order index fields in this sequence:</p>
                                <ol class="list-decimal list-outside space-y-1 pl-5 text-sm text-white mb-3">
                                    <li><strong>Equality:</strong> Fields matched exactly (e.g., `status: "active"`).</li>
                                    <li><strong>Sort:</strong> Fields used for sorting (e.g., `createdAt: -1`).</li>
                                    <li><strong>Range:</strong> Fields with range operators (e.g., `price: { $gt: 100 }`).</li>
                                </ol>
                                <p class="text-sm text-[--mongo-text-muted] mb-2"><strong>Advanced Strategies:</strong></p>
                                <ul class="list-disc list-outside space-y-1 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Partial Indexes:</strong> Index only a subset of documents (e.g., `{ status: "active" }`) to save RAM/Disk.</li>
                                </ul>
                            </div>

                            <details class="expandable-box mb-4">
                                <summary>Deep Dive: What is a Query Shape?</summary>
                                <div class="expandable-box-content">
                                    <p class="text-sm text-[--mongo-text-muted] mb-3">A <strong>Query Shape</strong> is a combination of the query predicate, sort, and projection. It ignores specific values. Optimizing one shape fixes performance for <em>all</em> queries of that type.</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mb-3">
// SAME Shape (Optimize once):
db.users.find({ status: "active", age: 25 })
db.users.find({ status: "active", age: 99 })

// DIFFERENT Shape (Needs separate index):
db.users.find({ status: "active", city: "NY" })
                                    </div>
        </div>
                                    <div class="mt-3 p-3 bg-[#001017] rounded border border-[--mongo-border]">
                                        <p class="text-xs text-white font-bold mb-1">ðŸ” How to Find Query Shape Hash:</p>
                                        <ol class="list-decimal list-inside text-xs text-[--mongo-text-muted] space-y-1">
                                            <li>Go to <strong>Atlas UI â†’ Profiler</strong>.</li>
                                            <li>Click on a slow query to expand details.</li>
                                            <li>Look for the <code>queryHash</code> or <code>planCacheKey</code> field in the JSON details.</li>
                                            <li>Use this hash to track this specific query shape across logs and profilers.</li>
                                        </ol>
                                    </div>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>Example: Optimizing with ESR</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2"><strong>Query:</strong> Find active users, sort by join date, filter by age > 25.</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">db.users.find({ status: "active", age: { $gt: 25 } }).sort({ joinedAt: -1 })</div>
        </div>
                                    <p class="mb-2"><strong>âŒ Bad Index:</strong> `{ age: 1, status: 1, joinedAt: 1 }` (Violates ESR)</p>
                                    <p class="mb-2"><strong>âœ… Good Index:</strong> `{ status: 1, joinedAt: 1, age: 1 }` (Follows ESR)</p>
                                    <p class="mt-2 text-sm text-[--mongo-text-muted]"><strong>Why?</strong> Putting the Range field (`age`) before Sort (`joinedAt`) prevents MongoDB from using the index for sorting, forcing an expensive in-memory sort.</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- 4. Sharding Performance -->
                    <div class="mb-8">
                        <h4 id="perf-sharding" class="text-xl font-semibold text-white mb-4">Sharding Performance: Hot Shards</h4>
                        <div class="bg-[#001E2B] p-6 rounded-lg border border-[--mongo-border]">
                            <p class="text-[--mongo-text-muted] mb-4">Uneven data distribution leads to "Hot Shards" - one node doing all the work.</p>

                            <!-- How to Identify -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Identify a Hot Shard</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Hardware Imbalance:</strong> One shard at 90% CPU, others at 5%.</li>
                                    <li><strong>Opcounters Skew:</strong> 10x more inserts on one shard than others.</li>
                                    <li><strong>Check Distribution:</strong> Run <code>db.collection.getShardDistribution()</code> to see data size per shard.</li>
                                    <li><strong>Analyze sh.status():</strong>
                                        <ul class="list-disc list-outside pl-5 mt-1 text-xs">
                                            <li>Check <code>balancer: "running"</code> (should be running).</li>
                                            <li>Check chunk counts per shard. A variance > 10-20 chunks suggests the balancer is lagging or stuck.</li>
                                        </ul>
                                    </li>
                                    <li><strong>Zone Ranges:</strong> Use <code>sh.balancerCollectionStatus()</code> to verify if chunks are pinned to the wrong zone (common in geo-sharding).</li>
                                </ul>
                            </div>

                            <!-- How to Fix -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Fix Hot Shards</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Refine Shard Key:</strong> Add a high-cardinality suffix to spread writes.
                                        <p class="text-xs mt-1 text-white"><em>Tip: High Cardinality (many unique values) != Good Distribution. You also need High Frequency (randomness).</em></p>
                                    </li>
                                    <li><strong>Hashed Sharding:</strong> Use `{ _id: "hashed" }` for random distribution.</li>
                                    <li><strong>Resharding (v5.0+):</strong> Use <code>db.adminCommand({ reshardCollection: "db.coll", key: { newKey: 1 } })</code> to fix a bad key online without downtime.</li>
                                    <li><strong>Manual Balance:</strong> Use <code>sh.moveChunk()</code> to manually migrate chunks off the hot shard.</li>
                                </ul>
                            </div>

                            <details class="expandable-box mb-4">
                                <summary>Deep Dive: The Jumbo Chunk Problem</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>What is it?</strong> A chunk >64MB that cannot be split because all documents have the same shard key.</p>
                                    <p class="mb-3"><strong>Fix:</strong></p>
                                    <ul class="list-disc list-outside space-y-2 pl-5">
                                        <li><strong>Immediate:</strong> `sh.splitAt()` if values differ.</li>
                                        <li><strong>Long-term:</strong> Refine shard key (e.g., add `userId` to `country`).</li>
                                    </ul>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>Deep Dive: Monotonically Increasing Keys</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>The Problem:</strong> Sharding on `createdAt` or `_id` (default ObjectId) causes all new inserts to go to the "last" chunk on a single shard. This creates a write hotspot that limits total cluster throughput to the speed of a single shard.</p>
                                    <p><strong>The Solution:</strong> Use <strong>Hashed Sharding</strong> on the key to randomly distribute writes across all shards, or use a compound shard key like `{ region: 1, createdAt: 1 }` to distribute writes by region.</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- 5. Monitoring & Alerts -->
                    <div class="mb-8">
                        <h4 id="perf-monitoring" class="text-xl font-semibold text-white mb-4">Monitoring & Alerts</h4>
                        <div class="overflow-x-auto rounded-lg border border-[--mongo-border]">
                            <table class="w-full text-left text-sm text-[--mongo-text-muted]">
                                <thead class="bg-[#001E2B] text-white uppercase">
                                    <tr>
                                        <th class="px-4 py-3">Metric</th>
                                        <th class="px-4 py-3">Threshold</th>
                                        <th class="px-4 py-3">Meaning</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-[--mongo-border] bg-[--mongo-card-accent]">
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">CPU Usage (System vs User)</td>
                                        <td class="px-4 py-3">> 80%</td>
                                        <td class="px-4 py-3">High <strong>User</strong> = DB work. High <strong>System</strong> = OS contention (Context Switching, Steal).</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">Disk Queue Depth</td>
                                        <td class="px-4 py-3">> 10</td>
                                        <td class="px-4 py-3">Disk I/O saturated. Upgrade IOPS or fix queries.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">Disk Burst Balance</td>
                                        <td class="px-4 py-3">< 20%</td>
                                        <td class="px-4 py-3">For AWS GP2/GP3. Running out of credits drops performance to baseline.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">Replication Lag / Oplog Window</td>
                                        <td class="px-4 py-3">> 60s / < 24h</td>
                                        <td class="px-4 py-3">Risk of stale reads. Small Oplog Window (< 24h) risks sync failure during maintenance.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">WiredTiger Cache "Dirty"</td>
                                        <td class="px-4 py-3">> 20%</td>
                                        <td class="px-4 py-3">Cache is filling with unwritten data. Causes write stalls (checkpoints).</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 font-medium text-white">Connections</td>
                                        <td class="px-4 py-3">> 80% of limit</td>
                                        <td class="px-4 py-3">Connection leak or sudden traffic spike.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 6. Connection Management -->
                    <div class="mb-8">
                        <h4 id="perf-connections" class="text-xl font-semibold text-white mb-4">Connection Management & Storms</h4>
                        <div class="bg-[#001E2B] p-6 rounded-lg border border-[--mongo-border]">
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">The "Thundering Herd" Problem</h5>
                                <p class="text-sm text-[--mongo-text-muted]">When application server restarts, it may try to open thousands of new connections simultaneously. This "storm" overwhelms the database CPU with authentication handshakes, causing a complete lockout.</p>
                            </div>

                            <!-- How to Identify -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Identify Connection Storms</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Sudden Spike:</strong> Connection count jumps from normal to max limit in seconds.</li>
                                    <li><strong>App Restarts:</strong> Correlates with application deployment or restart events.</li>
                                    <li><strong>Error Logs:</strong> Look for <code>MongoTimeoutError: Timed out after 30000ms</code>.</li>
                                </ul>
                            </div>

                            <!-- How to Fix -->
                            <div class="bg-[--mongo-card-accent] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                <h5 class="text-[--mongo-green] font-bold mb-2">How to Fix: Best Practices for Connection Pooling</h5>
                                <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                    <li><strong>Singleton Pattern:</strong> Create ONE `MongoClient` instance per application process and reuse it.</li>
                                    <li><strong>maxPoolSize:</strong> Set this to limit the number of open connections (Default: 100).</li>
                                    <li><strong>minPoolSize:</strong> Set this (e.g., 5) to keep connections warm.</li>
                                    <li><strong>Connection String Example:</strong><br>
                                        <code class="text-xs bg-black p-1 rounded">mongodb+srv://host/db?maxPoolSize=100&minPoolSize=5&connectTimeoutMS=2000</code>
                                    </li>
                                </ul>
                            </div>

                            <details class="expandable-box mb-4">
                                <summary>Deep Dive: Sizing the Connection Pool</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2 text-sm text-[--mongo-text-muted]"><strong>Formula:</strong> <code>Pool Size = ((Core Count * 2) + Effective Spindle Count)</code></p>
                                    <p class="mb-2 text-sm text-[--mongo-text-muted]"><strong>Why?</strong> MongoDB handles requests asynchronously. A pool size of 100 is usually enough to saturate even large clusters. Setting it to 10,000 just increases context switching overhead (Little's Law).</p>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>Deep Dive: Timeouts (Socket vs WaitQueue)</summary>
                                <div class="expandable-box-content">
                                    <ul class="list-disc list-outside space-y-2 pl-5 text-sm text-[--mongo-text-muted]">
                                        <li><strong>connectTimeoutMS:</strong> Fail fast if DB is down (e.g., 2000ms).</li>
                                        <li><strong>socketTimeoutMS:</strong> Kill the connection if a query takes too long (prevent hung threads). Use with caution.</li>
                                        <li><strong>waitQueueTimeoutMS:</strong> Time a thread waits for a connection from the pool. If this errors, your pool is too small or queries are too slow.</li>
                                    </ul>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- 7. Single Query Tips -->
                    <div>
                        <h4 id="perf-tips" class="text-xl font-semibold text-white mb-4">Single Query Tips & Anti-Patterns</h4>
                        <div class="space-y-4">
                            <details class="expandable-box">
                                <summary>$lookup Optimization</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2"><strong>Rule:</strong> Index the `foreignField` in the target collection.</p>
                                    <p class="text-sm">Without it, MongoDB does a collection scan for <em>every</em> document.</p>
                                </div>
                            </details>
                            <details class="expandable-box">
                                <summary>Unbounded Arrays & $unwind</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2"><strong>Risk:</strong> Unwinding a large array (e.g., 10,000 items) explodes the document count in the pipeline, consuming massive RAM.</p>
                                    <p class="text-sm"><strong>Fix:</strong> Filter the array before unwinding if possible, or use `$slice` to limit the number of items processed.</p>
                                </div>
                            </details>
                            <details class="expandable-box">
                                <summary>Regex & Case Insensitivity</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2"><strong>Anti-Pattern:</strong> <code>/^.*value/</code> (Leading wildcard) or Regex for case-insensitive search.</p>
                                    <p class="text-sm mb-2"><strong>Fix (Regex):</strong> Use <strong>Atlas Search</strong> (Lucene) for text search. Standard indexes cannot support leading wildcards.</p>
                                    <p class="text-sm"><strong>Fix (Case):</strong> Use <strong>Collation</strong> (Strength 1 or 2) on the index instead of Regex.</p>
                                </div>
                            </details>
                            <details class="expandable-box">
                                <summary>Pagination: Skip vs Keyset</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-2"><strong>Anti-Pattern:</strong> <code>.skip(50000).limit(10)</code>. The DB must scan and discard 50,000 docs.</p>
                                    <p class="text-sm"><strong>Fix:</strong> Use <strong>Keyset Pagination</strong> (Seek Method). Remember the last seen ID and query for the next page:</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-xs mt-2">find({ _id: { $gt: last_seen_id } }).limit(10)</div>
        </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab 8: Frequent FAQs -->
            <div id="tab-enterprise" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Quick Links</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#ent-overview" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Enterprise Advanced</a>
                        <a href="#ent-ops-manager" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Ops Manager</a>
                        <a href="#ent-kubernetes" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Kubernetes Operator</a>
                        <a href="#ent-vs-atlas" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Enterprise vs Atlas</a>
                    </div>
                </div>
                
                <!-- Introduction -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3m3 3a3 3 0 100 6h13.5a3 3 0 100-6m-16.5-3a3 3 0 013-3h13.5a3 3 0 013 3m-19.5 0a4.5 4.5 0 01.9-2.7L5.737 5.1a3.375 3.375 0 012.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 01.9 2.7m0 0a3 3 0 01-3 3m0 3h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008zm-3 6h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008z" /></svg>
                        <h3 id="ent-overview" class="text-2xl font-bold">MongoDB Enterprise Advanced (On-Premises)</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Self-Managed, Enterprise-Grade MongoDB.</strong> MongoDB Enterprise Advanced is the on-premises license that provides advanced security, management tooling, and operational control for organizations that need to run MongoDB in their own data centers or private clouds.</p>
                    
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h5 class="text-[--mongo-green] font-bold mb-3">What's Included</h5>
                        <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">MongoDB Server:</strong> Self-managed database with all enterprise features</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Ops Manager:</strong> Comprehensive management platform for monitoring, backup, and automation</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Kubernetes Operator:</strong> Native Kubernetes integration for cloud-native deployments</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Advanced Security:</strong> LDAP, Kerberos, encryption at rest, auditing, FIPS 140-2</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">In-Memory Storage Engine:</strong> Extreme performance for specific workloads</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">24/7 Enterprise Support:</strong> Direct access to MongoDB engineers</span></li>
                        </ul>
                    </div>
                </section>

                <!-- Ops Manager -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                        <h3 id="ent-ops-manager" class="text-2xl font-bold">Ops Manager: Mission Control for MongoDB</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Centralized Management Platform.</strong> Ops Manager is MongoDB's on-premises management platform that provides monitoring, backup, and automation for hundreds or thousands of MongoDB deployments from a single interface.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ“Š Monitoring & Alerting</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">100+ Metrics:</strong> Real-time performance monitoring</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Custom Alerts:</strong> Proactive issue detection</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Query Profiler:</strong> Identify slow queries</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Index Advisor:</strong> Optimization recommendations</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ’¾ Backup & Recovery</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Continuous Backup:</strong> Point-in-time recovery</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Snapshot Management:</strong> Scheduled backups</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Queryable Backups:</strong> Restore to any point</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Disaster Recovery:</strong> Multi-site backup storage</span></li>
                            </ul>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ¤– Automation</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Zero-Downtime Upgrades:</strong> Rolling upgrades across clusters</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Configuration Management:</strong> Centralized config deployment</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Scaling Operations:</strong> Add/remove nodes automatically</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Self-Healing:</strong> Automatic failover and recovery</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸŽ¯ Scale Management</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Multi-Cluster:</strong> Manage 1000+ deployments</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Role-Based Access:</strong> Team permissions & audit logs</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">API Integration:</strong> Automate via REST API</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Compliance Reports:</strong> Audit trail for regulations</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Real-World Use Case: Managing 500+ MongoDB Clusters</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Scenario:</strong> A large financial institution runs 500+ MongoDB replica sets across multiple data centers for different business units (trading, risk management, customer data).</p>
                            <p class="mb-3"><strong>Challenge:</strong> Without Ops Manager, each team would need dedicated DBAs to monitor, backup, and maintain their clusters. This creates inconsistent practices, security gaps, and operational overhead.</p>
                            <p class="mb-3"><strong>Solution with Ops Manager:</strong> A central platform team manages all 500+ deployments from a single Ops Manager instance. Automated backups run every 6 hours with point-in-time recovery. Performance alerts are standardized across all clusters. Upgrades are rolled out systematically with zero downtime.</p>
                            <p><strong>Result:</strong> 80% reduction in operational overhead, 99.99% uptime, and compliance-ready audit logs. A team of 5 DBAs can manage what would have required 50+ without Ops Manager.</p>
                        </div>
                    </details>
                </section>

                <!-- Kubernetes Operator -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                        <h3 id="ent-kubernetes" class="text-2xl font-bold">MongoDB Kubernetes Operator</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Cloud-Native MongoDB.</strong> The MongoDB Kubernetes Operator enables you to deploy, manage, and scale MongoDB clusters natively on Kubernetes, treating databases as Kubernetes resources with declarative configuration.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">â˜¸ï¸ Kubernetes-Native</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Custom Resources:</strong> Define MongoDB as YAML manifests</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">GitOps Ready:</strong> Version-controlled database configs</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Helm Charts:</strong> Simplified deployment</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Namespace Isolation:</strong> Multi-tenancy support</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ”„ Automated Operations</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Self-Healing:</strong> Automatic pod recovery</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Rolling Updates:</strong> Zero-downtime upgrades</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Auto-Scaling:</strong> HPA integration for reads</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Backup Integration:</strong> Works with Ops Manager</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Why Kubernetes Operator?</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Cloud-Native Architecture:</strong> Modern applications are built on Kubernetes. The Operator allows MongoDB to be deployed and managed using the same tools, workflows, and CI/CD pipelines as your applications.</p>
                            <p class="mb-3"><strong>Infrastructure as Code:</strong> Define your entire MongoDB infrastructure (replica sets, sharded clusters, users, roles) as YAML files. Version control them in Git. Deploy with kubectl or ArgoCD. This eliminates manual configuration and ensures consistency across environments.</p>
                            <p class="mb-3"><strong>Multi-Cloud Portability:</strong> Run the same MongoDB configuration on AWS EKS, Google GKE, Azure AKS, or on-premises Kubernetes. The Operator abstracts away cloud-specific details.</p>
                            <p><strong>Developer Experience:</strong> Developers can provision MongoDB databases using the same kubectl commands they use for everything else. No need to learn separate database provisioning tools.</p>
                        </div>
                    </details>

                    <details class="expandable-box">
                        <summary>Operator + Ops Manager: The Ultimate Combo</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Best of Both Worlds:</strong> The Kubernetes Operator handles deployment and lifecycle management on Kubernetes, while Ops Manager provides enterprise-grade monitoring, backup, and multi-cluster management.</p>
                            <p class="mb-3"><strong>How It Works:</strong> Deploy MongoDB using the Operator's Custom Resources. The Operator automatically registers the deployment with Ops Manager. Ops Manager then provides centralized monitoring, automated backups, and performance insights across all your Kubernetes-based MongoDB clusters.</p>
                            <p><strong>Use Case:</strong> A SaaS company runs 100+ MongoDB clusters across 20 Kubernetes namespaces (one per customer). The Operator automates deployment and scaling. Ops Manager provides a single pane of glass for monitoring all clusters, automated backups, and compliance reporting.</p>
                        </div>
                    </details>
                </section>

                <!-- When to Use Enterprise vs Atlas -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 id="ent-vs-atlas" class="text-2xl font-bold">When to Use Enterprise Advanced vs Atlas</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Strategic Decision Framework.</strong> Choosing between MongoDB Enterprise Advanced (on-prem) and MongoDB Atlas (SaaS) is a critical architectural decision that impacts cost, control, compliance, and operational overhead.</p>
                    
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h5 class="text-[--mongo-green] font-bold mb-3">Choose Enterprise Advanced (On-Prem) When:</h5>
                        <ul class="text-[--mongo-text-muted] text-sm space-y-3">
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">1.</span><span><strong class="text-white">Data Sovereignty Requirements:</strong> Regulations mandate data must stay in specific geographic locations or private data centers (e.g., government, healthcare in certain countries, financial services with strict data residency laws).</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">2.</span><span><strong class="text-white">Air-Gapped Environments:</strong> Your infrastructure is completely isolated from the internet for security reasons (defense, critical infrastructure, highly sensitive research).</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">3.</span><span><strong class="text-white">Existing Infrastructure Investment:</strong> You already have significant investment in on-premises data centers with excess capacity and want to maximize ROI.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">4.</span><span><strong class="text-white">Ultra-Low Latency Requirements:</strong> Your application requires <1ms database latency, which is only achievable with co-located compute and database on bare metal or dedicated hardware.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">5.</span><span><strong class="text-white">Custom Hardware Needs:</strong> You need specialized hardware (e.g., NVMe storage arrays, FPGA acceleration, specific CPU architectures) not available in cloud providers.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">6.</span><span><strong class="text-white">Extreme Scale (Petabyte+):</strong> At petabyte scale with predictable workloads, on-prem can be more cost-effective than cloud (though this requires significant operational expertise).</span></li>
                        </ul>
                    </div>

                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h5 class="text-[--mongo-green] font-bold mb-3">Choose Atlas (SaaS) When:</h5>
                        <ul class="text-[--mongo-text-muted] text-sm space-y-3">
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">1.</span><span><strong class="text-white">Speed to Market:</strong> You need to launch quickly without investing months in infrastructure setup and DBA hiring.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">2.</span><span><strong class="text-white">Variable Workloads:</strong> Your traffic is unpredictable or seasonal. Atlas auto-scaling eliminates over-provisioning costs.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">3.</span><span><strong class="text-white">Limited DBA Resources:</strong> You don't have dedicated MongoDB DBAs. Atlas handles upgrades, patching, backups, and monitoring automatically.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">4.</span><span><strong class="text-white">Global Distribution:</strong> You need low-latency access from multiple continents. Atlas provides 100+ regions worldwide with automatic data distribution.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">5.</span><span><strong class="text-white">Advanced Features:</strong> You want Atlas Search, Vector Search, Data Federation, Serverless, or Charts without managing additional infrastructure.</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">6.</span><span><strong class="text-white">Cost Optimization:</strong> For most workloads <10TB, Atlas is more cost-effective when you factor in operational overhead, DBA salaries, and infrastructure management.</span></li>
                        </ul>
                    </div>

                    <details class="expandable-box">
                        <summary>Scale Comparison: What Enterprise Can Do That Atlas Cannot</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Extreme Hardware Customization:</strong> Enterprise allows you to use bleeding-edge hardware not yet available in cloud providers. For example, deploying on servers with 1TB+ RAM, custom NVMe arrays with 20M+ IOPS, or specialized networking hardware for ultra-low latency trading systems.</p>
                            <p class="mb-3"><strong>Air-Gapped Deployments:</strong> Atlas requires internet connectivity. Enterprise can run in completely isolated networks with no external access, which is mandatory for certain government, defense, and critical infrastructure use cases.</p>
                            <p class="mb-3"><strong>Custom Storage Engines:</strong> While rare, Enterprise allows you to integrate custom storage engines or modify MongoDB internals for highly specialized use cases (though this requires deep expertise and is not recommended for most users).</p>
                            <p class="mb-3"><strong>Bare Metal Performance:</strong> On dedicated bare metal hardware, you can achieve lower latency and higher throughput than virtualized cloud environments. This matters for high-frequency trading, real-time analytics, or gaming leaderboards where every microsecond counts.</p>
                            <p><strong>Practical Analysis:</strong> For 95% of use cases, Atlas provides faster time-to-market than self-managed Enterprise.Choose Enterprise if you have specific requirements and scale that Atlas cannot meet.</p>
                        </div>
                    </details>

                    <details class="expandable-box">
                        <summary>Hybrid Approach: Best of Both Worlds</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Strategy:</strong> Many large organizations use both Atlas and Enterprise Advanced in a hybrid architecture. Atlas for new applications and global workloads, Enterprise for legacy systems and regulated data.</p>
                            <p class="mb-3"><strong>Example Architecture:</strong> A global bank uses Atlas for customer-facing mobile apps (fast iteration, global distribution) and Enterprise Advanced for core banking systems (data sovereignty, regulatory compliance, integration with existing on-prem infrastructure).</p>
                            <p class="mb-3"><strong>Migration Path:</strong> Start with Atlas for speed and agility. As you scale and mature, evaluate whether specific workloads would benefit from on-prem deployment. Use Ops Manager to manage both Atlas and on-prem clusters from a single interface.</p>
                            <p><strong>Data Synchronization:</strong> Use MongoDB's built-in replication or Atlas Data Federation to keep data synchronized between Atlas and on-prem clusters for disaster recovery or hybrid analytics.</p>
                        </div>
                    </details>
                </section>

            </div>

            <!-- Tab 6: Governance & Operations -->
            <div id="tab-architecture" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Quick Links</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#arch-multi-tenancy" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Multi-Tenancy</a>
                        <a href="#arch-best-practices" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Best Practices</a>
                        <a href="#arch-zero-downtime" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Zero Downtime</a>
                        <a href="#arch-backups" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Backups & HA</a>
                        <a href="#arch-online-archive" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Online Archive</a>
                    </div>
                </div>
                <!-- Section 4: Multi-Tenancy Models -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0v-2a2 2 0 012-2h5a2 2 0 012 2v2m-6 0v-2a2 2 0 012-2h1a2 2 0 012 2v2" /></svg>
                        <h3 id="arch-multi-tenancy" class="text-2xl font-bold">Multi-Tenancy Models: The Business of SaaS</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4">This decision framework directly aligns your infrastructure cost and isolation model with your business model. The wrong choice can kill profitability or block enterprise sales.<a href="https://www.mongodb.com/docs/atlas/build-multi-tenant-arch/" target="_blank" rel="noopener noreferrer" class="ref-link">[24]</a><a href="https://www.geeksforgeeks.org/dbms/build-a-multi-tenant-architecture-in-mongodb/" target="_blank" rel="noopener noreferrer" class="ref-link">[25]</a></p>
                    
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This decision framework directly aligns your infrastructure cost and isolation model with your business model. The wrong choice can kill profitability or block enterprise sales.</p></div>
                    </details>
                    
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-4">
                        <li><strong class="text-[--mongo-text]">Database per Tenant:</strong> A powerful sales tool for high-value enterprise customers. It provides maximum security, data isolation, and compliance (e.g., for HIPAA/GDPR). This is a premium, high-margin offering. (Great for < 100 tenants).</li>
                        <li><strong class="text-[--mongo-text]">Shared Collection:</strong> The key to profitability at scale for B2C, freemium, or SMB products. It has the lowest cost-per-tenant, allowing you to serve millions of users cost-effectively.</li>
                        <li><strong class="text-[--mongo-text]">Hybrid Model:</strong> The optimal business strategy. It allows you to capture the mass market with a low-cost shared plan while offering a high-margin "Enterprise" plan (with a dedicated database) as an upsell.</li>
                    </ul>
                    
                    <p class="text-[--mongo-text] mt-4 font-semibold">Key Recommendations:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>For shared collections, always use compound indexes with `tenantId` as the first field and shard on `{ tenantId: 1, userId: 1 }` for optimal distribution.<a href="https://www.mongodb.com/community/forums/t/best-shard-key-strategy-for-multi-tenant-e-commerce-platform/289972" target="_blank" rel="noopener noreferrer" class="ref-link">[26]</a></li>
                        <li>For Atlas Vector Search Multi-tenancy, use a single collection with `tenantID` as the index to filter out tenants.<a href="https://www.mongodb.com/community/forums/t/multi-tenancy-and-vector-search/252916" target="_blank" rel="noopener noreferrer" class="ref-link">[27]</a><a href="https://www.mongodb.com/docs/atlas/atlas-vector-search/multi-tenant-architecture/" target="_blank" rel="noopener noreferrer" class="ref-link">[28]</a></li>
                    </ul>

                    <details class="expandable-box">
                        <summary>Analysis (Shared Collection Best Practice)</summary>
                        <div class="expandable-box-content">
                            <p>Sharding on `{ tenantId: 1, ... }` is the most critical performance rule for the shared model. It co-locates all data for one tenant on a single shard. This ensures that a query for `tenantId="A"` is extremely fast (it only hits one server) and prevents a single, high-traffic "noisy neighbor" (`tenantId="B"`) from slowing down all other tenants.</p>
                        </div>
                    </details>
                </section>
                
                <!-- Section 5: Critical Best Practices -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2H1v-2h2v-2h2v2h2v-2h2v-2h2v-2h2v-2H9v-2H7V7H5V5h2V3h2v2h2v2h2v2h2v2h-2v2h-2v2h2v-2h-2v-2h-2v2z" /></svg>
                        <h3 id="arch-best-practices" class="text-2xl font-bold">Critical Best Practices: Protecting Production</h3>
                    </div>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Shard Key Selection<a href="https://www.geeksforgeeks.org/mongodb/shard-keys-in-mongodb/" target="_blank" rel="noopener noreferrer" class="ref-link">[29]</a><a href="https://www.mongodb.com/docs/manual/core/sharding-choose-a-shard-key/" target="_blank" rel="noopener noreferrer" class="ref-link">[9]</a></h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This decision ensures the long-term health and scalability of your entire application. A good key ensures performance and stability as you grow. A bad key (like a timestamp) guarantees performance bottlenecks, downtime, and an expensive, high-risk re-architecture project.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>A bad key (e.g., `_id` or timestamp) creates a "hot shard" where 100% of new writes go to a single server, completely negating the benefit of sharding. A high-cardinality key (like `userId` or `tenantId`) that appears in most queries spreads the load evenly, which is the entire goal.</p></div>
                    </details>
                    <p class="text-[--mongo-text] mt-4 font-semibold">Avoid common pitfalls:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>Don't use monotonically increasing fields (timestamps, `_id`) alone.</li>
                        <li>Don't create low-cardinality shard keys (status, country).</li>
                        <li>Don't skip pre-splitting for bulk loads.</li>
                        <li>Don't run long transactions (>60 seconds or >1,000 docs).</li>
                    </ul>


                    <h4 class="text-xl font-semibold text-white mt-6">Balancer Management</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is a simple risk mitigation strategy to protect cluster health. The balancer's job (moving data to keep shards even) consumes I/O and network resources.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>By scheduling this background maintenance to run only during low-traffic periods (e.g., 2 AM - 4 AM), you ensure it never impacts application performance during peak business hours. This prevents "random" slowdowns and guarantees a smooth experience for users when they are most active.</p>
                            <p>Connect to the `config` database on your Atlas cluster and run:</p>
                            <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block">
db.settings.updateOne(
  { _id: "balancer" },
  { $set: { activeWindow: { start: "02:00", stop: "06:00" } } },
  { upsert: true }
)
                            </div>
        </div>
                        </div>
                    </details>
                </section>

                <!-- Section 6: Zero Downtime -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                        <h3 id="arch-zero-downtime" class="text-2xl font-bold">Zero Downtime - Highly Available</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4">The <strong>5+1 Solution</strong>: A 3-region setup (5 electable nodes + 1 read-only) that provides <strong class="text-[--mongo-green]">< 5 second</strong> automatic failover with zero downtime if a primary region fails.</p>
                    <p class="text-[--mongo-text] font-semibold">Zero-downtime techniques include:</p>
                    <ul class="list-disc list-outside space-y-2 pl-5 text-[--mongo-text-muted] mt-2">
                        <li>Storage auto-scaling (first increase is in-place)<a href="https://www.mongodb.com/docs/atlas/customize-storage/" target="_blank" rel="noopener noreferrer" class="ref-link">[6]</a></li>
                        <li>Live resharding in MongoDB 5.0+ to change shard keys without downtime<a href="https://www.mongodb.com/resources/products/capabilities/scale-out-without-fear-friction-live-resharding-mongodb" target="_blank" rel="noopener noreferrer" class="ref-link">[7]</a></li>
                        <li>Rolling cluster tier upgrades (brief 2-5 second failover)</li>
                    </ul>
                </section>

                <!-- Section 7: Backups & High Availability -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.42-.38-2.75-.99-3.9l.01-.01c-.11.39-.22.78-.33 1.172m-13.256 0c1.32.39 2.71.64 4.15.64 3.314 0 6.3-1.29 8.57-3.417-2.27 2.127-5.256 3.417-8.57 3.417A10.965 10.965 0 013.33 6.643z" /></svg>
                        <h3 id="arch-backups" class="text-2xl font-bold">Backups & High Availability Strategy</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Business Continuity Foundation.</strong> A comprehensive backup and HA strategy protects against data loss, ensures business continuity, and meets compliance requirements. This is non-negotiable for production systems.</p>
                    
                    <!-- Backup Strategies -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">Backup Strategies</h4>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ“¸ Continuous Cloud Backup (Atlas)</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Point-in-Time Recovery:</strong> Restore to any second within retention window</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Retention:</strong> 1-35 days (configurable)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Snapshots:</strong> Hourly, daily, weekly, monthly</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">RPO:</strong> <1 hour (typically 6-8 hours for full snapshot)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Oplog Backup:</strong> Continuous for point-in-time granularity</span></li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ’¾ Snapshot Backup (Self-Managed)</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">mongodump:</strong> Logical backup (JSON/BSON export)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Filesystem Snapshots:</strong> LVM, EBS, or storage-level snapshots</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Ops Manager:</strong> Continuous backup with queryable snapshots</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Best Practice:</strong> Combine filesystem + oplog for PITR</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Schedule:</strong> Daily full + hourly incremental</span></li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>Backup Best Practices & 3-2-1 Rule</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>The 3-2-1 Backup Rule:</strong> A proven disaster recovery strategy that ensures data survivability.</p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>3 Copies:</strong> Production data + 2 backups (e.g., local snapshot + cloud backup)</li>
                                    <li><strong>2 Media Types:</strong> Different storage technologies (e.g., disk + object storage)</li>
                                    <li><strong>1 Off-Site:</strong> At least one backup in a different geographic location</li>
                                </ul>
                                <p class="mb-3"><strong>Atlas Implementation:</strong> Atlas automatically follows 3-2-1 with continuous backups stored in separate regions from your cluster. For critical data, enable cross-region backup copies.</p>
                                <p class="mb-3"><strong>Testing Backups:</strong> Schedule quarterly restore drills. A backup you've never tested is not a backup. Measure your actual RTO (Recovery Time Objective) during these drills.</p>
                                <p><strong>Encryption:</strong> Always encrypt backups at rest and in transit. Atlas backups are encrypted by default using the same encryption keys as your cluster.</p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Cross-Region Backups: Geographic Redundancy</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>What Are Cross-Region Backups?</strong> Cross-region backups store copies of your backup snapshots in a different geographic region from your primary cluster and primary backup storage. This provides an additional layer of protection against regional disasters.</p>
                                
                                <p class="mb-3"><strong>How It Works (Atlas):</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Primary Backup:</strong> Stored in the same region as your cluster (e.g., us-east-1)</li>
                                    <li><strong>Cross-Region Copy:</strong> Automatically replicated to a different region (e.g., eu-west-1)</li>
                                    <li><strong>Retention:</strong> Same retention policy as primary backups (1-35 days)</li>
                                    <li><strong>Recovery:</strong> Can restore from either primary or cross-region backup location</li>
                                </ul>

                                <p class="mb-3"><strong>When to Use Cross-Region Backups:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Regulatory Compliance:</strong> GDPR, HIPAA, SOC 2 often require geographically distributed backups</li>
                                    <li><strong>Disaster Recovery:</strong> Protection against complete regional failure (earthquakes, hurricanes, data center fires)</li>
                                    <li><strong>Ransomware Protection:</strong> If primary region is compromised, cross-region backup remains untouched</li>
                                    <li><strong>Data Sovereignty:</strong> Store backups in regions that meet specific legal requirements</li>
                                    <li><strong>Business Continuity:</strong> For mission-critical applications where data loss is unacceptable</li>
                                </ul>

                                <p class="mb-3"><strong>Configuration (Atlas):</strong> In Atlas UI, navigate to Backup â†’ Settings â†’ Enable "Cross-Region Backup Copies" and select target region(s). Additional cost: ~20-30% of primary backup storage cost.</p>

                                <p class="mb-3"><strong>Real-World Example:</strong> A healthcare SaaS company stores patient data in us-east-1 with cross-region backups in us-west-2. When Hurricane Sandy caused extended AWS us-east-1 outages, they restored their entire database from us-west-2 backups to a new cluster in us-west-1 within 2 hours, maintaining HIPAA compliance and zero data loss.</p>

                                <p class="mb-3"><strong>Best Practice for Multi-Region Clusters:</strong> If you already have a multi-region replica set (e.g., 5+1 configuration), cross-region backups provide an additional safety net. Your live data is already replicated across regions, but backups protect against logical corruption (accidental deletes, ransomware) that would affect all replicas.</p>

                                <p><strong>Cost vs. Risk:</strong> Cross-region backups add a modest incremental cost. For most production systems, this is negligible compared to the cost of data loss or extended downtime. For non-critical dev/test environments, standard single-region backups are sufficient.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Cross-Region Backup Strategy Card -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">ðŸŒ Cross-Region Backup Strategy</h4>
                        <p class="text-[--mongo-text-muted] text-sm mb-4">Geographic redundancy for disaster recovery and compliance.</p>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Protection Scenarios</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Regional Disaster:</strong> Natural disasters, power grid failures, complete data center loss</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Cloud Provider Outage:</strong> Extended regional service disruption (e.g., AWS us-east-1 outage)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Ransomware Attack:</strong> Malware that spreads across primary region but not cross-region backups</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Compliance Requirements:</strong> GDPR, HIPAA, SOC 2, PCI-DSS mandates for geographic redundancy</span></li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Implementation Details</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Automatic Replication:</strong> Backups copied to target region within 1-2 hours</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Same Retention:</strong> Cross-region copies follow same retention policy as primary</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Encrypted Transfer:</strong> All data encrypted in transit between regions</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Cost:</strong> +20-30% of primary backup storage cost</span></li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2">Recommended Region Pairs</h5>
                            <p class="text-[--mongo-text-muted] text-sm mb-2">Choose regions with geographic separation and low latency:</p>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                <li>â€¢ <strong class="text-white">US:</strong> us-east-1 (Virginia) â†” us-west-2 (Oregon) - 3000+ miles apart</li>
                                <li>â€¢ <strong class="text-white">Europe:</strong> eu-west-1 (Ireland) â†” eu-central-1 (Frankfurt) - Different countries, GDPR compliant</li>
                                <li>â€¢ <strong class="text-white">Asia:</strong> ap-southeast-1 (Singapore) â†” ap-northeast-1 (Tokyo) - Different seismic zones</li>
                                <li>â€¢ <strong class="text-white">Global:</strong> us-east-1 â†” eu-west-1 - Transatlantic redundancy for maximum separation</li>
                            </ul>
                        </div>
                    </div>

                    <!-- High Availability Configurations -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">High Availability Configurations</h4>
                        
                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Basic HA (3-Node)</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">Single region, 3 availability zones</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">Config:</strong> 1 Primary + 2 Secondaries</li>
                                    <li>â€¢ <strong class="text-white">Failover:</strong> 10-30 seconds</li>
                                    <li>â€¢ <strong class="text-white">Availability:</strong> 99.95%</li>
                                    <li>â€¢ <strong class="text-white">Use Case:</strong> Dev/staging, non-critical apps</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Production HA (5-Node)</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">Multi-region with priority failover</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">Config:</strong> 3 Primary Region + 2 DR Region</li>
                                    <li>â€¢ <strong class="text-white">Failover:</strong> 5-10 seconds</li>
                                    <li>â€¢ <strong class="text-white">Availability:</strong> 99.99%</li>
                                    <li>â€¢ <strong class="text-white">Use Case:</strong> Production apps, e-commerce</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Mission-Critical (5+1)</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">3 regions with analytics node</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">Config:</strong> 5 Electable + 1 Analytics</li>
                                    <li>â€¢ <strong class="text-white">Failover:</strong> <5 seconds</li>
                                    <li>â€¢ <strong class="text-white">Availability:</strong> 99.995%</li>
                                    <li>â€¢ <strong class="text-white">Use Case:</strong> Financial, healthcare, SaaS</li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>HA Architecture Deep Dive: The 5+1 Configuration</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Why 5+1 is the Gold Standard:</strong> This configuration provides the optimal balance of availability, performance, and cost for mission-critical applications.</p>
                                <p class="mb-3"><strong>Architecture:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Region 1 (Primary):</strong> 2 electable nodes (priority 7, 6)</li>
                                    <li><strong>Region 2 (DR):</strong> 2 electable nodes (priority 5, 4)</li>
                                    <li><strong>Region 3 (Tiebreaker):</strong> 1 electable node (priority 1) + 1 analytics read-only node (priority 0)</li>
                                </ul>
                                <p class="mb-3"><strong>Failover Behavior:</strong> If Region 1 fails, Region 2 automatically elects a new primary within 5 seconds. The tiebreaker in Region 3 ensures majority voting (3 out of 5 nodes) even if an entire region is down.</p>
                                <p class="mb-3"><strong>Analytics Node:</strong> The read-only analytics node (priority 0) never becomes primary but can serve read queries for reporting, ETL, or BI tools without impacting production workload.</p>
                                <p><strong>Cost Optimization:</strong> The analytics node can be a lower-tier instance (e.g., M10 vs M30 for electable nodes) since it doesn't handle writes or participate in elections or could be a much higher tier than base cluster if you run heavy BI queries.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Analytics Nodes: Workload Isolation -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">ðŸ“Š Analytics Nodes: Workload Isolation</h4>
                        <p class="text-[--mongo-text-muted] text-sm mb-4">Dedicated read-only nodes for analytical workloads that isolate heavy queries from production traffic, ensuring your application performance remains unaffected by BI tools, reporting, and data science workloads.</p>
                        
                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">What is an Analytics Node?</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Read-Only:</strong> Priority 0, never becomes primary</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Isolated:</strong> Queries don't impact production nodes</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Replicated:</strong> Full copy of data, always in sync</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Cost-Effective:</strong> Can be lower-tier instance</span></li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Common Use Cases</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span>Business Intelligence (Tableau, Power BI, Looker)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span>Data Science & ML model training</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span>ETL pipelines & data exports</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span>Complex aggregations & reports</span></li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">Performance Benefits</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span>Zero impact on application latency</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span>No resource contention (CPU, RAM, disk I/O)</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span>Run long queries without timeouts</span></li>
                                    <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span>Dedicated connection pool</span></li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>Analytics Node Configuration & Best Practices</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>How to Add an Analytics Node (Atlas):</strong></p>
                                <ol class="list-decimal list-outside space-y-2 pl-5 mb-3">
                                    <li>Navigate to Atlas UI â†’ Cluster â†’ Configuration â†’ Edit Configuration</li>
                                    <li>Under "Electable nodes for high availability", click "Add a node"</li>
                                    <li>Select "Analytics" node type (priority 0, hidden from application)</li>
                                    <li>Choose region (typically same as primary for low replication lag)</li>
                                    <li>Select instance size (can be smaller than electable nodes, e.g., M10 vs M30)</li>
                                    <li>Apply changes - Atlas provisions the node and syncs data</li>
                                </ol>

                                <p class="mb-3"><strong>Connection String for Analytics Node:</strong></p>
                                <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Standard connection (uses primary + secondaries)
mongodb+srv://cluster0.mongodb.net/mydb

// Analytics-only connection (uses only analytics node)
mongodb+srv://cluster0.mongodb.net/mydb?readPreference=secondary&readPreferenceTags=nodeType:ANALYTICS
                                </div>
        </div>

                                <p class="mb-3"><strong>Best Practices:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Right-Size the Instance:</strong> Analytics nodes don't handle writes or elections, so they can be 1-2 tiers smaller than electable nodes. For example, if your cluster uses M30 electable nodes, an M10 or M20 analytics node is often sufficient for small BI workloads or could be much bigger than the base cluster if you have heavy aggregation queries which could do collection scans.</li>
                                    <li><strong>Use Read Preference Tags:</strong> Configure your BI tools to explicitly target the analytics node using read preference tags. This ensures queries never hit production nodes.</li>
                                    <li><strong>Monitor Replication Lag:</strong> Analytics nodes replicate from the primary. If replication lag exceeds 60 seconds, your reports may show stale data. Increase analytics node size if lag is persistent.</li>
                                    <li><strong>Index Strategy:</strong> Create indexes specifically for analytical queries on the analytics node. These indexes won't impact write performance on the primary since they're only on the read-only node.</li>
                                    <li><strong>Connection Pooling:</strong> Configure separate connection pools for analytics vs application queries to prevent resource exhaustion.</li>
                                </ul>

                                <p class="mb-3"><strong>Cost Optimization Example:</strong></p>
                                <p class="mb-3">A cluster with 3 electable nodes plus 1 lower-tier analytics node can be significantly more cost-effective than upgrading all electable nodes to handle the combined operational and analytical workload.</p>
                                <p>Without an analytics node, you'd need to upgrade all electable nodes to a higher tier to handle the combined workload. <strong>Typical savings: 40-50% compared to upgrading all nodes</strong></p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Real-World Example: E-Commerce Analytics</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Scenario:</strong> An e-commerce platform runs real-time inventory and checkout operations on MongoDB. The business intelligence team needs to run daily sales reports, customer segmentation analysis, and product performance dashboards using Tableau.</p>
                                
                                <p class="mb-3"><strong>Problem Without Analytics Node:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li>BI queries scan millions of documents, consuming 80% CPU on primary/secondaries</li>
                                    <li>Application checkout latency spikes from 50ms to 500ms during report generation</li>
                                    <li>Customer complaints about slow page loads during business hours</li>
                                    <li>DBA forced to schedule reports only at 2 AM to avoid impacting users</li>
                                </ul>

                                <p class="mb-3"><strong>Solution With Analytics Node:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li>Added M20 analytics node to existing 3 Ã— M30 cluster</li>
                                    <li>Configured Tableau to connect exclusively to analytics node</li>
                                    <li>BI team can run reports 24/7 without impacting application</li>
                                    <li>Application latency remains stable at 50ms even during heavy reporting</li>
                                    <li>Cost increase: Adding a mid-tier analytics node vs upgrading all nodes to a higher tier</li>
                                </ul>

                                <p class="mb-3"><strong>Query Example:</strong> Daily sales aggregation that previously took 45 seconds and spiked CPU to 90% now runs on analytics node with zero impact on production.</p>

                                <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Complex aggregation running on analytics node
db.orders.aggregate([
  { $match: { orderDate: { $gte: ISODate("2024-01-01") } } },
  { $lookup: { from: "products", localField: "productId", foreignField: "_id", as: "product" } },
  { $unwind: "$product" },
  { $group: { 
      _id: { category: "$product.category", month: { $month: "$orderDate" } },
      totalRevenue: { $sum: "$totalAmount" },
      orderCount: { $sum: 1 },
      avgOrderValue: { $avg: "$totalAmount" }
  }},
  { $sort: { totalRevenue: -1 } }
]);
// This query scans 50M documents and takes 30 seconds
// On analytics node: Zero impact on application
// On primary: Would cause 500ms+ latency spikes
                                </div>
        </div>

                                <p><strong>Result:</strong> BI team is empowered to run ad-hoc queries anytime, application performance is protected, and total cost of ownership is reduced by 75% compared to scaling up all nodes.</p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Analytics Node vs Data Federation vs Online Archive</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>When to Use Each:</strong> MongoDB offers three solutions for analytical workloads. Here's how to choose:</p>
                                
                                <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border] mb-3">
                                    <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ“Š Analytics Node</h5>
                                    <p class="text-[--mongo-text-muted] text-sm mb-2"><strong class="text-white">Best For:</strong> Real-time or near-real-time analytics on hot data (last 30-90 days)</p>
                                    <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                        <li>â€¢ <strong class="text-white">Data Freshness:</strong> Real-time (replication lag <1 second)</li>
                                        <li>â€¢ <strong class="text-white">Query Performance:</strong> Fast (same as cluster, uses indexes)</li>
                                        <li>â€¢ <strong class="text-white">Cost:</strong> Varies by instance size</li>
                                        <li>â€¢ <strong class="text-white">Use Case:</strong> Daily dashboards, live BI reports, operational analytics</li>
                                    </ul>
                                </div>

                                <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border] mb-3">
                                    <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ”— Data Federation</h5>
                                    <p class="text-[--mongo-text-muted] text-sm mb-2"><strong class="text-white">Best For:</strong> Querying across multiple data sources (Atlas + S3 + Data Lake)</p>
                                    <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                        <li>â€¢ <strong class="text-white">Data Freshness:</strong> Real-time for Atlas data, batch for S3/Data Lake</li>
                                        <li>â€¢ <strong class="text-white">Query Performance:</strong> Medium (depends on data source and partitioning)</li>
                                        <li>â€¢ <strong class="text-white">Cost:</strong> Pay-per-query based on data scanned</li>
                                        <li>â€¢ <strong class="text-white">Use Case:</strong> Cross-database analytics, joining Atlas with external data</li>
                                    </ul>
                                </div>

                                <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                    <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ“¦ Online Archive</h5>
                                    <p class="text-[--mongo-text-muted] text-sm mb-2"><strong class="text-white">Best For:</strong> Historical data analysis (data >90 days old)</p>
                                    <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                        <li>â€¢ <strong class="text-white">Data Freshness:</strong> Batch (archived daily)</li>
                                        <li>â€¢ <strong class="text-white">Query Performance:</strong> Slower (1-5 seconds for simple queries, minutes for complex)</li>
                                        <li>â€¢ <strong class="text-white">Cost:</strong> Low-cost object storage + pay-per-query</li>
                                        <li>â€¢ <strong class="text-white">Use Case:</strong> Compliance, historical trend analysis, long-term data retention</li>
                                    </ul>
                                </div>

                                <p class="mt-3"><strong>Combined Strategy:</strong> Many organizations use all three together: Analytics node for real-time dashboards on hot data, Data Federation to join with external datasets, and Online Archive for historical analysis and compliance.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Read Preference, Write Concern & Node Tags -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">ðŸŒ Global Data Distribution & Consistency Controls</h4>
                        <p class="text-[--mongo-text-muted] text-sm mb-4">In multi-region and multi-cloud deployments, controlling where data is written and read from is critical for performance, availability, and compliance (GDPR). MongoDB provides granular controls through Write Concern, Read Preference, and Node Tags.</p>
                        
                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">âœï¸ Write Concern</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">Controls durability guarantees.</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">w:1</strong> - Acknowledge by primary only (Fastest)</li>
                                    <li>â€¢ <strong class="text-white">w:majority</strong> - Acknowledge by majority of nodes (Safe)</li>
                                    <li>â€¢ <strong class="text-white">w:all</strong> - Acknowledge by all nodes (Paranoid)</li>
                                    <li>â€¢ <strong class="text-white">w: "Tag"</strong> - Custom (e.g., "US_East_Ack")</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ“– Read Preference</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">Controls where queries are routed.</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">primary</strong> - Strict consistency (Default)</li>
                                    <li>â€¢ <strong class="text-white">primaryPreferred</strong> - Primary if available, else secondary</li>
                                    <li>â€¢ <strong class="text-white">secondary</strong> - Eventual consistency</li>
                                    <li>â€¢ <strong class="text-white">nearest</strong> - Lowest latency node</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">ðŸ·ï¸ Node Tags</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-2">Labels for targeting specific nodes.</p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ <strong class="text-white">region:</strong> us-east-1, eu-central-1</li>
                                    <li>â€¢ <strong class="text-white">provider:</strong> aws, azure, gcp</li>
                                    <li>â€¢ <strong class="text-white">workload:</strong> analytics, operational</li>
                                    <li>â€¢ <strong class="text-white">rack:</strong> rack1, rack2</li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>Multi-Shard & Multi-Cloud Scenarios</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Scenario: Global Multi-Cloud Application</strong></p>
                                <p class="mb-3">Imagine a banking app running on AWS (US), Azure (Europe), and GCP (Asia). You need to ensure low latency for local users and comply with data residency laws (GDPR).</p>

                                <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border] mb-4">
                                    <h5 class="text-[--mongo-green] font-bold mb-3">Configuration Strategy</h5>
                                    
                                    <p class="text-white text-sm font-semibold mb-1">1. Tag Your Nodes (in Atlas)</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Atlas automatically tags nodes, but you can add custom tags:
{ "region": "US", "cloud": "AWS", "type": "operational" }
{ "region": "EU", "cloud": "AZURE", "type": "operational" }
{ "region": "ASIA", "cloud": "GCP", "type": "operational" }
                                    </div>
        </div>

                                    <p class="text-white text-sm font-semibold mb-1">2. Zone Sharding (Data Locality)</p>
                                    <p class="text-[--mongo-text-muted] text-sm mb-3">Pin data ranges to specific shards based on the shard key (e.g., `country`).</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Pin US users to AWS shards
sh.addShardTag("shard-aws-us", "US");
sh.updateZoneKeyRange("users", { country: "US", _id: MinKey }, { country: "US", _id: MaxKey }, "US");

// Pin EU users to Azure shards (GDPR)
sh.addShardTag("shard-azure-eu", "EU");
sh.updateZoneKeyRange("users", { country: "DE", _id: MinKey }, { country: "DE", _id: MaxKey }, "EU");
                                    </div>
        </div>

                                    <p class="text-white text-sm font-semibold mb-1">3. Targeted Reads & Writes</p>
                                    <p class="text-[--mongo-text-muted] text-sm mb-2">Configure your application driver to route queries intelligently.</p>
                                    <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block">
// US Application Server -> Connects to Mongos
// Read from nearest node (likely local AWS shard)
readPreference: "nearest"

// Write with region-aware durability
// Ensure write is acknowledged by at least one node in US region
writeConcern: { w: "majority", wtimeout: 5000 } 
// OR custom tag for cross-region safety
writeConcern: { w: "US_East_Ack", wtimeout: 5000 }
                                    </div>
        </div>
                                </div>

                                <p class="mb-3"><strong>Best Practices for Multi-Cloud:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5">
                                    <li><strong>Use `nearest` for Reads:</strong> In a multi-region cluster, `readPreference=nearest` automatically routes queries to the lowest-latency node (usually in the same cloud region as the app server).</li>
                                    <li><strong>Tag-Aware Sharding:</strong> Use zones to keep data close to users. This reduces cross-region data transfer costs and improves latency.</li>
                                    <li><strong>Workload Isolation:</strong> Tag specific nodes as `workload: analytics` and target them with `readPreferenceTags=workload:analytics` for heavy reporting, keeping operational nodes free.</li>
                                    <li><strong>Cross-Cloud DR:</strong> If AWS goes down, your Azure nodes (if part of the same replica set) can take over. Configure `w:majority` to ensure data is replicated to at least one other node (potentially across clouds) before acknowledging success.</li>
                                </ul>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Advanced: Tag Sets for Custom Routing</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Problem:</strong> You have a 5-node replica set distributed across 3 Availability Zones (AZs). You want to ensure reads only come from nodes in the <em>same</em> AZ as the application server to avoid cross-AZ data transfer charges.</p>
                                
                                <p class="mb-3"><strong>Solution:</strong> Use Read Preference Tag Sets.</p>
                                
                                <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Node Tags configured in Atlas/Replica Set:
Node 1: { "az": "us-east-1a" }
Node 2: { "az": "us-east-1a" }
Node 3: { "az": "us-east-1b" }
Node 4: { "az": "us-east-1b" }
Node 5: { "az": "us-east-1c" }

// Application Connection String (App in us-east-1a):
mongodb+srv://...?readPreference=secondaryPreferred&readPreferenceTags=az:us-east-1a
                                </div>
        </div>

                                <p><strong>How it works:</strong> The driver first tries to find a secondary with `az: us-east-1a`. If found, it reads from there (free local traffic). If <em>none</em> are found (e.g., both local nodes down), it falls back to other nodes (cross-AZ traffic) to maintain availability.</p>
                            </div>
                        </details>
                    </div>

                    <!-- RPO and RTO -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">RPO & RTO: Defining Your Recovery Objectives</h4>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">RPO (Recovery Point Objective)</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-3"><em>How much data can you afford to lose?</em></p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li><strong class="text-white">RPO = 0:</strong> Zero data loss. Use replica sets with majority write concern + continuous backup.</li>
                                    <li><strong class="text-white">RPO < 1 hour:</strong> Atlas continuous backup with oplog (typical for most production apps).</li>
                                    <li><strong class="text-white">RPO < 24 hours:</strong> Daily snapshots (acceptable for non-critical data, analytics).</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2">RTO (Recovery Time Objective)</h5>
                                <p class="text-[--mongo-text-muted] text-sm mb-3"><em>How quickly must you recover?</em></p>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                    <li><strong class="text-white">RTO < 10 seconds:</strong> Automatic failover with 5-node replica set (no manual intervention).</li>
                                    <li><strong class="text-white">RTO < 1 hour:</strong> Atlas automated restore from backup (depends on data size).</li>
                                    <li><strong class="text-white">RTO < 4 hours:</strong> Manual restore from backup with validation (typical for DR scenarios).</li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>Achieving RPO = 0 with Write Concern Majority</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>The Problem:</strong> By default, MongoDB acknowledges writes after they're written to the primary's journal. If the primary fails before replicating to secondaries, those writes are lost (RPO > 0).</p>
                                <p class="mb-3"><strong>The Solution:</strong> Use write concern <code>{ w: "majority" }</code> to ensure writes are acknowledged only after being replicated to a majority of nodes.</p>
                                <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Application code (Node.js example)
await collection.insertOne(
  { userId: "123", order: "ABC" },
  { writeConcern: { w: "majority", wtimeout: 5000 } }
);
                                </div>
        </div>
                                <p class="mb-3"><strong>Trade-off:</strong> Slightly higher write latency (+2-5ms) but guaranteed zero data loss. For financial transactions, user accounts, or any critical data, this is mandatory.</p>
                                <p><strong>Atlas Default:</strong> Atlas uses <code>w: "majority"</code> by default for all clusters M10+, ensuring RPO = 0 out of the box.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Disaster Recovery -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">Disaster Recovery Scenarios</h4>
                        
                        <details class="expandable-box">
                            <summary>Scenario 1: Accidental Data Deletion (Human Error)</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Situation:</strong> A developer accidentally runs <code>db.users.deleteMany({})</code> in production instead of staging, deleting all user records.</p>
                                <p class="mb-3"><strong>Recovery with Atlas:</strong></p>
                                <ol class="list-decimal list-outside space-y-2 pl-5 mb-3">
                                    <li>Immediately pause application writes to prevent further changes</li>
                                    <li>In Atlas UI, navigate to Backup â†’ Point-in-Time Restore</li>
                                    <li>Select timestamp 5 minutes before deletion (e.g., 2:45 PM if deletion was 2:50 PM)</li>
                                    <li>Restore to a new cluster for validation (don't overwrite production)</li>
                                    <li>Export deleted data from restored cluster and import back to production</li>
                                    <li>Total RTO: 15-30 minutes for <100GB databases</li>
                                </ol>
                                <p><strong>Prevention:</strong> Use database-level access controls, separate staging/prod credentials, and require peer review for destructive operations.</p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Scenario 2: Regional Outage (Cloud Provider Failure)</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Situation:</strong> AWS us-east-1 experiences a complete regional outage affecting your primary MongoDB region.</p>
                                <p class="mb-3"><strong>Automatic Recovery (5-Node Multi-Region):</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li>Within 10 seconds, replica set detects primary is unreachable</li>
                                    <li>Nodes in us-west-2 (DR region) hold election and promote new primary</li>
                                    <li>Application automatically reconnects to new primary (if using proper connection string with all nodes)</li>
                                    <li>Total downtime: 5-15 seconds (users may see brief "loading" state)</li>
                                    <li>Zero data loss if using write concern majority</li>
                                </ul>
                                <p class="mb-3"><strong>Manual Recovery (Single-Region Cluster):</strong> If you only have nodes in us-east-1, you must restore from backup to a new region. RTO: 1-4 hours depending on data size.</p>
                                <p><strong>Lesson:</strong> Multi-region replica sets are essential for production. The cost difference is minimal compared to hours of downtime.</p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Scenario 3: Ransomware Attack (Data Corruption)</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Situation:</strong> Ransomware encrypts your database through a compromised application credential, corrupting all data.</p>
                                <p class="mb-3"><strong>Recovery Strategy:</strong></p>
                                <ol class="list-decimal list-outside space-y-2 pl-5 mb-3">
                                    <li>Immediately revoke all database credentials and rotate encryption keys</li>
                                    <li>Identify when corruption started (e.g., 6 hours ago based on monitoring alerts)</li>
                                    <li>Restore from continuous backup to point before corruption (e.g., 7 hours ago)</li>
                                    <li>Restore to new cluster, validate data integrity</li>
                                    <li>Update application to point to restored cluster</li>
                                    <li>Investigate attack vector and patch vulnerability</li>
                                </ol>
                                <p class="mb-3"><strong>RPO:</strong> 6 hours of data lost (transactions between 7 hours ago and attack time). For critical systems, consider cross-region backup copies with longer retention (90+ days) to recover from delayed-discovery attacks.</p>
                                <p><strong>Prevention:</strong> Principle of least privilege (read-only credentials for apps that don't write), network isolation, IP whitelisting, and regular security audits.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Monitoring and Alerts -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                        <h4 class="text-xl font-semibold text-white mb-3">Monitoring for HA & Backup Health</h4>
                        <p class="text-[--mongo-text-muted] text-sm mb-3">Critical alerts to configure for backup and HA monitoring:</p>
                        
                        <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Backup Failures:</strong> Alert immediately if scheduled backup fails (check within 1 hour)</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Replication Lag:</strong> Alert if secondary is >60 seconds behind primary (indicates potential failover issues)</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Node Unavailability:</strong> Alert if any replica set member is unreachable for >5 minutes</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Oplog Window:</strong> Alert if oplog window <24 hours (risk of secondaries falling too far behind)</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Disk Space:</strong> Alert at 80% disk usage (backups need space for snapshots)</span></li>
                            <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ””</span><span><strong class="text-white">Failed Elections:</strong> Alert if replica set election fails (indicates network or configuration issues)</span></li>
                        </ul>

                        <p class="text-[--mongo-text] mt-4 font-semibold">Atlas Monitoring:</p>
                        <p class="text-[--mongo-text-muted] text-sm mt-2">Atlas provides built-in alerts for all these scenarios. Configure PagerDuty, Slack, or email notifications for your on-call team. Test alert delivery quarterly.</p>
                    </div>

                </section>

                <!-- Section 8: Atlas Online Archive -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>
                        <h3 id="arch-online-archive" class="text-2xl font-bold">Atlas Online Archive - Cost-Optimized Cold Storage</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Reduce Storage Costs by 90%+.</strong> Atlas Online Archive automatically moves infrequently accessed data to low-cost cloud object storage (S3, Azure Blob, GCS) while keeping it queryable through federated queries. Perfect for compliance, historical data, and time-series workloads.</p>
                    
                    <!-- What is Online Archive -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">What is Atlas Online Archive?</h4>
                        
                        <p class="text-[--mongo-text-muted] text-sm mb-4">Online Archive is a fully managed service that automatically tiers cold data from your Atlas cluster to low-cost cloud object storage. Unlike traditional archival solutions, archived data remains queryable using standard MongoDB queries through Data Federation.</p>

                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ“¦ Automatic Tiering</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ Define archival rules by date field</li>
                                    <li>â€¢ Data moved automatically (e.g., >90 days old)</li>
                                    <li>â€¢ No application code changes</li>
                                    <li>â€¢ Runs continuously in background</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ’° Cost Savings</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ 90-95% reduction in storage costs</li>
                                    <li>â€¢ 90-95% lower storage cost vs Atlas cluster storage</li>
                                    <li>â€¢ Smaller cluster tier = lower compute costs</li>
                                    <li>â€¢ Pay only for queries executed</li>
                                </ul>
                            </div>
                            <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border]">
                                <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ” Federated Queries</h5>
                                <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                    <li>â€¢ Query hot + cold data together</li>
                                    <li>â€¢ Standard MongoDB query syntax</li>
                                    <li>â€¢ Aggregation pipeline support</li>
                                    <li>â€¢ Transparent to applications</li>
                                </ul>
                            </div>
                        </div>

                        <details class="expandable-box">
                            <summary>How Online Archive Works Under the Hood</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Architecture:</strong> Online Archive uses Atlas Data Federation to create a unified view of your hot (cluster) and cold (archive) data. When you query, Data Federation intelligently routes queries to the appropriate storage tier.</p>
                                
                                <p class="mb-3"><strong>Archival Process:</strong></p>
                                <ol class="list-decimal list-outside space-y-2 pl-5 mb-3">
                                    <li>You define an archival rule (e.g., "archive documents where `createdAt` < 90 days ago")</li>
                                    <li>Atlas scans your collection daily and identifies matching documents</li>
                                    <li>Matching documents are copied to S3/Azure/GCS in optimized Parquet format</li>
                                    <li>After verification, documents are deleted from the cluster</li>
                                    <li>Data Federation indexes the archived data for efficient querying</li>
                                </ol>

                                <p class="mb-3"><strong>Query Routing:</strong> When you query through Data Federation, it analyzes your query predicates. If the query only needs archived data (e.g., `createdAt < 90 days`), it queries S3 directly. If it needs both hot and cold data, it queries both and merges results.</p>

                                <p><strong>Data Format:</strong> Archived data is stored in Apache Parquet format, a columnar storage format optimized for analytical queries. This provides 5-10x compression and faster query performance compared to raw BSON.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Use Cases -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">Common Use Cases</h4>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <details class="expandable-box">
                                <summary>Time-Series Data (IoT, Logs, Metrics)</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>Scenario:</strong> An IoT platform collects sensor data from 100,000 devices, generating 10TB of data per year. Recent data (last 30 days) is queried frequently for real-time dashboards, but older data is only accessed for compliance audits or historical analysis.</p>
                                    
                                    <p class="mb-3"><strong>Online Archive Strategy:</strong></p>
                                    <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                        <li>Keep last 30 days in Atlas cluster (hot data): ~800GB</li>
                                        <li>Archive data >30 days old to S3: ~9.2TB annually</li>
                                        <li>Query both tiers for historical trend analysis</li>
                                    </ul>

                                    <p class="mb-3"><strong>Cost Savings:</strong> By keeping only hot data in Atlas and archiving cold data, total storage costs are reduced by <strong>85%</strong> compared to keeping all data in the Atlas cluster.</p>

                                    <p><strong>Query Example:</strong> Analyze temperature trends for the past year across all sensors - Data Federation queries last 30 days from cluster and 11 months from archive, merging results seamlessly.</p>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>E-Commerce Order History</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>Scenario:</strong> An e-commerce platform stores 50M orders. Recent orders (last 90 days) are accessed frequently for customer service, shipping, and returns. Older orders are rarely accessed except for annual tax reporting or customer history lookups.</p>
                                    
                                    <p class="mb-3"><strong>Online Archive Strategy:</strong></p>
                                    <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                        <li>Keep last 90 days in Atlas: ~5M orders (500GB)</li>
                                        <li>Archive orders >90 days old: ~45M orders (4.5TB)</li>
                                        <li>Customer "View All Orders" queries both tiers</li>
                                    </ul>

                                    <p class="mb-3"><strong>Benefits:</strong> Cluster size reduced from M60 (6TB) to M30 (1TB), significantly reducing compute costs. The modest archive storage cost results in substantial net savings.</p>

                                    <p><strong>User Experience:</strong> When a customer views their order history, the app queries Data Federation. Recent orders load instantly from the cluster, while older orders stream from archive with 1-2 second latency (acceptable for historical data).</p>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>Compliance & Regulatory Data Retention</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>Scenario:</strong> A healthcare provider must retain patient records for 7 years per HIPAA regulations. Active patient records (last 2 years) are accessed daily, but older records are only accessed for audits or legal requests.</p>
                                    
                                    <p class="mb-3"><strong>Online Archive Strategy:</strong></p>
                                    <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                        <li>Keep last 2 years in Atlas cluster (hot data)</li>
                                        <li>Archive years 3-7 to encrypted S3 bucket</li>
                                        <li>Set 7-year retention policy on archive</li>
                                        <li>Enable audit logging for compliance</li>
                                    </ul>

                                    <p class="mb-3"><strong>Compliance Features:</strong> Archived data inherits Atlas encryption at rest. S3 bucket has versioning and MFA delete enabled. All archive queries are logged for audit trails.</p>

                                    <p><strong>Cost:</strong> Storing years of archived data in object storage is significantly cheaper than keeping it in Atlas. Meets HIPAA requirements at 90%+ lower cost.</p>
                                </div>
                            </details>

                            <details class="expandable-box">
                                <summary>SaaS Multi-Tenant Data</summary>
                                <div class="expandable-box-content">
                                    <p class="mb-3"><strong>Scenario:</strong> A SaaS analytics platform has 10,000 customers. Active customers (last 6 months) generate 80% of queries, but churned customers' data must be retained for 2 years for potential reactivation or legal reasons.</p>
                                    
                                    <p class="mb-3"><strong>Online Archive Strategy:</strong></p>
                                    <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                        <li>Archive data for churned customers after 30 days</li>
                                        <li>Archive data for inactive customers (>6 months no login)</li>
                                        <li>If customer reactivates, restore from archive to cluster</li>
                                    </ul>

                                    <p class="mb-3"><strong>Dynamic Archival:</strong> Use a scheduled job to identify churned/inactive tenants and update archival rules. This keeps the cluster lean and focused on active workloads.</p>

                                    <p><strong>Reactivation:</strong> If a churned customer returns, their data can be restored from archive to the cluster in 1-4 hours (depending on data size), or they can query archived data directly with slightly higher latency.</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- Configuration & Best Practices -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h4 class="text-xl font-semibold text-white mb-3">Configuration & Best Practices</h4>
                        
                        <details class="expandable-box">
                            <summary>Setting Up Online Archive (Step-by-Step)</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>Prerequisites:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li>Atlas cluster M10 or higher (M2/M5 not supported)</li>
                                    <li>Collection must have a date field for archival criteria (e.g., `createdAt`, `timestamp`)</li>
                                    <li>Index on the date field for efficient archival scanning</li>
                                </ul>

                                <p class="mb-3"><strong>Setup Steps:</strong></p>
                                <ol class="list-decimal list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Navigate to Atlas UI:</strong> Cluster â†’ Data Federation â†’ Online Archive â†’ Create Archive</li>
                                    <li><strong>Select Collection:</strong> Choose the collection to archive (e.g., `logs.events`)</li>
                                    <li><strong>Define Archival Rule:</strong> Specify date field and criteria (e.g., `timestamp` older than 90 days)</li>
                                    <li><strong>Choose Storage:</strong> Select cloud provider (AWS S3, Azure Blob, or GCS) and region</li>
                                    <li><strong>Set Partition:</strong> Optional - partition archived data by date for faster queries (e.g., partition by month)</li>
                                    <li><strong>Review & Create:</strong> Atlas validates the configuration and starts archival process</li>
                                </ol>

                                <p class="mb-3"><strong>Initial Archival:</strong> The first archival run processes all existing documents matching the criteria. For large collections (>1TB), this can take 24-48 hours. Subsequent runs are incremental and much faster.</p>

                                <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block mb-3">
// Example: Query federated data (hot + cold)
// No code changes needed - use standard MongoDB queries
db.getSiblingDB("federated").events.aggregate([
  { $match: { timestamp: { $gte: ISODate("2023-01-01") } } },
  { $group: { _id: "$userId", totalEvents: { $sum: 1 } } },
  { $sort: { totalEvents: -1 } },
  { $limit: 100 }
]);
// This query automatically spans cluster + archive
                                </div>
        </div>

                                <p><strong>Monitoring:</strong> Atlas provides metrics for archival progress, archived data size, query performance, and costs in the Data Federation tab.</p>
                            </div>
                        </details>

                        <details class="expandable-box">
                            <summary>Best Practices for Optimal Performance</summary>
                            <div class="expandable-box-content">
                                <p class="mb-3"><strong>1. Choose the Right Archival Threshold:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li><strong>Too Aggressive (e.g., 7 days):</strong> Frequent queries hit slow archive storage, degrading UX</li>
                                    <li><strong>Too Conservative (e.g., 365 days):</strong> Minimal cost savings, large cluster still needed</li>
                                    <li><strong>Sweet Spot:</strong> 30-90 days for most workloads. Analyze query patterns to find the 80/20 point (80% of queries access 20% of data).</li>
                                </ul>

                                <p class="mb-3"><strong>2. Partition Archived Data:</strong> For large archives (>1TB), partition by date (e.g., year/month). This allows Data Federation to skip irrelevant partitions, speeding up queries by 10-100x.</p>

                                <p class="mb-3"><strong>3. Index Strategy:</strong></p>
                                <ul class="list-disc list-outside space-y-2 pl-5 mb-3">
                                    <li>Ensure the archival date field is indexed in the cluster for fast scanning</li>
                                    <li>Data Federation automatically creates indexes on archived data based on query patterns</li>
                                    <li>For complex queries, manually define indexes in Data Federation configuration</li>
                                </ul>

                                <p class="mb-3"><strong>4. Query Optimization:</strong> Always include the date field in query predicates to enable partition pruning. For example, `{ timestamp: { $gte: ISODate("2024-01-01") } }` allows Data Federation to skip older partitions.</p>

                                <p class="mb-3"><strong>5. Separate Read Paths:</strong> For applications, consider separate query paths for "recent data" (cluster only, fast) vs "historical analysis" (federated, slower but comprehensive). This prevents slow archive queries from impacting real-time user experiences.</p>

                                <p><strong>6. Cost Monitoring:</strong> Set up billing alerts for Data Federation query costs. While archive storage is very cost-effective, query costs depend on data scanned. Optimize queries to scan less data (use indexes, partitions, and selective predicates).</p>
                            </div>
                        </details>
                    </div>

                    <!-- Cost Analysis -->
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                        <h4 class="text-xl font-semibold text-white mb-3">ðŸ’° Cost Analysis: Online Archive vs Atlas Cluster</h4>
                        
                        <div class="bg-[#001E2B] p-4 rounded-lg border border-[--mongo-border] mb-4">
                            <h5 class="text-[--mongo-green] font-bold mb-3">Example: 10TB Dataset (1TB hot, 9TB cold)</h5>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-white font-semibold mb-2">âŒ All Data in Atlas Cluster</p>
                                    <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                        <li>â€¢ Cluster Tier: M60 (12TB capacity)</li>
                                        <li>â€¢ Higher compute costs for large cluster</li>
                                        <li>â€¢ Higher storage costs for all data</li>
                                        <li>â€¢ <strong class="text-white">Total: Baseline cost</strong></li>
                                    </ul>
                                </div>
                                <div>
                                    <p class="text-white font-semibold mb-2">âœ… With Online Archive</p>
                                    <ul class="text-[--mongo-text-muted] text-sm space-y-1">
                                        <li>â€¢ Cluster Tier: M30 (1.5TB capacity)</li>
                                        <li>â€¢ Lower compute costs (smaller cluster)</li>
                                        <li>â€¢ Hot data in Atlas, cold data in archive</li>
                                        <li>â€¢ Modest query costs (pay-per-use)</li>
                                        <li>â€¢ <strong class="text-[--mongo-green]">Typical Savings: 70-80%</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <p class="text-[--mongo-text-muted] text-sm mb-3"><strong class="text-white">Query Costs:</strong> Data Federation charges based on data scanned. With proper indexing and partitioning, query costs remain modest even for regular analytical workloads.</p>

                        <p class="text-[--mongo-text-muted] text-sm"><strong class="text-white">ROI Timeline:</strong> For most workloads, Online Archive pays for itself within the first month. The larger your dataset and the older your data, the greater the savings.</p>
                    </div>

                </section>
            </div>

            <!-- Tab 5: Enterprise Advanced (On-Prem) -->
            <div id="tab-features" class="tab-content p-6 md:p-10 space-y-8">
                
                <!-- Quick Links Index -->
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Quick Links</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#core-features" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Overview</a>
                        <a href="#core-document" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Document Model</a>
                        <a href="#core-sharding" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Sharding</a>
                        <a href="#core-replica" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Replica Sets</a>
                        <a href="#core-acid" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Transactions</a>
                        <a href="#core-aggregation" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Aggregation</a>
                        <a href="#core-federation" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Data Federation</a>
                        <a href="#core-triggers" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Triggers</a>
                    </div>
                </div>

                <!-- Section 2: Core Features -->
                <section id="core-features">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                        <h3 class="text-2xl font-bold">Core Features: Analysis & Rationale</h3>
                    </div>
                    <div class="space-y-6">
                        
                        <div>
                            <strong id="core-document" class="text-white">Document Model (Schema-less)</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Delivers faster time-to-market. Developers can map application objects directly to the database, eliminating the complex "object-relational mapping" (ORM) tax. This flexibility allows for rapid iteration and shipping new features without complex, high-risk schema migrations.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>Storing related data together in a single document (embedding) makes reads incredibly fast, as all data for a "view" (e.g., a user profile with their last 5 orders) is retrieved in a single operation, reducing database load and application latency.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong id="core-sharding" class="text-white">Sharding<a href="https://www.percona.com/blog/when-should-i-enable-mongodb-sharding/" target="_blank" rel="noopener noreferrer" class="ref-link">[8]</a><a href="https://www.mongodb.com/docs/manual/core/sharding-choose-a-shard-key/" target="_blank" rel="noopener noreferrer" class="ref-link">[9]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Provides cost-effective horizontal scalability. Instead of buying a single, massive, and expensive "scale-up" server, you can scale out by adding cheaper, commodity hardware. This creates a predictable, linear cost model for growth and ensures high performance as user load increases, preventing crashes.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is the strategy for handling web-scale data and user concurrency. Hashed keys are critical for even distribution to prevent "hot shards" (one server taking all the load), which is the most common failure pattern.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong id="core-replica" class="text-white">Replica Sets</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Guarantees high availability (HA) and automated disaster recovery. For any critical application, uptime is paramount. Automatic failover (in seconds) means a single server crash is a non-event for users, protecting cluster health, meeting SLAs, and preserving brand reputation.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>The multi-region 5-node setup is required to reliably elect a new "primary" node if there is a region failure (3 nodes will work for in-region redundancy). This self-healing capability is the foundation of a resilient system and requires no manual intervention.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong id="core-acid" class="text-white">ACID Transactions<a href="https://severalnines.com/blog/overview-multi-document-acid-transactions-mongodb-and-how-use-them/" target="_blank" rel="noopener noreferrer" class="ref-link">[10]</a><a href="https://www.mongodb.com/resources/products/capabilities/performance-best-practices-transactions-and-read-write-concerns" target="_blank" rel="noopener noreferrer" class="ref-link">[11]</a></strong>
                             <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables the development of mission-critical, reliable applications (e.g., financial ledgers, booking systems) on MongoDB by ensuring "all-or-nothing" data integrity across multiple documents.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This feature simplifies the tech stack. It eliminates the need for a separate relational database just for transactional workloads, thereby reducing operational complexity and total cost of ownership (TCO). The limits (1,000 docs/60s) encourage a micro-service-friendly design rather than large, monolithic database operations.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong id="core-aggregation" class="text-white">Aggregation Pipeline</strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables real-time business intelligence (BI) and analytics directly on live operational data. This avoids the cost and delay of slow, nightly ETL (Extract, Transform, Load) jobs to a separate data warehouse, empowering faster, data-driven decisions.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is a powerful data processing tool inside the database. Pushing a `$match` early is a critical optimization; it filters the data before it enters the complex pipeline stages, dramatically reducing memory and CPU usage.</p></div>
                            </details>
                        </div>

           
                        

                        <div>
                            <strong id="core-federation" class="text-white">Data Federation<a href="https://www.mongodb.com/docs/atlas/data-federation/" target="_blank" rel="noopener noreferrer" class="ref-link">[19]</a><a href="https://www.mongodb.com/docs/atlas/data-federation/tutorial/deploy/" target="_blank" rel="noopener noreferrer" class="ref-link">[20]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Delivers massive cost optimization via intelligent data tiering. It allows you to archive "cold" (old, rarely accessed) data to low-cost S3 storage (as Parquet) while still retaining the ability to query it on demand.</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This provides a unified query interface across all data tiers (hot Atlas, warm S3). Analysts get a complete view of live and historical data without needing complex data movement, simplifying the BI and analytics landscape.</p></div>
                            </details>
                        </div>

                        <div>
                            <strong id="core-triggers" class="text-white">Atlas Triggers<a href="https://www.mongodb.com/docs/atlas/atlas-ui/triggers/" target="_blank" rel="noopener noreferrer" class="ref-link">[21]</a><a href="https://www.youtube.com/watch?v=2FoNtDqQODO" target="_blank" rel="noopener noreferrer" class="ref-link">[22]</a><a href="https://www.mongodb.com/resources/products/capabilities/database-triggers" target="_blank" rel="noopener noreferrer" class="ref-link">[23]</a></strong>
                            <details class="expandable-box">
                                <summary>Why</summary>
                                <div class="expandable-box-content"><p>Enables highly responsive, event-driven applications. Instead of a slow batch job (e.g., "check inventory every hour"), a Trigger can instantly react to a change (e.g., inventory < 10) and execute code (like sending an alert or placing a reorder).</p></div>
                            </details>
                            <details class="expandable-box">
                                <summary>Analysis</summary>
                                <div class="expandable-box-content"><p>This is serverless automation inside the database. It simplifies application architecture by moving business logic out of application servers and into the data layer. This reduces server load and eliminates a common point of failure (the batch job server).</p></div>
                            </details>
                        </div>

                    </div>
                </section>
            </div>

            <!-- Tab 3: Advanced Features -->
            <div id="tab-advanced" class="tab-content p-6 md:p-10 space-y-8">
                
                <!-- Quick Links Index -->
                <div class="quick-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#advanced-search">Atlas Search</a></li>
                        <li><a href="#advanced-vector">Vector Search</a></li>
                        <li><a href="#advanced-hybrid">Hybrid Search</a></li>
                        <li><a href="#advanced-voyage">VoyageAI Embeddings</a></li>
                        <li><a href="#advanced-timeseries">Time Series</a></li>
                    </ul>
                </div>

                <!-- Full-Text Search (Atlas Search) -->
                <section id="advanced-search">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                        <h3 class="text-2xl font-bold">Full-Text Search (Atlas Search)</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Integrated Enterprise Search.</strong> Atlas Search integrates Apache Lucene directly into MongoDB, eliminating the need for separate search infrastructure while delivering rich, modern search experiences.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ’¡ Key Capabilities</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Autocomplete:</strong> Real-time suggestions as users type</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Fuzzy Matching:</strong> Handles typos and misspellings</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Faceted Search:</strong> Filter by categories, price ranges, etc.</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Highlighting:</strong> Show matched terms in results</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â€¢</span><span><strong class="text-white">Synonyms:</strong> "laptop" matches "notebook computer"</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">âš¡ Business Impact</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">$</span><span><strong class="text-white">70% Cost Reduction:</strong> vs. managing Elasticsearch cluster</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âš¡</span><span><strong class="text-white">3x Faster Development:</strong> No data sync pipelines needed</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ”’</span><span><strong class="text-white">Simplified Security:</strong> Single authentication layer</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">ðŸ“Š</span><span><strong class="text-white">Real-time Updates:</strong> Data searchable within seconds</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Architecture & Performance</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Index Structure:</strong> Atlas Search creates separate Lucene indexes that are automatically kept in sync with your MongoDB collections. Changes to documents trigger near-instant index updates.</p>
                            <p class="mb-3"><strong>Query Performance:</strong> Search queries run in parallel with database queries. A typical autocomplete query returns in <50ms. Faceted search across millions of documents completes in <200ms.</p>
                            <p><strong>Scaling:</strong> Search indexes scale independently from your database. As your data grows, Atlas automatically provisions additional search nodes to maintain performance.</p>
                        </div>
                    </details>
                </section>

                <!-- Atlas Vector Search -->
                <section id="advanced-vector">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17.67l-3.75-3.75a.75.75 0 011.06-1.06L9.75 14.84l6.69-6.69a.75.75 0 011.06 1.06l-7.5 7.5a.75.75 0 01-1.06 0z" /></svg>
                        <h3 class="text-2xl font-bold">Atlas Vector Search (AI/RAG)</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">The On-Ramp to AI.</strong> Enables semantic (meaning-based) search, recommendations, and RAG (Retrieval-Augmented Generation) for AI applications that can "reason" over your private data.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ¤– AI Use Cases</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Semantic Search:</strong> "affordable SUVs" finds relevant cars</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Recommendations:</strong> "Find similar products"</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">RAG Chatbots:</strong> Answer questions using your docs</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Image Search:</strong> Find visually similar images</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸŽ¯ Technical Advantages</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">No Separate DB:</strong> Eliminates Pinecone/Milvus</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">No Data Sync:</strong> Vectors stored with documents</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Hybrid Search:</strong> Combine vector + keyword search</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Pre/Post Filtering:</strong> Filter by metadata</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>How It Works</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Step 1 - Generate Embeddings:</strong> Use an embedding model (OpenAI, Cohere, VoyageAI) to convert text/images into high-dimensional vectors (arrays of numbers that represent meaning).</p>
                            <p class="mb-3"><strong>Step 2 - Store in MongoDB:</strong> Store the vector alongside your document data. No separate database needed.</p>
                            <p class="mb-3"><strong>Step 3 - Create Vector Index:</strong> Atlas creates a specialized index (HNSW algorithm) optimized for fast similarity search.</p>
                            <p><strong>Step 4 - Query:</strong> Convert your search query to a vector and find the most similar vectors using cosine similarity or Euclidean distance. Results return in <100ms even across millions of vectors.</p>
                        </div>
                    </details>
                </section>

                <!-- Hybrid Search -->
                <section id="advanced-hybrid">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        <h3 class="text-2xl font-bold">Hybrid Search on Atlas</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Best of Both Worlds.</strong> Combine keyword-based search (Atlas Search) with semantic search (Vector Search) in a single query for superior accuracy and relevance.</p>
                    
                    <details class="expandable-box">
                        <summary>Why Hybrid Search?</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Keyword Search Alone:</strong> Misses semantic meaning. Searching "affordable cars" won't find "budget vehicles" or "inexpensive automobiles."</p>
                            <p class="mb-3"><strong>Vector Search Alone:</strong> Can miss exact matches. Searching for "MongoDB Atlas" might return results about "database platforms" but miss documents with the exact term.</p>
                            <p><strong>Hybrid Search:</strong> Combines both approaches. Uses keyword search for precision and vector search for recall, then merges results using Reciprocal Rank Fusion (RRF) for optimal relevance.</p>
                        </div>
                    </details>

                    <details class="expandable-box">
                        <summary>Implementation Example</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Use Case:</strong> E-commerce product search where users type "warm winter jacket" but products are tagged as "insulated coat" or "thermal outerwear."</p>
                            <p class="mb-3"><strong>Keyword Search:</strong> Finds exact matches for "winter jacket"</p>
                            <p class="mb-3"><strong>Vector Search:</strong> Finds semantically similar items ("insulated coat", "thermal parka")</p>
                            <p><strong>Result:</strong> Combined results ranked by relevance score, delivering comprehensive results that satisfy both exact and semantic matches.</p>
                        </div>
                    </details>
                </section>

                <!-- VoyageAI -->
                <section id="advanced-voyage">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" /></svg>
                        <h3 class="text-2xl font-bold">VoyageAI Embeddings</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">State-of-the-Art Embeddings.</strong> VoyageAI provides domain-specific embedding models optimized for different use cases, delivering superior accuracy compared to general-purpose models.</p>
                    
                    <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border] mb-4">
                        <h5 class="text-[--mongo-green] font-bold mb-3">Available Models (Please check official listing)</h5>
                        <ul class="text-[--mongo-text-muted] text-sm space-y-3">
                            <li><strong class="text-white">voyage-large-2:</strong> Best overall performance. 1024 dimensions. Ideal for general-purpose semantic search and RAG applications.</li>
                            <li><strong class="text-white">voyage-code-2:</strong> Optimized for code search. Understands programming languages, function names, and code semantics.</li>
                            <li><strong class="text-white">voyage-finance-2:</strong> Fine-tuned on financial documents. Excels at understanding financial terminology, reports, and analysis.</li>
                            <li><strong class="text-white">voyage-law-2:</strong> Specialized for legal documents. Trained on case law, contracts, and legal terminology.</li>
                        </ul>
                    </div>

                    <details class="expandable-box">
                        <summary>Why VoyageAI?</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Superior Accuracy:</strong> Domain-specific models outperform OpenAI's general-purpose embeddings by 15-30% on specialized tasks.</p>
                            <p class="mb-3"><strong>Cost-Effective:</strong> Smaller dimension count (1024 vs 1536 for OpenAI) means lower storage costs and faster queries while maintaining superior accuracy.</p>
                            <p><strong>Integration:</strong> Generate embeddings via VoyageAI API, store in MongoDB documents, and query using Atlas Vector Search. The entire pipeline can be automated using Atlas Triggers or App Services.</p>
                        </div>
                    </details>
                </section>

                <!-- Time Series Collections -->
                <section id="advanced-timeseries">
                    <div class="flex items-center text-[--mongo-green] mb-4">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 class="text-2xl font-bold">Time Series Collections</h3>
                    </div>
                    <p class="text-[--mongo-text] mb-4"><strong class="text-[--mongo-green]">Purpose-Built for IoT & Metrics.</strong> Time series collections provide up to 90% storage savings and 10x query performance for timestamped data compared to standard collections.</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸ“ˆ Ideal Use Cases</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">IoT Sensor Data:</strong> Temperature, pressure, GPS coordinates</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Application Metrics:</strong> CPU, memory, request latency</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">Financial Tick Data:</strong> Stock prices, trades, order books</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">â†’</span><span><strong class="text-white">User Activity Logs:</strong> Clickstreams, page views</span></li>
                            </ul>
                        </div>
                        <div class="bg-[--mongo-card-accent] p-5 rounded-lg border border-[--mongo-border]">
                            <h5 class="text-[--mongo-green] font-bold mb-2 text-sm uppercase tracking-wide">ðŸŽ¯ Performance Benefits</h5>
                            <ul class="text-[--mongo-text-muted] text-sm space-y-2">
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">90% Storage Savings:</strong> Columnar compression for time-series data</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">10x Faster Queries:</strong> Optimized for time-range scans</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">Automatic Bucketing:</strong> Groups data by time windows</span></li>
                                <li class="flex items-start"><span class="text-[--mongo-green] mr-2">âœ“</span><span><strong class="text-white">TTL Expiration:</strong> Auto-delete old data</span></li>
                            </ul>
                        </div>
                    </div>

                    <details class="expandable-box">
                        <summary>Configuration & Best Practices</summary>
                        <div class="expandable-box-content">
                            <p class="mb-3"><strong>Key Fields:</strong> Define a `timeField` (timestamp), `metaField` (device ID, sensor ID, stock symbol), and optional `granularity` (seconds, minutes, hours). The metaField acts as a "tag" that groups related measurements.</p>
                            <p class="mb-3"><strong>Bucketing Strategy:</strong> MongoDB automatically groups measurements into buckets based on time and metaField. Each bucket is compressed and stored efficiently. Choose granularity based on your query patterns (e.g., "seconds" for high-frequency IoT, "hours" for daily analytics).</p>
                            <p class="mb-3"><strong>Query Optimization:</strong> Always include the metaField in queries for maximum performance. Time-range queries are extremely fast due to the bucketed structure. Combine with aggregation pipelines for real-time analytics.</p>
                            <p><strong>Cost Savings Example:</strong> A 100GB IoT dataset in a standard collection becomes ~10GB in a time series collection, significantly reducing storage costs on Atlas while delivering faster queries.</p>
                        </div>
                    </details>
                </section>

            </div>

            <!-- Tab 4: Architecture & Best Practices -->
            <div id="tab-governance" class="tab-content p-6 md:p-10 space-y-8">
                <!-- Quick Links Index -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-4 mb-8">
                    <h4 class="text-[--mongo-green] font-bold mb-2 uppercase text-xs tracking-wider">Quick Links</h4>
                    <div class="flex flex-wrap gap-2">
                        <a href="#gov-security" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Security & Compliance</a>
                        <a href="#gov-observability" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Observability</a>
                        <a href="#gov-cost" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Cost Management</a>
                        <a href="#gov-dr" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Backup & DR</a>
                        <a href="#gov-cicd" class="text-sm text-[--mongo-text-muted] hover:text-white bg-[--mongo-card] hover:bg-[--mongo-card-accent] px-3 py-1 rounded-full transition-colors border border-[--mongo-border]">Developer Governance</a>
                    </div>
                </div>
                <!-- Section 7: Security & Compliance -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.42-.38-2.75-.99-3.9l.01-.01c-.11.39-.22.78-.33 1.172m-13.256 0c1.32.39 2.71.64 4.15.64 3.314 0 6.3-1.29 8.57-3.417-2.27 2.127-5.256 3.417-8.57 3.417A10.965 10.965 0 013.33 6.643z" /></svg>
                        <h3 id="gov-security" class="text-2xl font-bold">Security & Compliance Strategy</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Moving from "what" features exist to "how" they must be configured to protect the business. Security is the default, not an option.</p>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Network Security (The "Mote")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is a non-negotiable security control that drastically reduces the attack surface. It ensures that only your trusted application servers can even attempt to connect to the database. This is a foundational requirement for achieving compliance (like SOC2, HIPAA, PCI) and preventing unauthorized access.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Atlas clusters must never be open to the public internet (`0.0.0.0/0`). This is the #1 cause of data breaches. The only acceptable configurations are VPC Peering (for app servers in the same cloud) or Private Link (for multi-cloud or complex corporate networks). This creates a private, isolated network perimeter.</p></div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Authentication & Authorization (The "Guards")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This eliminates the risk of leaked or shared credentials. When an employee leaves, their access is revoked centrally at the IdP, and their database access disappears instantly. This provides a clear, auditable trail of access and is a critical control for internal security.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Passwords (SCRAM) are the bare minimum. For production, passwordless authentication (like AWS IAM or OIDC) or x.509 certificates should be used for all application services. This ties database access to your central Identity Provider (IdP) or cloud-native roles. Furthermore, all access must adhere to the Principle of Least Privilege using custom roles.</p></div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Encryption (The "Safe")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides "zero trust" data protection. It's the ultimate safeguard against a full database breach or a malicious insider. For businesses in healthcare (HIPAA) or finance, this feature is often the key differentiator that makes it possible to use a DBaaS platform while remaining compliant.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Atlas encrypts all data at rest and in transit by default. This is good. However, for highly sensitive data (PII, financial info), this is not enough. You must use Client-Side Field Level Encryption (CSFLE) or Queryable Encryption. This encrypts sensitive fields *before* they are sent from your application server, making them unreadable to MongoDB, Atlas staff, and even your own DBAs.</p></div>
                    </details>
                </section>

                <!-- Section 8: Observability -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.2-5.2" /></svg>
                        <h3 id="gov-observability" class="text-2xl font-bold">Observability & Performance Management</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Defining the "pulse" of the system. Proactive problem detection. Don't wait for customers to complain "the app is slow."</p>
                    
                    <h4 class="text-xl font-semibold text-white mt-4">Key Metrics to Monitor (The "Dashboard")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides proactive problem detection. Instead of waiting for a customer to call and say "the app is slow" (reactive), this dashboard alerts you to a degrading query or resource bottleneck (proactive). This minimizes performance-related downtime and improves user satisfaction.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Don't just watch CPU and RAM. The most important Atlas metrics are:</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li><strong>Query Targeting:</strong> The ratio of `docsScanned` to `docsReturned`. A 1:1 ratio is perfect. A 1,000,000:1 ratio means you're missing an index.</li>
                                <li><strong>Connections:</strong> A sudden spike or a gradual climb toward the connection limit signals a connection leak in your application.</li>
                                <li><strong>Replication Lag:</strong> If > 10s, your secondary nodes are falling behind, risking data loss and serving stale reads.</li>
                                <li><strong>Disk Queue Depth & IOPS:</strong> If maxed out, your storage is the bottleneck.</li>
                            </ul>
                        </div>
                    </details>
                    
                    <h4 class="text-xl font-semibold text-white mt-6">Alerting Strategy (The "Pager")</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This ensures the right person is notified of the right problem, immediately. It automates the detection part of your incident response, slashing your Time-to-Resolution (TTR) and protecting cluster health.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Set up Atlas Alerts that integrate directly with your team's tools (PagerDuty, Slack, Datadog). Your most critical alerts should be:</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li>Replication Lag > 10 seconds</li>
                                <li>Query Targeting > 1000:1 (on any primary query)</li>
                                <li>Connections > 80% of limit</li>
                                <li>Cluster failed over (so you can investigate why)</li>
                            </ul>
                        </div>
                    </details>
                </section>

                <!-- Section 9: Cost Management -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 id="gov-cost" class="text-2xl font-bold">Cost Management & TCO Optimization</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Ensuring the platform's cost scales efficiently with the business and prevents "bill shock."</p>

                    <h4 class="text-xl font-semibold text-white mt-4">Cluster Sizing & Scaling Model</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This is the #1 strategy for reducing TCO. Indexing is free. Hardware is not. A culture of performance tuning directly translates to lower infrastructure costs, maximizing your profitability.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Don't guess your tier (e.g., M40, M50). Use the Performance Advisor to find and add missing indexes first. A single missing index can make an M40 perform worse than a properly indexed M10. Only scale up (vertical scaling) when your working set (data + indexes) exceeds available RAM. Enable cluster auto-scaling as a safety net, but set a max tier to prevent a bad query from bankrupting you.</p></div>
                    </details>
                <!-- This section was missing from the user's uploaded HTML, so I will leave it out as requested -->
                <!--
                <h4 class="text-xl font-semibold text-white mt-6">Serverless vs. Provisioned Clusters</h4>
...
                -->
                </section> <!-- This closes section 9 -->

                <!-- Section 10: Backup & Disaster Recovery -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 10.5v3.75m7.5-3.75h.008v.008H19.5v-.008Zm0 3.75h.008v.008H19.5v-.008Zm-3.75 0h.008v.008H15.75v-.008Zm0-3.75h.008v.008H15.75v-.008Zm-3.75 0h.008v.008H12v-.008Zm0 3.75h.008v.008H12v-.008Zm-3.75 0h.008v.008H8.25v-.008Zm0-3.75h.008v.008H8.25v-.008ZM3 10.5a8.25 8.25 0 0113.5-6.521 8.25 8.25 0 019.646 6.521M3 10.5v6.225A2.25 2.25 0 005.25 19.5h13.5A2.25 2.25 0 0021 16.725V10.5" /></svg>
                        <h3 id="gov-dr" class="text-2xl font-bold">Backup, Restore, & Disaster Recovery (DR)</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">HA (Replica Sets) is NOT Disaster Recovery. A replica set will not save you if a developer drops a collection.</p>
                     
                    <h4 class="text-xl font-semibold text-white mt-4">Backup vs. Restore Strategy (RPO/RTO)</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>PITR is your "undo button" for catastrophic human error (e.g., a bad script deletes all user data). This capability can save the entire business from an extinction-level event. The cost is negligible compared to the risk of irreversible data loss.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content">
                            <p>Atlas provides Continuous Cloud Backups (Point-in-Time Restore - PITR). This should always be on for production. This allows you to restore to any specific minute in the last 24-72 hours.</p>
                            <ul class="list-disc list-outside space-y-2 pl-5 mt-2">
                                <li><strong>RPO (Recovery Point Objective):</strong> ~1-5 minutes. (How much data can you afford to lose?)</li>
                                <li><strong>RTO (Recovery Time Objective):</strong> ~15-60+ minutes. (How fast do you need to be back online?)</li>
                            </ul>
                        </div>
                    </details>
                     
                    <h4 class="text-xl font-semibold text-white mt-6">Disaster Recovery (DR) Plan</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This provides regional fault tolerance. For applications with a global user base or an extremely high uptime requirement (e.g., 99.99%), this is the only way to survive a cloud provider's regional outage and continue operating. This is a high-cost, high-value feature for mission-critical systems.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>A regional outage (e.g., us-east-1 goes down) will take your cluster with it. A true DR plan involves a multi-region cluster. This places readable secondary nodes in a different geographic region (e.g., us-west-2). In a total regional failure, Atlas can fail over to the other region.</p></div>
                    </details>
                </section>

                <!-- Section 11: Developer Governance -->
                <section>
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
                        <h3 id="gov-cicd" class="text-2xl font-bold">Developer Governance & CI/CD</h3>
                    </div>
                    <p class="text-[--mongo-text-muted] mb-4">Ensuring that developer velocity doesn't lead to production chaos.</p>
                     
                    <h4 class="text-xl font-semibold text-white mt-4">Schema Governance</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This prevents data corruption and application-level bugs before they happen. It enforces data quality at the database level, dramatically reducing developer time spent debugging "bad data" and simplifying application logic.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>The "schema-less" flexibility is dangerous at scale. You must use Schema Validation on all critical collections. This enforces that a `userId` is always a string, a `createdAt` field always exists, and `status` is one of ["pending", "active", "archived"].</p></div>
                    </details>
                     
                    <h4 class="text-xl font-semibold text-white mt-6">CI/CD & Index Management</h4>
                    <details class="expandable-box">
                        <summary>Why</summary>
                        <div class="expandable-box-content"><p>This de-risks database migrations. It makes schema and index changes a routine, automated, and safe operation instead of a high-stress, "all-hands-on-deck" manual event. This supports a true DevOps culture and increases deployment frequency.</p></div>
                    </details>
                    <details class="expandable-box">
                        <summary>Analysis</summary>
                        <div class="expandable-box-content"><p>Developers should not be applying indexes manually in the Atlas UI. All index changes must go through a CI/CD pipeline. The pipeline should use a tool or script to perform a rolling index build. This builds the index on each secondary node one by one, then finally on the primary, ensuring zero application downtime.</p></div>
                    </details>
                </section>
            </div>

            <!-- Tab 6: Performance Troubleshooting -->
            <div id="tab-api" class="tab-content p-6 md:p-10 space-y-8">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">ðŸ’» API Examples: Python + Pandas + PyMongoArrow</h2>
                <p class="text-[--mongo-text-muted] text-lg mb-8">Production-ready code examples for MongoDB Python development, including PyMongo, pandas integration, PyMongoArrow for high-performance data transfer, and advanced aggregation with window functions.</p>

                <!-- Quick Links -->
                <div class="bg-[#001E2B] border border-[--mongo-green] rounded-lg p-5 mb-8">
                    <h4 class="text-[--mongo-green] text-sm font-bold uppercase tracking-wide mb-3">Quick Links</h4>
                    <ul class="flex flex-wrap gap-2">
                        <li><a href="#api-setup" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">Setup & Connection</a></li>
                        <li><a href="#api-pymongo" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">PyMongo Basics</a></li>
                        <li><a href="#api-pandas" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">Pandas Integration</a></li>
                        <li><a href="#api-pymongoarrow" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">PyMongoArrow</a></li>
                        <li><a href="#api-window" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">Window Functions</a></li>
                        <li><a href="#api-advanced" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-card-accent] text-[--mongo-text] border border-[--mongo-border] rounded-full transition-all inline-block">Advanced Patterns</a></li>
                    </ul>
                </div>

                <!-- Section 1: Setup & Connection -->
                <section id="api-setup">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        <h3 class="text-2xl font-bold">Setup & Connection</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <h4 class="text-white font-semibold mb-3">Installation</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm mb-4"># Install required packages
pip install pymongo pandas pymongoarrow dnspython

# For Atlas connection with srv
pip install "pymongo[srv]"

# Optional: For better performance
pip install pyarrow</div>
        </div>
                        
                        <h4 class="text-white font-semibold mb-3 mt-6">Connection Setup</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">from pymongo import MongoClient
from pymongo.server_api import ServerApi
import pandas as pd
from pymongoarrow.api import Schema, find_pandas_all
import pyarrow as pa

# Atlas Connection (Recommended)
MONGO_URI = "mongodb+srv://username:password@cluster.mongodb.net/?retryWrites=true&w=majority"

client = MongoClient(
    MONGO_URI,
    server_api=ServerApi('1'),
    maxPoolSize=50,
    minPoolSize=10,
    maxIdleTimeMS=45000,
    serverSelectionTimeoutMS=5000
)

# Test connection
try:
    client.admin.command('ping')
    print("âœ… Connected to MongoDB Atlas!")
except Exception as e:
    print(f"âŒ Connection failed: {e}")

# Access database and collection
db = client['analytics']
collection = db['events']</div>
        </div>
                    </div>
                </section>

                <!-- Section 2: PyMongo Basics -->
                <section id="api-pymongo">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>
                        <h3 class="text-2xl font-bold">PyMongo: CRUD Operations</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <h4 class="text-white font-semibold mb-3">Insert Operations</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">from datetime import datetime
from bson import ObjectId

# Insert single document
event = {
    "user_id": "user_12345",
    "event_type": "page_view",
    "page": "/products/laptop",
    "timestamp": datetime.utcnow(),
    "metadata": {
        "device": "mobile",
        "browser": "Chrome",
        "country": "US"
    }
}
result = collection.insert_one(event)
print(f"Inserted ID: {result.inserted_id}")

# Bulk insert with ordered=False for better performance
events = [
    {"user_id": f"user_{i}", "event_type": "click", "timestamp": datetime.utcnow()}
    for i in range(10000)
]
result = collection.insert_many(events, ordered=False)
print(f"Inserted {len(result.inserted_ids)} documents")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Query Operations</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Find with projection (only return specific fields)
cursor = collection.find(
    {"event_type": "purchase", "metadata.country": "US"},
    {"user_id": 1, "timestamp": 1, "metadata.device": 1, "_id": 0}
).limit(100)

# Convert to list
results = list(cursor)

# Find one with sorting
latest_purchase = collection.find_one(
    {"event_type": "purchase"},
    sort=[("timestamp", -1)]
)

# Count documents (use count_documents, not deprecated count)
total_purchases = collection.count_documents({"event_type": "purchase"})
print(f"Total purchases: {total_purchases}")

# Distinct values
unique_countries = collection.distinct("metadata.country")
print(f"Countries: {unique_countries}")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Update Operations</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Update single document
collection.update_one(
    {"user_id": "user_12345"},
    {
        "$set": {"metadata.last_seen": datetime.utcnow()},
        "$inc": {"visit_count": 1}
    }
)

# Bulk update with upsert
from pymongo import UpdateOne

bulk_ops = [
    UpdateOne(
        {"user_id": f"user_{i}"},
        {"$set": {"active": True}, "$setOnInsert": {"created_at": datetime.utcnow()}},
        upsert=True
    )
    for i in range(1000)
]
result = collection.bulk_write(bulk_ops, ordered=False)
print(f"Modified: {result.modified_count}, Upserted: {result.upserted_count}")</div>
        </div>
                    </div>
                </section>

                <!-- Section 3: Pandas Integration -->
                <section id="api-pandas">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                        <h3 class="text-2xl font-bold">Pandas Integration</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <h4 class="text-white font-semibold mb-3">MongoDB â†’ Pandas DataFrame</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">import pandas as pd
from datetime import datetime, timedelta

# Method 1: Simple conversion (small datasets < 100K docs)
cursor = collection.find({"event_type": "purchase"})
df = pd.DataFrame(list(cursor))

# Method 2: Aggregation pipeline â†’ DataFrame
pipeline = [
    {"$match": {"timestamp": {"$gte": datetime.utcnow() - timedelta(days=7)}}},
    {"$group": {
        "_id": {"date": {"$dateToString": {"format": "%Y-%m-%d", "date": "$timestamp"}}, "country": "$metadata.country"},
        "total_revenue": {"$sum": "$amount"},
        "transaction_count": {"$sum": 1},
        "avg_amount": {"$avg": "$amount"}
    }},
    {"$sort": {"_id.date": -1}}
]

results = list(collection.aggregate(pipeline))
df = pd.DataFrame(results)

# Flatten nested _id field
df['date'] = df['_id'].apply(lambda x: x['date'])
df['country'] = df['_id'].apply(lambda x: x['country'])
df = df.drop('_id', axis=1)

print(df.head())
print(f"\\nDataFrame shape: {df.shape}")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Pandas DataFrame â†’ MongoDB</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Create sample DataFrame
data = {
    'product_id': ['P001', 'P002', 'P003'],
    'name': ['Laptop', 'Mouse', 'Keyboard'],
    'price': [999.99, 29.99, 79.99],
    'stock': [50, 200, 150]
}
df = pd.DataFrame(data)

# Convert DataFrame to dict and insert
records = df.to_dict('records')
collection.insert_many(records)

# For large DataFrames: chunk insertion
chunk_size = 10000
for i in range(0, len(df), chunk_size):
    chunk = df.iloc[i:i+chunk_size]
    collection.insert_many(chunk.to_dict('records'), ordered=False)
    print(f"Inserted chunk {i//chunk_size + 1}")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Data Analysis Example</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Fetch data and analyze
pipeline = [
    {"$match": {"event_type": "purchase"}},
    {"$project": {
        "user_id": 1,
        "amount": 1,
        "timestamp": 1,
        "device": "$metadata.device"
    }}
]

df = pd.DataFrame(list(collection.aggregate(pipeline)))

# Pandas analysis
print("Revenue by Device:")
print(df.groupby('device')['amount'].agg(['sum', 'mean', 'count']))

# Time-based analysis
df['date'] = pd.to_datetime(df['timestamp']).dt.date
daily_revenue = df.groupby('date')['amount'].sum()
print(f"\\nDaily Revenue:\\n{daily_revenue}")</div>
        </div>
                    </div>
                </section>

                <!-- Section 4: PyMongoArrow -->
                <section id="api-pymongoarrow">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        <h3 class="text-2xl font-bold">PyMongoArrow: High-Performance Data Transfer</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <p class="text-[--mongo-text-muted] text-sm mb-4"><strong>Why PyMongoArrow?</strong> 10-50x faster than standard PyMongo for large datasets (>100K documents). Uses Apache Arrow for zero-copy data transfer.</p>
                        
                        <h4 class="text-white font-semibold mb-3">Define Schema</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">from pymongoarrow.api import Schema, find_pandas_all, aggregate_pandas_all
import pyarrow as pa

# Define schema for your collection
schema = Schema({
    'user_id': pa.string(),
    'event_type': pa.string(),
    'amount': pa.float64(),
    'timestamp': pa.timestamp('ms'),
    'metadata': pa.struct([
        ('device', pa.string()),
        ('country', pa.string())
    ])
})</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Fast Query â†’ Pandas</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Method 1: find_pandas_all (10-50x faster than list(cursor))
df = find_pandas_all(
    collection,
    {"event_type": "purchase"},
    schema=schema
)

print(f"Loaded {len(df)} rows in milliseconds!")
print(df.head())

# Method 2: Aggregation with PyMongoArrow
pipeline = [
    {"$match": {"timestamp": {"$gte": datetime.utcnow() - timedelta(days=30)}}},
    {"$project": {
        "user_id": 1,
        "event_type": 1,
        "amount": 1,
        "timestamp": 1,
        "metadata.device": 1,
        "metadata.country": 1
    }}
]

df = aggregate_pandas_all(collection, pipeline, schema=schema)
print(f"Aggregated {len(df)} rows")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Performance Comparison</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">import time

# Standard PyMongo (slow for large datasets)
start = time.time()
cursor = collection.find({"event_type": "purchase"}).limit(100000)
df_slow = pd.DataFrame(list(cursor))
slow_time = time.time() - start

# PyMongoArrow (fast)
start = time.time()
df_fast = find_pandas_all(
    collection,
    {"event_type": "purchase"},
    schema=schema,
    limit=100000
)
fast_time = time.time() - start

print(f"PyMongo: {slow_time:.2f}s")
print(f"PyMongoArrow: {fast_time:.2f}s")
print(f"Speedup: {slow_time/fast_time:.1f}x faster!")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Write DataFrame to MongoDB (Fast)</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">from pymongoarrow.api import write

# Create large DataFrame
df = pd.DataFrame({
    'user_id': [f'user_{i}' for i in range(100000)],
    'amount': np.random.uniform(10, 1000, 100000),
    'timestamp': pd.date_range('2024-01-01', periods=100000, freq='1min')
})

# Fast write using PyMongoArrow
write(collection, df)
print(f"Wrote {len(df)} documents in seconds!")</div>
        </div>
                    </div>
                </section>

                <!-- Section 5: Window Functions -->
                <section id="api-window">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" /></svg>
                        <h3 class="text-2xl font-bold">Window Functions (MongoDB 5.0+)</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <h4 class="text-white font-semibold mb-3">Running Totals & Moving Averages</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">pipeline = [
    {"$setWindowFields": {
        "partitionBy": "$user_id",  # Separate window per user
        "sortBy": {"timestamp": 1},
        "output": {
            # Running total of purchases
            "cumulative_spent": {
                "$sum": "$amount",
                "window": {"documents": ["unbounded", "current"]}
            },
            # 7-day moving average
            "moving_avg_7d": {
                "$avg": "$amount",
                "window": {"range": [-7, 0], "unit": "day"}
            },
            # Row number (rank)
            "purchase_number": {
                "$documentNumber": {}
            }
        }
    }},
    {"$match": {"purchase_number": {"$lte": 10}}}  # First 10 purchases per user
]

df = pd.DataFrame(list(collection.aggregate(pipeline)))
print(df[['user_id', 'amount', 'cumulative_spent', 'moving_avg_7d', 'purchase_number']])</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Ranking & Percentiles</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Rank users by total spending
pipeline = [
    {"$group": {
        "_id": "$user_id",
        "total_spent": {"$sum": "$amount"},
        "purchase_count": {"$sum": 1}
    }},
    {"$setWindowFields": {
        "sortBy": {"total_spent": -1},
        "output": {
            # Dense rank (no gaps)
            "rank": {"$denseRank": {}},
            # Percentile
            "percentile": {
                "$percentile": {
                    "input": "$total_spent",
                    "p": [0.5, 0.75, 0.9, 0.95],
                    "method": "approximate"
                }
            }
        }
    }},
    {"$limit": 100}  # Top 100 spenders
]

top_users = pd.DataFrame(list(collection.aggregate(pipeline)))
print(top_users)</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Lead/Lag (Compare with Previous/Next Row)</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Calculate time between purchases
pipeline = [
    {"$match": {"user_id": "user_12345"}},
    {"$sort": {"timestamp": 1}},
    {"$setWindowFields": {
        "sortBy": {"timestamp": 1},
        "output": {
            # Previous purchase timestamp
            "prev_timestamp": {
                "$shift": {
                    "output": "$timestamp",
                    "by": -1
                }
            },
            # Next purchase amount
            "next_amount": {
                "$shift": {
                    "output": "$amount",
                    "by": 1
                }
            }
        }
    }},
    {"$addFields": {
        # Days since last purchase
        "days_since_last": {
            "$divide": [
                {"$subtract": ["$timestamp", "$prev_timestamp"]},
                1000 * 60 * 60 * 24
            ]
        }
    }}
]

df = pd.DataFrame(list(collection.aggregate(pipeline)))
print(df[['timestamp', 'amount', 'prev_timestamp', 'days_since_last', 'next_amount']])</div>
        </div>
                    </div>
                </section>

                <!-- Section 6: Advanced Patterns -->
                <section id="api-advanced">
                    <div class="flex items-center text-[--mongo-green] mb-3">
                        <svg class="card-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                        <h3 class="text-2xl font-bold">Advanced Patterns</h3>
                    </div>
                    
                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border] mb-6">
                        <h4 class="text-white font-semibold mb-3">Cohort Analysis</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># User cohorts by signup month
pipeline = [
    {"$addFields": {
        "signup_month": {"$dateToString": {"format": "%Y-%m", "date": "$created_at"}},
        "purchase_month": {"$dateToString": {"format": "%Y-%m", "date": "$timestamp"}}
    }},
    {"$group": {
        "_id": {
            "signup_month": "$signup_month",
            "purchase_month": "$purchase_month"
        },
        "users": {"$addToSet": "$user_id"},
        "revenue": {"$sum": "$amount"}
    }},
    {"$project": {
        "signup_month": "$_id.signup_month",
        "purchase_month": "$_id.purchase_month",
        "user_count": {"$size": "$users"},
        "revenue": 1,
        "_id": 0
    }},
    {"$sort": {"signup_month": 1, "purchase_month": 1}}
]

cohort_df = pd.DataFrame(list(collection.aggregate(pipeline)))

# Pivot for cohort matrix
cohort_matrix = cohort_df.pivot(
    index='signup_month',
    columns='purchase_month',
    values='user_count'
).fillna(0)

print(cohort_matrix)</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Time-Series Bucketing</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm"># Aggregate events into 1-hour buckets
pipeline = [
    {"$match": {"timestamp": {"$gte": datetime.utcnow() - timedelta(days=1)}}},
    {"$bucket": {
        "groupBy": "$timestamp",
        "boundaries": [
            datetime.utcnow() - timedelta(hours=i) 
            for i in range(24, -1, -1)
        ],
        "default": "Other",
        "output": {
            "count": {"$sum": 1},
            "total_amount": {"$sum": "$amount"},
            "unique_users": {"$addToSet": "$user_id"}
        }
    }},
    {"$project": {
        "hour": "$_id",
        "count": 1,
        "total_amount": 1,
        "unique_users": {"$size": "$unique_users"}
    }}
]

hourly_df = pd.DataFrame(list(collection.aggregate(pipeline)))
print(hourly_df)</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Change Streams (Real-Time)</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">import threading

# Watch for changes in real-time
def watch_collection():
    with collection.watch() as stream:
        for change in stream:
            if change['operationType'] == 'insert':
                doc = change['fullDocument']
                print(f"New event: {doc['event_type']} by {doc['user_id']}")
            elif change['operationType'] == 'update':
                print(f"Updated document: {change['documentKey']}")

# Run in background thread
watcher_thread = threading.Thread(target=watch_collection, daemon=True)
watcher_thread.start()

# Your main application continues...
print("Watching for changes...")</div>
        </div>

                        <h4 class="text-white font-semibold mb-3 mt-6">Batch Processing Pattern</h4>
                        <div class="code-container">
            <button class="copy-button" onclick="copyCode(this)">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                Copy
            </button>
            <div class="code-block text-sm">from pymongo import UpdateOne
from datetime import datetime

def process_batch(batch_size=1000):
    """Process unprocessed events in batches"""
    while True:
        # Find unprocessed events
        cursor = collection.find(
            {"processed": {"$ne": True}},
            limit=batch_size
        )
        
        events = list(cursor)
        if not events:
            break
        
        # Process events (example: calculate metrics)
        bulk_ops = []
        for event in events:
            # Your processing logic here
            metrics = calculate_metrics(event)
            
            bulk_ops.append(UpdateOne(
                {"_id": event["_id"]},
                {
                    "$set": {
                        "processed": True,
                        "processed_at": datetime.utcnow(),
                        "metrics": metrics
                    }
                }
            ))
        
        # Bulk update
        if bulk_ops:
            result = collection.bulk_write(bulk_ops, ordered=False)
            print(f"Processed {result.modified_count} events")

def calculate_metrics(event):
    # Your metric calculation logic
    return {"score": 100}

# Run batch processing
process_batch()</div>
        </div>
                    </div>

                    <div class="bg-[--mongo-card-accent] p-6 rounded-lg border border-[--mongo-border]">
                        <h4 class="text-white font-semibold mb-3">ðŸ“š Additional Resources</h4>
                        <div class="flex flex-wrap gap-2">
                            <a href="https://pymongo.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-green] hover:text-black text-[--mongo-green] border border-[--mongo-green] rounded-full transition-all">PyMongo Docs</a>
                            <a href="https://mongo-arrow.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-green] hover:text-black text-[--mongo-green] border border-[--mongo-green] rounded-full transition-all">PyMongoArrow Docs</a>
                            <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/setWindowFields/" target="_blank" rel="noopener noreferrer" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-green] hover:text-black text-[--mongo-green] border border-[--mongo-green] rounded-full transition-all">Window Functions Reference</a>
                            <a href="https://www.mongodb.com/docs/drivers/python/" target="_blank" rel="noopener noreferrer" class="text-xs px-3 py-1.5 bg-[--mongo-card] hover:bg-[--mongo-green] hover:text-black text-[--mongo-green] border border-[--mongo-green] rounded-full transition-all">Python Driver Guide</a>
                        </div>
                    </div>
                </section>
            </div>
            
        </div>
    </main>

    </main>
    
    <script>
        // Sidebar Navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                const tab = item.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`tab-${tab}`)?.classList.add('active');
            });
        });
        
        // Scroll Progress
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('scrollProgress').style.width = scrolled + '%';
        });
        
        // Copy Code Function
        function copyCode(button) {
            const codeBlock = button.nextElementSibling;
            const code = codeBlock.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                button.classList.add('copied');
                button.innerHTML = `
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Copied!
                `;
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = `
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Copy
                    `;
                }, 2000);
            });
        }
        
        
        // Search Functionality
        const searchInput = document.getElementById('searchInput');
        let searchTimeout;
        
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    // Reset all highlights and visibility
                    document.querySelectorAll('.search-highlight').forEach(el => {
                        el.classList.remove('search-highlight');
                    });
                    document.querySelectorAll('section, .expandable-box, p, li, h3, h4, h5').forEach(el => {
                        el.style.display = '';
                    });
                    return;
                }
                
                // Search through all content
                const activeTab = document.querySelector('.tab-content.active');
                if (!activeTab) return;
                
                const searchableElements = activeTab.querySelectorAll('section, p, li, h3, h4, h5, .expandable-box summary, .code-block');
                let hasResults = false;
                
                searchableElements.forEach(el => {
                    const text = el.textContent.toLowerCase();
                    const parent = el.closest('section') || el.closest('.expandable-box');
                    
                    if (text.includes(searchTerm)) {
                        hasResults = true;
                        if (parent) parent.style.display = '';
                        el.style.display = '';
                        
                        // Highlight matching text
                        if (!el.classList.contains('code-block')) {
                            const regex = new RegExp(`(${searchTerm})`, 'gi');
                            const originalHTML = el.innerHTML;
                            if (!originalHTML.includes('<')) { // Only for text nodes
                                el.innerHTML = originalHTML.replace(regex, '<mark class="search-highlight">$1</mark>');
                            }
                        }
                    }
                });
                
                // Show "no results" message if needed
                if (!hasResults) {
                    console.log('No results found for:', searchTerm);
                }
            }, 300); // Debounce for 300ms
        });
        
        // Search Keyboard Shortcut (Cmd+K)
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
        });
        
        // Mobile Menu Toggle
        document.getElementById('mobileMenuToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });
        
        // Cross-tab navigation (from original file)
        function navigateToSection(targetId) {
            const element = document.getElementById(targetId);
            if (!element) return;
            
            const tabContent = element.closest('.tab-content');
            if (tabContent) {
                const tabId = tabContent.id.replace('tab-', '');
                document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                    if (item.dataset.tab === tabId) {
                        item.click();
                    }
                });
                
                setTimeout(() => {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        // Handle anchor links
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && e.target.hash) {
                const targetId = e.target.hash.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    e.preventDefault();
                    navigateToSection(targetId);
                }
            }
        });
    </script>
</body>
</html>